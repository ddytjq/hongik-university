ID=E0152
URL=http://www.gotw.ca/gotw/073.htm
SIZE=46131
DATE=12/07/02
TIME=19:18:05
DATASET=C
HTML=
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">


<title>GotW #73: Style Case Study #1 - Index Tables</title>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="stylesheet" type="text/css" href="../gotw.css">
<meta name="Microsoft Theme" content="gotw 111, default">
<meta name="Microsoft Border" content="tlb, default">
</head>

<body background="../_themes/gotw/glabkgnd.jpg" bgcolor="#CCFFFF" text="#000000" link="#008080" vlink="#008080" alink="#0000FF"  ><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font><table border="0" cellspacing="0" width="100%">
  <tr>
    <td colspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica"><font size="6"><strong>
    GotW #73</strong></font> <!--mstheme--></font></td>
  </tr>
  <tr>
    <td valign="middle"><!--mstheme--><font face="Arial, Arial, Helvetica">




<p align="left" style="margin-top: 0; margin-bottom: 0">

<script language="JavaScript"><!--
MSFPhover = 
  (((navigator.appName == "Netscape") && 
  (parseInt(navigator.appVersion) >= 3 )) || 
  ((navigator.appName == "Microsoft Internet Explorer") && 
  (parseInt(navigator.appVersion) >= 4 ))); 
function MSFPpreload(img) 
{
  var a=new Image(); a.src=img; return a; 
}
// --></script><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav1n=MSFPpreload("../_derived/home_cmp_gotw110_hbtn.gif"); MSFPnav1h=MSFPpreload("../_derived/home_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1h.src" onmouseout="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1n.src"><img src="../_derived/home_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Home" align="middle" name="MSFPnav1"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav2n=MSFPpreload("../_derived/news.htm_cmp_gotw110_hbtn.gif"); MSFPnav2h=MSFPpreload("../_derived/news.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../news.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2h.src" onmouseout="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2n.src"><img src="../_derived/news.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="News &amp; Events" align="middle" name="MSFPnav2"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav3n=MSFPpreload("../resources/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav3h=MSFPpreload("../resources/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../resources/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3h.src" onmouseout="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3n.src"><img src="../resources/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Community Resources" align="middle" name="MSFPnav3"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav4n=MSFPpreload("../_derived/consulting.htm_cmp_gotw110_hbtn.gif"); MSFPnav4h=MSFPpreload("../_derived/consulting.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../consulting.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4h.src" onmouseout="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4n.src"><img src="../_derived/consulting.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Consulting Services" align="middle" name="MSFPnav4"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav5n=MSFPpreload("../_derived/presentations.htm_cmp_gotw110_hbtn.gif"); MSFPnav5h=MSFPpreload("../_derived/presentations.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../presentations.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5h.src" onmouseout="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5n.src"><img src="../_derived/presentations.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Presentations" align="middle" name="MSFPnav5"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav6n=MSFPpreload("../publications/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav6h=MSFPpreload("../publications/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../publications/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6h.src" onmouseout="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6n.src"><img src="../publications/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Publications" align="middle" name="MSFPnav6"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav7n=MSFPpreload("_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav7h=MSFPpreload("_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7h.src" onmouseout="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7n.src"><img src="_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Guru of the Week" align="middle" name="MSFPnav7"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav8n=MSFPpreload("../conv/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav8h=MSFPpreload("../conv/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../conv/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8h.src" onmouseout="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8n.src"><img src="../conv/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Conversations" align="middle" name="MSFPnav8"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav9n=MSFPpreload("../_derived/search.htm_cmp_gotw110_hbtn.gif"); MSFPnav9h=MSFPpreload("../_derived/search.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../search.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav9'].src=MSFPnav9h.src" onmouseout="if(MSFPhover) document['MSFPnav9'].src=MSFPnav9n.src"><img src="../_derived/search.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Search GotW.ca" align="middle" name="MSFPnav9"></a>
</p>




    <!--mstheme--></font></td>
    <td valign="middle"><!--mstheme--><font face="Arial, Arial, Helvetica">
      <p style="margin-top: 0; margin-bottom: 0">
      <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav10n=MSFPpreload("../_derived/back_cmp_gotw110_back.gif"); MSFPnav10h=MSFPpreload("../_derived/back_cmp_gotw110_back_a.gif"); }
// --></script><a href="072.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav10'].src=MSFPnav10h.src" onmouseout="if(MSFPhover) document['MSFPnav10'].src=MSFPnav10n.src"><img src="../_derived/back_cmp_gotw110_back.gif" width="100" height="20" border="0" alt="Prev" name="MSFPnav10"></a><br><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav11n=MSFPpreload("../_derived/up_cmp_gotw110_up.gif"); MSFPnav11h=MSFPpreload("../_derived/up_cmp_gotw110_up_a.gif"); }
// --></script><a href="index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav11'].src=MSFPnav11h.src" onmouseout="if(MSFPhover) document['MSFPnav11'].src=MSFPnav11n.src"><img src="../_derived/up_cmp_gotw110_up.gif" width="100" height="20" border="0" alt="Up" name="MSFPnav11"></a><br><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav12n=MSFPpreload("../_derived/next_cmp_gotw110_next.gif"); MSFPnav12h=MSFPpreload("../_derived/next_cmp_gotw110_next_a.gif"); }
// --></script><a href="074.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav12'].src=MSFPnav12h.src" onmouseout="if(MSFPhover) document['MSFPnav12'].src=MSFPnav12n.src"><img src="../_derived/next_cmp_gotw110_next.gif" width="100" height="20" border="0" alt="Next" name="MSFPnav12"></a><!--mstheme--></font></td>
  </tr>
  <tr>
    <td height="5" background="../images/bar.gif" colspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica">&nbsp;<!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font></td></tr><!--msnavigation--></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" width="1%"><!--mstheme--><font face="Arial, Arial, Helvetica">

<!--mstheme--></font><table border="0" cellspacing="0" bgcolor="#000000" cellpadding="0">
  <tr>
    <td><!--mstheme--><font face="Arial, Arial, Helvetica">
    <!--mstheme--></font><table border="0" cellpadding="2" cellspacing="1" width="100%" height="483">
        <tr>
          <td align="center" bgcolor="#000000" colspan="2" height="16"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin-top: 0; margin-bottom: 0"><a href="../news.htm"><b><font color="#FFFF00">News</font></b></a><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="3"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <font size="1" color="#0000FF">J<br>
          U<br>
          L<br>
          Y</font><!--mstheme--></font></td>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin-left: 3; margin-right: 3; margin-top: 0" align="center"><font size="1" color="#0000FF">
            Print articles newly available online</font><!--mstheme--></font><table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber1" bgcolor="#FFFFCC" bordercolordark="#006666" bordercolorlight="#99CCCC">
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mill20.htm"><b><i>
                <font color="#0000FF">Sutter's Mill</font></i></b><font color="#0000FF"> 
                column, &quot;Toward a Standard C++ Library, Part 1&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000" bgcolor="#FFFFCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mxc++-item-4.htm">
                <font color="#0000FF">Excerpt from MXC++, &quot;Extensible Templates: 
                Via Inheritance or Traits?&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mcd_review.htm"><font color="#0000FF">
                Book Review: Modern C++ Design</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mill21.htm"><b><i>
                <font color="#0000FF">Sutter's Mill</font></i></b><font color="#0000FF"> 
                column, &quot;Toward a Standard C++ Library, Part 2: Namespaceops and 
                Library Versioning&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
            </table><!--mstheme--><font face="Arial, Arial, Helvetica">
          <!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3"><font size="1" color="#0000FF"><b><i>Sutter's 
            Mill</i></b> column,
            &quot;A Pragmatic Look at Exception Specifications&quot;<br>
            </font><font size="1" color="#000080">The usefulness, or lack 
            thereof, of exception specifications, and how results can vary 
            across real-world compilers</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3">
            <a target="_blank" href="http://www.cuj.com/experts/2007/hyslop.htm"><font size="1" color="#0000FF"><i><b>Conversations</b></i> column,
            &quot;Getting to the Point&quot;</font></a><font color="#0000FF" size="1"><br>
            </font><font size="1" color="#000080">The Boost library has five 
            smart pointers that provide a rich array [sic] of useful behaviors.</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica"><font color="#0000FF" size="1">A<br>
            U<br>
          G<br>
          U<br>
          S<br>
          T</font><!--mstheme--></font></td>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin:0 3; ">
            <a target="_blank" href="http://www.cuj.com/experts/2008/sutter.htm"><i><b><font size="1" color="#0000FF">The New C++</font></b></i> <font size="1" color="#0000FF">
            column, &quot;Smart(er) Pointers&quot;</font></a><font size="1" color="#000080"><br>
            A closer look at one of the proposed new standard C++ library 
            features -- smart pointers, particularly those in Boost and Loki, 
            and a sneak peek at the usefulness of the proposed typedef templates</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <p style="margin:0 3; ">
          <a target="_blank" href="http://www.cuj.com/experts/2008/hyslop.htm"><font size="1" color="#0000FF"><i><b>Conversations</b></i> column,
            &quot;A Midsummer Night's Madness&quot;</font></a><font color="#0000FF" size="1"><br>
            </font><font size="1" color="#000080">A brew that mixes pointers, 
          typedefs, and const</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="3"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <p style="margin-top: 0; margin-bottom: 0">
          <font size="1" color="#0000FF">S<br>
          E<br>
          P<br>
          T<br>
          E<br>
          M<br>
          B<br>
          E<br>
          R</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3">
            <font size="1" color="#0000FF">&quot;Standard C++ Meets Managed C++&quot;<br>
            </font><font size="1" color="#000080">A survey of the main (in)compatibilities 
            between Standard C++ and Microsoft’s managed extensions for C++, and 
            how the two could converge</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3"><font size="1" color="#0000FF"><b><i>Sutter's 
            Mill</i></b> column,
            &quot;Export Restrictions, Part 1&quot;<br>
            </font><font size="1" color="#000080">The scoop on export -- what 
            some people think it does, what it actually does, and why it’s the 
            most widely-ignored feature in the C++ standard</font><!--mstheme--></font></td>
        </tr>
      </table><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica">
<p style="margin-top: 0; margin-bottom: 0">
<img border="0" src="../images/140.gif" width="140" height="1"></p>

<!--mstheme--></font></td><td valign="top" width="24"></td><!--msnavigation--><td valign="top"><!--mstheme--><font face="Arial, Arial, Helvetica">
      <h2><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Style Case Study #1: Index Tables&nbsp;<font size="3"><br>
      Difficulty: 5 / 10</font><!--mstheme--></font></h2>
<p><i>This GotW introduces a new theme that we'll see again from time to time in
future Style Case Study issues: We examine a piece of published code, critique
it to illustrate proper coding style, and develop an improved version. You may
be amazed at just how much can be done even with code that has been written,
vetted, and proofread by experts.</i></p>
<p align="center"><img border="0" src="../images/h-line.gif" width="248" height="2"></p>

<h3><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Problem<!--mstheme--></font></h3>

<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">JG Question<!--mstheme--></font></h4>
<p><b><font size="4">1.</font></b>   Who benefits from clear, understandable
code?</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Guru Question<!--mstheme--></font></h4>
<p><b><font size="4">2.</font></b>   The following code presents an interesting
and genuinely useful idiom for creating index tables into existing containers.
For a more detailed explanation, see the original article.<b><sup><a href="#1">[1]</a></sup></b></p>
<p>Critique this code and identify:</p>
<blockquote>
  <p>a) Mechanical errors, such as invalid syntax or nonportable conventions.</p>
  <p>b) Stylistic improvements that would improve code clarity, reusability, and
  maintainability.</p>
  <p><font face="Courier New"><code>// program sort_idxtbl(...) to make a
  permuted array of indices<br>
  #include &lt;vector&gt;<br>
  #include &lt;algorith&gt;<br>
  <br>
  template &lt;class RAIter&gt;<br>
  struct sort_idxtbl_pair<br>
  {<br>
  &nbsp; RAIter it;<br>
  &nbsp; int i;<br>
  &nbsp; bool operator&lt;( const sort_idxtbl_pair&amp; s )<br>
  &nbsp;&nbsp;&nbsp; { return (*it) &lt; (*(s.it)); }<br>
  &nbsp; void set( const RAIter&amp; _it, int _i ) { it=_it; i=_i; }<br>
  &nbsp; sort_idxtbl_pair() {}<br>
  };<br>
  <br>
  template &lt;class RAIter&gt;<br>
  void sort_idxtbl( RAIter first, RAIter last, int* pidxtbl )<br>
  {<br>
  &nbsp; int iDst = last-first;<br>
  &nbsp; typedef std::vector&lt; sort_idxtbl_pair&lt;RAIter&gt; &gt; V;<br>
  &nbsp; V v( iDst );<br>
  <br>
  &nbsp; int i=0;<br>
  &nbsp; RAIter it = first;<br>
  &nbsp; V::iterator vit = v.begin();<br>
  &nbsp; for( i=0; it&lt;last; it++, vit++, i++ )<br>
  &nbsp;&nbsp;&nbsp; (*vit).set(it,i);<br>
  <br>
  &nbsp; std::sort(v.begin(), v.end());<br>
  <br>
  &nbsp; int *pi = pidxtbl;<br>
  &nbsp; vit = v.begin();<br>
  &nbsp; for( ; vit&lt;v.end(); pi++, vit++ )<br>
  &nbsp;&nbsp;&nbsp; *pi = (*vit).i;<br>
  }<br>
  <br>
  main()<br>
  {<br>
  &nbsp; int ai[10] = { 15,12,13,14,18,11,10,17,16,19 };<br>
  <br>
  &nbsp; cout &lt;&lt; &quot;#################&quot; &lt;&lt; endl;<br>
  &nbsp; std::vector&lt;int&gt; vecai(ai, ai+10);<br>
  &nbsp; int aidxtbl[10];<br>
  &nbsp; sort_idxtbl(vecai.begin(), vecai.end(), aidxtbl);<br>
  <br>
  &nbsp; for (int i=0; i&lt;10; i++)<br>
  &nbsp; cout &lt;&lt; &quot;i=&quot; &lt;&lt; i<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt; &quot;, aidxtbl[i]=&quot;
  &lt;&lt; aidxtbl[i]<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt; &quot;, ai[aidxtbl[i]]=&quot;
  &lt;&lt; ai[aidxtbl[i]]<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt; endl;<br>
  &nbsp; cout &lt;&lt; &quot;#################&quot; &lt;&lt; endl;<br>
  </code></font><code><font face="Courier New">}</font></code></p>
</blockquote>
<p align="center"><img border="0" src="../images/h-line.gif" width="248" height="2"></p>
<h3><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666"><a name="Solution"></a>Solution<!--mstheme--></font></h3>

<p><font color="#999933"><b><font size="4">1.</font></b>   Who benefits from clear, understandable
code?</font></p>
<p>In short, just about everyone benefits.</p>
<p>First, clear code is easier to follow while debugging, and for that matter is
less likely to have as many bugs in the first place, so writing clean code makes
your own life easier even in the very short term. (For a case in point, see the <a href="072.htm">GotW
#72</a> solution for Question 3.<b><a href="#2"><sup>[2]</sup></a></b>) Further,
when you return to the code a month or a year later -- as you surely will if the
code is any good and is actually being used -- then it's much easier to pick it
up again and understand what's going on. Most programmers find it difficult to
keep full details of code in their heads for even a few weeks, especially after
having moved on to other work; after a few months, or even a few years, it's too
easy to go back to your own code and imagine it was written by a stranger --
albeit a stranger who curiously happened to follow your personal coding style.</p>
<p>But enough about selfishness. Let's turn to altruism: Those who have to
maintain your code also benefit from clarity and readability. After all, to
maintain code well one must first grok the code. &quot;To grok,&quot; as coined
by Robert Heinlein, means to comprehend deeply and fully; in this case, that
includes understanding the internal workings of the code itself, as well as its
side effects and interactions with other subsystems. It is altogether too easy
to introduce new errors when changing code one does not fully understand. Code
that is clear and understandable is easier to grok, and therefore fixes to such
code become less fragile, less risky, less likely to have unintended side
effects.</p>
<p>Most importantly, however, your end users benefit from clear and
understandable code for all of the above reasons: Such code is likely to have
had fewer initial bugs in the first place, and it's likely to have been be
maintained more correctly without as many new bugs being introduced.</p>
<p><font color="#999933"><b><font size="4">2.</font></b>   The following code presents an interesting
and genuinely useful idiom for creating index tables into existing containers.
For a more detailed explanation, see the original article.<b><sup><a href="#1">[1]</a></sup></b></font></p>
<p><font color="#999933">Critique this code and identify:</font></p>
<p>Again, let me repeat that which bears repeating: This code presents an
interesting and genuinely useful idiom. I've frequently found it necessary to
access the same container in different ways, such as using different sort
orders. For this reason it can be useful indeed to have one principal container
that holds the data (for example, a <code>vector&lt;Employee&gt;</code>) and
secondary containers <i>of iterators</i> into the main container that support
variant access methods (for example, a <code>set&lt;vector&lt;Employee&gt;::iterator,
Funct&gt;</code> where <code>Funct</code> is a functor that compares <code>Employee</code>
objects indirectly yielding a different ordering than the order in which the
objects are physically stored in the <code>vector</code>).</p>
<p>Having said that, style matters too. The original author has kindly allowed
me to use his code as a case in point, and I'm not trying to pick on him here;
I'm just adopting the technique, pioneered long ago by luminaries like P.J.
Plauger, of expounding coding style guidelines via the dissection and critique
of published code. I've critiqued other published material before, have had
other people critique my own, and I'm positive that further dissections will no
doubt follow.</p>
<p>Having said <i>all</i> that, let's see what we might be able to improve in
this particular piece of code:</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Correcting Mechanical Errors<!--mstheme--></font></h4>
<blockquote>
  <p><font color="#999933">a) Mechanical errors, such as invalid syntax or
  nonportable conventions.</font></p>
</blockquote>
<p>The first area for constructive criticism is mechanical errors in the code,
which on most platforms won't compile as shown.</p>
<blockquote>
  <p class="code"><font face="Courier New" color="#999933"><code>#include
  &lt;algorith&gt;</code></font></p>
</blockquote>
<p>1. Spell standard headers correctly: Here the header <code>&lt;algorithm&gt;</code>
is misspelled as <code>&lt;algorith&gt;</code>. My first guess was that this is
probably an artifact of an 8-character file system used to test the original
code, but even my old version of MSVC on an old version of Windows (based on the
8.3 filename system) rejected this code. Anyway, it's not standard, and even on
hobbled file systems the compiler itself is required to support any standard
long header names even if it silently maps it onto a shorter filename (or onto
no file at all).</p>
<blockquote>
  <p><font face="Courier New" color="#999933"><code><br>
  main()</code></font></p>
</blockquote>
<p>2. Define <code>main()</code> correctly: The signature &quot;<code>main()</code>&quot;
has never been valid C++. That used to be valid in pre-1999 C, which had an
implicit <code>int</code> rule, but it's nonstandard in both C++ (which never
had implicit <code>int</code>) and C99 (which as far as I can tell didn't merely
deprecate implicit <code>int</code>, but actually removed it outright). In the
C++ standard, see:</p>
<!--mstheme--></font><!--msthemelist--><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="../_themes/gotw/aglabul1.gif" width="15" height="15" hspace="13" alt="bullet"></td><td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">
    <p style="margin-top: 0; margin-bottom: 6">3.6.1/2: portable code must
    define <code>main()</code> as either &quot;<code>int main()</code>&quot; or
    &quot;<code>int main( int, char*[] )</code>&quot;<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="../_themes/gotw/aglabul1.gif" width="15" height="15" hspace="13" alt="bullet"></td><td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">
    <p style="margin-top: 0; margin-bottom: 6">7/7 footnote 78, and 7.1.5/2
    footnote 80: implicit <code>int</code> banned<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="../_themes/gotw/aglabul1.gif" width="15" height="15" hspace="13" alt="bullet"></td><td valign="top" width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">
    <p style="margin-top: 0; margin-bottom: 6">Annex C (Compatibility), comment
    on 7.1.5/4: explicitly notes that &quot;<code>main()</code>&quot; is invalid
    C++, and must be written &quot;<code>int main()</code>&quot;<!--mstheme--></font><!--msthemelist--></td></tr>
<!--msthemelist--></table><!--mstheme--><font face="Arial, Arial, Helvetica">
<blockquote>
  <p><font face="Courier New" color="#999933"><code><br>
  &nbsp; cout &lt;&lt; &quot;#################&quot; &lt;&lt; endl;
  </code></font></p>
</blockquote>
<p>3. Always <code>#include</code> the headers for the types whose definitions
you need: The program uses <code>cout</code> and <code>endl</code>, but fails to
<code>#include &lt;iostream&gt;</code>. Why did this probably work on the
original developer's system? Because C++ standard headers can <code>#include</code>
each other, but unlike C, C++ does not specify which standard headers <code>#include</code>
which other standard headers.</p>
<p>In this case, the program does <code>#include &lt;vector&gt;</code> and <code>&lt;algorithm&gt;</code>,
and on the original system it probably just so happened that one of those
headers happened to indirectly <code>#include &lt;iostream&gt;</code> too. That
may work on the library implementation used to develop the original code, and it
happens to work on mine too, but it's not portable and not good style.</p>
<p>4. Follow the guidelines in my <i>Migrating to Namespaces</i> article<b><sup><a href="#3">[3]</a></sup></b>
about using namespaces: Speaking of <code>cout</code> and <code>endl</code>, the
program must also qualify them with <code>std::</code>, or write &quot;<code>using
std::cout; using std::endl;</code>&quot;. Unfortunately it's still common for
authors to forget namespace scope qualifiers -- I hasten to point out that this
author did correctly scope <code>vector</code> and <code>sort</code>.</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Improving Style<!--mstheme--></font></h4>
<blockquote>
  <p><font color="#999933">b) Stylistic improvements that would improve code
  clarity, reusability, and maintainability.</font></p>
</blockquote>

<p>Beyond the above mechanical errors, there were several things I personally
would have done differently in the code example. First, a couple of comments
about the helper struct:</p>

<blockquote>
  <p><font face="Courier New"><code>
  template &lt;class RAIter&gt;<br>
  struct sort_idxtbl_pair<br>
  {<br>
  &nbsp; RAIter it;<br>
  &nbsp; int i;<br>
  &nbsp; bool operator&lt;( const sort_idxtbl_pair&amp; s )<br>
  &nbsp;&nbsp;&nbsp; { return (*it) &lt; (*(s.it)); }<br>
  &nbsp; void set( const RAIter&amp; _it, int _i ) { it=_it; i=_i; }<br>
  &nbsp; sort_idxtbl_pair() {}<br>
  };
  </code></font></p>
</blockquote>

<p>5. Be const-correct: In particular, <code>sort_idxtbl_pair::operator&lt;()</code>
doesn't modify <code>*this</code>, so it ought to be declared as a <code>const</code>
member function.</p>
<p>6. Remove redundant code: The program explicitly writes class <code>sort_idxtbl_pair</code>'s
default constructor even though it's no different from the implicitly generated
version. There doesn't seem to be much point to this. Also, as long as <code>sort_idxbl_pair</code>
is a <code>struct</code> with public data, having a distinct <code>set()</code>
operation adds a little syntactic sugar but since it's only called in one place
the minor extra complexity doesn't gain much.</p>
<p>Next, we come to the core function, <code>sort_idxtbl()</code>:</p>

<blockquote>
  <p><font face="Courier New"><code>template &lt;class RAIter&gt;<br>
  void sort_idxtbl( RAIter first, RAIter last, int* pidxtbl )<br>
  {<br>
  &nbsp; int iDst = last-first;<br>
  &nbsp; typedef std::vector&lt; sort_idxtbl_pair&lt;RAIter&gt; &gt; V;<br>
  &nbsp; V v( iDst );<br>
  <br>
  &nbsp; int i=0;<br>
  &nbsp; RAIter it = first;<br>
  &nbsp; V::iterator vit = v.begin();<br>
  &nbsp; for( i=0; it&lt;last; it++, vit++, i++ )<br>
  &nbsp;&nbsp;&nbsp; (*vit).set(it,i);<br>
  <br>
  &nbsp; std::sort(v.begin(), v.end());<br>
  <br>
  &nbsp; int *pi = pidxtbl;<br>
  &nbsp; vit = v.begin();<br>
  &nbsp; for( ; vit&lt;v.end(); pi++, vit++ )<br>
  &nbsp;&nbsp;&nbsp; *pi = (*vit).i;<br>
  }
  </code></font></p>
</blockquote>

<p>7. Choose meaningful and appropriate names: In this case, <code>sort_idxtbl</code>
is a misleading name because the function doesn't sort an index table... it
creates one! On the other hand, the code gets good marks for using the template
parameter name <code>RAIter</code> to indicate a random access iterator, which
is what's required in this version of the code and so naming the parameter to
indicate this is a good reminder.</p>
<p>8. Be consistent: In the function above, sometimes variables are initialized
(or set) in for-init-statements, and sometimes they aren't. This just makes
things harder to read, at least for me. Your mileage may vary on this one.</p>
<p>9. Remove gratuitous complexity: This function adores gratuitous local
variables! It contains three examples. First, the variable <code>iDst</code> is
initialized to <code>last-first</code>, and then used only once; why not just
write <code>last-first</code> where it's used and get rid of clutter? Second,
the <code>vector</code> iterator <code>vit</code> is created where a subscript
was already available and could have been used just as well, and the code would
have been clearer. Third, the local variable <code>it</code> gets initialized to
the value of a function parameter, after which the function parameter is never
used; my personal preference in that case is just to use the function parameter
(even if you change its value -- that's okay!) instead of introducing another
name.</p>
<p>10. Reuse Part 1: Reuse more of the standard library. Now, the original
program gets good marks for reusing <code>std::sort()</code> -- that's good. But
why handcraft that final loop to perform a copy when <code>std::copy()</code>
does the same thing? Why reinvent a special-purpose <code>sort_idxtbl_pair</code>
class when the only thing it has that <code>std::pair</code> doesn't is a
comparison function? Besides being easier, reuse also makes our own code more
readable. Humble thyself and reuse!</p>
<p>11. Reuse Part 2: Kill two birds with one stone by making the implementation
itself more reusable. Of the original implementation, nothing is directly
reusable other than the function itself. The helper <code>sort_idxtbl_pair</code>
class is hardwired for its purpose and is not independently reusable.</p>
<p>12. Reuse Part 3: Improve the signature. The original signature</p>
<blockquote>
  <p><font face="Courier New"><code>
  template &lt;class RAIter&gt;<br>
  void sort_idxtbl( RAIter first, RAIter last, int* pidxtbl )
  </code></font></p>
</blockquote>
<p>takes a bald <code>int*</code> pointer to the output area, which I generally
try to avoid in favor of managed storage (say, a <code>vector</code>). But at
the end of the day the user ought to be able to call <code>sort_idxtbl</code>
and put the output into a plain array, or a <code>vector</code>, or anything
else. Well, the requirement &quot;be able to put the output into any
container&quot; simply cries out for an iterator, doesn't it?</p>
<blockquote>
  <p><code><font face="Courier New">template&lt; class RAIn, class RAOut &gt;<br>
  void sort_idxtbl( RAIn first, RAIn last, Out result )</font></code></p>
</blockquote>
<p>13. Reuse Part 4, or Prefer comparing iterators using <code>!=</code>: When
comparing iterators, always use <code>!=</code> (which works for all kinds of
iterators) instead of <code>&lt;</code> (which works only for random-access
iterators), unless of course you really need to use <code>&lt;</code> and only
intend to support random-access iterators. The original program uses <code>&lt;</code>
to compare the iterators it's given to work on, which is fine for random access
iterators, which was the program's initial intent -- to create indexes into <code>vector</code>s
and arrays, both of which support random-access iteration. But there's no reason
we may not want to do exactly the same thing for other kinds of containers, like
<code>list</code>s and <code>set</code>s, that don't support random-access
iteration, and the only reason the original code won't work for such containers
is that it uses <code>&lt;</code> instead of <code>!=</code> to compare
iterators.</p>
<p>As Scott Meyers puts it eloquently, &quot;program in the future tense.&quot;
He elaborates:</p>
<blockquote>
  <p>&quot;Good software adapts well to change. It accommodates new features, it
  ports to new platforms, it adjusts to new demands, it handles new inputs.
  Software this flexible, this robust, and this reliable does not come about by
  accident. It is designed and implemented by programmers who conform to the
  constraints of today while keeping in mind the probable needs of tomorrow.
  This kind of software -- software that accepts change gracefully -- is written
  by people who program in the future tense.&quot;<b><sup><a href="#4">[4]</a></sup></b></p>
</blockquote>
<p>14. Prefer preincrement unless you really need the old value: Here, for the
iterators, writing preincrement (<code>++i</code>) should habitually be
preferred over writing postincrement (<code>i++</code>).<b><a href="#5"><sup>[5]</sup></a></b>
True, that probably doesn't make a material difference in the original code
because <code>vector&lt;T&gt;::iterator</code> does not have to be a
cheap-to-copy <code>T*</code> (although it almost always will be); but if we
implement point 13 we may no longer be limited to just <code>vector&lt;T&gt;::iterator</code>s,
and most other iterators are of class type -- perhaps often still not too
expensive to copy, but why introduce this possible inefficiency needlessly?</p>
<p>That covers most the important issues. There are other things we could
critique but that I didn't consider important enough to call attention to here;
for example, production code should have comments that document each class's and
function's purpose and semantics, but that doesn't apply to code accompanying
magazine articles where the explanation is typically written in better English
and in greater detail than code comments have any right to expect.</p>
<p>I'm deliberately not critiquing the mainline for style (as opposed to the
mechanical errors already noted above that would cause the mainline to fail to
compile) because after all this particular mainline is only meant to be a
demonstration harness to help readers of the magazine article see how the index
table apparatus is meant to work, and it's the index table apparatus that's the
intended focus.</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Conclusion<!--mstheme--></font></h4>
<p>Let's preserve the original code's basic interface choice instead of straying far afield and proposing alternate design
choices.<b><a href="#6"><sup>[6]</sup></a></b> Limiting our critique just to correcting the code for mechanical
errors and basic style, then, consider the three alternative improved versions below.  Each has its own benefits, drawbacks, and style
preferences as explained in the accompanying comments.  What all three versions have in common is that they are clearer, more understandable,
and more portable code -- and that ought to count for something, in your company and in mine.</p>
<blockquote>
  <p class="code"><font face="Courier New">// An improved version of the code
  originally<br>
  // published in <a href="#1">[1]</a>.<br>
  //<br>
  #include &lt;vector&gt;<br>
  #include &lt;map&gt;<br>
  #include &lt;algorithm&gt;<br>
  <br>
  </font></p>
  <p class="code"><font face="Courier New">// Solution 1 does some basic cleanup
  but still<br>
  // preserves the general structure of the<br>
  // original's approach. We're down to 17 lines<br>
  // (even if you count &quot;public:&quot; and &quot;private:&quot;<br>
  // as lines), where the original had 23.<br>
  //<br>
  namespace Solution1<br>
  {<br>
  &nbsp; template&lt;class Iter&gt;<br>
  &nbsp; class sort_idxtbl_pair<br>
  &nbsp; {<br>
  &nbsp; public:<br>
  &nbsp;&nbsp;&nbsp; void set( const Iter&amp; it, int i ) { it_ = it; i_ = i; }</font></p>
  <p class="code"><font face="Courier New">&nbsp;&nbsp;&nbsp; bool operator&lt;(
  const sort_idxtbl_pair&amp; other ) const<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return *it_ &lt; *other.it_; }<br>
  &nbsp;&nbsp;&nbsp; operator int() const { return i_; }</font></p>
  <p class="code"><font face="Courier New">&nbsp; private:<br>
  &nbsp;&nbsp;&nbsp; Iter it_;<br>
  &nbsp;&nbsp;&nbsp; int i_;<br>
  &nbsp; };<br>
  </font></p>
  <p class="code"><font face="Courier New">&nbsp; // This function is where most
  of the clarity<br>
  &nbsp; // savings came from; it has 5 lines, where<br>
  &nbsp; // the original had 13. After each code line,<br>
  &nbsp; // I'll show the corresponding original code<br>
  &nbsp; // for comparison. Prefer to write code that<br>
  &nbsp; // is clear and concise, not unnecessarily<br>
  &nbsp; // complex or obscure!<br>
  &nbsp; //<br>
  &nbsp; template&lt;class IterIn, class IterOut&gt;<br>
  &nbsp; void sort_idxtbl( IterIn first, IterIn last, IterOut out )<br>
  &nbsp; {<br>
  &nbsp;&nbsp;&nbsp; std::vector&lt;sort_idxtbl_pair&lt;IterIn&gt; &gt;
  v(last-first);<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // int iDst = last-first;<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // typedef std::vector&lt;
  sort_idxtbl_pair&lt;RAIter&gt; &gt; V;<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // V v(iDst);</font></p>
  <p class="code"><font face="Courier New"><br>
  &nbsp;&nbsp;&nbsp; for( int i=0; i &lt; last-first; ++i )<br>
  &nbsp; &nbsp;&nbsp;&nbsp; v[i].set( first+i, i );<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // int i=0;<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // RAIter it = first;<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // V::iterator vit = v.begin();<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for (i=0; it&lt;last; it++, vit++, i++)<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (*vit).set(it,i);</font></p>
  <p class="code"><font face="Courier New"><br>
  &nbsp;&nbsp;&nbsp; std::sort( v.begin(), v.end() );<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // std::sort(v.begin(), v.end());</font></p>
  <p class="code"><font face="Courier New"><br>
  &nbsp;&nbsp;&nbsp; std::copy( v.begin(), v.end(), out );<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // int *pi = pidxtbl;<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // vit = v.begin();<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for (; vit&lt;v.end(); pi++, vit++)<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // *pi = (*vit).i;<br>
  &nbsp; }<br>
  }<br>
  <br>
  </font></p>
  <p class="code"><font face="Courier New">// Solution 2 uses a pair instead of
  reinventing<br>
  // a pair-like helper class. Now we're down to<br>
  // 13 lines, from the original 23. Of the 14<br>
  // lines, 9 are purpose-specific, and 5 are<br>
  // directly reusable in other contexts.<br>
  //<br>
  namespace Solution2<br>
  {<br>
  &nbsp; template&lt;class T, class U&gt;<br>
  &nbsp; struct ComparePair1stDeref<br>
  &nbsp; {<br>
  &nbsp;&nbsp;&nbsp; bool operator()( const std::pair&lt;T,U&gt;&amp; a,<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  const std::pair&lt;T,U&gt;&amp; b ) const<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return *a.first &lt; *b.first; }<br>
  &nbsp; };<br>
  </font></p>
  <p class="code"><font face="Courier New">&nbsp; template&lt;class IterIn,
  class IterOut&gt;<br>
  &nbsp; void sort_idxtbl( IterIn first, IterIn last, IterOut out )<br>
  &nbsp; {<br>
  &nbsp;&nbsp;&nbsp; std::vector&lt; std::pair&lt;IterIn,int&gt; &gt; s(
  last-first );<br>
  &nbsp;&nbsp;&nbsp; for( int i=0; i &lt; s.size(); ++i )<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s[i] = std::make_pair( first+i, i );<br>
  &nbsp;&nbsp;&nbsp; std::sort( s.begin(), s.end(),<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  ComparePair1stDeref&lt;IterIn,int&gt;() );<br>
  &nbsp;&nbsp;&nbsp; for( int i=0; i &lt; s.size(); ++i, ++out )<br>
  &nbsp;&nbsp;&nbsp; *out = s[i].second;<br>
  &nbsp; }<br>
  }<br>
  <br>
  </font></p>
  <p class="code"><font face="Courier New">// Solution 3 just shows a couple of
  alternative<br>
  // details -- it uses a map to avoid a separate<br>
  // sorting step, and it uses std::transform()<br>
  // instead of a handcrafted loop. Here we still<br>
  // have 15 lines, but more are reusable. This<br>
  // version uses more space overhead and probably<br>
  // more time overhead too, so I prefer Solution 2,<br>
  // but this is an example of finding alternative<br>
  // approaches to a problem.<br>
  //<br>
  namespace Solution3<br>
  {<br>
  &nbsp; template&lt;class T&gt;<br>
  &nbsp; struct CompareDeref<br>
  &nbsp; {<br>
  &nbsp;&nbsp;&nbsp; bool operator()( const T&amp; a, const T&amp; b ) const<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return *a &lt; *b; }<br>
  &nbsp; };</font></p>
  <p class="code"><font face="Courier New"><br>
  &nbsp; template&lt;class T, class U&gt;<br>
  &nbsp; struct Pair2nd<br>
  &nbsp; {<br>
  &nbsp;&nbsp;&nbsp; const U&amp; operator()( const std::pair&lt;T,U&gt;&amp; a
  ) const<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return a.second; }<br>
  &nbsp; };<br>
  </font></p>
  <p class="code"><font face="Courier New">&nbsp; template&lt;class IterIn,
  class IterOut&gt;<br>
  &nbsp; void sort_idxtbl( IterIn first, IterIn last, IterOut out )<br>
  &nbsp; {<br>
  &nbsp;&nbsp;&nbsp; std::multimap&lt;InputIter, int, CompareDeref&lt;InputIter> > v;<br>
  &nbsp;&nbsp;&nbsp; for( int i=0; first != last; ++i, ++first )<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v.insert( std::make_pair( first, i ) );<br>
  &nbsp;&nbsp;&nbsp; std::transform( v.begin(), v.end(), out,<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  Pair2nd&lt;IterIn const,int&gt;() );<br>
  &nbsp; }<br>
  }<br>
  <br>
  </font></p>
  <p class="code"><font face="Courier New">// I left the test harness
  essentially unchanged,<br>
  // except to demonstrate putting the output in an</font></p>
  <p class="code"><font face="Courier New">// output iterator (instead of necessarily an<br>
  // int*) and using the source array directly as a<br>
  // container.<br>
  //<br>
  #include &lt;iostream&gt;</font></p>
  <p class="code"><font face="Courier New">int main()<br>
  {<br>
  &nbsp; int ai[10] = { 15,12,13,14,18,11,10,17,16,19 };</font></p>
  <p class="code"><font face="Courier New">&nbsp; std::cout &lt;&lt;
  &quot;#################&quot; &lt;&lt; std::endl;<br>
  &nbsp; std::vector&lt;int&gt; aidxtbl( 10 );</font></p>
  <p class="code"><font face="Courier New"><br>
  &nbsp; // use another namespace name to test a different solution<br>
  &nbsp; Solution3::sort_idxtbl( ai, ai+10, aidxtbl.begin() );</font></p>
  <p class="code"><font face="Courier New"><br>
  &nbsp; for( int i=0; i&lt;10; ++i )<br>
  &nbsp; std::cout &lt;&lt; &quot;i=&quot; &lt;&lt; i<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt;
  &quot;, aidxtbl[i]=&quot; &lt;&lt; aidxtbl[i]<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt;
  &quot;, ai[aidxtbl[i]]=&quot; &lt;&lt; ai[aidxtbl[i]]<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt;
  std::endl;<br>
  &nbsp; std::cout &lt;&lt; &quot;#################&quot; &lt;&lt; std::endl;<br>
  }</font></p>
</blockquote>

<p>&nbsp;</p>

<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Notes<!--mstheme--></font></h4>
<p><a name="1"></a>1. C. Hicks. <b>&quot;Creating an Index Table in STL&quot;</b>
(<i>C/C++ Users Journal</i>, 18(8), August 2000).</p>
<p><a name="2"></a>2. Available at <a href="072.htm">http://www.gotw.ca/gotw/072.htm</a>.</p>
<p><a name="3"></a>3. H. Sutter. <b><a href="../publications/migrating_to_namespaces.htm">&quot;Migrating to Namespaces&quot;</a></b> (<i>Dr.
Dobb's Journal</i>, 25(10), October 2000).</p>
<p><a name="4"></a>4. S. Meyers. <b>More Effective C++</b>, Item 32
(Addison-Wesley, 1996).</p>
<p><a name="5"></a>5. H. Sutter. <b><a href="../publications/xc++.htm">Exceptional
C++</a></b> (Addison-Wesley, 2000).</p>
<p><a name="6"></a>6. The original author also reports separate feedback from <a href="mailto:ssimpson@mediaone.net">Steve
Simpson</a> demonstrating another elegant, but substantially different,
approach: Simpson creates a containerlike object that wraps the original
container, including its iterators, and allows iteration using the alternative
ordering.</p>
<!--mstheme--></font><!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="Arial, Arial, Helvetica"><h4 align="right"><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666"><a href="../copyright.htm"><font size="2">Copyright ©
2002 Herb Sutter</font></a><!--mstheme--></font></h4>

<!--mstheme--></font></td></tr><!--msnavigation--></table></body>
</html>

