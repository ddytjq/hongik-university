ID=F0124
URL=http://www.vbwm.com/articles/2002/shopkins/netdb01/
SIZE=77841
DATE=09/07/2002
TIME=13:15:11
DATASET=Visual Basic
HTML=<html

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Designing Relational Databases for Objects</title>

<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Courier;
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:AGaramond;
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman"; margin-left:0cm; margin-right:0cm; margin-top:0cm}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";}
 /* List Definitions */
@list l0
	{mso-list-id:162626646;
	mso-list-type:hybrid;
	mso-list-template-ids:1621416356 580664892 -66314554 333984646 702833644 -468963960 79490704 -1969193584 1825710602 1386774774;}
@list l1
	{mso-list-id:1946498828;
	mso-list-type:hybrid;
	mso-list-template-ids:114961190 -906974798 -984155408 1760490698 2123803470 1714313826 -948378598 1559675592 29014644 -1670622594;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<meta name=Template content="C:\Program Files\Microsoft Office\Office\html.dot">
</head>

<body lang=EN-AU link=blue vlink=purple style='tab-interval:36.0pt'>


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<LINK REL=STYLESHEET TYPE="text/css" HREF="/vbwm_main.css">

<script language="JavaScript">
<!-- hide from JavaScript-challenged browsers
function openResourceWin(url) {
  popupWin = window.open(url,'vbwmPopup','width=700,height=500,toolbar=yes,status=yes,resizable=yes,scrollbars=yes,menubar=yes');
}
function clearSearchBox()
{
  var txtBox = document.topSearchForm.txtTopSearch;
  if (txtBox.value = 'Enter keywords here.') { 
    txtBox.value='';
  }
}
// done hiding -->
</script>
</head>

<body>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%">

<table border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#CC6633" height="52">
  <form method="POST" action="/articles/2002/shopkins/netdb01/Default.asp?authaction=login">
  <tr>
    <td width="100%"><a href="http://www.vbwm.com/"><img
      border="0" src="/images/topheader/left.gif" width="280"
      height="48"></a></td>
    <td><table border="0"
      width="250" cellpadding="0" cellspacing="0">
      <tr>
        <td width="50%" class="system-smlheader">login:</td>
        <td width="50%">
          <input type="text" name="Name" size="10" tabindex="1" class="orange">
        </td>
        <td rowspan="2"><nobr><input type="image"
           border="0" src="/images/topheader/login.gif"
           width="76" height="48"><a href="/forums/policy.asp"><img border="0"
           src="/images/topheader/createacct.gif" width="139"
           height="48"></a></nobr></td>
      </tr>
      <tr>
        <td width="50%" class="system-smlheader">password:</td>
        <td width="50%">
          <input type="password" name="Password" size="10" tabindex="2" class="orange">
        </td>
      </tr>
      </table></td>
  </tr>
  </form>
</table>
<table cellpadding="0" cellspacing="0" width="100%" bgcolor="#999999" border="0">
  <form name="topSearchForm" action="/resources/search.asp" method="POST">
  <input type="hidden" name="SearchBox" value="1">
  <input type="hidden" name="Type" value="All">
  <tr>
    <td><input type="image" src="/images/topheader/searchicon.gif" width="60"
      height="62" border="0" onmousedown="clearSearchBox();"></td>
    <td valign="center"><input type="text" name="Words" size="18" id="txtTopSearch"
      value="Enter keywords here." class="orange" onfocus="clearSearchBox();"></td>
    <td><a href="/forums/active.asp"><img src="/images/topheader/activetopics.gif"
      width="88" height="62" border="0"></a><a
      href="mailto:editor@vbwm.com"><img src="/images/topheader/contactus.gif"
      width="85" height="62" border="0"></a></nobr></td>
    <td align="right"><a
      href="http://www.bitsonthewire.com/adrdrmanager.asp?loc=1"><img
      src="http://www.bitsonthewire.com/admanager.asp?loc=1&siteid=11&ad_type=0"
      border="0"></a></td>
  </tr>
  </form>
</table>
    <table border="0" width="100%" cellspacing="0" cellpadding="0">
      <tr>
        <td width="150" valign="top">
        
    <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse"
    width="150" id="AutoNumber5" background="/images/sitestructure/sidebar-left-middle.gif">
    
      <tr>
        <td width="150" colspan="3">
        
        <img border="0" src="/images/sitestructure/sidebar-left-top.gif" width="150" height="30"></td>
        
      </tr>
      <tr>
        
        <td width="5">&nbsp;</td>
        <td width="115">
        
              <a href="/" class=sidebar title="Go to the main page.">Home</a><br>
              <a href="/resources" class=sidebar title="View thousands of links to resources around the Internet.">Resources</a><br>
              <a href="/resources/default.asp?page=UserSubmissions" class=sidebar title="Code, tips, and tricks. Submit your own.">Code &amp; Tip Library</a><br>
              <a href="/forums" class=sidebar title="Post your questions and help someone else by posting an answer.">Message Board</a><br>
              <a href="/articles" class=sidebar title="Original articles from leading authors in the VB/ASP field.">Articles</a><br>
              <a href="/news" class=sidebar title="News articles and press releases from VB companies.">News</a><br>
              <a href="/learnvb/" class=sidebar title="Our beginners site. Find tutorials and books that can help you learn VB.">LearnVB</a><br>
              <a href="/learnvb/tutorials.asp" class=sidebar title="Excellent tutorials from this site and around the web.">Tutorials</a><br>
              <a href="/vendors" class=sidebar title="Find information on a particular tool or company.">Vendors</a><br>
              <a href="/resources/default.asp?page=Jobs" class=sidebar title="Sites that offer jobs to Visual Basic programmers.">Job Market</a><br>
              <a href="/mediazone" class=sidebar title="Find out how to advertise your services and products on one of the largest VB sites on the Internet.">Advertising</a><br>
              <a href="/about" class=sidebar tile="Information on our purpose here at VBWM.COM.">About Us</a><br>
                
        </td>
        
        <td width="30">&nbsp;</td>
        
      </tr>
      <tr>
        
        <td width="150" colspan="3">
        <img border="0" src="/images/sitestructure/sidebar-left-bottom.gif" width="150" height="34"></td>
        
      </tr>
    </table>
 
        <div align="center"><center>
          <a href="http://www.bitsonthewire.com/adrdrmanager.asp?loc=3">
          <img border="0" src="http://www.bitsonthewire.com/admanager.asp?loc=3&siteid=11&ad_type=-6"></a>
        </center></div>

        </td>
        <td width="100%" valign="top">
        <table border="0" width="100%" height="10" cellspacing="0" cellpadding="0">
          <tr>
            <td width="100%"><img src="/images/pixel.gif" width="1" height="10"</td>
          </tr>
        </table> 

        <table border="0" width="100%" cellspacing="0" cellpadding="0">
          <tr>
            <td width="100%">

        <table border="1" width="100%" bgcolor="#EEEEEE"
        bordercolor="#FFCC99" cellspacing="0" cellpadding="0"
        width="100%">
          <tr>
            <td width="100%">

            <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr><td width="100%" bgcolor="#FAFAFA" style="border: 1px outset #FAFAFA;">
            <table border="0" width="100%" cellspacing="0" cellpadding="5" bordercolor="#EEEEEE"
             style="border: 0px solid #EEEEEE;">
            <tr><td width="100%" align="top" class=system>

<p class=title>Designing Relational Databases for Object Hierarchies Using .NET</p>
<p class=header><b>By Stephen Hopkins</b></p>
<p class=smallsystem>Pre-requisites: A knowledge of SQL,
object-oriented terms and some VB experience.</p>
</td></tr></table></td></tr></table>
<table border="0" cellpadding="3" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber1">
  <tr>
    <td width="30%" align="center" class="smallsystem">
       Current Rating:<br><img src="/images/sitestructure/bullet-orange.gif"><img src="/images/sitestructure/bullet-orange.gif"><img src="/images/sitestructure/bullet-orange.gif"><img src="/images/sitestructure/bullet-orange.gif"><img src="/images/sitestructure/bullet-gray.gif"><br>
       with 1 votes.
    </td>
    <td width="70%" align="center" class="smallsystem">

	<center>
	Please sign in to VBWM.COM to place your vote above. New users can 
	<a href="/forums/policy.asp">create a login</a> with just their email address.
	</center>
	
    </td>
  </tr>
</table>


	<hr>
	
            <table border="0" width="100%" cellspacing="0" cellpadding="4">
            <tr><td width="100%" align="top" class=system>


<h3>The First Step</h3>

<p><span style='font-size:10.0pt'>Let’s face it. It’s not easy using relational
databases with objects. One solution is to move to Object databases or
Object/Relational databases. However, these have their limitations.
Alternatively, we can review how we design our relational databases to make
them more object-oriented friendly. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>For our examples, we’ll use a simple class
defined in VB.NET. Its definition is below:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><span style='color:blue'>Public Class</span> CPerson</pre><pre><span style="mso-spacerun: yes">    </span><span
style='color:blue'>Private</span> msLastName <span style='color:blue'>As</span> String = &quot;&quot;</pre><pre><span style="mso-spacerun: yes">    </span><span
style='color:blue'>Private</span> msFirstName <span style='color:blue'>As</span> String = &quot;&quot;</pre><pre><span style="mso-spacerun: yes">    </span><span
style='color:blue'>Public Property</span> FirstName() <span style='color:blue'>As</span> String</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">            </span>FirstName = msFirstName</pre><pre><span style="mso-spacerun: yes">    </span><span style="mso-spacerun: yes">    </span><span
style='color:blue'>End Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Set</span>(ByVal Value <span style='color:blue'>As</span> String)</pre><pre><span style="mso-spacerun: yes">            </span>msFirstName = Value</pre><pre><span style="mso-spacerun: yes">            </span>IsDirty() = <span
style='color:blue'>True<o:p></o:p></span></pre><pre><span style='color:blue'><span style="mso-spacerun: yes">        </span>End Set<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">    </span><span
style='color:blue'>End Property<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">    </span><span
style='color:blue'>Public Property</span> LastName() <span style='color:blue'>As</span> String</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">            </span>LastName = msLastName</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>End Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Set</span>(ByVal Value <span style='color:blue'>As</span> String)</pre><pre><span style="mso-spacerun: yes">            </span>msLastName = Value</pre><pre><span style="mso-spacerun: yes">            </span>IsDirty() = <span
style='color:blue'>True<o:p></o:p></span></pre><pre><span style='color:blue'><span style="mso-spacerun: yes">        </span>End Set<o:p></o:p></span></pre><pre><span
style='color:blue'><span style="mso-spacerun: yes">    </span>End Property<o:p></o:p></span></pre><pre><span
style='color:blue'>End Class<o:p></o:p></span></pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>This class declares two properties, FirstName
and LastName, and represents a person. Lets consider how we’ll store this class
in a relational database. The initial starting point is to map the class to a
table. So in the above case, the initial table definition would be:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>exec sp_addtype FirstName<span style="mso-spacerun: yes">    </span>, &quot;Char(30)&quot;</pre><pre>exec sp_addtype LastName<span style="mso-spacerun: yes">     </span>, &quot;Char(30)&quot;</pre><pre>go</pre><pre>CREATE TABLE Person</pre><pre><span style="mso-spacerun: yes">   </span>(</pre><pre> <span style="mso-spacerun: yes">   </span>FirstName<span style="mso-spacerun: yes">      </span>FirstName<span style="mso-spacerun: yes">      </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>LastName<span style="mso-spacerun: yes">       </span>LastName<span style="mso-spacerun: yes">       </span>NOT NULL </pre><pre>)</pre>
</td></tr></table></td></tr></table>


<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<h3>Object Identity</h3>

<p><span style='font-size:10.0pt'>Obviously the above table definition has a
few problems. One is that each row may not be unique. For example, we may have
two instances of CPerson, representing two <b>different</b> people, who both
have the same first and last name. In object-oriented terms this is not a
problem, as each instance of CPerson will have its own object identity. We test
this identity in VB.NET (and VB6) by using the Is keyword as shown below:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><span style="mso-spacerun: yes">        </span><span style='color:blue'>Dim</span> c1 <span
style='color:blue'>As</span> CPerson</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Dim</span> c2 <span style='color:blue'>As</span> CPerson</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Dim</span> c3 <span style='color:blue'>As</span> CPerson</pre><pre><span style="mso-spacerun: yes">        </span>c1 = <span
style='color:blue'>New</span> Class1()</pre><pre><span style="mso-spacerun: yes">        </span>c2 = <span
style='color:blue'>New</span> Class1()</pre><pre><span style="mso-spacerun: yes">        </span>c3 = c1 </pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The following piece of code would display
false:<o:p></o:p></span></p>

<pre><span style="mso-spacerun: yes">        </span><span style='color:blue'>MsgBox</span>(c1 <span
style='color:blue'>Is</span> c2)</pre>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>while this piece of code would display true:<o:p></o:p></span></p>

<pre><span style="mso-spacerun: yes">        </span><span style='color:blue'>MsgBox</span>(c1 <span
style='color:blue'>Is</span> c3)</pre>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>Variable C1 actually refers to a piece of
memory containing the state of an instance of CPerson. This is what is meant by
&quot;By Reference&quot;. The variable contains a reference to a piece of
memory. The variable C2 refers to a different piece of memory containing the
state of another instance of CPerson. When executing the code, C1 is C2, the
compiler merely checks if the two variables are referring to the same piece of
memory. If they don’t, then false is returned indicating that the variables are
referring to two different instances. The code c3 = c1 sets variable c3 to
refer to the same piece of memory as c1, and therefore the same instance of
class1. Executing, c1 is c3, will return true.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>Going back to our table definition, Person,
if we have two instances of CPerson which represent two different people who
both have the name &quot;John Smith&quot; , we’re in trouble. We won’t be able
to tell which row contains which instances state. If we save the objects to a
relational database, we need some way of also saving the fact that they are
different instances or in human speak, two different people. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>To deal with this problem, we can add an ID.
This ID is known as the Object Identifier. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>This object identifier should fulfill the
same purpose as the Is keyword. That is, it should be able to differentiate
instances of objects created from the same class, as well as differentiating
instances created from different classes. It will also be used to represent relationships
between objects, as we’ll see later.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>As well, the solution shouldn’t create a
dependency on a relational database. For example, an object hierarchy should be
able to be saved to a file on the users C drive as well as to a relational
database. Sounds difficult....<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>Generating IDs is not a simple task. We could
make a call to a central database, increment a counter using the databases
transaction properties, and return a unique ID. The problem is that this will
create a &quot;Hotspot&quot; on the database, with new IDs constantly being
generated and returned to clients. A Hotspot causes pending requests to queue
up, which in turn can lead to failures due to timeouts etc. We also need to
consider that our design should be flexible enough so that we are not dependent
on any particular storage media. That is, we should be able to write the state
of our object to a message queue, relational database or a flat file. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>As well, many objects may be created that
will never be saved to the database. If we are generating object Ids from a
central database, this would lead to many unnecessary calls over the network. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>An alternative is to come up with an
algorithm that uses information on the machine that creates the object to
generate a unique ID. One way to do this is to use Globally unique Identifiers
(GUID). <o:p></o:p></span></p>

<p><b><i><span style='font-family:Arial'>&nbsp;<o:p></o:p></span></i></b></p>

<h3>Use GUIDS to represent Object Identity</h3>

<p><span style='font-size:10.0pt'>The term GUID is used by Microsoft, but such
IDs are also known as Universally Unique Identifier, or UUIDs. GUIDs are IDs
that are guaranteed to be unique in space and time. Although theoretically it
is possible to generate the same GUID on two different machines, the chances of
doing so are so remote that you are more likely to die from getting struck by
an asteroid (well at least until 3400 A.D. when the chance of generating
duplicate GUIDs will increase....as if we’re going to be around to worry about
it!). A GUID is generated using various information, including:<o:p></o:p></span></p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo1;tab-stops:list 36.0pt'><span style='font-size:
     10.0pt'>A clock value <o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo1;tab-stops:list 36.0pt'><span style='font-size:
     10.0pt'>A time sequence <o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo1;tab-stops:list 36.0pt'><span style='font-size:
     10.0pt'>An identifier gathered from the network card [Leach,1998]<o:p></o:p></span></li>
</ul>

<p><span style='font-size:10.0pt'>If no network card is installed in the
machine, a pseudo-id is generated. A GUID itself is 128-bits (16 bytes) in
length, and is supported by most of the major database vendors. In .NET, GUID’s
are particularly easy to generate, as shown below.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><span style='color:blue'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
style='color:blue'><span style="mso-spacerun: yes">    </span>Private</span><span
style='font-family:Courier'> moGuid <span style='color:blue'>As</span> Guid<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">    </span><span
style='color:blue'>Public Sub New</span>()<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">        </span>moGuid = <span
style='color:blue'>New</span> Guid().NewGuid<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">    </span><span
style='color:blue'>End Sub<o:p></o:p></span></span></pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The above code defines a variable moGUID to
hold an instance of the class Guid. We then initialize the variable in the
default constructor. The remaining task is to provide access to the ID. It’s
important however that the ID cannot be changed. To ensure this, we’ll add a
ReadOnly ID property.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><span style="mso-spacerun: yes">    </span><span style='color:blue'>Public ReadOnly</span> <span
style='color:blue'>Property</span> ID() <span style='color:blue'>As</span> Guid</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">            </span>ID = moGuid</pre><pre><span style="mso-spacerun: yes">        </span><span
style='color:blue'>End Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">    </span><span
style='color:blue'>End Property<o:p></o:p></span></pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>In SQL Server, GUIDs are called unique
identifiers. So, our table definition (in SQL Server) would be changed to:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre ALIGN=JUSTIFY><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>exec sp_addtype ObjectID<span style="mso-spacerun: yes">     </span>, UniqueIdentifier</pre><pre>exec sp_addtype FirstName<span style="mso-spacerun: yes">    </span>, &quot;Char(30)&quot;</pre><pre>exec sp_addtype LastName<span style="mso-spacerun: yes">     </span>, &quot;Char(30)&quot;</pre><pre>go</pre><pre>CREATE TABLE Person</pre><pre><span style="mso-spacerun: yes">   </span>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">             </span>ObjectID<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>FirstName<span style="mso-spacerun: yes">      </span>FirstName<span style="mso-spacerun: yes">      </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>LastName<span style="mso-spacerun: yes">       </span>LastName<span style="mso-spacerun: yes">       </span>NOT NULL </pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Person</pre><pre><span style="mso-spacerun: yes">          </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">   </span>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>We’ve also added a primary key to the table
using the ID, which is possible due to the guarantee of uniqueness for GUIDs. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>This provides a very elegant solution in many
ways.<o:p></o:p></span></p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><span style='font-size:
     10.0pt'>We can create and throw away as many IDs as we want.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><span style='font-size:
     10.0pt'>The generation of IDs is carried out on the client machine,
     ensuring a scalable application.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list 36.0pt'><span style='font-size:
     10.0pt'>The IDs are architecturally neutral, allowing the state of our
     objects to be stored on relational databases, message queues, files etc.<o:p></o:p></span></li>
</ol>

<p><span style='font-size:10.0pt'>The down side is that the GUIDs require 16
bytes of storage, which may lead to a slight performance disadvantage and will
make our indexes larger than if we were to use integers etc.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<h3>Surrogate Keys</h3>

<p><span style='font-size:10.0pt'>In relational database terms, we have
introduced a surrogate key. That is, we have put a key in the table that has no
business meaning. Surrogate keys provide a number of advantages. The most
significant one is that the key will never have to change. This is a common
problem for many applications. Often an abbreviation is used as the key, and
invariably a decision is made sometime in the future to change the
abbreviation. For example, a table may contain the countries of the world, with
two columns, the countries abbreviation and full name. So for the United
States, the abbreviation could be &quot;US&quot; and the description would be
&quot;United States of America&quot;. What would happen if we were to change
the abbreviation to &quot;USA&quot;? We would have to track down all references
to the abbreviation &quot;US&quot;, and change it to &quot;USA&quot;. This
could potentially be a very expensive and tedious task. If we had used
surrogate keys, we can change the abbreviation at any time with no impact. This
is a rule I always follow when designing databases:<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'><span style='mso-tab-count:1'>                </span>Always
use surrogate keys.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>This fits in neatly when developing
object-oriented applications, as the surrogate key is simply the ID of the
object. <o:p></o:p></span></p>

<h3>Referencing Other Objects</h3>

<p><span style='font-size:10.0pt'>Any reasonably sized object oriented
application will be comprised of a network of objects, linked by references. In
code, a reference can be stored in an instance variable and retrieved and set
through a property. For example, the following code adds a reference to an
instance of Caddress (which represents the address of the person) to our
CPerson class.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><span style='color:blue'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
style='color:blue'>Private</span> moAddress <span style='color:blue'>As</span> CAddress</pre><pre><span
style='color:blue'>Public</span> <span style='color:blue'>Property</span> Address() <span
style='color:blue'>As</span> CAddress</pre><pre><span style='color:blue'><span style="mso-spacerun: yes">    </span>Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">        </span>Address = moAddress</pre><pre><span
style='color:blue'><span style="mso-spacerun: yes">    </span>End</span> <span
style='color:blue'>Get<o:p></o:p></span></pre><pre><span style='color:blue'><span style="mso-spacerun: yes">    </span>Set</span>(<span
style='color:blue'>ByVal</span> Value <span style='color:blue'>As</span> CAddress)</pre><pre><span style="mso-spacerun: yes">        </span>moAddress = Value</pre><pre><span style="mso-spacerun: yes">        </span>IsDirty() = <span
style='color:blue'>True<o:p></o:p></span></pre><pre><span style='color:blue'><span style="mso-spacerun: yes">    </span>End</span> <span
style='color:blue'>Set<o:p></o:p></span></pre><pre><span style='color:blue'>End</span> <span
style='color:blue'>Property<o:p></o:p></span></pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'><span style='mso-tab-count:1'>                </span>This
reference needs to be reflected in our tables that store the state of our
objects in the relational database. Often the solution is to create an address
table that contains the ID of the instance of CPerson and the ID of the
instance of CAddress, and use this to form the primary key of the CAddress
table. For example:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>CREATE TABLE Address</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>PersonID<span style="mso-spacerun: yes">   </span>ObjectID<span style="mso-spacerun: yes">   </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">         </span>ObjectID<span style="mso-spacerun: yes">   </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>StreetName StreetName NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>Suburb<span style="mso-spacerun: yes">     </span>Suburb<span style="mso-spacerun: yes">     </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>City<span style="mso-spacerun: yes">  </span><span style="mso-spacerun: yes">     </span>City<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>ZipCode<span style="mso-spacerun: yes">    </span>ZipCode<span style="mso-spacerun: yes">    </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Address</pre><pre><span style="mso-spacerun: yes">    </span>PRIMARY KEY CLUSTERED (PersonID, ID),</pre><pre>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The column PersonID will contain the ID of
the person object that references this particular address object. The problem
is that by placing the id of the referencing object in the referenced object,
we are severely hampering the flexibility of our address object. For example,
if two people live at the same address, why can’t they both reference the same
object? With the above table definition this is not possible. More importantly,
we want to be able to use our CAddress objects in other classes without making
any database changes. For example, a CCompany class may want to reference a
CAddress object to store its mailing address.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>To provide the flexibility we need, we simply
place the ID representing the reference in the referencing objects table as
shown below:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>CREATE TABLE Person</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">         </span>ObjectID<span style="mso-spacerun: yes">  </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>AddressID<span style="mso-spacerun: yes">  </span>ObjectID<span style="mso-spacerun: yes">  </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>FirstName<span style="mso-spacerun: yes">  </span>FirstName NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>LastName<span style="mso-spacerun: yes">   </span>LastName<span style="mso-spacerun: yes">  </span>NOT NULL </pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Person</pre><pre><span style="mso-spacerun: yes">    </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_Person_Address FOREIGN KEY </pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes"> </span>(</pre><pre><span
style='mso-tab-count:1'>        </span> AddressID</pre><pre><span
style='mso-tab-count:1'>        </span> ) </pre><pre>REFERENCES </pre><pre><span style="mso-spacerun: yes">    </span>Address </pre><pre><span style="mso-spacerun: yes">    </span>(</pre><pre><span style="mso-spacerun: yes">        </span>ID</pre><pre><span style="mso-spacerun: yes">    </span>)</pre><pre>)</pre><pre>CREATE TABLE Address</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">         </span>ObjectID<span style="mso-spacerun: yes">   </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>StreetName StreetName NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>Suburb<span style="mso-spacerun: yes">     </span>Suburb<span style="mso-spacerun: yes">     </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>City<span style="mso-spacerun: yes">       </span>City<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>ZipCode<span style="mso-spacerun: yes">    </span>ZipCode<span style="mso-spacerun: yes">    </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Address</pre><pre><span style="mso-spacerun: yes">    </span>PRIMARY KEY CLUSTERED (ID),</pre><pre>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The AddressID column in the Person table now
represents the reference and the PersonID column in table Address has been
removed. We can now use CAddress objects independently of CPerson objects. In
fact, we can add a reference to an instance of CAddress anywhere we need it as
long as we store its ID in the referencing object. So we need to update our
code in CPerson to store the ID.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><span style='color:blue'>Private</span> moAddress <span style='color:blue'>As</span> CAddress</pre><pre><span
style='color:blue'>Private</span> moAddressId <span style='color:blue'>As</span> Guid</pre><pre><span
style='color:blue'>Public</span> <span style='color:blue'>Property</span> Address() <span
style='color:blue'>As</span> CAddress</pre><pre><span style='color:blue'><span style="mso-spacerun: yes">    </span>Get<o:p></o:p></span></pre><pre><span style="mso-spacerun: yes">       </span>Address = moAddress</pre><pre><span
style='color:blue'><span style="mso-spacerun: yes">    </span>End</span> <span
style='color:blue'>Get<o:p></o:p></span></pre><pre><span style='color:blue'><span style="mso-spacerun: yes">    </span>Set</span>(<span
style='color:blue'>ByVal</span> Value <span style='color:blue'>As</span> CAddress)</pre><pre><span style="mso-spacerun: yes">        </span>moAddress = Value</pre><pre><span style="mso-spacerun: yes">        </span>moAddressId = moAddress.ID</pre><pre><span
style='color:blue'><span style="mso-spacerun: yes">    </span>End</span> <span
style='color:blue'>Set<o:p></o:p></span></pre><pre><span style='color:blue'>End</span> <span
style='color:blue'>Property<o:p></o:p></span></pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>In the above code an instance variable,
moAddressID, has been added to store the ID of the address object. As well, the
code to store the ID of an address object, moAddressID </span><span
style='font-size:10.0pt;font-family:"Courier New"'>= moAddress.ID</span><span
style='font-size:10.0pt'>, has been added. This will ensure that the latest ID
is stored in the instance variable moAddressID. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<h3>Referencing Many Objects</h3>

<p><span style='font-size:10.0pt'>What about the situation where we want to
reference many objects? For example, lets assume that we want to capture the
friends and relatives of a person. That is, we want to store the relationship
between an instance of CPerson and zero or more instances of CPerson. If we are
using GUIDs, this is actually very straightforward. We will need two tables, a
Collection table and a CollectionMember table. The collection table represents
a collection object. An entry in this table indicates the existence of a
collection containing zero or more members. For example, a row in the
collection table with no matching rows in the CollectionMember table would
indicate the existence of a collection with zero members. The DefaultID column
can be used to store the default member, useful for drop-down lists.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>The CollectionMember table contains the IDs
of all objects that are members of the collection in column MemberID. The
advantage of this definition is that we can build a generalized collection
class that allows us to collect up instances of any objects that support our
own user defined collection interface. To retrieve the members of the
collection, we join the MemberID column of CollectionMember to the table
containing the state of the members (for example to the ID column of Person).
The OrderNbr column can be used to provide a sorted collection, that is to
return the rows in a particular order, a very useful feature. To do this,
whenever we perform the join between yje CollectionMember table and another
table, we need to sort by the OrderNbr column.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>Unfortunately the code required for this
collection class is beyond the scope of this article, but rest assured it can
be achieved with not too many lines of code.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>CREATE TABLE Collection</pre><pre>(</pre><pre><span style="mso-spacerun: yes">   </span><span style="mso-spacerun: yes"> </span>ID<span style="mso-spacerun: yes">        </span>ObjectID NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>DefaultID ObjectID NULL</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Collection</pre><pre><span style="mso-spacerun: yes">    </span>PRIMARY KEY CLUSTERED (ID),</pre><pre>)</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>CREATE TABLE CollectionMember</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">       </span>ObjectID NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>MemberID ObjectID NULL,</pre><pre><span style="mso-spacerun: yes">    </span>OrderNbr Integer<span style="mso-spacerun: yes">  </span>NOT NULL </pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_CollectionMember</pre><pre><span style="mso-spacerun: yes">    </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_CollectionMember_Collection FOREIGN KEY </pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes"> </span>(</pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes">    </span>ID</pre><pre><span
style='mso-tab-count:1'>        </span> ) </pre><pre><span style="mso-spacerun: yes">    </span>REFERENCES </pre><pre><span style="mso-spacerun: yes">        </span>Collection </pre><pre><span style="mso-spacerun: yes">        </span>(</pre><pre><span style="mso-spacerun: yes">            </span>ID</pre><pre><span style="mso-spacerun: yes">        </span>)</pre><pre>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>The other thing we need to do is add a foreign
key to our Person table as shown below:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>CREATE TABLE Person</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">           </span>ObjectID<span style="mso-spacerun: yes">  </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>AddressID<span style="mso-spacerun: yes">    </span>ObjectID<span style="mso-spacerun: yes">  </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>FirstName<span style="mso-spacerun: yes">    </span>FirstName NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>LastName<span style="mso-spacerun: yes">     </span>LastName<span style="mso-spacerun: yes">  </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>CollectionID ObjectID<span style="mso-spacerun: yes">  </span>NOT NULL </pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Person</pre><pre><span style="mso-spacerun: yes">    </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_Person_Address FOREIGN KEY </pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes"> </span>(</pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes">     </span>AddressID</pre><pre><span
style='mso-tab-count:1'>        </span> ) </pre><pre><span style="mso-spacerun: yes">    </span>REFERENCES </pre><pre><span style="mso-spacerun: yes">        </span>Address </pre><pre><span style="mso-spacerun: yes">        </span>(</pre><pre><span style="mso-spacerun: yes">            </span>ID</pre><pre><span style="mso-spacerun: yes">         </span>)</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_Person_Collection FOREIGN KEY </pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes"> </span>(</pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes">    </span>CollectionID</pre><pre><span
style='mso-tab-count:1'>        </span> ) </pre><pre><span style="mso-spacerun: yes">    </span>REFERENCES </pre><pre><span style="mso-spacerun: yes">        </span>Collection </pre><pre><span style="mso-spacerun: yes">            </span>(</pre><pre><span style="mso-spacerun: yes">                </span>ID</pre><pre><span style="mso-spacerun: yes">            </span>)</pre><pre>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<h3>Logical Deletes</h3>

<p><span style='font-size:10.0pt'>Having a network of objects means that many
of the tables defined to store the state of objects will have columns that
represent references. So what do we do when a reference is no longer needed?
That is, what do we do when a row is no longer needed?<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>The obvious solution is to delete the row.
When we issue an SQL delete statement, it is termed a physical delete.
Unfortunately, for heavily referenced rows deleting the row also requires
changing or deleting all the rows containing a reference to it. In extreme
cases, to carry out such a delete requires downtime for the application.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>An alternative is to use logical deletes.
Logical deletes are where we mark the row as deleted, without physically
deleting it.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>For heavily referenced rows, an effective way
of implementing logical deletes is to add start and end dates to each row.
Between these two dates, the row is active. Outside of the dates, the row is
inactive. An example would be for tax scales which typically last for 12
months. To get the tax rates effective at a particular point in time, we would
simply select all rows where the start and end dates encompass the effective
date. This technique also allows us to maintain historical accuracy, as
references to old tax scales can remain in place indefinitely.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>For less referenced rows, a column can be
added to mark the row as being deleted. This column can simply contain a
&quot;Y&quot; to indicate that the row has been logically deleted. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>The final method is to simply remove the
references to a row, without physically deleting it. For example, if we change
the address object referenced by an instance of the CPerson class, there is no
need to delete the row representing the state of the previously referenced
address object.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>An advantage of designing applications to use
logical deletes is that it significantly reduces the error code needed. There
is no need to check that a row that once existed is still in the database. As
an exercise, revisit some of your applications code and see how much deals with
physical deletes. I think you’ll be surprised. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>Of course, there is a downside. The tables in
the database will contain information that is not in use, which in turn means
that the amount of storage required for the tables is larger than necessary.
The question that needs to be asked is when the amount of wasted storage
becomes significant. Then a periodical clean up the database can be carried out
to remove rows that have been logically deleted.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>&nbsp;<o:p></o:p></span></p>

<h3>Hidden Updates</h3>

<p><span style='font-size:10.0pt'>Another perennial problem faced by developers
is the problem of hidden updates. Hidden updates occur because we have to make
choices on locking information when building an enterprise application. Lets
assume that the user wants to change the details of a person represented by the
CPerson class previously defined. To maximize the number of users that can use
our application concurrently, we would read the state of the CPerson object and
display it to the user. The user could then make any changes to the person’s
details, and our application would send the revised state of the object to the
database where an update statement would be executed.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>This all sounds pretty straightforward. Of
course, if we are developing for the enterprise then other users would be
interacting with the application at the same time. One of these users may get
the person’s details just after the previous user has retrieved them, make some
changes and update the details before the other users update. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>What then occurs is called a hidden update.
The update performed by the second user is effectively completely lost. In
certain situations this is okay, but in most we would want to inform the first
user that details have been changed since they were retrieved from the database
when they try and update those details.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>One option is to exclusively lock the row
when it is read from the table stopping anyone else from updating. The
exclusive lock can then be released when the row is updated. This approach is
called pessimistic locking and is unacceptable for any application supporting a
number of users. Locking rows for extended periods severely restricts the
number of concurrent users an application can support and can also lead to
deadlocks. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>There are a number of alternatives to locking
the row for long periods. One is to add a counter to each row in the table,
When the row is read, the counter is stored. When the subsequent update is
executed, the counter is used on the SQL where clause to select the row and
incremented. For example:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>Create Procedure sp_UpdatePerson</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>@pID<span style="mso-spacerun: yes">        </span>ObjectID ,</pre><pre><span style="mso-spacerun: yes">    </span>@pFirstName FirstName ,</pre><pre><span style="mso-spacerun: yes">    </span>@pLastName<span style="mso-spacerun: yes">  </span>LastName ,</pre><pre><span style="mso-spacerun: yes">    </span>@pCounter<span style="mso-spacerun: yes">   </span>Counter </pre><pre>)</pre><pre>as</pre><pre><span style="mso-spacerun: yes">    </span>Update Person</pre><pre><span style="mso-spacerun: yes">       </span>set FirstName = @pFirstName,</pre><pre><span style="mso-spacerun: yes">           </span>LastName<span style="mso-spacerun: yes">  </span>= @pLastName ,</pre><pre><span style="mso-spacerun: yes">           </span>Counter<span style="mso-spacerun: yes">   </span>= Counter + 1</pre><pre><span style="mso-spacerun: yes">     </span>where ID<span style="mso-spacerun: yes">        </span>= @pID</pre><pre><span style="mso-spacerun: yes">       </span>and Counter<span style="mso-spacerun: yes">   </span>= @pCounter </pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The names beginning with @ are stored
procedure parameters. By passing in the counter from when the row was read, any
hidden updates will cause the above update statement to not find the row, as
the counter will have been incremented. The problem is that all updates should
be performed through the stored procedure, as we are relying on the counter to
be incremented whenever an update is carried out. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>A better alternative is to use a timestamp. A
timestamp is guaranteed by the database management system (DBMS), such as SQL
Server, to be discrete enough so that whenever a row is updated, the new
timestamp will differ from the existing one. (NOTE: This is different from
using datetime types, where we could potentially update a row and generate an
identical value). The other advantage is that the DBMS automatically updates
the timestamp whenever the row is updated. So our SQL changes to:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>Create Procedure sp_UpdatePerson</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>@pID<span style="mso-spacerun: yes">        </span>ObjectID ,</pre><pre><span style="mso-spacerun: yes">    </span>@pFirstName FirstName ,</pre><pre><span style="mso-spacerun: yes">    </span>@pLastName<span style="mso-spacerun: yes">  </span>LastName ,</pre><pre><span style="mso-spacerun: yes">    </span>@pTimestamp Timestamp </pre><pre>)</pre><pre>as</pre><pre><span style="mso-spacerun: yes">  </span><span style="mso-spacerun: yes">  </span>Update Person</pre><pre><span style="mso-spacerun: yes">       </span>set FirstName = @pFirstName,</pre><pre><span style="mso-spacerun: yes">           </span>LastName = @pLastName </pre><pre><span style="mso-spacerun: yes">     </span>where ID = @pID</pre><pre><span style="mso-spacerun: yes">       </span>and Timestamp = @pTimestamp</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The above stored procedure will ensure a
hidden update does not occur. However, there are two extra things we need to
do. One is to somehow determine when a hidden update has occurred, so we can
notify the user. The other is to return the timestamp when an update is
successful to the object, so that subsequent updates by the same user aren’t
mistaken for hidden updates.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>To determine if a hidden update has occurred,
we simply check the number of rows updated.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>If the row count is zero after executing the
above stored procedure, we can assume that a hidden update has occurred (This
assumes we are using logical deletes). <o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>To return the timestamp, we need to make two
changes. The first is to add the keyword output to the timestamp parameter.
This will ensure that the timestamp is returned after executing the stored
procedure. The second is to select the new timestamp value after a successful
update.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre>Create Procedure sp_UpdatePerson</pre><pre>(</pre><pre><span style="mso-spacerun: yes">    </span>@pID<span style="mso-spacerun: yes">        </span>ObjectID ,</pre><pre><span style="mso-spacerun: yes">    </span>@pFirstName FirstName ,</pre><pre><span style="mso-spacerun: yes">    </span>@pLastName<span style="mso-spacerun: yes">  </span>LastName ,</pre><pre><span style="mso-spacerun: yes">    </span>@pTimestamp Timestamp output</pre><pre>)</pre><pre>as</pre><pre><span style="mso-spacerun: yes">    </span>Update Person</pre><pre><span style="mso-spacerun: yes">       </span>set FirstName = @pFirstName,</pre><pre><span style="mso-spacerun: yes">           </span>LastName = @pLastName </pre><pre><span style="mso-spacerun: yes">     </span>where ID = @pID</pre><pre><span style="mso-spacerun: yes">       </span>and Timestamp = @pTimestamp</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><span style="mso-spacerun: yes">    </span>if @@rowcount = 1 </pre><pre><span style="mso-spacerun: yes">        </span>select @pTimestamp = Timestamp</pre><pre><span style="mso-spacerun: yes">          </span>from Person</pre><pre><span style="mso-spacerun: yes">         </span>where ID = @pID</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>If the timestamp has changed due to a hidden
update, @@rowcount will have a value of zero. If there is no hidden update,
@@rowcount will have a value of one, so the subsequent select statement will be
executed which will retrieve the latest timestamp for the row.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>To support timestamps, we need to add an
instance variable and associated property statements to our CPerson class as
follows:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre ALIGN=JUSTIFY><span style='color:blue'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
style='color:blue'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></pre><pre><span
style='color:blue'>Private</span><span
style='font-family:Courier'> mbytTimestamp <span style='color:blue'>As Byte</span>()<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span
style='color:blue'>Private Property</span> Timestamp() <span style='color:blue'>As Byte</span>()<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">        </span><span
style='color:blue'>Get<o:p></o:p></span></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">            </span>Timestamp = mbytTimestamp<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">        </span><span
style='color:blue'>End Get<o:p></o:p></span></span></pre><pre><span
style='font-family:Courier;color:blue'>        Set</span><span style='font-family:Courier'>(<span
style='color:blue'>ByVal</span> Value <span style='color:blue'>AsByte</span>())<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">            </span>mbytTimestamp = Value<o:p></o:p></span></pre><pre><span
style='font-family:Courier'><span style="mso-spacerun: yes">        </span><span
style='color:blue'>End Set<o:p></o:p></span></span></pre><pre><span
style='font-family:Courier;color:blue'>End Property<o:p></o:p></span></pre>
</td></tr></table></td></tr></table>

<p><span style='font-family:AGaramond'>&nbsp;<o:p></o:p></span></p>

<h3>What about Inheritance?</h3>

<p><span style='font-size:10.0pt'>Of course, we need to also consider
inheritance. How can we reflect inheritance in our tables? First let’s consider
a class, CEmployee, that inherits from CPerson. This class includes an
eight-character Employee number. In relational terms, we have two options. One
is to collapse all the definitions into one table as shown below.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>CREATE TABLE Employee</pre><pre><span style="mso-spacerun: yes">   </span>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">          </span><span style="mso-spacerun: yes">   </span>ObjectID<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>EmployeeNbr<span style="mso-spacerun: yes">    </span>EmployeeNbr<span style="mso-spacerun: yes">    </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>AddressID<span style="mso-spacerun: yes">      </span>ObjectID<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>FirstName<span style="mso-spacerun: yes">      </span>FirstName<span style="mso-spacerun: yes">      </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>LastName<span style="mso-spacerun: yes">       </span>LastName<span style="mso-spacerun: yes">       </span>NOT NULL </pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Employee</pre><pre><span style="mso-spacerun: yes">          </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_Employee_Address FOREIGN KEY </pre><pre><span
style='mso-tab-count:3'>                       </span>(</pre><pre><span
style='mso-tab-count:4'>                               </span>AddressID</pre><pre><span
style='mso-tab-count:3'>                       </span>) REFERENCES Address (</pre><pre><span
style='mso-tab-count:5'>                                      </span>ID</pre><pre><span
style='mso-tab-count:3'>                       </span>)</pre><pre><span style="mso-spacerun: yes">   </span>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>The above table definition contains the state
of an Employee, which is the state of a Person plus an Employee number. This
will give us good performance when retrieving, inserting and updating employee
details. On the other hand, it complicates issues when we want to cast our
CEmployee object to a CPerson object. We can create a view on the Employee
table that will return the state of our CPerson class. This view, shown below,
will also allow us to update (and insert if we change the EmployeeNbr column to
allow nulls ) when dealing with a CPerson object.<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>CREATE VIEW dbo.VPerson</pre><pre>AS</pre><pre><span style="mso-spacerun: yes">    </span>SELECT<span style="mso-spacerun: yes">     </span>ID, AddressID, FirstName, LastName</pre><pre><span style="mso-spacerun: yes">    </span>FROM<span style="mso-spacerun: yes">       </span>dbo.Employee</pre>
</td></tr></table></td></tr></table>
<p><span style='font-size:10.0pt'>As soon as we have another class inheriting
from CPerson, the situation becomes more complicated and restrictive. Assume we
have also created a CCustomer class, which inherits from the CPerson class. Now
our view is changed to:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>CREATE VIEW dbo.VPerson</pre><pre>AS</pre><pre><span style="mso-spacerun: yes">    </span>SELECT<span style="mso-spacerun: yes">     </span>ID, AddressID, FirstName, LastName</pre><pre><span style="mso-spacerun: yes">      </span>FROM<span style="mso-spacerun: yes">     </span>dbo.Employee</pre><pre>UNION</pre><pre><span style="mso-spacerun: yes">    </span>SELECT<span style="mso-spacerun: yes">     </span>ID, AddressID, FirstName, LastName</pre><pre><span style="mso-spacerun: yes">      </span>FROM<span style="mso-spacerun: yes">     </span>dbo.Customer</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>This view definition will allow us to
retrieve CPerson objects, but not insert/update them.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>An alternative solution is to have separate
tables for each level of inheritance. <o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>CREATE TABLE Person</pre><pre><span style="mso-spacerun: yes">   </span>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">             </span>ObjectID<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>AddressID<span style="mso-spacerun: yes">      </span>ObjectID<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>FirstName<span style="mso-spacerun: yes">      </span>FirstName<span style="mso-spacerun: yes">      </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>LastName<span style="mso-spacerun: yes">       </span>LastName<span style="mso-spacerun: yes">       </span>NOT NULL </pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Person</pre><pre><span style="mso-spacerun: yes">          </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_Person_Address FOREIGN KEY </pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes">      </span>(</pre><pre><span
style='mso-tab-count:2'>               </span><span style="mso-spacerun: yes">          </span>AddressID</pre><pre><span
style='mso-tab-count:1'>        </span><span style="mso-spacerun: yes">      </span>) </pre><pre><span style="mso-spacerun: yes">    </span>REFERENCES </pre><pre><span style="mso-spacerun: yes">          </span>Address </pre><pre><span style="mso-spacerun: yes">              </span>(</pre><pre><span style="mso-spacerun: yes">                  </span>ID</pre><pre><span style="mso-spacerun: yes">              </span>)</pre><pre><span style="mso-spacerun: yes">   </span>)</pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>CREATE TABLE Employee</pre><pre><span style="mso-spacerun: yes">   </span>(</pre><pre><span style="mso-spacerun: yes">    </span>ID<span style="mso-spacerun: yes">             </span>ObjectID<span style="mso-spacerun: yes">       </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>EmployeeNbr<span style="mso-spacerun: yes">    </span>EmployeeNbr<span style="mso-spacerun: yes">    </span>NOT NULL,</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT PK_Employee</pre><pre><span style="mso-spacerun: yes">          </span>PRIMARY KEY CLUSTERED (ID),</pre><pre><span style="mso-spacerun: yes">    </span>CONSTRAINT FK_Employee_Person FOREIGN KEY </pre><pre><span
style='mso-tab-count:3'>                       </span>(</pre><pre><span
style='mso-tab-count:4'>                               </span>ID</pre><pre><span
style='mso-tab-count:3'>                       </span>) REFERENCES Person (</pre><pre><span
style='mso-tab-count:5'>                                      </span>ID</pre><pre><span
style='mso-tab-count:3'>                       </span>)</pre><pre><span style="mso-spacerun: yes">   </span>)</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>Note that the Employee table definition has a
foreign key definition to the Person table. To return the state of an Employee,
a join must be made with all the tables that store the state of objects further
up the inheritance hierarchy. For example, the following SQL will return the
state of an Employee object, and does a join between the Person and Employee
tables:<o:p></o:p></span></p>


<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></pre><pre>select E.ID ,</pre><pre><span style="mso-spacerun: yes">       </span>E.EmployeeNbr, </pre><pre><span style="mso-spacerun: yes">       </span>P.AddressID,</pre><pre><span style="mso-spacerun: yes">       </span>P.FirstName,</pre><pre><span style="mso-spacerun: yes">       </span>P.LastName</pre><pre><span style="mso-spacerun: yes">  </span>from Employee E,</pre><pre><span style="mso-spacerun: yes">       </span>Person P</pre><pre> where E.ID = P.ID</pre>
</td></tr></table></td></tr></table>

<p><span style='font-size:10.0pt'>This table structure allows casting to any
level of the inheritance hierarchy, and is more flexible when changes need to
be made to the hierarchy. The downside is that a join is required for each
level of the inheritance hierarchy. So if we want to retrieve the state of an
object nine levels down the hierarchy we will need to join nine tables. In this
situation, the question to ask is why we have nine levels in our inheritance
hierarchy!<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>So which one to use? Generally shallow
inheritance hierarchies are seen as one aspect of a well designed application.
This in turn means that the potential number of tables that need to be joined
should be limited in a well designed application. In this case, the second
option is superior as it far more forgiving when we move into our maintenance
cycles for our application.<o:p></o:p></span></p>

<h3>Summary</h3>

<p><span style='font-size:10.0pt'>This article has hopefully given some insight
into techniques that can be used when designing relational tables to store the
state of an object hierarchy. Once we have our table definitions, we still have
to use another set of techniques to ensure that we retrieve and insert/update
in the most effective manner. But that’s for another article....<o:p></o:p></span></p>

<p><span style='font-size:10.0pt'>About the Author<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt'>Stephen Hopkins</span></b><span
style='font-size:10.0pt'> has a Masters of Science degree from the University
of Technology, Sydney and is currently writing a book on <i>Universal Business
Objects in VB.NET</i>.<o:p></o:p></span></p>

</td></tr></table></td></tr></table>
<img src="/images/pixel.gif" width=10 height=2>
        </td>
        <td width="200" valign="top">

    <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse"
    width="200" id="AutoNumber5" background="/images/sitestructure/sidebar-right-middle.gif">
    
      <tr>
        <td width="150" colspan="3">
        
        <img border="0" src="/images/sitestructure/sidebar-right-top.gif" width="200" height="30"></td>
		
      </tr>
      <tr>
        
        <td width="30">&nbsp;</td>
        <td width="165">
		
<p class="system-titleheader">summary</p>

<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">

<p><span style='font-size:10.0pt'>The problem of
placing an object’s state into a relational database is a problem of such
significance that it has been given its own name, &quot;impedance
mismatch&quot;. There are a number of techniques that can be used to overcome
the problems, and this article outlines some of them. In particular it deals
with object identity, logical deletes, hidden updates and inheritance.<o:p></o:p></span></p>
</td></tr></table></td></tr></table>        
        </td>
        
        <td width="5">&nbsp;</td>
        
      </tr>
      <tr>
        
        <td width="200" colspan="3">
        <img border="0" src="/images/sitestructure/sidebar-right-bottom.gif" width="200" height="34"></td>
        
      </tr>
    </table>

    <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse"
    width="200" id="AutoNumber5" background="/images/sitestructure/sidebar-right-middle.gif">
    
      <tr>
        <td width="150" colspan="3">
        
        <img border="0" src="/images/sitestructure/sidebar-right-top.gif" width="200" height="30"></td>
		
      </tr>
      <tr>
        
        <td width="30">&nbsp;</td>
        <td width="165">
		
<p class="system-titleheader">links</p>

<table cellpadding="0" cellspacing="1" bgcolor="#EEEEEE"
style="border-left:1px solid #AAAAAA; border-right:1px solid #FFFFFF; border-top:1px solid #AAAAAA; border-bottom:1px solid #FFFFFF; "
width="100%">
  <tr>
    <td width="100%">
<table cellpadding="2" cellspacing="0" border="1"
 bordercolor="#DDDDDD" width="100%" bgcolor="#FFFFFF"
 style="border: 1px solid #DDDDDD;">
  <tr>
    <td width="100%">


<p><a
href="http://www.alternic.org/drafts/drafts-l-m/draft-leach-uuids-guids-01.txt">Paul J. Leach, Microsoft, UUIDs and GUIDs , February
4, 1998</a></p>

<p><a href="http://www-106.ibm.com/developerworks/library/mapping-to-rdb/index.html">
Scott Ambler, Mapping objects to relational databases, 2001</a></p>

<p><a
href="http://msdn.microsoft.com/msdnmag/issues/01/11/instincts/instincts0111.asp">Ted Pattison, Using Inheritance in the .NET World</a></p>

<p><a
href="http://msdn.microsoft.com/msdnmag/issues/01/12/Instincts/Instincts0112.asp">Ted Pattison, Using Inheritance in the .NET World,
Part 2</a></p>
</td></tr></table></td></tr></table>        
        </td>
        
        <td width="5">&nbsp;</td>
        
      </tr>
      <tr>
        
        <td width="200" colspan="3">
        <img border="0" src="/images/sitestructure/sidebar-right-bottom.gif" width="200" height="34"></td>
        
      </tr>
    </table>

        </td>
      </tr>
      <tr>
      	<td colspan="2">
        <table border="0" width="100%" height="10" cellspacing="0" cellpadding="0">
          <tr>
            <td width="100%"></td>
          </tr>
        </table>
        <div align="center"><center>
          <a href="http://www.bitsonthewire.com/adrdrmanager.asp?loc=2">
          <img border="0" src="http://www.bitsonthewire.com/admanager.asp?loc=2&siteid=11&ad_type=2"></a>
        </center></div>
        </td>
      </tr>
    </table>
    </td>
  </tr>
</table>
</body>

</html>



</body>

</html>
