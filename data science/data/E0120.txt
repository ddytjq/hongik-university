ID=E0120
URL=http://www.codeguru.com/cpp_mfc/CfgDemo.html
SIZE=38130
DATE=12/07/02
TIME=19:17:45
DATASET=C
HTML=<HTML>
<HEAD>   
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">   
    <META NAME="Author" CONTENT="Tom Archer">
    <TITLE>C++ & MFC - Table of Contents</TITLE>   
    <META Name="description" Content="Source codes with MFC">
    <META Name="keywords" Content="SOURCE CODE MFC">

    <SCRIPT LANGUAGE="JavaScript">
<!--
var axel = Math.random() + "";
var ord = axel * 1000000000000000000 + "?";

//This part of script alleviates a Netscape document.write bug
<!-- 
NS4 = document.layers;
if (NS4) {
origWidth = innerWidth;
origHeight = innerHeight;
}
function reDo() {
if (innerWidth != origWidth || innerHeight != origHeight) 
location.reload();
}
if (NS4) onresize = reDo;
//-->
</SCRIPT>

</HEAD>



<body>

<!-- begin logo and top banner ad table -->

<TABLE width=100% cellpadding="0" cellspacing="0">

  <TR align="left">
    <TD COLSPAN="3" VALIGN="TOP" align="left">
      <A HREF="http://www.earthweb.com" TARGET="_top">
        <IMG SRC="/images/eweb_banner.gif" BORDER="0" ALT="EarthWeb">
      </a>
    </TD>
  </TR>

  <TR>
<!--BljAds
    <TD VALIGN="TOP" align=left>
      <A HREF="/">
        <IMG SRC="/images/logo_cobrand.gif" BORDER="0" ALT="Developer.com">
      </a>
    </TD>

    <TD>
      <img src="/images/dotclear.gif" WIDTH="40" HEIGHT="1">
    </TD>
-->
    <TD align="TOP">
    <center>
      <IFRAME SRC="http://ad.doubleclick.net/adi/N339.Internet.com/B974922;sz=468x60;ord=2002.07.12.18.17.14?" WIDTH=470 HEIGHT=62 MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no BORDERCOLOR='#000000'>
<SCRIPT language='JavaScript1.1' SRC="http://ad.doubleclick.net/adj/N339.Internet.com/B974922;abr=!ie;sz=468x60;ord=2002.07.12.18.17.14?">
</SCRIPT>
<NOSCRIPT>
<A HREF="http://ad.doubleclick.net/jump/N339.Internet.com/B974922;abr=!ie4;abr=!ie5;sz=468x60;ord=2002.07.12.18.17.14?">
<IMG SRC="http://ad.doubleclick.net/ad/N339.Internet.com/B974922;abr=!ie4;abr=!ie5;sz=468x60;ord=2002.07.12.18.17.14?" BORDER=0 WIDTH=468 HEIGHT=60 ALT="Alt Text">Alt Text</A>
</NOSCRIPT>
</IFRAME><IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22081/468x60-1/Oracle_RUP_ORA09M_1a/InternetRONBanner468x60.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>

<!-- Counter Position Eliminated -->

    </center>
    </TD>
  </TR>

</TABLE>
<hr>
<!-- end logo and top banner ad table -->

<!-- begin lower outer table -->

<TABLE cellpadding="0" cellspacing="0" border="0">
<TR>
<TD bgcolor=#efefef VALIGN="TOP" WIDTH="90">




<table border=1 cellspacing=0 cellpadding=0>
<tr><td>

<table border=0 cellpadding=5 cellspacing=0 width=150>
   <tr>
     <td align="center">
      <A HREF="/">
        <IMG SRC="/images/logo_cobrand.gif" BORDER="0" ALT="Developer.com">
      </a>
      </td>
   </tr>
   <tr>
     <td align="center">
     <A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/2672/125x125-1/House_Career_Channel_11g/webopediajobs-125.gif/38366531313035623364326631643230" target="_top"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_Career_Channel_11g/webopediajobs-125.gif"  WIDTH=125 HEIGHT=125 ALT=""  BORDER="0"></A><img src="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/2672/125x125-1/House_Career_Channel_11g/webopediajobs-125.gif/38366531313035623364326631643230?_RM_EMPTY_" Width="1" Height="1" Border="0">
     </td>
   </tr>
</table>

</td></tr>
<tr><td align="center">
  <table width="100%" border=0 cellpadding=5 cellspacing=0><tr><td align="center"><font size=-1>
  <a href="http://www.bizrate.com/mkt.xpml?mkt_id=503249" target="new">Shop for Software</a></font>
  </td></tr></table>
</td></tr>
<tr><td>
  <table width=130 border=0 cellpadding=5 cellspacing=0>
    <tr>
      <td>
        <!-- SEARCH FORM-->
        <form method="post" action="http://search.internet.com/codeguru.earthweb.com">
          <input type="hidden" name="IC_StartNumber" value="0">
          <input type="hidden" name="IC_BatchSize" value="10">
          <input type="hidden" name="IC_RelevanceThreshold" value="30">
          <input type="hidden" name="IC_QueryDatabase"  value="codeguru.earthweb.com">
          <input type="text"   name="IC_QueryText" value="" size="10">
          <input type="submit" value="Search">
        </form>
        <!-- END OF SEARCH FORM -->
      </td>
    </tr>
  </table>

  <table border=0 cellpadding=5 cellspacing=0 width=150>
    <tr><td><span class="navBarH1">CodeGuru Sites</span></td></tr>
    <tr><td nowrap>
        <small>
          <a href="/index.shtml">Visual C++ / MFC / C++</a><br>
          <a HREF="/csharp/index.shtml">.NET (C# and more)</a><br>
          <a href="/vb/index.shtml">Visual Basic</a><br>
          <a href="http://www.gamelan.com">Gamelan (Java)</a><br>
          <a href="http://www.jars.com">JARs (Java Applets)</a><br>
          <hr>
        </small>
        
        
    <a href="/SubmissionsGuidelines.html">
    <font face="verdana, helvetica" color="#000000" size=1>
       submission guidelines
    </font></a>
<br>

<hr>

    </td></tr>


    <tr><td><span class="navBarH1">Interact</span></td></tr>
    <tr><td nowrap>
        <small>
          <a href="/cgi-bin/bbs/wt/wwwthreads.pl">Discussion Boards</a><br>
          <a href="http://e-newsletters.internet.com">Newsletters (subscribe)</a><br>
          <a href="/Guestbook/guestbook.shtml">Guestbook</a><br>
          <a href="/cgi-bin/recommend.cgi">Recommend Us!</a><br>
          <hr>
        </small>
    </td></tr>


    <tr><td><span class="navBarH1">Of Interest</span></td></tr>
    <tr><td nowrap>
        <small>
       <a href="/announcements/dotnetbooks.html">Books on .NET</a><!--<img src="/images/new.gif">--><br>
       <a HREF="/bookReviews/index.shtml">Book Reviews</a><br>
       <a href="/newsletters/index.shtml">Newsletters (archived)</a><br> 
          <a href="/about.shtml">About Us</a><br>
          <hr>
        </small>
    </td></tr>

    <tr><td><span class="navBarH1">Article Sections</span></td></tr>

    <tr><td>
      <span class="navBarH2">C++</span>
      <br>
      <small>
        <a href="/algorithms/index.shtml">algorithms & formulas</a></br>
        <a href="/cpp_mfc/index.shtml">c++ & mfc</a><br>
        <a href="/date_time/index.shtml">date & time</a><br>
        <a href="/string/index.shtml">string</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">COM-based Technologies</span>
      <br>
      <small>
        <a href="/atl/index.shtml">atl & wtl</a><br>
        <a href="/activex/index.shtml">com & activex</a><br>
        <a href="/complus/index.shtml">com+</a><br>
        <a href="/shell/index.shtml">shell programming</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Controls</span>
      <br>
      <small>
        <a href="/buttonctrl/index.shtml">button control  </a><br>
        <a href="/combobox//index.shtml">combobox  </a><br>
        <a href="/editctrl/index.shtml">edit control  </a><br>
        <a href="/imagelist/index.shtml">imagelist control </a><br>
        <a href="/listbox/index.shtml">listbox control  </a><br>
        <a href="/listview/index.shtml">listview control  </a><br>
        <a href="/menu/index.shtml">menu  </a><br>
        <a href="/controls/index.shtml">other controls </a><br>
        <a href="/propertysheet/index.shtml">property sheet  </a><br>
        <a href="/richedit/index.shtml">rich edit control  </a><br>
        <a href="/staticctrl/index.shtml">static control  </a><br>
        <a href="/statusbar/index.shtml">status bar </a><br>
        <a href="/toolbar/index.shtml">toolbar  </a><br>
        <a href="/treeview/index.shtml">treeview control </a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Data</span>
      <br>
      <small>
    <!--
        <a href="/ado/index.shtml">ado & oledb</a><br>
        <a href="/odbc/index.shtml">odbc</a><br>
        <a href="/mfc_database/index.shtml">mfc database classes</a><br>
        <a href="/office_db/index.shtml">office products</a><br>
        <a href="/oracle/index.shtml">oracle</a><br>
        <a href="/serialization/index.shtml">serialization</a><br>
        <a href="/sqlserver/index.shtml">sql server</a><br>
    -->
        <a href="/mfc_database/index.shtml">database</a><br>
        <a href="/data-misc/index.shtml">miscellaneous</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Frameworks</span>
      <br>
      <small>
    <!--
        <a href="/component_frameworks/index.shtml">component frameworks</a><br>
        <a href="/printing_frameworks/index.shtml">printing frameworks</a><br>
        <a href="/ui_frameworks/index.shtml">ui frameworks</a><br>
    -->
        <a href="/advancedui/index.shtml">ui & printing frameworks</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Graphics & Multimedia</span>
      <br>
      <small>
        <a href="/bitmap/index.shtml">bitmaps & palettes</a><br>
        <a href="/directx/index.shtml">directx</a><br>
        <a href="/gdi/index.shtml">gdi</a><br>
        <a href="/multimedia/index.shtml">multimedia</a><br>
        <a href="/opengl/index.shtml">opengl</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Internet & Networking</span>
      <br>
      <small>
        <a href="/ieprogram/index.shtml">ie programming</a><br>
        <a href="/internet/index.shtml">internet protocols</a><br>
        <a href="/isapi/index.shtml">isapi</a><br>
        <a href="/network/index.shtml">network protocols</a><br>
      </small>
    </td></tr>
	
    <tr><td>
      <span class="navBarH2">Miscellaneous</span>
      <br>
      <small>
        <a href="/misc/index.shtml">miscellaneous</a><br>
        <a href="/samples/index.shtml">samples</a><br>
      </small>
    </td></tr>

    <!--
    <tr><td><span class="navBarH2">Security</span></td></tr>
    <tr><td><small>
      <a href="/cryptoapi/index.shtml">crypto api</a><br>
      <a href="/encryption/index.shtml">encryption/decryption</a><br>
      <br>
    </small></td></tr>
    -->

    <tr><td>
      <span class="navBarH2">Visual Studio</span>
      <br>
      <small>
    <!--
        <a href="/addins/index.shtml">add-ins</a><br>

        <a href="/tips/index.shtml">editor tips</a><br>
        <a href="/macros/index.shtml">macros</a><br>
    -->
        <a href="/debug/index.shtml">debugging</a><br>
        <a href="/devstudio_macros/index.shtml">add-ins & macros</a><br>
        <a href="/tips/index.shtml">editor tips</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Windows Programming</span>
      <br>
      <small>
        <a href="/ce/index.shtml">ce</a><br>
        <a href="/clipboard/index.shtml">clipboard</a><br>
        <a href="/dll/index.shtml">dll</a><br>
        <a href="/files/index.shtml">file & folder</a><br>
        <a href="/help/index.shtml">help systems</a><br>
        <a href="/printing/index.shtml">printing</a><br>
        <a href="/win32/index.shtml">win32</a><br>
        <a href="/system/index.shtml">system</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Windows &amp; Dialogs</span>
      <br>
      <small>
        <a href="/console/index.shtml">console</a></br>
        <a href="/dialog/index.shtml">dialog</a><br>
        <a href="/docking/index.shtml">docking window</a><br>
        <a href="/doc_view/index.shtml">doc/view</a><br>
        <a href="/splitter/index.shtml">splitter</a><br>
      </small>
      <hr>
    </td></tr>

    </table>

<!-- JOB BUTTON --> 
    <table border=0 cellpadding=5 cellspacing=0 width=150>
    <tr><td align="center">
       <a href="http://jobs.internet.com" target="new">
         <IMG SRC="http://www.codeguru.com/jobs.gif" alt="[Internet Jobs]">
       </a>
    </td></tr>
    </table>

  </td>
</tr>
</table>

<!--/navbar>


<!-- blank column for spacing -->

<td valign="top" width="20">&nbsp;&nbsp;&nbsp;</td>

<!-- end blank column for spacing -->

<!-- begin content column -->

<TD VALIGN="TOP" >

<!--
<table cellpadding="0" cellspacing="0">
<tr>
-->

<!-- begin main content column -->


<!-- closign of column, row, and table are in subfoot file -->





<script type="text/javascript" language="javascript"> 
if (screen.width==640 || screen.width==800)
{
   document.write("<link rel=stylesheet href='/global/global800.css'>"); 
} 
else 
{ 
   document.write("<link rel=stylesheet href='/global/global.css'>"); 
} 
</script>


<CENTER><H3><FONT COLOR="#AOAO99">
Non volatile variables and configuration settings for MFC applications
</FONT></H3></CENTER><HR>

<!-- Author and contact details -->

This article was contributed by
<A HREF="mailto:ruben@pp.sbbs.se">Ruben Jönsson</A>.

<!-- Sample image - gif or jpg -->
<P><IMG SRC="CfgDemo.jpg" >

<!-- For which environment is this code specific??? -->
<p><u>Environment:</u> VC6 sp5 tested on W95 and W98

<p>
This article describes two classes for storing and retrieving string, numeric and BOOL variables to/from files in ASCII text format - much like INI files. The first class - CTxtVar, is used to dynamically add and remove variables in the text file. The second class - CCfg, which is derived from CTxtVar, is used as a base class to map a fixed set of variables or configuration settings in the text file to constant ID's which are used anywhere in the application to access (read and write) the actual variables/settings in the text file.

<h3>The CTxtVar class</h3>

I have chosen to put the variables in text files in human readable format instead of a binary format in order to make it easy to examine and modify the variables from any text editor. The format of the text file is divided into sections, items and variables:

<PRE>
[SECTION_HEADER]
ITEM VAR,VAR,VAR
ITEM VAR
ITEM VAR,VAR,VAR,VAR,VAR

[SECTION_HEADER]
ITEM VAR
ITEM VAR,VAR,VAR
</PRE>

Every item can have up to 20 variables attached to it (this is #defined to 20 in the CTxtVar header file for now - in the future this may be changed to a dynamic CStringList instead of a fixed array as now). For a real example, see the edit box on the right in the picture of the demo app above.
<p>
All variables are handled as strings in the CTxtVar class. Each line in the text file (item and section headers) are stored in a CStringList in the CTxtVar class. Items are accessed with a section header name and an item name. There are also functions to split the item and it's variables from a single
string to an array of strings, one for each variable, which makes it possible to extract a single variable from an item. String variables and item names that contains white spaces or commas must be embedded within double quotes to be treated as one single variable. The items and it's variables are written back to the string list as one complete string. It is up to the calling function to build this string before it is written back.
<p>
Other functions in the CTxtVar class is: Read stringlist from file, write stringlist to file, find section, find item in section, add item, remove item, remove section and iterate through a section getting the items one by one.
<p>
The CTxtVar class is used when the number of items in a section is dynamic - items are added and removed on the fly, or when the item name and number of variables for an item is unknown at design time. Even the section name could be unknown. Example of this is list or combo boxes which could have it's contents manipulated by the user. The demo app demonstrates this example.
<p>
The functions SetItem() and SetSectionItem() has a BOOL parameter called bAdd which, if set to TRUE, allows items with identical names to be added to one section as separate items. An example where this could be useful is where the item represents a graphical object of some sort in a view. The name of the item is given by the user - not known at design time. The graphical object could be displayed on several places, perhaps in different modes on the same view. The item is the name supplied by the user, variable 1 could be the drawing mode, variable 2 the x position, variable 3 the y position and so on. This would mean that the item name would show up for every object of this type that is placed in the view. To retrieve the variables for these items FindItem() and FindSectionItem() would only find the first item with this name after the section header. In this case it is more useful to use the function FindSectionHeader() for the section with the items of interest and then iterate through every item of this section with GetNextItem(), perhaps
building a linked list or an array of objects for these items, which is then used to access the objects within the application. One way to write back changed settings for the objects (added/removed objects, changed position) is to simply remove all items from the section in the string list with the function EmptySection() and then iterate through the list or array of objects in the app and for each one build the item string and write it back with SetSection() or SetSectionItem(). 
<p>
There is a BOOL member variable in the CTxtVar, m_bChanged, that is set to TRUE whenever a string is added, removed or changed in the string list. This value is checked in the destructor of the class which, if TRUE, automatically updates the text file. This means that there is generally no need to write the stringlist back to the text file manually (with Flush()) unless another class needs to read the text file during the lifetime of the CTxtVar class. This is the case in the demo app since the text file itself is displayed in a rich edit control and updated whenever there has been a change in the string list of the CTxtVar class. Of course, if the app exits unnaturally the destructor Flush() may not work so it will be a good idea Flush() critical changes back to the text file right after they are changed.
<p>
See the CTxtVar.cpp file for more information about member functions and variables.

<h3>The CCfg class</h3>

Whenever I do an MFC app I have a lot of variables and settings that should be saved between sessions. 
Call me old fashioned but I rather save these variables in a separate file in my app's directory than
in the registry for several reasons: It is easy to read and modify (if it is in text format),
it is easy to clean up, the same app can have several settings by simply starting it in different
directories, just to mention some. The variables used for configuration settings are all known at design
time. The CCfg class associates every setting/variable (and section and item) with an ID which is used
instead of the section name and item name to access it's value. Furthermore, the variables can be of type
string, numeric, limited numeric (limited by a max and min value) and BOOL. Every variable also has a
default value which is used if the setting isn't found in the text file (which it isn't the first time the
app starts or if the text file is deleted). If a value for a setting isn't found in the text file the
default value will be written to the text file.
<p>
The CCfg class holds the information for every variable, item and section in a list of CCfgNode derived
classes. These classes have information about the ID, the current value, the default value and a maximum
and minimum value for the limited numeric type. The CCfg class uses the string list of the CTxtVar to load 
the CCfgNodes with current values for the settings. The CCfgNode list is written back to the text file in
two steps, first the CCfgList is converted back to the string list in CTxtVar and then the base class CTxtVar
writes back the string list to the text file. This isn't done until the Flush() function is called which
could be as late as in the destructor of the CCfg and CTxtVar classes. The CCfg class dynamically builds the
CCfgNode list upon initialization from information in an array of structures typedefed as CFGDEF.
<p>
The CFGDEF array is where the programmer specifies what section names, item names types of variables, 
default values and ID's should be used for the settings. In order to keep things simple and not having
to remember too much about how this CFGDEF structure works I have created a set of macros that does most
of the job during compile time. Also, these macros automatically assigns the ID a unique number which
makes it impossible to have two ID's of the same number by mistake. How can this be done, you may ask,
how can a macro both define a structure array and declare a constant with a different value at the same time?
Well it can't, but by putting the macros for the definition of the CFGDEF structure in the header file of the
CCfg derived class (the user class) and redefining the macros and including this header file twice from the
implementation file (.cpp file) of the CCfg derived class it can. The macros that generate the unique ID's and
builds the CFGDEF array can look something like this:

<PRE>
BEGIN_CFGDEF(cfgdef)

   CFG_SECTION(CFGID_SETTINGS,"Settings")
      CFG_WINDOWPOS(CFGID_INITWINDOWPOS,"MainWindowPos",
                      100,100,620,510,0)
      CFG_FONT(CFGID_FONT,"Font","System",12,FW_NORMAL,FALSE)

      CFG_ITEM(CFGID_CURRENTCOMBOLIST,1,"Currentcombolist")
      CFG_STRING(CFGID_CURRENTCOMBOLIST_NAME,"")

      CFG_ITEM(CFGID_BOOL,1,"Bool")
      CFG_BOOL(CFGID_BOOLVALUE,0)

      CFG_ITEM(CFGID_NUM,1,"Numeric")
      CFG_NUM(CFGID_NUMVALUE,0)

      CFG_ITEM(CFGID_DIR,1,"Directory")
      CFG_STRING(CFGID_DIRSTRING,"")

END_CFGDEF
</PRE>
The resulting text file with default values for this CFGDEF looks like this:
<PRE>
[Settings]
MainWindowPos 100,100,620,510,0
Font "System",12,400,0
Currentcombolist ""
Bool 0
Numeric 0
Directory ""
</PRE>

The order of the items in the section may vary though.

<p>
I have chosen to make the CCfg derived class global in order to make it accessible from all classes that has
included the header file of the CCfg derived class. I think this is one case where a global variable is a good
thing in a C++ application. This way it is easy for the objects that needs to access non volatile variables or
configuration settings themselves without obtaining a pointer from another (global) class.
<p>
The variables/settings can be read by the following functions: GetBool(int VariableId), GetString(int VariableId) and 
GetNum(int VariableId) or GetBool(int ItemId, int VariableIndex), GetString(int ItemId, int VariableIndex) and
GetNum(int ItemId, int VariableIndex) where VariableIndex is the indexnumber for a variable in an Item. Index 0 is the
first varaible. Use the following functions to write variables/settings: SetBool(int VariableId,BOOL Value),
SetString(int VariableId,CString Value) and SetNum(int VariableId,long Value) or SetBool(int ItemId, int VariableIndex, BOOL Value), SetString(int ItemId, int VariableIndex, CString Value) and SetNum(int ItemId, int VariableIndex, CString Value).
<p>
To check the integrity of the CFGDEF array the debug version fails ASSERT macros if something is wrong. This could be: A CFG_SECTION isn't the first macro after BEGIN_CFGDEF or an item has more or less variables than
specified. ASSERT also fails if the application is trying to use the wrong access function for a variable ID, for example trying to read a string variable with the GetNum() function.

<h3>How the CFGDEF macros work</h3>

When the header file (the declaration file) for the CCfg derived class is included from the cpp file (the implementation file) for the CCfg derived class the first time or whenever it is included from another class the
macros generate a typedef of an enumerated variable that include all ID's from the CFGDEF macros. This way the ID's have been assigned unique consecutive numbers which is known by all classes that includes the declaration
file. Before the header file is included a second time from the cpp file of the CCfg derived class it has defined an identifier to tell the header file that this time the macros should generate the implementation of the CFGDEF
structure array. To accomplish this the macros are redefined. The definition and redefinition of the macros takes place in the header file for the CCfg class. 

<h3>How to use it</h3>

In order to use the CCfg class you have to derive a class from it and put the macros for the CFGDEF structure array in the derived class' header file. The only function needed is the constructor which has to generate
the CfgNode list with a call to MakeCfgList(const CFGDEF *cfg_def). It may be easiest to use the following implementation and declaration files as a template and change the names as you want.
<p>
The declaration file (header file)
<PRE>
<span class="codeComment">// CfgDem.h: interface for the CCfgDem class.
//
///////////////////////////////////////////////////////</span>

#if !defined( \
AFX_CFGDEM_H__20008C44_F97E_11D5_8C08_B343B9E2DD77__INCLUDED_)
#define \
AFX_CFGDEM_H__20008C44_F97E_11D5_8C08_B343B9E2DD77__INCLUDED_
#define __CFG_FIRST_RUN__   
#endif

#if defined(__CFG_FIRST_RUN__)
#define   __INCLUDE_CFGDEF__
#elif defined(__CFG_IMPLEMENTATION__)
#define   __INCLUDE_CFGDEF__
#endif

#if defined(__INCLUDE_CFGDEF__)
#include "Cfg.h"

<span class="codeComment">/*
   This file must be #included twice from the CCfg 
   derived class, once to enumerate the ID's 
   (definition) and once to implement the array of 
   CFGDEF structures (declaration).
   The CFG_... macros are redefined when 
   __CFG_IMPLEMENTATION__ is defined.

   When this file is included from the CCfg derived 
   class and __CFG_IMPLEMENTATOIN__ is defined the 
   following macros generate the array of CFGDEF 
   structures used to access the cfg file.

   When this file is included without 
   __CFG_IMPLEMENTATION__ defined (the first time
   it is included in the CCfg derived class and 
   whenever it is included in another cpp file) all 
   ID's are enumerated to generate unique numbers 
   for all cfg ID's.
*/</span>

   BEGIN_CFGDEF(cfgdef)  <span class="codeComment">// cfgdef is the name 
                         //for the CFGDEF structure 
                    // array - CFGDEF cfgdef[]={

      // Put the rest of the CFGDEF macros here</span>

   END_CFGDEF

#endif

#if defined(__CFG_FIRST_RUN__)

class CCfgDem : public CCfg  
{
public:
   CCfgDem();
   virtual ~CCfgDem();

};

extern CCfgDem cfg;    <span class="codeComment">// Make the global cfg 
                     // variable visible to 
                // other classes that 
                     // includes this .h file.</span>

#endif

#undef __INCLUDE_CFGDEF__
#undef __CFG_FIRST_RUN__
#undef __CFG_IMPLEMENTATION__
</PRE> 

Note that the #pragma once can not be used in this header file. Rename all instances of CCfgDem to whatever
name you want the derived class to have. 

<p>
The implementation file (cpp file)
<PRE>
<span class="codeComment">// CfgDem.cpp: implementation of the CCfgDem class.
//
//////////////////////////////////////////////////</span>

#include "stdafx.h"
#include "CfgDemo.h"
#include "CfgDem.h"

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

#define __CFG_IMPLEMENTATION__
#include "CfgDem.h"  <span class="codeComment">// When __CFG_IMPLEMENTATION__ is 
                     // defined 
                     // CfgDem.h actually defines the CFGDEF
                     // structure array</span>

CCfgDem     cfg;     <span class="codeComment">// Global CCfgDem class.</span>

<span class="codeComment">/////////////////////////////////////////////////////////
// Construction/Destruction
/////////////////////////////////////////////////////////</span>

CCfgDem::CCfgDem()
{
  MakeCfgList(cfgdef);  <span class="codeComment">// Make the cfg node list from 
                        // the cfgdef struct array.</span>
}

CCfgDem::~CCfgDem()
{

}
</PRE>

Rename all instances of CCfgDem to whatever name you want the derived class to have. 
<p>

See the source files for more information about the CCfg class.

<h3>About the demo app</h3>

The view class together with some custom controls handles all the functionality of the CfgDemo app. The document class is not used at all.
<p>
All controls on the left side is used to show and manipulate settings in the 
text file. The CRichEditCtrl on the right side is used to show the actual contents of the text file itself and is updated whenever the text file is changed.
<p>
There are two combo boxes which are used to enter and display data of three lists. The first combo box is of type drop list which selects one of three lists. The other combo box is a drop down type used to select and enter data into the list selected by the first combo box. The selection of an item in the second combo doesn't do anything in this demo, though. There is also a button to delete the currently selected list. The lists are updated and accessed in the text file by CTxtVar (base class of the CCfg class) functions that directly reads and writes to and from the CStringList representing the text file in the CTxtVar class. This is done to demonstrate that dynamic sections and items can be read and written to the same text file as CFGID linked sections and items.
<p>
There is a read only edit box which displays a directory selection done with a 
SHBrowseForFolder dialog through a button next to the edit box.
<p>
There is an edit box with a spin control used for entering a numeric value.
<p>
There is a check box used for a BOOL value.
<p>
There is a button which opens up a modal font selection dialog box to set the
font for the CRichEditCtrl. The font setting is also stored in the text file.
<p>
The app also uses a custom class derived from CFormView called CMyFormView as a base class for the view. This class automatically handles resizing and repositioning of controls on the form when the main frame is resized. The size, position and maximized/normal state is saved in the text file when the app closes and is restored when the app is loaded the next time. 
<p>
Use the source as you want. If you do - please send me a mail to tell me.

<h3>Downloads</h3>

<A HREF="CfgDemo.zip">Download demo project - 21 Kb</A><BR>
<A HREF="CfgDemoSource.zip">Download source - 47 Kb</A><BR>

<h3>History</h3>
<!-- submitted 1/10/02 -->
Date Posted:  January 24, 2002<BR>

<!-- Only use the following if the article is updated --> 
<!-- Date Last Updated:  [today's date in the format month day, year] -->

<!--comments-->
<h3>Comments:</h3><ul>
<!--startlist-->
<li><a href="/mfc/comments/32811.shtml">Thanks, works great</a> - gatman (2002/02/05)

<li><a href="/mfc/comments/32436.shtml">interest</a> - Moth (2002/01/27)

</ul>
<P>
<strong><a href="/cgi-bin/addpage/addpage.cgi?cfg=addcomment&action=Comment">
Add Comment</a></strong>
<P>

</td>

      <!--BLJAds - Added right side tower ad -->
<TD VALIGN="TOP">
<A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/16031/125x800/Oracle_RUP_ORA09M_1a/InternetcomRONSky120x600.html/38366531313035623364326631643230?2002.07.12.18.17.14"> <IMG SRC="http://ad.doubleclick.net/ad/N339.Internet.com/B974922.2;sz=120x600;ord=2002.07.12.18.17.14?" BORDER=0 WIDTH=120 HEIGHT=600 ALT=""></A>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/16031/125x800/Oracle_RUP_ORA09M_1a/InternetcomRONSky120x600.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>

<p>

<!-- Commerce bar -->
<table border="0" cellpadding="3" width="140">

<tr bgcolor="black"><td>
<font face="Arial" color="white" size="1" >
<b><center>internet.commerce</center></b></font>
</td></tr>
<tr bgcolor="lightgrey"><td>
<font face="Arial" size="1" >
<a href="http://www.internet.com/partners/">Be a Commerce Partner</A><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12033/cp1/Trellian_8d/PromoteYourWebsite.html/38366531313035623364326631643230">Promote Your Website</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12033/cp1/Trellian_8d/PromoteYourWebsite.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1112/cp2/Erain_1e/flash.html/38366531313035623364326631643230">FlashMX Tools/Bundles</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1112/cp2/Erain_1e/flash.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22960/cp3/PriceGrabber.com_2d/ComparisonShopping.html/38366531313035623364326631643230">Comparison Shopping</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22960/cp3/PriceGrabber.com_2d/ComparisonShopping.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12040/cp4/DealTime_3b/dealtime.html/38366531313035623364326631643230">Compare Prices</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12040/cp4/DealTime_3b/dealtime.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1119/cp5/Imsisoft_2a/ForWebGraphics.html/38366531313035623364326631643230">For Web Graphics</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1119/cp5/Imsisoft_2a/ForWebGraphics.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22967/cp6/UltraDNS_9e/FreeDNSOffer.html/38366531313035623364326631643230">Free DNS Offer</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22967/cp6/UltraDNS_9e/FreeDNSOffer.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12046/cp7/Global_Reports_2a/FindAnnualReports.html/38366531313035623364326631643230">Find Annual Reports</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12046/cp7/Global_Reports_2a/FindAnnualReports.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1126/cp8/Rawhide_3b/Rawhide_text.html/38366531313035623364326631643230">Search Marketplace</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1126/cp8/Rawhide_3b/Rawhide_text.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22973/cp9/Dice_16b/dice_careerbuilder_text.html/38366531313035623364326631643230">Internet Jobs</a>


<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/22973/cp9/Dice_16b/dice_careerbuilder_text.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12053/cp10/Kaspersky_Lab_4d/AntiVirusSoftware.html/38366531313035623364326631643230">Anti-Virus Software</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/12053/cp10/Kaspersky_Lab_4d/AntiVirusSoftware.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>

</font>
</td></tr>
</table>
<br>


</TD>

</tr>
</table>
<!-- begin footer information -->
<br>
<CENTER>
<SCRIPT LANGUAGE=JavaScript>
<!--
var plugin = 0;
if (navigator.mimeTypes && navigator.mimeTypes["application/x-shockwave-flash"] && navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)
{
if (navigator.plugins && navigator.plugins["Shockwave Flash"])plugin = 1;
}
else if (navigator.userAgent && navigator.userAgent.indexOf("MSIE")!="-1"
&& (navigator.userAgent.indexOf("Windows 95")>=0 || navigator.userAgent.indexOf("Windows 98")>=0 || navigator.userAgent.indexOf("Windows NT")>=0)) {
document.write('<SCRIPT LANGUAGE=VBScript\>\n');
document.write('on error resume next \n');
document.write('plugin = ( IsObject(CreateObject("ShockwaveFlash.ShockwaveFlash.3")))\n');
document.write('if ( plugin <= 0 ) then plugin = ( IsObject(CreateObject("ShockwaveFlash.ShockwaveFlash.4")))\n');
document.write('if ( plugin <= 0 ) then plugin = ( IsObject(CreateObject("ShockwaveFlash.ShockwaveFlash.5")))\n');
document.write('</SCRIPT\> \n');
}
if ( plugin )
{
document.write('<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"');
document.write('  codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=3,0,0,0" ');
document.write(' ID=chicagotower_new WIDTH=750 HEIGHT=100>');
document.write(' <PARAM NAME=movie VALUE="http://www.codeguru.com/RealMedia/ads/Creatives/House_VoiceXML_Planet_Conf_1a/vxml-750.swf?clickTAG=http://www.codeguru.com/RealMedia/ads/click_lx.ads/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1132/468x60-2/House_VoiceXML_Planet_Conf_1a/vxml-750x100.html/38366531313035623364326631643230?http://www.intmediaevents.com/vxml/fall02"><PARAM NAME=menu VALUE=false> <PARAM NAME=quality VALUE=high> <PARAM NAME=bgcolor VALUE=WHITE>  ');
document.write(' <EMBED src="http://www.codeguru.com/RealMedia/ads/Creatives/House_VoiceXML_Planet_Conf_1a/vxml-750.swf?clickTAG=http://www.codeguru.com/RealMedia/ads/click_lx.ads/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1132/468x60-2/House_VoiceXML_Planet_Conf_1a/vxml-750x100.html/38366531313035623364326631643230?http://www.intmediaevents.com/vxml/fall02" menu=false quality=high bgcolor=WHITE  ');
document.write(' swLiveConnect=FALSE WIDTH=750 HEIGHT=100');
document.write(' TYPE="application/x-shockwave-flash" PLUGINSPAGE="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash">');	document.write(' </EMBED>');
document.write(' </OBJECT>');
}
else if (!(navigator.appName && navigator.appName.indexOf("Netscape")>=0 && navigator.appVersion.indexOf("2.")>=0))
{
document.write('<a href="http://www.codeguru.com/RealMedia/ads/click_lx.ads/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1132/468x60-2/House_VoiceXML_Planet_Conf_1a/vxml-750x100.html/38366531313035623364326631643230?http://www.intmediaevents.com/vxml/fall02"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_VoiceXML_Planet_Conf_1a/vxml-750x100.gif" WIDTH=750 HEIGHT=100 BORDER=0>');
}
//-->
</SCRIPT>
<NOEMBED>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.ads/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1132/468x60-2/House_VoiceXML_Planet_Conf_1a/vxml-750x100.html/38366531313035623364326631643230?http://www.intmediaevents.com/vxml/fall02"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_VoiceXML_Planet_Conf_1a/vxml-750x100.gif" WIDTH=750 HEIGHT=100 BORDER=0>
</NOEMBED>
<NOSCRIPT>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.ads/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1132/468x60-2/House_VoiceXML_Planet_Conf_1a/vxml-750x100.html/38366531313035623364326631643230?http://www.intmediaevents.com/vxml/fall02"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_VoiceXML_Planet_Conf_1a/vxml-750x100.gif" WIDTH=750 HEIGHT=100 BORDER=0>
</NOSCRIPT><IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/CfgDemo.html/1132/468x60-2/House_VoiceXML_Planet_Conf_1a/vxml-750x100.html/38366531313035623364326631643230?_RM_EMPTY_" WIDTH=1 HEIGHT=1>


<br>
<FONT SIZE="-1">EarthWeb is a service of INT Media Group, Incorporated.<br>
Copyright 2002 INT Media Group, Incorporated. All Rights Reserved.<BR>
<A HREF="http://www.internet.com/help/feedback.html">Feedback</A>, &nbsp;
<A HREF="http://www.itmarketer.com">Advertising Info</A>, &nbsp;
<A HREF="http://www.internet.com/corporate/legal.html">Legal Notices</A>,&nbsp;
<A HREF="http://www.internet.com/corporate/reprints.html#Licensing">Licensing</A>, 
<A HREF="http://www.internet.com/corporate/reprints.html#Reprints">Reprints</A>, &amp; 
<A HREF="http://www.internet.com/corporate/reprints.html#Permissions">Permissions</A>, &nbsp;
<A HREF="http://www.internet.com/corporate/privacy/privacypolicy.html">Privacy Policy</A>.
<BR>
<A HREF="http://www.internet.com"><IMG SRC="/images/internetcom.gif"
ALT="http://www.internet.com/" WIDTH="161" HEIGHT="18"
BORDER="0"></A></FONT>
</CENTER>

</BODY>
</HTML>






