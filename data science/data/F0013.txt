ID=F0013
URL=http://jadebox.dreamhost.com/vbprog/html/listing_3_-_metafile.bas.html
SIZE=22550
DATE=09/07/2002
TIME=13:11:55
DATASET=Visual Basic
HTML=<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<HTML>
<HEAD>
<TITLE>Listing 3 - METAFILE.BAS</TITLE>
<meta name="keywords" content="Visual Basic,VB,VB5,VB6,Programming,Application,Development,Debug,Debugging,Basic,Metafiles,WMF,JPEG,JPG,GIF,Image,Images">

<META NAME="Generator" CONTENT="NetObjects Fusion 2.0.2 for Windows">

</HEAD>

<BODY BGCOLOR="#FFFFFF" LINK="#800000" VLINK="#808080" TEXT="#000000">
<TABLE CELLPADDING=0 CELLSPACING=0 BORDER=0 WIDTH=1341>
<TR VALIGN="top" ALIGN="left">
<TD>

  <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH=98>
   <TR VALIGN="top" ALIGN="left">
	<TD WIDTH=2 HEIGHT =75><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =2 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=96><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =96 HEIGHT =1 BORDER=0></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD HEIGHT =230></TD>
	<TD WIDTH=96>
	  <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=3 >
	 <TR VALIGN="top" ALIGN="left">
		<TD WIDTH=90 HEIGHT=40><A HREF="../index.html"><IMG HEIGHT=40 WIDTH=90 SRC="../assets/auto_generated_images/img_49ab4036.gif"  BORDER=0  ALT=" Home " ></A></TD>
	 </TR>
	 <TR VALIGN="top" ALIGN="left">
		<TD WIDTH=90 HEIGHT=40><A HREF="../html/meta_files.html"><IMG HEIGHT=40 WIDTH=90 SRC="../assets/auto_generated_images/img_49b45df1a.gif"  BORDER=0  ALT=" Meta Files " ></A></TD>
	 </TR>
	 <TR VALIGN="top" ALIGN="left">
		<TD WIDTH=90 HEIGHT=40><A HREF="../html/review__hardcore_visual_basic.html"><IMG HEIGHT=40 WIDTH=90 SRC="../assets/auto_generated_images/img_4c083bc1.gif"  BORDER=0  ALT=" Hardcore VB " ></A></TD>
	 </TR>
	 <TR VALIGN="top" ALIGN="left">
		<TD WIDTH=90 HEIGHT=40><A HREF="../html/what_s_wrong_with_vb_.html"><IMG HEIGHT=40 WIDTH=90 SRC="../assets/auto_generated_images/img_4c0841a2.gif"  BORDER=0  ALT=" What's Wrong? " ></A></TD>
	 </TR>
	 <TR VALIGN="top" ALIGN="left">
		<TD WIDTH=90 HEIGHT=40><A HREF="../html/jpg_and_gif_sizes.html"><IMG HEIGHT=40 WIDTH=90 SRC="../assets/auto_generated_images/img_5138a491.gif"  BORDER=0  ALT=" Image Sizes " ></A></TD>
	 </TR>
	  </TABLE></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD COLSPAN=2 HEIGHT =6556></TD>
   </TR>
  </TABLE>
</TD>
<TD>

  <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH=1243>
   <TR VALIGN="top" ALIGN="left">
	<TD HEIGHT =71></TD>
	<TD WIDTH=468 COLSPAN=2><A HREF="http://www.jadebox.com/arrow/"><IMG HEIGHT=60 WIDTH=468 SRC="../assets/images/aniarrow.gif"  BORDER=0  ALT="Arrow" ></A></TD>
	<TD></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD WIDTH=12 HEIGHT =40><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =12 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=310><IMG HEIGHT=40 WIDTH=310 SRC="../assets/auto_generated_images/img_4a95e36107.gif"  BORDER=0  ALT=" Listing 3 - METAFILE.BAS " ></TD>
	<TD WIDTH=158><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =158 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=763><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =763 HEIGHT =1 BORDER=0></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD COLSPAN=4 HEIGHT =10></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD HEIGHT =48></TD>
	<TD WIDTH=468 COLSPAN=2 ALIGN="left" VALIGN="top"><A HREF="../html/listings.html"><IMG HEIGHT=48 WIDTH=48 SRC="../assets/images/Hand_Icon_Up.gif"  BORDER=0  ALT="Picture" ></A></TD>
	<TD></TD>
   </TR>
  </TABLE>

  <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 WIDTH=1243>
   <TR VALIGN="top" ALIGN="left">
	<TD WIDTH=12 HEIGHT =11><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =12 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=494><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =494 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=737><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =737 HEIGHT =1 BORDER=0></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD></TD>
	<TD WIDTH=494><P><FONT SIZE="-2" FACE="Courier New,Courier">'*******************************************</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'Windows Placeable MetaFile Library</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'Copyright (c) 1994 by Roger Smith</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'See:</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'&nbsp;&nbsp;&nbsp;&nbsp; http://www.jadebox.com/vbprog/</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'DO NOT DISTRIBUTE MODIFIED VERSIONS OF</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'THIS FILE WITHOUT PERMISSION FROM ROGER</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'SMITH.</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'*******************************************</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Option Explicit</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' The Meta_Placeable_Header Structure</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' defines the header for a Placeable</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' Windows MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Type Meta_Placeable_Header</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtKey As Long 'must be 0x9AC6CDD7</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtHandle As Integer 'must be 0</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtLeft As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtTop As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtRight As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtBottom As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtInch As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtReserved As Long 'must be 0</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; mtCheckSum As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">End Type</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">' The Meta_File_Info Structure and Meta_Files</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' array store information about open metafiles.</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' The array is global since the functions in</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' METAGDI.BAS need access to it.</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Type Meta_File_Info</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; File_Open As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_hDC As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Left As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Right As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Top As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Bottom As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_File As String</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Units As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_OldPen As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_BlackPen As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Brush As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_OldBrush As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">End Type</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Global Meta_Files() As Meta_File_Info</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">' The Meta_Init_Done flag is used</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' to test if this package has been</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' initialized</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Dim Meta_Init_Done As Integer</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">'*******************************************</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'Meta_File_Close Subroutine - Closes the</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'MetaFile and adds the Placeable MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'Header.</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'*******************************************</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Sub Meta_File_Close (index As Integer)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim hMF As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim Ivar As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim Header As Meta_Placeable_Header</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim C As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim Temp_Ext As String</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim WMF_Ext As String</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim InFile As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim OutFile As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim buffer As String</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; If Not Meta_Init_Done Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Exit Sub</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; End If</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; If index &lt; 0 Or index &gt; UBound(Meta_Files) Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Exit Sub</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; End If</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; If Not Meta_Files(index).File_Open Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Exit Sub</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; End If</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Deinitialize the MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_OldPen = SelectObject(Meta_Files(index).Meta_hDC, Meta_Files(index).Meta_OldPen)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Ivar = DeleteObject(Meta_Files(index).Meta_BlackPen)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_OldBrush = SelectObject(Meta_Files(index).Meta_hDC, Meta_Files(index).Meta_OldBrush)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Ivar = DeleteObject(Meta_Files(index).Meta_Brush)</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Close the MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; hMF = CloseMetaFile(Meta_Files(index).Meta_hDC)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Ivar = DeleteMetaFile(hMF)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).File_Open = False</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Open the Temporary file</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Temp_Ext = &quot;~~~&quot;</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; OutFile = FreeFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Open Meta_Files(index).Meta_File + Temp_Ext For Binary As OutFile</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Initialize the Header</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtKey = &amp;H9AC6CDD7</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtHandle = 0</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtLeft = Meta_Files(index).Meta_Left</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtTop = Meta_Files(index).Meta_Top</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtRight = Meta_Files(index).Meta_Right</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtBottom = Meta_Files(index).Meta_Bottom</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtInch = Meta_Files(index).Meta_Units</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtReserved = 0</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Header.mtCheckSum = 0</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Write the Header to the Temporary File</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Put OutFile, 1, Header</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Compute the Header's Checksum</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; For Ivar = 1 To 20 Step 2</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Get OutFile, Ivar, C</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Header.mtCheckSum = Header.mtCheckSum Xor C</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Next Ivar</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Update the Header</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Put OutFile, 1, Header</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Append the Original MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; WMF_Ext = &quot;WMF&quot;</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; InFile = FreeFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Open Meta_Files(index).Meta_File + WMF_Ext For Binary As InFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; buffer = Space(LOF(InFile))</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Get InFile, 1, buffer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Put OutFile, 23, buffer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; </FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Close the files</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Close OutFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Close InFile</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Move the Temporary File to the Original</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Kill Meta_Files(index).Meta_File + WMF_Ext</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Name Meta_Files(index).Meta_File + Temp_Ext As Meta_Files(index).Meta_File + WMF_Ext</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Shrink the Meta_Files array</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; If index = UBound(Meta_Files) Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Do While index &gt; 1</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Meta_Files(index).File_Open Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Do</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = index - 1</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReDim Preserve Meta_Files(index)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Loop</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; End If</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">End Sub</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">'*******************************************</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' Meta_File_Open function - Opens a MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' for output and returns an index to the</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">' metafile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">'*******************************************</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">Function Meta_File_Create (FileSpec As String, LeftX As Integer, RightX As Integer, TopY As Integer, BottomY As Integer, Units As Integer) As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim Ivar As Integer</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim Lvar As Long</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim lb As LOGBRUSH</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Dim index As Integer</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' Initialize if we haven't already</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; If Not Meta_Init_Done Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; ReDim Preserve Meta_Files(1)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Meta_Files(1).File_Open = False</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; Meta_Init_Done = True</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; End If</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' Look for an unused slot in the Meta_Files</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' array</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; index = 1</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Do While index &lt;= UBound(Meta_Files)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; If Not Meta_Files(index).File_Open Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Do</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp; Else</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; index = index + 1</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; End If</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Loop</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' Add a slot if none free</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; If index &gt; UBound(Meta_Files) Then</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp;&nbsp;&nbsp; ReDim Preserve Meta_Files(index)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; End If</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' Mark the slot as used</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).File_Open = True</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Store the File Specification</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Ivar = InStr(FileSpec + &quot;.&quot;, &quot;.&quot;)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_File = Left(FileSpec + &quot;.&quot;, Ivar)</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; 'Save Size and Position</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_Left = LeftX</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_Right = RightX</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_Top = TopY</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_Bottom = BottomY</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_Units = Units</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' Create and Initialize the MetaFile</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_hDC = CreateMetaFile(Meta_Files(index).Meta_File + &quot;WMF&quot;)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_BlackPen = CreatePen(PS_SOLID, 0, RGB(0, 0, 0))</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_OldPen = SelectObject(Meta_Files(index).Meta_hDC, Meta_Files(index).Meta_BlackPen)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Lvar = SetBKColor(Meta_Files(index).Meta_hDC, RGB(255, 255, 255))</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; lb.lbStyle = 0</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; lb.lbColor = QBColor(0)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; lb.lbHatch = 0</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_Brush = CreateBrushIndirect(lb)</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_Files(index).Meta_OldBrush = SelectObject(Meta_Files(index).Meta_hDC, Meta_Files(index).Meta_Brush)</FONT></P><P>&nbsp;</P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; ' Return the Index</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">&nbsp; Meta_File_Create = index</FONT></P><P><FONT SIZE="-2" FACE="Courier New,Courier">End Function</FONT></P><P>&nbsp;</TD>

	<TD></TD>
   </TR>
  </TABLE>

  <TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0>
   <TR VALIGN="top" ALIGN="left">
	<TD WIDTH=19 HEIGHT =17><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =19 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=431><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =431 HEIGHT =1 BORDER=0></TD>
	<TD WIDTH=793><IMG SRC="../assets/auto_generated_images/img_3dfbb805.gif" WIDTH =793 HEIGHT =1 BORDER=0></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD></TD>
	<TD NOWRAP> [<A HREF="../index.html">Home</A>]  [<A HREF="../html/meta_files.html">Meta&nbsp;Files</A>]  [<A HREF="../html/review__hardcore_visual_basic.html">Hardcore&nbsp;VB</A>]  [<A HREF="../html/what_s_wrong_with_vb_.html">What's&nbsp;Wrong?</A>]  [<A HREF="../html/jpg_and_gif_sizes.html">Image&nbsp;Sizes</A>] </TD>
	<TD></TD>
   </TR>
   <TR VALIGN="top" ALIGN="left">
	<TD COLSPAN=3 HEIGHT =975></TD>
   </TR>
  </TABLE>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>

