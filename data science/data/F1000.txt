ID=F1000
URL=http://www.vb-helper.com/howto_find_angles.html
SIZE=18818
DATE=09/07/2002
TIME=13:28:47
DATASET=Visual Basic
HTML=<HTML>
<META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.rsac.org/ratingsv01.html" l gen true comment "RSACi North America Server" by "RodStephens@vb-helper.com" for "http://www.vb-helper.com" on "1998.03.17T18:18-0800" r (n 0 s 0 v 0 l 0))'>
<HEAD>
<TITLE>VB Helper: HowTo: Find the angle between two line segments</TITLE>
<META NAME="Author" CONTENT="Rod Stephens">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Keywords" CONTENT="angle, line segments">
<META NAME="Keywords" CONTENT="angle, line segments">
<META NAME="Description" CONTENT="VB Helper: HowTo: Find the angle between two line segments">
<META NAME="Copyright" CONTENT="Copyright 1997-2001, Rocky Mountain Computer Consulting, Inc.">
<META NAME="Rating" CONTENT="General">
<META NAME="Robots" CONTENT="All">
</HEAD>

<BODY BGCOLOR="#E1F3FF" BACKGROUND="bg_blue.jpg">

  <!-- This table contains the banner, menu column, and content. -->
  <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
    <!-- ****** -->
    <!-- Banner -->
    <!-- ****** -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0" ALIGN="Left">
        <TR>
          <TD BACKGROUND="banner_mid.jpg"><IMG SRC="banner_l.jpg" WIDTH="410" HEIGHT="64"></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="banner_r.jpg" WIDTH="32" HEIGHT="64"></TD>
        </TR>
      </TABLE>
    </TD></TR>
    <TR><TD>&nbsp;</TD></TR>

    <!-- Menu column and content -->
    <TR><TD>
      <TABLE WIDTH="100%" BORDER="0" CELLSPACING="2" CELLPADDING="0">
        <!-- *********** -->
        <!-- Menu column -->
        <!-- *********** -->
        <TR>
          <TD ALIGN="Left" VALIGN="Top">
            <TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- Menu top -->
              <TR>
                <TD><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_um.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Menu entries -->
              <TR BGCOLOR="#7FCFFF">
                <TD BACKGROUND="blue_l.jpg" WIDTH="16">&nbsp;</TD>
                <TD><CENTER>
                  <A HREF="index.html"><B><FONT SIZE="+1">Home</FONT></B></A><BR>
                  &nbsp;<BR>
                  <A HREF="whats_new.html"><B>What's New</B></A><BR>
                  <A HREF="index_categories.html"><B>Index</B></A><BR>
                  <A HREF="books.html"><B>Books</B></A><BR>
                  <A HREF="links.html"><B>Links</B></A><BR>
                  <A HREF="http://www.topica.com/lists/VBHelperQA/read"><B>Q &amp; A</B></A><BR>
                  <A HREF="newsletter.html"><B>Newsletter</B></A><BR>
                  <A HREF="banners.html"><B>Banners</B></A><BR>
                  &nbsp;<BR>
                  <A HREF="mailto:feedback@vb-helper.com"><B>Feedback</B></A><BR>
                  <A HREF="tip_jar.html"><B>Tip Jar</B></A><BR>
                </CENTER></TD>
                <TD BACKGROUND="blue_r.jpg" WIDTH="16">&nbsp;</TD>
              </TR>

              <!-- Menu bottom -->
              <TR>
                <TD><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lm.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <TR><TD HEIGHT="20" COLSPAN="3">&nbsp;</TR></TD>
              <!-- Old Menu top -->
              <TR>
                <TD><IMG SRC="magenta_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="magenta_t.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="magenta_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Menu entries -->
              <TR BGCOLOR="#E36BFF">
                <TD BACKGROUND="magenta_lside.jpg" WIDTH="16">&nbsp;</TD>
                <TD><CENTER>
                  <B><FONT SIZE="+1">Old Pages</FONT></B><BR>
                  &nbsp;<BR>
                  <A HREF="old_index.htm"><B>Old Index</B></A></BR>
                  <A HREF="sitemap.htm"><B>Site Map</B></A></BR>
                  <A HREF="whatsnew.htm"><B>What's New</B></A></BR>
                  &nbsp;<BR>
                  <A HREF="books.htm"><B>Books</B></A></BR>
                  <A HREF="howto.htm"><B>How To</B></A></BR>
                  <A HREF="tips.htm"><B>Tips &amp; Tricks</B></A></BR>
                  <A HREF="tutorial.htm"><B>Tutorials</B></A></BR>
                  <A HREF="stories.htm"><B>Stories</B></A></BR>
                  <A HREF="perform.htm"><B>Performance</B></A></BR>
                  <A HREF="essays.htm"><B>Essays</B></A></BR>
                  <A HREF="links.htm"><B>Links</B></A></BR>
                  <A HREF="q_and_a.htm"><B>Q &amp; A</B></A></BR>
                  <A HREF="newvb6.htm"><B>New in VB6</B></A></BR>
                  <A HREF="free.htm"><B>Free Stuff</B></A></BR>
                  <A HREF="pictures.htm"><B>Pictures</B></A></BR>
                </CENTER></TD>
                <TD BACKGROUND="magenta_rside.jpg" WIDTH="16">&nbsp;</TD>
              </TR>

              <!-- Old Menu bottom -->
              <TR>
                <TD><IMG SRC="magenta_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
                <TD><IMG SRC="magenta_b.jpg" WIDTH="93" HEIGHT="16"></TD>
                <TD><IMG SRC="magenta_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
              </TR>

              <!-- Other stuff in the menu column -->
              <TR><TD HEIGHT="100" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ***************** -->
              <!-- Amazon Recommends -->
              <!-- ***************** -->
              <TR><TD COLSPAN="3" ALIGN="Center">
<!-- -->
                <SCRIPT SRC="http://rcm.amazon.com/e/cm?t=vbhelper&l=rc1&p=2&o=1" TYPE="text/JavaScript"></SCRIPT>
<!-- -->
                <NOSCRIPT>
                  <TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="125">
                    <TR><TD>
                      <MAP NAME="boxmap">
                        <AREA SHAPE="RECT" COORDS="18, 263, 105, 274" HREF="http://rcm.amazon.com/e/cm/privacy-policy.html?o=1">
                        <AREA COORDS="0,0,10000,10000" HREF="http://www.amazon.com/exec/obidos/redirect-home/vbhelper">
                      </MAP>
                      <img src="http://rcm-images.amazon.com/images/G/01/associates/amzn_recommends/gnbox125x275.gif" width="125" height="275" border="0" usemap="#boxmap">
                    </TD></TR>
                  </TABLE>
                </NOSCRIPT>
              </TD></TR>
              <TR><TD HEIGHT="100" COLSPAN="3">&nbsp;</TR></TD>

              <!-- ******** -->
              <!-- Partners -->
              <!-- ******** -->
              <TR><TD COLSPAN="3" ALIGN="Center" BACKGROUND="sandpaper.gif"><A HREF="http://www.wiley.zcom/compbooks"><IMG SRC="wiley_logo.gif" BORDER="0" ALIGN="Center" WIDTH="77" HEIGHT="105"></TD></TR>
              <TR><TD COLSPAN="3"><FONT SIZE="1">&nbsp;</FONT></TD></TR>
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="http://www.quepublishing.com"><IMG SRC="que.gif" BORDER="0" ALIGN="Center" WIDTH="121" HEIGHT="36"></A></TD></TR>
              <TR><TD COLSPAN="3"><FONT SIZE="1">&nbsp;</FONT></TD></TR>
              <TR><TD COLSPAN="3" ALIGN="Center"><A HREF="amazon.html"><IMG SRC="amazon_logo.gif" BORDER="0" ALIGN="Center" WIDTH="68" HEIGHT="65"></A></TD></TR>
              <TR><TD COLSPAN="3">&nbsp;</TR></TD>

              <!-- ********** -->
              <!-- More stuff -->
              <!-- ********** -->
            </TABLE>
          </TD>

          <!-- A little space between the menus and content -->
          <TD WIDTH="5">&nbsp;</TD>

          <!-- ******* -->
          <!-- Content -->
          <!-- ******* -->
          <TD WIDTH="100%" ALIGN="Left" VALIGN="Top">
            <TABLE WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
              <!-- How To Summary -->
              <TR><TD>
                <TABLE WIDTH="100%" BORDER="2" CELLSPACING="0" CELLPADDING="2">
                  <TR><TH ALIGN="Left">Title</TH><TD WIDTH="100%">Find the angle between two line segments</TD></TR>
                  <TR><TH ALIGN="Left">Keywords</TH><TD>angle, line segments</TD></TR>
                  <TR><TH ALIGN="Left">Categories</TH><TD>Algorithms</TD></TR>
                </TABLE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
The GetAngle function uses vector mathematics including dot products and cross products. Before you can understand the function, it helps to understand a little vector algebra.
<P>
A <B>vector</B> consists of a series of components giving a direction and a distance. You can think of the vector as an arrow: it has direction and length.
<P>
In 2 dimensions, you can write a vector as &lt;x, y&gt; where x and y give the vector's X and Y components. For example, the vector &lt;2, 0&gt; is a vector of length 2 parallel to the X axis and pointing to the right (in the positive X direction).
<P>
You can find the vector between two points by subtracting the coordinates of the points. The vector from point (x1, y1) to point (x2, y2) is:
<P>
<PRE>    V = &lt;x2 - x1, y2 - y1&gt;</PRE>
<P>
The <B>length</B> of a vector &lt;x, y&gt; is written |&lt;x, y&gt;| . Using the Pythagorean Theorem it is easy to show that:
<P>
<PRE>    |&lt;x, y&gt;| = Sqr(x * x + y * y)</PRE>
<P>
<TABLE WIDTH="100%" BGCOLOR="00C0FF">
  <TR><TD><FONT SIZE="+2"><B>Dot Product</B></FONT></TD></TR>
</TABLE>
<P>
The <B>dot product</B> of two vectors A = &lt;x1, y1&gt; and B = &lt;x2, y2&gt; is written A &#183; B and has the value:
<P>
<PRE>    A &#183; B = |A| * |B| * Cos(theta)</PRE>
<P>
where theta is the angle between the two vectors. You can easily calculate the dot product using this equation:
<P>
<PRE>    A &#183; B = x1 * x2 + y1 * y2</PRE>
<P>
The following code calculates the dot product of two vectors. The function takes as parameters the coordinates of three points A, B, and C, and finds the dot product of the vectors AB and BC.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Return the dot product AB &#183; BC.</FONT>
<FONT COLOR="#008000">' Note that AB &#183; BC = |AB| * |BC| * Cos(theta).</FONT>
Private Function DotProduct( _
    ByVal Ax As Single, ByVal Ay As Single, _
    ByVal Bx As Single, ByVal By As Single, _
    ByVal Cx As Single, ByVal Cy As Single _
  ) As Single
Dim BAx As Single
Dim BAy As Single
Dim BCx As Single
Dim BCy As Single

    <FONT COLOR="#008000">' Get the vectors' coordinates.</FONT>
    BAx = Ax - Bx
    BAy = Ay - By
    BCx = Cx - Bx
    BCy = Cy - By

    <FONT COLOR="#008000">' Calculate the dot product.</FONT>
    DotProduct = BAx * BCx + BAy * BCy
End Function</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
<TABLE WIDTH="100%" BGCOLOR="00C0FF">
  <TR><TD><FONT SIZE="+2"><B>Cross Product</B></FONT></TD></TR>
</TABLE>
<P>
The <B>cross product</B> of two vectors A = &lt;x1, y1&gt; and B = &lt;x2, y2&gt; is written A &#215; B. The result is a new vector that is prependicular to both A and B and that has length:
<P>
<PRE>    |A &#215; B| = |A| * |B| * Sin(theta)</PRE>
<P>
where theta is the angle between the two vectors. You can calculate the cross product of two vectors in the X-Y plane using this equation:
<P>
<PRE>    A &#215; B = &lt;0, 0, x1 * y2 - x2 * y1&gt;</PRE>
<P>
Note that this vector is parallel to the Z-axis. That makes sense because the vectors A and B lie in the X-Y plane and the cross product should give a vector perpendicular to both.
<FONT SIZE="-1"><B>Exercise: Calculate &lt;1, 0&gt; &#215; &lt;0, 1&gt;. Does the result make sense?</B></FONT>
<P>
There are similar formulas (although they are a bit more complicated) for calculating cross products in higher dimensions.
<P>
The following code calculates the cross product of two vectors and returns the length of the result.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Return the cross product AB x BC.</FONT>
<FONT COLOR="#008000">' The cross product is a vector perpendicular to AB</FONT>
<FONT COLOR="#008000">' and BC having length |AB| * |BC| * Sin(theta) and</FONT>
<FONT COLOR="#008000">' with direction given by the right-hand rule.</FONT>
<FONT COLOR="#008000">' For two vectors in the X-Y plane, the result is a</FONT>
<FONT COLOR="#008000">' vector with X and Y components 0 so the Z component</FONT>
<FONT COLOR="#008000">' gives the vector's length and direction.</FONT>
Public Function CrossProductLength( _
    ByVal Ax As Single, ByVal Ay As Single, _
    ByVal Bx As Single, ByVal By As Single, _
    ByVal Cx As Single, ByVal Cy As Single _
  ) As Single
Dim BAx As Single
Dim BAy As Single
Dim BCx As Single
Dim BCy As Single

    <FONT COLOR="#008000">' Get the vectors' coordinates.</FONT>
    BAx = Ax - Bx
    BAy = Ay - By
    BCx = Cx - Bx
    BCy = Cy - By

    <FONT COLOR="#008000">' Calculate the Z coordinate of the cross product.</FONT>
    CrossProductLength = BAx * BCy - BAy * BCx
End Function</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
<TABLE WIDTH="100%" BGCOLOR="00C0FF">
  <TR><TD><FONT SIZE="+2"><B>Finding Angles</B></FONT></TD></TR>
</TABLE>
Now you can use the dot product and cross product to find the sine and cosine of the angle between the two vectors.
<P>
<PRE>    Cos(theta) =  A &#183; B  / (|A| * |B|)
    Sin(theta) = |A &#215; B| / (|A| * |B|)</PRE>
<P>
A little trigonometry gives you:
<P>
<PRE>    Tan(theta) = Sin(theta) / Cos(theta)</PRE>
<P>
So
<PRE>    Tan(theta) = [|A &#215; B| / (|A| * |B|)] / [A &#183; B  / (|A| * |B|)]
               = |A &#215; B| / A &#183; B</PRE>
<P>
The following routines use these facts to calculate the angle between two vectors.
              </TD></TR>

              <!-- Code content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR>
                <TD BACKGROUND="computer_paper.jpg">
                  <PRE><FONT NAME="Courier New" POINT-SIZE="10" SIZE="2"><FONT COLOR="#008000">' Return the angle with tangent opp/hyp. The returned</FONT>
<FONT COLOR="#008000">' value is between PI and -PI.</FONT>
Public Function ATan2(ByVal opp As Single, ByVal adj As _
    Single) As Single
Dim angle As Single

    <FONT COLOR="#008000">' Get the basic angle.</FONT>
    If Abs(adj) &lt; 0.0001 Then
        angle = PI / 2
    Else
        angle = Abs(Atn(opp / adj))
    End If

    <FONT COLOR="#008000">' See if we are in quadrant 2 or 3.</FONT>
    If adj &lt; 0 Then
        <FONT COLOR="#008000">' angle &gt; PI/2 or angle &lt; -PI/2.</FONT>
        angle = PI - angle
    End If

    <FONT COLOR="#008000">' See if we are in quadrant 3 or 4.</FONT>
    If opp &lt; 0 Then
        angle = -angle
    End If

    <FONT COLOR="#008000">' Return the result.</FONT>
    ATan2 = angle
End Function

<FONT COLOR="#008000">' Return the angle ABC.</FONT>
<FONT COLOR="#008000">' Return a value between PI and -PI.</FONT>
<FONT COLOR="#008000">' Note that the value is the opposite of what you might</FONT>
<FONT COLOR="#008000">' expect because Y coordinates increase downward.</FONT>
Public Function GetAngle(ByVal Ax As Single, ByVal Ay As _
    Single, ByVal Bx As Single, ByVal By As Single, ByVal _
    Cx As Single, ByVal Cy As Single) As Single
Dim dot_product As Single
Dim cross_product As Single

    <FONT COLOR="#008000">' Get the dot product and cross product.</FONT>
    dot_product = DotProduct(Ax, Ay, Bx, By, Cx, Cy)
    cross_product = CrossProductLength(Ax, Ay, Bx, By, Cx, _
        Cy)

    <FONT COLOR="#008000">' Calculate the angle.</FONT>
    GetAngle = ATan2(cross_product, dot_product)
End Function</FONT></PRE>
              </TD></TR>

              <!-- Text content -->
              <TR><TD>&nbsp;<BR></TD></TR>
              <TR><TD>
The book <A HREF="vbgp.htm">Visual Basic Graphics Programming</A> contains more information on vector calculations used fro producing three-dimensional graphics.
              </TD></TR>

              <!-- *************** -->
              <!-- Download button -->
              <!-- *************** -->

              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>
              <TR><TD ALIGN="Center"><A HREF="HowTo/howto_find_angles.zip"><IMG SRC="download.jpg" BORDER="0"></A></TD></TR>
              <TR><TD><FONT SIZE="-2">&nbsp;</FONT></TD></TR>

            </TABLE> <!-- End content table -->
          </TD>
        </TR> <!-- End row containing menu column and content -->
      </TABLE> <!-- End table containing menu column and content -->
    </TD></TR>

    <!-- ****** -->
    <!-- Footer -->
    <!-- ****** -->
    <TR><TD WIDTH="100%">
      <TABLE WIDTH="100%" BORDER="0" BGCOLOR="#87CEFA" CELLSPACING="0" CELLPADDING="0">
        <!-- Top row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ul.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_um.jpg" COLSPAN="2" ALIGN="Center"><FONT SIZE="-2">
            Copyright &copy; 1997-2001 Rocky Mountain Computer Consulting, Inc. &nbsp; All rights reserved.
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_ur.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>

        <!-- Bottom row -->
        <TR>
          <TD BGCOLOR="#E1F3FF" ALIGN="Right" WIDTH="16"><IMG SRC="blue_ll.jpg" WIDTH="16" HEIGHT="16"></TD>
          <TD BACKGROUND="blue_lm.jpg"><FONT SIZE="-2">
            &nbsp;<SCRIPT LANGUAGE=JavaScript>document.write(document.URL)</SCRIPT></FONT></TD>
          <TD BACKGROUND="blue_lm.jpg" ALIGN="Right"><FONT SIZE="-2">
            Updated <SCRIPT LANGUAGE=JavaScript>document.write(document.lastModified)</SCRIPT> &nbsp;
          </FONT></TD>
          <TD BGCOLOR="#E1F3FF"><IMG SRC="blue_lr.jpg" WIDTH="16" HEIGHT="16"></TD>
        </TR>
      </TABLE>
    </TD></TR>
  </TABLE> <!-- End table containing banner, menu column + content, and footer -->

</BODY>
</HTML>
