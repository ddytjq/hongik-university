ID=E0999
URL=http://www.gotw.ca/gotw/048.htm
SIZE=25871
DATE=12/07/02
TIME=19:26:39
DATASET=C
HTML=
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">


<title>GotW #48: Switching Streams</title>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="stylesheet" type="text/css" href="../gotw.css">
<meta name="Microsoft Theme" content="gotw 111, default">
<meta name="Microsoft Border" content="tlb, default">
</head>

<body background="../_themes/gotw/glabkgnd.jpg" bgcolor="#CCFFFF" text="#000000" link="#008080" vlink="#008080" alink="#0000FF"  ><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font><table border="0" cellspacing="0" width="100%">
  <tr>
    <td colspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica"><font size="6"><strong>
    GotW #48</strong></font> <!--mstheme--></font></td>
  </tr>
  <tr>
    <td valign="middle"><!--mstheme--><font face="Arial, Arial, Helvetica">




<p align="left" style="margin-top: 0; margin-bottom: 0">

<script language="JavaScript"><!--
MSFPhover = 
  (((navigator.appName == "Netscape") && 
  (parseInt(navigator.appVersion) >= 3 )) || 
  ((navigator.appName == "Microsoft Internet Explorer") && 
  (parseInt(navigator.appVersion) >= 4 ))); 
function MSFPpreload(img) 
{
  var a=new Image(); a.src=img; return a; 
}
// --></script><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav1n=MSFPpreload("../_derived/home_cmp_gotw110_hbtn.gif"); MSFPnav1h=MSFPpreload("../_derived/home_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1h.src" onmouseout="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1n.src"><img src="../_derived/home_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Home" align="middle" name="MSFPnav1"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav2n=MSFPpreload("../_derived/news.htm_cmp_gotw110_hbtn.gif"); MSFPnav2h=MSFPpreload("../_derived/news.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../news.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2h.src" onmouseout="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2n.src"><img src="../_derived/news.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="News &amp; Events" align="middle" name="MSFPnav2"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav3n=MSFPpreload("../resources/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav3h=MSFPpreload("../resources/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../resources/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3h.src" onmouseout="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3n.src"><img src="../resources/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Community Resources" align="middle" name="MSFPnav3"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav4n=MSFPpreload("../_derived/consulting.htm_cmp_gotw110_hbtn.gif"); MSFPnav4h=MSFPpreload("../_derived/consulting.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../consulting.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4h.src" onmouseout="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4n.src"><img src="../_derived/consulting.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Consulting Services" align="middle" name="MSFPnav4"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav5n=MSFPpreload("../_derived/presentations.htm_cmp_gotw110_hbtn.gif"); MSFPnav5h=MSFPpreload("../_derived/presentations.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../presentations.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5h.src" onmouseout="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5n.src"><img src="../_derived/presentations.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Presentations" align="middle" name="MSFPnav5"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav6n=MSFPpreload("../publications/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav6h=MSFPpreload("../publications/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../publications/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6h.src" onmouseout="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6n.src"><img src="../publications/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Publications" align="middle" name="MSFPnav6"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav7n=MSFPpreload("_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav7h=MSFPpreload("_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7h.src" onmouseout="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7n.src"><img src="_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Guru of the Week" align="middle" name="MSFPnav7"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav8n=MSFPpreload("../conv/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav8h=MSFPpreload("../conv/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../conv/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8h.src" onmouseout="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8n.src"><img src="../conv/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Conversations" align="middle" name="MSFPnav8"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav9n=MSFPpreload("../_derived/search.htm_cmp_gotw110_hbtn.gif"); MSFPnav9h=MSFPpreload("../_derived/search.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../search.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav9'].src=MSFPnav9h.src" onmouseout="if(MSFPhover) document['MSFPnav9'].src=MSFPnav9n.src"><img src="../_derived/search.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Search GotW.ca" align="middle" name="MSFPnav9"></a>
</p>




    <!--mstheme--></font></td>
    <td valign="middle"><!--mstheme--><font face="Arial, Arial, Helvetica">
      <p style="margin-top: 0; margin-bottom: 0">
      <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav10n=MSFPpreload("../_derived/back_cmp_gotw110_back.gif"); MSFPnav10h=MSFPpreload("../_derived/back_cmp_gotw110_back_a.gif"); }
// --></script><a href="047.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav10'].src=MSFPnav10h.src" onmouseout="if(MSFPhover) document['MSFPnav10'].src=MSFPnav10n.src"><img src="../_derived/back_cmp_gotw110_back.gif" width="100" height="20" border="0" alt="Prev" name="MSFPnav10"></a><br><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav11n=MSFPpreload("../_derived/up_cmp_gotw110_up.gif"); MSFPnav11h=MSFPpreload("../_derived/up_cmp_gotw110_up_a.gif"); }
// --></script><a href="index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav11'].src=MSFPnav11h.src" onmouseout="if(MSFPhover) document['MSFPnav11'].src=MSFPnav11n.src"><img src="../_derived/up_cmp_gotw110_up.gif" width="100" height="20" border="0" alt="Up" name="MSFPnav11"></a><br><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav12n=MSFPpreload("../_derived/next_cmp_gotw110_next.gif"); MSFPnav12h=MSFPpreload("../_derived/next_cmp_gotw110_next_a.gif"); }
// --></script><a href="049.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav12'].src=MSFPnav12h.src" onmouseout="if(MSFPhover) document['MSFPnav12'].src=MSFPnav12n.src"><img src="../_derived/next_cmp_gotw110_next.gif" width="100" height="20" border="0" alt="Next" name="MSFPnav12"></a><!--mstheme--></font></td>
  </tr>
  <tr>
    <td height="5" background="../images/bar.gif" colspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica">&nbsp;<!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font></td></tr><!--msnavigation--></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" width="1%"><!--mstheme--><font face="Arial, Arial, Helvetica">

<!--mstheme--></font><table border="0" cellspacing="0" bgcolor="#000000" cellpadding="0">
  <tr>
    <td><!--mstheme--><font face="Arial, Arial, Helvetica">
    <!--mstheme--></font><table border="0" cellpadding="2" cellspacing="1" width="100%" height="483">
        <tr>
          <td align="center" bgcolor="#000000" colspan="2" height="16"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin-top: 0; margin-bottom: 0"><a href="../news.htm"><b><font color="#FFFF00">News</font></b></a><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="3"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <font size="1" color="#0000FF">J<br>
          U<br>
          L<br>
          Y</font><!--mstheme--></font></td>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin-left: 3; margin-right: 3; margin-top: 0" align="center"><font size="1" color="#0000FF">
            Print articles newly available online</font><!--mstheme--></font><table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber1" bgcolor="#FFFFCC" bordercolordark="#006666" bordercolorlight="#99CCCC">
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mill20.htm"><b><i>
                <font color="#0000FF">Sutter's Mill</font></i></b><font color="#0000FF"> 
                column, &quot;Toward a Standard C++ Library, Part 1&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000" bgcolor="#FFFFCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mxc++-item-4.htm">
                <font color="#0000FF">Excerpt from MXC++, &quot;Extensible Templates: 
                Via Inheritance or Traits?&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mcd_review.htm"><font color="#0000FF">
                Book Review: Modern C++ Design</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mill21.htm"><b><i>
                <font color="#0000FF">Sutter's Mill</font></i></b><font color="#0000FF"> 
                column, &quot;Toward a Standard C++ Library, Part 2: Namespaceops and 
                Library Versioning&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
            </table><!--mstheme--><font face="Arial, Arial, Helvetica">
          <!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3"><font size="1" color="#0000FF"><b><i>Sutter's 
            Mill</i></b> column,
            &quot;A Pragmatic Look at Exception Specifications&quot;<br>
            </font><font size="1" color="#000080">The usefulness, or lack 
            thereof, of exception specifications, and how results can vary 
            across real-world compilers</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3">
            <a target="_blank" href="http://www.cuj.com/experts/2007/hyslop.htm"><font size="1" color="#0000FF"><i><b>Conversations</b></i> column,
            &quot;Getting to the Point&quot;</font></a><font color="#0000FF" size="1"><br>
            </font><font size="1" color="#000080">The Boost library has five 
            smart pointers that provide a rich array [sic] of useful behaviors.</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica"><font color="#0000FF" size="1">A<br>
            U<br>
          G<br>
          U<br>
          S<br>
          T</font><!--mstheme--></font></td>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin:0 3; ">
            <a target="_blank" href="http://www.cuj.com/experts/2008/sutter.htm"><i><b><font size="1" color="#0000FF">The New C++</font></b></i> <font size="1" color="#0000FF">
            column, &quot;Smart(er) Pointers&quot;</font></a><font size="1" color="#000080"><br>
            A closer look at one of the proposed new standard C++ library 
            features -- smart pointers, particularly those in Boost and Loki, 
            and a sneak peek at the usefulness of the proposed typedef templates</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <p style="margin:0 3; ">
          <a target="_blank" href="http://www.cuj.com/experts/2008/hyslop.htm"><font size="1" color="#0000FF"><i><b>Conversations</b></i> column,
            &quot;A Midsummer Night's Madness&quot;</font></a><font color="#0000FF" size="1"><br>
            </font><font size="1" color="#000080">A brew that mixes pointers, 
          typedefs, and const</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="3"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <p style="margin-top: 0; margin-bottom: 0">
          <font size="1" color="#0000FF">S<br>
          E<br>
          P<br>
          T<br>
          E<br>
          M<br>
          B<br>
          E<br>
          R</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3">
            <font size="1" color="#0000FF">&quot;Standard C++ Meets Managed C++&quot;<br>
            </font><font size="1" color="#000080">A survey of the main (in)compatibilities 
            between Standard C++ and Microsoft’s managed extensions for C++, and 
            how the two could converge</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3"><font size="1" color="#0000FF"><b><i>Sutter's 
            Mill</i></b> column,
            &quot;Export Restrictions, Part 1&quot;<br>
            </font><font size="1" color="#000080">The scoop on export -- what 
            some people think it does, what it actually does, and why it’s the 
            most widely-ignored feature in the C++ standard</font><!--mstheme--></font></td>
        </tr>
      </table><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica">
<p style="margin-top: 0; margin-bottom: 0">
<img border="0" src="../images/140.gif" width="140" height="1"></p>

<!--mstheme--></font></td><td valign="top" width="24"></td><!--msnavigation--><td valign="top"><!--mstheme--><font face="Arial, Arial, Helvetica">
<!--mstheme--></font><table border="1" cellpadding="6" cellspacing="0" width="100%" bgcolor="#CCCCFF" bordercolordark="#006666" bordercolorlight="#99CCCC">
  <tr>
    <td width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">
      <p align="center">This is the original GotW problem and solution
      substantially as posted to Usenet. See the book <i><a href="../publications/mxc++.htm"><b>More
      Exceptional C++</b></a></i> (Addison-Wesley, 2002) for the most current
      solution to this GotW issue. The solutions in the book have been revised
      and expanded since their initial appearance in GotW. The book versions
      also incorporate corrections, new material, and conformance to the final
      ANSI/ISO C++ standard.</p>
    <!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica">
<h2><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Switching Streams<font size="3"><br>
      Difficulty: 2 / 10</font><!--mstheme--></font></h2>
<p><i>What's the best way to switch between different stream sources and
targets, including the standard console streams and files?</i></p>
<p align="center"><img border="0" src="../images/h-line.gif" width="248" height="2"></p>

<h3><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Problem<!--mstheme--></font></h3>

<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">JG Question<!--mstheme--></font></h4>
<p><b><font size="4">1.</font></b>   What are the types of std::cin and
std::cout?</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Guru Question<!--mstheme--></font></h4>
<p><b><font size="4">2.</font></b>   Write an ECHO program that simply echoes
its input and that can be invoked equivalently in two ways:</p>
<!--mstheme--></font><pre>    ECHO &lt;infile &gt;outfile

    ECHO infile outfile</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>In most popular command-line environments, the first command assumes that the
program takes input from std::cin and sends output to std::cout. The second
command tells the program to take its input from the file named
&quot;infile&quot; and to produce output in the file named &quot;outfile&quot;.
The program should be able to support all of the above input/output options.</p>
<p align="center"><img border="0" src="../images/h-line.gif" width="248" height="2"></p>
<h3><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666"><a name="Solution"></a>Solution<!--mstheme--></font></h3>

<p><font color="#999933"><b><font size="4">1.</font></b>   What are the types of
std::cin and std::cout?</font></p>

<p>Short answer is that cin is:</p>

<!--mstheme--></font><pre>  std::basic_istream&lt;char, std::char_traits&lt;char&gt; &gt;</pre><!--mstheme--><font face="Arial, Arial, Helvetica">

<p>and cout is:</p>

<!--mstheme--></font><pre>  std::basic_ostream&lt;char, std::char_traits&lt;char&gt; &gt;</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>Longer answer: std::cin and std::cout have type std::istream and
std::ostream, respectively. In turn, those are typdef'd as
std::basic_istream&lt;char&gt; and std::basic_ostream&lt;char&gt;. Finally,
after accounting for the default template arguments, we get the above.</p>
<p>Note: If you are using an older implementation of the iostreams subsystem,
you might still see intermediate classes like istream_with_assign. Those classes
do not appear in the final standard, and your implementation should eliminate
them soon as it catches up, if it hasn't already.</p>
<p><font color="#999933"><b><font size="4">2.</font></b>   Write an ECHO program
that simply echoes its input and that can be invoked equivalently in two ways:</font></p>
<!--mstheme--></font><pre><font color="#999933">    ECHO &lt;infile &gt;outfile

    ECHO infile outfile</font></pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p><font color="#999933">In most popular command-line environments, the first
command assumes that the program takes input from std::cin and sends output to
std::cout. The second command tells the program to take its input from the file
named &quot;infile&quot; and to produce output in the file named
&quot;outfile&quot;. The program should be able to support all of the above
input/output options.</font></p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Method 0: The Tersest Solution<!--mstheme--></font></h4>
<p>The tersest solution is a single statement:</p>
<!--mstheme--></font><pre>  #include &lt;fstream&gt;
  #include &lt;iostream&gt;
  using namespace std;

  int main( int argc, char* argv[] ) {
    (argc&gt;2
       ? ofstream(argv[2], ios::out | ios::binary)
       : cout)
    &lt;&lt;
    (argc&gt;1
       ? ifstream(argv[1], ios::in | ios::binary)
       : cin)
    .rdbuf();
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>This works because basic_ios provides a convenient rdbuf() member function
that returns the streambuf used inside a given stream object. Pretty much
everything in the iostreams subsystem is derived from the basic_ios class
template. In particular, that includes cin, cout, and the ifstream and ofstream
templates.</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">More Flexible Solutions<!--mstheme--></font></h4>
<p>Method 0 has two major drawbacks: First, the terseness is borderline, and
extreme terseness is not suitable for production code. From the GotW coding
standards:</p>
<blockquote>

<p>- programming style:</p>

  <blockquote>

<p>- prefer readability:</p>

    <blockquote>

<p>- avoid writing terse (brief but difficult to understand and maintain) code;
eschew obfuscation (Sutter97b)</p>

    </blockquote>
  </blockquote>
</blockquote>

<p>Second, although Method 0 answers the immediate question, it's only good for
when you want to copy the input verbatim. That may be enough today, but what if
tomorrow you need to do other processing on the input, like converting it to
upper case or calculating a total or removing every third character? That may
well be a reasonable thing to want to do in the future, so it would be better
right now to encapsulate the processing work in a separate function that can use
the right kind of input or output object polymorphically:</p>

<!--mstheme--></font><pre>  #include &lt;fstream&gt;
  #include &lt;iostream&gt;
  using namespace std;

  int main( int argc, char* argv[] ) {
    Process(
      (argc&gt;1
         ? ifstream(argv[1], ios::in  | ios::binary)
         : cin ),
      (argc&gt;2
         ? ofstream(argv[2], ios::out | ios::binary)
         : cout)
      );
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>But how do we implement Process()? In C++, there are two useful ways to
express polymorphism:</p>
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Method 1: Templates (Compile-Time Polymorphism)<!--mstheme--></font></h4>
<p>The first way is to use compile-time polymorphism using templates, which
merely requires the passed objects to have a suitable interface (such as a
member function named rdbuf):</p>
<!--mstheme--></font><pre>  template&lt;class In, class Out&gt;
  void Process( In&amp; in, Out&amp; out ) {
    // ... do something more sophisticated,
    //     or just plain &quot;out &lt;&lt; in.rdbuf();&quot;...
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Method 2: Virtual Functions (Run-Time Polymorphism)<!--mstheme--></font></h4>
<p>The second way is to use run-time polymorphism, which makes use of the fact
that there is a common base class with a suitable interface:</p>
<!--mstheme--></font><pre>  //  Method 2(a): First attempt, sort of okay.
  //
  void Process( basic_istream&lt;char&gt;&amp; in,
                basic_ostream&lt;char&gt;&amp; out ) {
    // ... do something more sophisticated,
    //     or just plain &quot;out &lt;&lt; in.rdbuf();&quot;...
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>(The parameters are not of type basic_ios&lt;char&gt;&amp; because that
wouldn't permit the use of operator&lt;&lt;.)</p>
<p>Of course, this depends on the input and output streams being derived from
basic_istream&lt;char&gt; and basic_ostream&lt;char&gt;. That happens to be good
enough for our example, but not all streams are based on plain chars or even on
char_traits&lt;char&gt;. For example, wide character streams are based on
wchar_t, and <a href="029.htm"> GotW #29</a> showed the usefulness of user-defined traits with
different behaviour (ci_char_traits, for case insensitivity).</p>
<p>Even Method 2 ought to use templates, and let the compiler deduce the
arguments appropriately:</p>
<!--mstheme--></font><pre>  //  Method 2(b): Better solution.
  //
  template&lt;class C = char, class T = char_traits&lt;C&gt; &gt;
  void Process( basic_istream&lt;C,T&gt;&amp; in,
                basic_ostream&lt;C,T&gt;&amp; out ) {
    // ... do something more sophisticated,
    //     or just plain &quot;out &lt;&lt; in.rdbuf();&quot;...
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Sound Engineering Principles<!--mstheme--></font></h4>
<p>All of these answers are &quot;right&quot; as far as they go, but in this
situation I personally tend to prefer Method 1. This is because of two valuable
guidelines:</p>
<blockquote>
  <p><b>Guideline:</b> Prefer extensibility.</p>
</blockquote>
<p>Avoid writing code that only solves the immediate problem. Writing an
extensible solution is almost always far better (just don't go overboard).</p>
<p>Balanced judgment is one hallmark of the experienced programmer. In
particular, experienced programmers understand how to strike the right balance
between writing special-purpose code that solves only the immediate problem
(shortsighted, hard to extend) and writing a gradiose general framework to solve
what should be a simple problem (rabid overdesign).</p>
<p>Method 1 is only slightly more complex than Method 0, but that extra
complexity buys you better extensibility. It is at once both simpler and more
flexible than Method 2; it is more adaptable to new situations because it avoids
being hardwired to work with the iostreams hierarchy only.</p>
<p>So, prefer extensibility. Note that this is NOT an open license to go
overboard and overdesign what ought to be a simple system. It is, however,
encouragement to do more than just solve the immediate problem, when a little
thought lets you discover that the problem you're solving is a special case of a
more general problem. This is especially true because designing for
extensibility often implicitly means designing for encapsulation:</p>
<blockquote>
  <p><b>Guideline:</b> Prefer encapsulation. Separate concerns.</p>
</blockquote>
<p>As far as possible, one piece of code -- function, or class -- should know
about and be responsible for one thing.</p>
<p>Arguably best of all, Method 1 exhibits good separation of concerns: The code
that knows about the possible differences in input/output sources and sinks is
separated from the code that knows how to actually do the work. This is a second
hallmark of sound engineering.<!--mstheme--></font><!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="Arial, Arial, Helvetica"><h4 align="right"><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666"><a href="../copyright.htm"><font size="2">Copyright ©
2002 Herb Sutter</font></a><!--mstheme--></font></h4>

<!--mstheme--></font></td></tr><!--msnavigation--></table></body>
</html>

