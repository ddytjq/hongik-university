ID=E0754
URL=http://www.gotw.ca/gotw/015.htm
SIZE=28724
DATE=12/07/02
TIME=19:24:05
DATASET=C
HTML=
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">


<title>GotW #15: Class Relationships - Part II</title>
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="stylesheet" type="text/css" href="../gotw.css">
<meta name="Microsoft Theme" content="gotw 111, default">
<meta name="Microsoft Border" content="tlb, default">
</head>

<body background="../_themes/gotw/glabkgnd.jpg" bgcolor="#CCFFFF" text="#000000" link="#008080" vlink="#008080" alink="#0000FF"  ><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font><table border="0" cellspacing="0" width="100%">
  <tr>
    <td colspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica"><font size="6"><strong>
    GotW #15</strong></font> <!--mstheme--></font></td>
  </tr>
  <tr>
    <td valign="middle"><!--mstheme--><font face="Arial, Arial, Helvetica">




<p align="left" style="margin-top: 0; margin-bottom: 0">

<script language="JavaScript"><!--
MSFPhover = 
  (((navigator.appName == "Netscape") && 
  (parseInt(navigator.appVersion) >= 3 )) || 
  ((navigator.appName == "Microsoft Internet Explorer") && 
  (parseInt(navigator.appVersion) >= 4 ))); 
function MSFPpreload(img) 
{
  var a=new Image(); a.src=img; return a; 
}
// --></script><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav1n=MSFPpreload("../_derived/home_cmp_gotw110_hbtn.gif"); MSFPnav1h=MSFPpreload("../_derived/home_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1h.src" onmouseout="if(MSFPhover) document['MSFPnav1'].src=MSFPnav1n.src"><img src="../_derived/home_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Home" align="middle" name="MSFPnav1"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav2n=MSFPpreload("../_derived/news.htm_cmp_gotw110_hbtn.gif"); MSFPnav2h=MSFPpreload("../_derived/news.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../news.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2h.src" onmouseout="if(MSFPhover) document['MSFPnav2'].src=MSFPnav2n.src"><img src="../_derived/news.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="News &amp; Events" align="middle" name="MSFPnav2"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav3n=MSFPpreload("../resources/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav3h=MSFPpreload("../resources/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../resources/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3h.src" onmouseout="if(MSFPhover) document['MSFPnav3'].src=MSFPnav3n.src"><img src="../resources/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Community Resources" align="middle" name="MSFPnav3"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav4n=MSFPpreload("../_derived/consulting.htm_cmp_gotw110_hbtn.gif"); MSFPnav4h=MSFPpreload("../_derived/consulting.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../consulting.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4h.src" onmouseout="if(MSFPhover) document['MSFPnav4'].src=MSFPnav4n.src"><img src="../_derived/consulting.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Consulting Services" align="middle" name="MSFPnav4"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav5n=MSFPpreload("../_derived/presentations.htm_cmp_gotw110_hbtn.gif"); MSFPnav5h=MSFPpreload("../_derived/presentations.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../presentations.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5h.src" onmouseout="if(MSFPhover) document['MSFPnav5'].src=MSFPnav5n.src"><img src="../_derived/presentations.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Presentations" align="middle" name="MSFPnav5"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav6n=MSFPpreload("../publications/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav6h=MSFPpreload("../publications/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../publications/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6h.src" onmouseout="if(MSFPhover) document['MSFPnav6'].src=MSFPnav6n.src"><img src="../publications/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Publications" align="middle" name="MSFPnav6"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav7n=MSFPpreload("_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav7h=MSFPpreload("_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7h.src" onmouseout="if(MSFPhover) document['MSFPnav7'].src=MSFPnav7n.src"><img src="_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Guru of the Week" align="middle" name="MSFPnav7"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav8n=MSFPpreload("../conv/_derived/index.htm_cmp_gotw110_hbtn.gif"); MSFPnav8h=MSFPpreload("../conv/_derived/index.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../conv/index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8h.src" onmouseout="if(MSFPhover) document['MSFPnav8'].src=MSFPnav8n.src"><img src="../conv/_derived/index.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Conversations" align="middle" name="MSFPnav8"></a> <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav9n=MSFPpreload("../_derived/search.htm_cmp_gotw110_hbtn.gif"); MSFPnav9h=MSFPpreload("../_derived/search.htm_cmp_gotw110_hbtn_a.gif"); }
// --></script><a href="../search.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav9'].src=MSFPnav9h.src" onmouseout="if(MSFPhover) document['MSFPnav9'].src=MSFPnav9n.src"><img src="../_derived/search.htm_cmp_gotw110_hbtn.gif" width="140" height="40" border="0" alt="Search GotW.ca" align="middle" name="MSFPnav9"></a>
</p>




    <!--mstheme--></font></td>
    <td valign="middle"><!--mstheme--><font face="Arial, Arial, Helvetica">
      <p style="margin-top: 0; margin-bottom: 0">
      <script language="JavaScript"><!--
if(MSFPhover) { MSFPnav10n=MSFPpreload("../_derived/back_cmp_gotw110_back.gif"); MSFPnav10h=MSFPpreload("../_derived/back_cmp_gotw110_back_a.gif"); }
// --></script><a href="014.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav10'].src=MSFPnav10h.src" onmouseout="if(MSFPhover) document['MSFPnav10'].src=MSFPnav10n.src"><img src="../_derived/back_cmp_gotw110_back.gif" width="100" height="20" border="0" alt="Prev" name="MSFPnav10"></a><br><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav11n=MSFPpreload("../_derived/up_cmp_gotw110_up.gif"); MSFPnav11h=MSFPpreload("../_derived/up_cmp_gotw110_up_a.gif"); }
// --></script><a href="index.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav11'].src=MSFPnav11h.src" onmouseout="if(MSFPhover) document['MSFPnav11'].src=MSFPnav11n.src"><img src="../_derived/up_cmp_gotw110_up.gif" width="100" height="20" border="0" alt="Up" name="MSFPnav11"></a><br><script language="JavaScript"><!--
if(MSFPhover) { MSFPnav12n=MSFPpreload("../_derived/next_cmp_gotw110_next.gif"); MSFPnav12h=MSFPpreload("../_derived/next_cmp_gotw110_next_a.gif"); }
// --></script><a href="016.htm" language="JavaScript" onmouseover="if(MSFPhover) document['MSFPnav12'].src=MSFPnav12h.src" onmouseout="if(MSFPhover) document['MSFPnav12'].src=MSFPnav12n.src"><img src="../_derived/next_cmp_gotw110_next.gif" width="100" height="20" border="0" alt="Next" name="MSFPnav12"></a><!--mstheme--></font></td>
  </tr>
  <tr>
    <td height="5" background="../images/bar.gif" colspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica">&nbsp;<!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font></td></tr><!--msnavigation--></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" width="1%"><!--mstheme--><font face="Arial, Arial, Helvetica">

<!--mstheme--></font><table border="0" cellspacing="0" bgcolor="#000000" cellpadding="0">
  <tr>
    <td><!--mstheme--><font face="Arial, Arial, Helvetica">
    <!--mstheme--></font><table border="0" cellpadding="2" cellspacing="1" width="100%" height="483">
        <tr>
          <td align="center" bgcolor="#000000" colspan="2" height="16"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin-top: 0; margin-bottom: 0"><a href="../news.htm"><b><font color="#FFFF00">News</font></b></a><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="3"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <font size="1" color="#0000FF">J<br>
          U<br>
          L<br>
          Y</font><!--mstheme--></font></td>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin-left: 3; margin-right: 3; margin-top: 0" align="center"><font size="1" color="#0000FF">
            Print articles newly available online</font><!--mstheme--></font><table border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber1" bgcolor="#FFFFCC" bordercolordark="#006666" bordercolorlight="#99CCCC">
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mill20.htm"><b><i>
                <font color="#0000FF">Sutter's Mill</font></i></b><font color="#0000FF"> 
                column, &quot;Toward a Standard C++ Library, Part 1&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000" bgcolor="#FFFFCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mxc++-item-4.htm">
                <font color="#0000FF">Excerpt from MXC++, &quot;Extensible Templates: 
                Via Inheritance or Traits?&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mcd_review.htm"><font color="#0000FF">
                Book Review: Modern C++ Design</font></a></font><!--mstheme--></font></td>
              </tr>
              <tr>
                <td width="100%" bordercolor="#808000"><!--mstheme--><font face="Arial, Arial, Helvetica">
                <p style="margin: 3"><font size="1" color="#0000FF">
                <a href="../publications/mill21.htm"><b><i>
                <font color="#0000FF">Sutter's Mill</font></i></b><font color="#0000FF"> 
                column, &quot;Toward a Standard C++ Library, Part 2: Namespaceops and 
                Library Versioning&quot;</font></a></font><!--mstheme--></font></td>
              </tr>
            </table><!--mstheme--><font face="Arial, Arial, Helvetica">
          <!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3"><font size="1" color="#0000FF"><b><i>Sutter's 
            Mill</i></b> column,
            &quot;A Pragmatic Look at Exception Specifications&quot;<br>
            </font><font size="1" color="#000080">The usefulness, or lack 
            thereof, of exception specifications, and how results can vary 
            across real-world compilers</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3">
            <a target="_blank" href="http://www.cuj.com/experts/2007/hyslop.htm"><font size="1" color="#0000FF"><i><b>Conversations</b></i> column,
            &quot;Getting to the Point&quot;</font></a><font color="#0000FF" size="1"><br>
            </font><font size="1" color="#000080">The Boost library has five 
            smart pointers that provide a rich array [sic] of useful behaviors.</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="2"><!--mstheme--><font face="Arial, Arial, Helvetica"><font color="#0000FF" size="1">A<br>
            U<br>
          G<br>
          U<br>
          S<br>
          T</font><!--mstheme--></font></td>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin:0 3; ">
            <a target="_blank" href="http://www.cuj.com/experts/2008/sutter.htm"><i><b><font size="1" color="#0000FF">The New C++</font></b></i> <font size="1" color="#0000FF">
            column, &quot;Smart(er) Pointers&quot;</font></a><font size="1" color="#000080"><br>
            A closer look at one of the proposed new standard C++ library 
            features -- smart pointers, particularly those in Boost and Loki, 
            and a sneak peek at the usefulness of the proposed typedef templates</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <p style="margin:0 3; ">
          <a target="_blank" href="http://www.cuj.com/experts/2008/hyslop.htm"><font size="1" color="#0000FF"><i><b>Conversations</b></i> column,
            &quot;A Midsummer Night's Madness&quot;</font></a><font color="#0000FF" size="1"><br>
            </font><font size="1" color="#000080">A brew that mixes pointers, 
          typedefs, and const</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="center" bgcolor="#CCCCCC" bordercolor="#CCCCCC" rowspan="3"><!--mstheme--><font face="Arial, Arial, Helvetica">
          <p style="margin-top: 0; margin-bottom: 0">
          <font size="1" color="#0000FF">S<br>
          E<br>
          P<br>
          T<br>
          E<br>
          M<br>
          B<br>
          E<br>
          R</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3">
            <font size="1" color="#0000FF">&quot;Standard C++ Meets Managed C++&quot;<br>
            </font><font size="1" color="#000080">A survey of the main (in)compatibilities 
            between Standard C++ and Microsoft’s managed extensions for C++, and 
            how the two could converge</font><!--mstheme--></font></td>
        </tr>
        <tr>
          <td align="left" bgcolor="#FFFF99" bordercolor="#CCCCCC"><!--mstheme--><font face="Arial, Arial, Helvetica">
            <p style="margin: 0 3"><font size="1" color="#0000FF"><b><i>Sutter's 
            Mill</i></b> column,
            &quot;Export Restrictions, Part 1&quot;<br>
            </font><font size="1" color="#000080">The scoop on export -- what 
            some people think it does, what it actually does, and why it’s the 
            most widely-ignored feature in the C++ standard</font><!--mstheme--></font></td>
        </tr>
      </table><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica">
<p style="margin-top: 0; margin-bottom: 0">
<img border="0" src="../images/140.gif" width="140" height="1"></p>

<!--mstheme--></font></td><td valign="top" width="24"></td><!--msnavigation--><td valign="top"><!--mstheme--><font face="Arial, Arial, Helvetica"><!--mstheme--></font><table border="1" cellpadding="6" cellspacing="0" width="100%" bgcolor="#FFCC99" bordercolordark="#006666" bordercolorlight="#99CCCC">
  <tr>
    <td width="100%"><!--mstheme--><font face="Arial, Arial, Helvetica">
      <p align="center">This is the original GotW problem and solution
      substantially as posted
      to Usenet. See the book <i><a href="../publications/xc++.htm"><b>Exceptional
      C++</b></a></i> (Addison-Wesley, 2000) for the most current solutions to
      GotW issues #1-30. The solutions in the book have been revised and
      expanded since their initial appearance in GotW. The book versions also
      incorporate corrections, new material, and conformance to the final
      ANSI/ISO C++ standard.</p>
    <!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="Arial, Arial, Helvetica">
<h2><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Class Relationships - Part II<font size="3"><br>
      Difficulty: 6 / 10</font><!--mstheme--></font></h2>
<p><i>Design patterns are an important tool in writing reusable code. Do you
recognize the patterns used in this GotW? If so, can you improve them?</i></p>
<p align="center"><img border="0" src="../images/h-line.gif" width="248" height="2"></p>

<h3><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Problem<!--mstheme--></font></h3>

<p>A database manipulation program often needs to do some work on every record
(or selected records) in a given table, by first performing a read-only pass
through the table to cache information about which records need to be processed
and then performing a second pass to actually make the changes.</p>
<p>Instead of rewriting much of the common logic each time, a programmer has
tried to provide a generic reusable framework in the following abstract class.
The intent is that the abstract class should encapsulate the repetitive work by:
first, compiling a list of table rows on which work needs to be done; and
second, performing the work on each affected row. Derived classes are
responsible for providing the details of their specific operations.</p>
<!--mstheme--></font><pre>  //---------------------------------------------------
  // File gta.h
  //---------------------------------------------------
  class GenericTableAlgorithm {
  public:
    GenericTableAlgorithm( const string&amp; table );
    virtual ~GenericTableAlgorithm();

    // Process() returns true iff successful.
    // It does all the work: a) physically reads
    // the table's records, calling Filter() on each
    // to determine whether it should be included
    // in the rows to be processed; and b) when the
    // list of rows to operate upon is complete, calls
    // ProcessRow() for each such row.
    //
    bool Process();

  private:
    // Filter() returns true iff the row should be
    // included in the ones to be processed.  The
    // default action is to include every row.
    //
    virtual bool Filter( const Record&amp; ) {
      return true;
    }

    // ProcessRow() is called once per record that
    // was included for processing.  This is where
    // the concrete class does its specialized work.
    // (Note: This means every row to be processed
    // will be read twice, but assume that that is
    // necessary and not an efficiency consideration.)
    //
    virtual bool ProcessRow( const PrimaryKey&amp; ) =0;

    class GenericTableAlgorithmImpl* pimpl_; // MYOB
  };</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>For example, the client code to derive a concrete worker class and use it in
a mainline looks something like this:</p>
<!--mstheme--></font><pre>  class MyAlgorithm : public GenericTableAlgorithm {
    // ... override Filter() and ProcessRow() do
    //     implement a specific operation ...
  };

  int main( int, char*[] ) {
    MyAlgorithm a( &quot;Customer&quot; );
    a.Process();
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>The questions:</p>
<p><font size="4"><b>1.</b></font> This is a good design and implements a
well-known design pattern. Which pattern is this? Why is it useful here?</p>
<p><font size="4"><b>2</b></font> Without changing
the fundamental design, critique the way this design was executed. What might
you have done differently? What is the purpose of the &quot;pimpl_&quot; member?</p>
<p><font size="4"><b>3</b></font> This design can,
in fact, be substantially improved. What are GenericTableAlgorithm's
responsibilities? If more than one, how could they be better encapsulated?
Explain how your answer affects the class' reusability, especially its
extensibility.</p>
<p align="center"><img border="0" src="../images/h-line.gif" width="248" height="2"></p>
<h3><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666"><a name="Solution"></a>Solution<!--mstheme--></font></h3>

<p><font color="#999933"><font size="4"><b>1.</b></font> This is a good design
and implements a well-known design pattern. Which pattern is this? Why is it
useful here?</font></p>
<p>This is the Template Method pattern (not to be confused with C++ templates).<b><sup><a href="#1">[1]</a></sup></b> It's useful because we can generalize a common way of doing
something that always follows the same steps, and only the details may differ
and can be supplied by a concrete derived class.</p>
<p>(Note: The pimpl_ idiom is superficially similar to Bridge<b><a href="#1"><sup>[1]</sup></a></b>, but here it's
only intended to hide this particular class' own implementation as a compilation
dependency firewall, not to act as a true extensible bridge.)</p>
<p><font color="#999933"><font size="4"><b>2</b></font><font size="4"><b>.</b></font>
Without changing the fundamental design, critique the way this design was
executed. What might you have done differently? What is the purpose of the
&quot;pimpl_&quot; member?</font></p>
<p>This design uses bools as return codes, with apparently no other way (status
codes or exceptions) of reporting failures. Depending on the requirements, this
may be fine, but it's something to note.</p>
<p>The (intentionally pronounceable) pimpl_ member nicely hides the
implementation behind an opaque pointer. The struct that pimpl_ points to will
contain the private member functions and member variables, so that any change to
them will not require client code to recompile. This is an important technique
documented by Lakos<b><a href="#2"><sup>[2]</sup></a></b> and others, because while it's a little annoying to code
it does help compensate for C++'s lack of a module system.</p>
<p><font color="#999933"><font size="4"><b>3</b></font><font size="4"><b>.</b></font>
This design can, in fact, be substantially improved. What are
GenericTableAlgorithm's responsibilities? If more than one, how could they be
better encapsulated? Explain how your answer affects the class' reusability,
especially its extensibility.</font></p>
<p>GenericTableAlgorithm can be substantially improved because it currently
holds two jobs. Just as humans get stressed when they have to hold two jobs --
because that means they're loaded up with extra and competing responsibilities
-- so too this class could benefit from adjusting its focus.</p>
<p>In the original version, GenericTableAlgorithm is burdened with two different
and unrelated responsibilities which can be effectively separated, since the two
responsibilities are to support entirely different audiences. In short, they
are:</p>
<p>1. Client code USES the (suitably specialized) generic algorithm.</p>
<p>2. GenericTableAlgorithm USES the specialized concrete &quot;details&quot;
class to specialize its operation for a specific case or usage.</p>
<p>That said, let's look at some improved code:</p>
<!--mstheme--></font><pre>  //---------------------------------------------------
  // File gta.h
  //---------------------------------------------------

  // Responsibility #1: Providing a public interface
  // that encapsulates common functionality as a
  // template method.  This has nothing to do with
  // inheritance relationships, and can be nicely
  // isolated to stand on its own in a better-focused
  // class.  The target audience is external users of
  // GenericTableAlgorithm.
  //
  class GTAClient;

  class GenericTableAlgorithm {
  public:
    // Ctor now takes a concrete implementation object.
    //
    GenericTableAlgorithm( const string&amp; table,
                           GTAClient&amp;    worker );

    // Since we've separated away the inheritance
    // relationships, the dtor doesn't need to be
    // virtual.  In fact, we may not need it at all.
    //
    ~GenericTableAlgorithm();

    bool Process(); // unchanged

  private:
    class GenericTableAlgorithmImpl* pimpl_; // MYOB
  };

  //---------------------------------------------------
  // File gtaclient.h
  //---------------------------------------------------

  // Responsibility #2: Providing an abstract interface
  // for extensibility.  This is an implementation
  // detail of GenericTableAlgorithm that has nothing
  // to do with its external clients, and can be nicely
  // separated out into a better-focused abstract
  // protocol class.  The target audience is writers of
  // concrete &quot;implementation detail&quot; classes which
  // work with (and extend) GenericTableAlgorithm.
  //
  class GTAClient {
  public:
    virtual ~GTAClient() =0;

    virtual bool Filter( const Record&amp; ) {
      return true;
    }

    virtual bool ProcessRow( const PrimaryKey&amp; ) =0;
  };</pre><!--mstheme--><font face="Arial, Arial, Helvetica">

<p>As shown, these two classes should appear in separate header files. With
these changes, how does this now look to the client code? The answer is, pretty
much the same:</p>

<!--mstheme--></font><pre>  class MyWorker : public GTAClient {
    // ... override Filter() and ProcessRow() do
    //     implement a specific operation ...
  };

  int main( int, char*[] ) {
    GenericTableAlgorithm a( &quot;Customer&quot;, MyWorker() );
    a.Process();
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>While this may look pretty much the same, consider three important effects:</p>
<blockquote>
  <p>1. What if GenericTableAlgorithm's common public interface changes (e.g., a
  new public member is added)? In the original version, all concrete worker
  classes would have to be recompiled because they are derived from
  GenericTableAlgorithm. In this version, any change to GenericTableAlgorithm's
  public interface is nicely isolated, and does not affect the concrete worker
  classes at all.</p>
  <p>2. What if GenericTableAlgorithm's extensible protocol changes (e.g., if
  additional defaulted arguments were added to Filter() or ProcessRow())? In the
  original version, all external clients of GenericTableAlgorithm would have to
  be recompiled even though the public interface is unchanged, because a
  derivation interface is visible in the class definition. In this version, any
  changes to GenericTableAlgorithm's extension protocol interface is nicely
  isolated, and does not affect external users at all.</p>
  <p>3. Any concrete worker classes can now be used within any other algorithm
  which can operate using the Filter()/ProcessRow() interface, not just
  GenericTableAlgorithm.</p>
</blockquote>
<p>In fact, what we've ended up with is very similar to the Strategy pattern.<b><a href="#1"><sup>[1]</sup></a></b></p>
<p>Remember the computer science motto: Most any problem can be solved by adding
a level of indirection. Of course, it's wise to temper this with Occam's Razor:
Don't multiply entities more than necessary. A proper balance between the two in
this case delivers much better reusability and maintainability, at little or no
cost... a good deal by all accounts!</p>
<p>You may have noticed that GenericTableAlgorithm could actually be a function
instead of a class (in fact, some people might be tempted to rename Process() as
operator()() since now the class apparently really is just a functor). The
reason it could be replaced with a function is that the description doesn't say
that it needs to keep state across calls to Process(). For example, if it does
not need to keep state across invocations, we could replace it with:</p>
<!--mstheme--></font><pre>  bool GenericTableAlgorithm(
            const string&amp; table,
            GTAClient&amp;    method ) {
    // ... original contents of Process() go here ...
  }

  int main( int, char*[] ) {
    GenericTableAlgorithm( &quot;Customer&quot;, MyWorker() );
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">

<p>What we've really got here is a generic function, which can be given
&quot;specialized&quot; behaviour as needed. If you know that 'method' objects
never need to store state (that is, all instances are functionally equivalent
and provide only the virtual functions), you can get fancy and make 'method' a
non-class template parameter instead:</p>

<!--mstheme--></font><pre>  template&lt;typename GTACworker&gt;
  bool GenericTableAlgorithm( const string&amp; table ) {
    // ... original contents of Process() go here ...
  }

  int main( int, char*[] ) {
    GenericTableAlgorithm&lt;MyWorker&gt;( &quot;Customer&quot; );
  }</pre><!--mstheme--><font face="Arial, Arial, Helvetica">
<p>I don't think that this buys you much here besides getting rid of a comma in
the client code, so the first function is better. It's always good to resist the
temptation to write cute code for its own sake.</p>
<p>At any rate, whether to use a function or a class in a given situation can
depend on what you're trying to achieve, but in this case writing a generic
function may be a better solution.</p>

<p>&nbsp;</p>

<h4><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666">Notes<!--mstheme--></font></h4>
<p><a name="1"></a>1. E. Gamma et al., <b>Design Patterns: Elements of Reusable
Object-Oriented Software</b> (Addison-Wesley, 1995).</p>
<p><a name="2"></a>2. J. Lakos. <b>Large-Scale C++ Software Design</b>
(Addison-Wesley, 1996).</p>
<!--mstheme--></font><!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="Arial, Arial, Helvetica"><h4 align="right"><!--mstheme--><font face="Verdana, Arial, Helvetica" color="#006666"><a href="../copyright.htm"><font size="2">Copyright ©
2002 Herb Sutter</font></a><!--mstheme--></font></h4>

<!--mstheme--></font></td></tr><!--msnavigation--></table></body>
</html>

