ID=E0222
URL=http://www.codeguru.com/cpp_mfc/SnR.html
SIZE=32114
DATE=12/07/02
TIME=19:18:54
DATASET=C
HTML=<HTML>
<HEAD>   
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">   
    <META NAME="Author" CONTENT="Tom Archer">
    <TITLE>C++ & MFC - Table of Contents</TITLE>   
    <META Name="description" Content="Source codes with MFC">
    <META Name="keywords" Content="SOURCE CODE MFC">

    <SCRIPT LANGUAGE="JavaScript">
<!--
var axel = Math.random() + "";
var ord = axel * 1000000000000000000 + "?";

//This part of script alleviates a Netscape document.write bug
<!-- 
NS4 = document.layers;
if (NS4) {
origWidth = innerWidth;
origHeight = innerHeight;
}
function reDo() {
if (innerWidth != origWidth || innerHeight != origHeight) 
location.reload();
}
if (NS4) onresize = reDo;
//-->
</SCRIPT>

</HEAD>



<body>

<!-- begin logo and top banner ad table -->

<TABLE width=100% cellpadding="0" cellspacing="0">

  <TR align="left">
    <TD COLSPAN="3" VALIGN="TOP" align="left">
      <A HREF="http://www.earthweb.com" TARGET="_top">
        <IMG SRC="/images/eweb_banner.gif" BORDER="0" ALT="EarthWeb">
      </a>
    </TD>
  </TR>

  <TR>
<!--BljAds
    <TD VALIGN="TOP" align=left>
      <A HREF="/">
        <IMG SRC="/images/logo_cobrand.gif" BORDER="0" ALT="Developer.com">
      </a>
    </TD>

    <TD>
      <img src="/images/dotclear.gif" WIDTH="40" HEIGHT="1">
    </TD>
-->
    <TD align="TOP">
    <center>
      <IFRAME SRC="http://ad.doubleclick.net/adi/N339.Internet.com/B974922;sz=468x60;ord=2002.07.12.18.18.23?" WIDTH=470 HEIGHT=62 MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no BORDERCOLOR='#000000'>
<SCRIPT language='JavaScript1.1' SRC="http://ad.doubleclick.net/adj/N339.Internet.com/B974922;abr=!ie;sz=468x60;ord=2002.07.12.18.18.23?">
</SCRIPT>
<NOSCRIPT>
<A HREF="http://ad.doubleclick.net/jump/N339.Internet.com/B974922;abr=!ie4;abr=!ie5;sz=468x60;ord=2002.07.12.18.18.23?">
<IMG SRC="http://ad.doubleclick.net/ad/N339.Internet.com/B974922;abr=!ie4;abr=!ie5;sz=468x60;ord=2002.07.12.18.18.23?" BORDER=0 WIDTH=468 HEIGHT=60 ALT="Alt Text">Alt Text</A>
</NOSCRIPT>
</IFRAME><IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/20140/468x60-1/Oracle_RUP_ORA09M_1a/InternetRONBanner468x60.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>

<!-- Counter Position Eliminated -->

    </center>
    </TD>
  </TR>

</TABLE>
<hr>
<!-- end logo and top banner ad table -->

<!-- begin lower outer table -->

<TABLE cellpadding="0" cellspacing="0" border="0">
<TR>
<TD bgcolor=#efefef VALIGN="TOP" WIDTH="90">




<table border=1 cellspacing=0 cellpadding=0>
<tr><td>

<table border=0 cellpadding=5 cellspacing=0 width=150>
   <tr>
     <td align="center">
      <A HREF="/">
        <IMG SRC="/images/logo_cobrand.gif" BORDER="0" ALT="Developer.com">
      </a>
      </td>
   </tr>
   <tr>
     <td align="center">
     <A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/731/125x125-1/House_Career_Channel_11g/webopediajobs-125.gif/38366531313035623364326631643630" target="_top"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_Career_Channel_11g/webopediajobs-125.gif"  WIDTH=125 HEIGHT=125 ALT=""  BORDER="0"></A><img src="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/731/125x125-1/House_Career_Channel_11g/webopediajobs-125.gif/38366531313035623364326631643630?_RM_EMPTY_" Width="1" Height="1" Border="0">
     </td>
   </tr>
</table>

</td></tr>
<tr><td align="center">
  <table width="100%" border=0 cellpadding=5 cellspacing=0><tr><td align="center"><font size=-1>
  <a href="http://www.bizrate.com/mkt.xpml?mkt_id=503249" target="new">Shop for Software</a></font>
  </td></tr></table>
</td></tr>
<tr><td>
  <table width=130 border=0 cellpadding=5 cellspacing=0>
    <tr>
      <td>
        <!-- SEARCH FORM-->
        <form method="post" action="http://search.internet.com/codeguru.earthweb.com">
          <input type="hidden" name="IC_StartNumber" value="0">
          <input type="hidden" name="IC_BatchSize" value="10">
          <input type="hidden" name="IC_RelevanceThreshold" value="30">
          <input type="hidden" name="IC_QueryDatabase"  value="codeguru.earthweb.com">
          <input type="text"   name="IC_QueryText" value="" size="10">
          <input type="submit" value="Search">
        </form>
        <!-- END OF SEARCH FORM -->
      </td>
    </tr>
  </table>

  <table border=0 cellpadding=5 cellspacing=0 width=150>
    <tr><td><span class="navBarH1">CodeGuru Sites</span></td></tr>
    <tr><td nowrap>
        <small>
          <a href="/index.shtml">Visual C++ / MFC / C++</a><br>
          <a HREF="/csharp/index.shtml">.NET (C# and more)</a><br>
          <a href="/vb/index.shtml">Visual Basic</a><br>
          <a href="http://www.gamelan.com">Gamelan (Java)</a><br>
          <a href="http://www.jars.com">JARs (Java Applets)</a><br>
          <hr>
        </small>
        
        
    <a href="/SubmissionsGuidelines.html">
    <font face="verdana, helvetica" color="#000000" size=1>
       submission guidelines
    </font></a>
<br>

<hr>

    </td></tr>


    <tr><td><span class="navBarH1">Interact</span></td></tr>
    <tr><td nowrap>
        <small>
          <a href="/cgi-bin/bbs/wt/wwwthreads.pl">Discussion Boards</a><br>
          <a href="http://e-newsletters.internet.com">Newsletters (subscribe)</a><br>
          <a href="/Guestbook/guestbook.shtml">Guestbook</a><br>
          <a href="/cgi-bin/recommend.cgi">Recommend Us!</a><br>
          <hr>
        </small>
    </td></tr>


    <tr><td><span class="navBarH1">Of Interest</span></td></tr>
    <tr><td nowrap>
        <small>
       <a href="/announcements/dotnetbooks.html">Books on .NET</a><!--<img src="/images/new.gif">--><br>
       <a HREF="/bookReviews/index.shtml">Book Reviews</a><br>
       <a href="/newsletters/index.shtml">Newsletters (archived)</a><br> 
          <a href="/about.shtml">About Us</a><br>
          <hr>
        </small>
    </td></tr>

    <tr><td><span class="navBarH1">Article Sections</span></td></tr>

    <tr><td>
      <span class="navBarH2">C++</span>
      <br>
      <small>
        <a href="/algorithms/index.shtml">algorithms & formulas</a></br>
        <a href="/cpp_mfc/index.shtml">c++ & mfc</a><br>
        <a href="/date_time/index.shtml">date & time</a><br>
        <a href="/string/index.shtml">string</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">COM-based Technologies</span>
      <br>
      <small>
        <a href="/atl/index.shtml">atl & wtl</a><br>
        <a href="/activex/index.shtml">com & activex</a><br>
        <a href="/complus/index.shtml">com+</a><br>
        <a href="/shell/index.shtml">shell programming</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Controls</span>
      <br>
      <small>
        <a href="/buttonctrl/index.shtml">button control  </a><br>
        <a href="/combobox//index.shtml">combobox  </a><br>
        <a href="/editctrl/index.shtml">edit control  </a><br>
        <a href="/imagelist/index.shtml">imagelist control </a><br>
        <a href="/listbox/index.shtml">listbox control  </a><br>
        <a href="/listview/index.shtml">listview control  </a><br>
        <a href="/menu/index.shtml">menu  </a><br>
        <a href="/controls/index.shtml">other controls </a><br>
        <a href="/propertysheet/index.shtml">property sheet  </a><br>
        <a href="/richedit/index.shtml">rich edit control  </a><br>
        <a href="/staticctrl/index.shtml">static control  </a><br>
        <a href="/statusbar/index.shtml">status bar </a><br>
        <a href="/toolbar/index.shtml">toolbar  </a><br>
        <a href="/treeview/index.shtml">treeview control </a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Data</span>
      <br>
      <small>
    <!--
        <a href="/ado/index.shtml">ado & oledb</a><br>
        <a href="/odbc/index.shtml">odbc</a><br>
        <a href="/mfc_database/index.shtml">mfc database classes</a><br>
        <a href="/office_db/index.shtml">office products</a><br>
        <a href="/oracle/index.shtml">oracle</a><br>
        <a href="/serialization/index.shtml">serialization</a><br>
        <a href="/sqlserver/index.shtml">sql server</a><br>
    -->
        <a href="/mfc_database/index.shtml">database</a><br>
        <a href="/data-misc/index.shtml">miscellaneous</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Frameworks</span>
      <br>
      <small>
    <!--
        <a href="/component_frameworks/index.shtml">component frameworks</a><br>
        <a href="/printing_frameworks/index.shtml">printing frameworks</a><br>
        <a href="/ui_frameworks/index.shtml">ui frameworks</a><br>
    -->
        <a href="/advancedui/index.shtml">ui & printing frameworks</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Graphics & Multimedia</span>
      <br>
      <small>
        <a href="/bitmap/index.shtml">bitmaps & palettes</a><br>
        <a href="/directx/index.shtml">directx</a><br>
        <a href="/gdi/index.shtml">gdi</a><br>
        <a href="/multimedia/index.shtml">multimedia</a><br>
        <a href="/opengl/index.shtml">opengl</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Internet & Networking</span>
      <br>
      <small>
        <a href="/ieprogram/index.shtml">ie programming</a><br>
        <a href="/internet/index.shtml">internet protocols</a><br>
        <a href="/isapi/index.shtml">isapi</a><br>
        <a href="/network/index.shtml">network protocols</a><br>
      </small>
    </td></tr>
	
    <tr><td>
      <span class="navBarH2">Miscellaneous</span>
      <br>
      <small>
        <a href="/misc/index.shtml">miscellaneous</a><br>
        <a href="/samples/index.shtml">samples</a><br>
      </small>
    </td></tr>

    <!--
    <tr><td><span class="navBarH2">Security</span></td></tr>
    <tr><td><small>
      <a href="/cryptoapi/index.shtml">crypto api</a><br>
      <a href="/encryption/index.shtml">encryption/decryption</a><br>
      <br>
    </small></td></tr>
    -->

    <tr><td>
      <span class="navBarH2">Visual Studio</span>
      <br>
      <small>
    <!--
        <a href="/addins/index.shtml">add-ins</a><br>

        <a href="/tips/index.shtml">editor tips</a><br>
        <a href="/macros/index.shtml">macros</a><br>
    -->
        <a href="/debug/index.shtml">debugging</a><br>
        <a href="/devstudio_macros/index.shtml">add-ins & macros</a><br>
        <a href="/tips/index.shtml">editor tips</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Windows Programming</span>
      <br>
      <small>
        <a href="/ce/index.shtml">ce</a><br>
        <a href="/clipboard/index.shtml">clipboard</a><br>
        <a href="/dll/index.shtml">dll</a><br>
        <a href="/files/index.shtml">file & folder</a><br>
        <a href="/help/index.shtml">help systems</a><br>
        <a href="/printing/index.shtml">printing</a><br>
        <a href="/win32/index.shtml">win32</a><br>
        <a href="/system/index.shtml">system</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Windows &amp; Dialogs</span>
      <br>
      <small>
        <a href="/console/index.shtml">console</a></br>
        <a href="/dialog/index.shtml">dialog</a><br>
        <a href="/docking/index.shtml">docking window</a><br>
        <a href="/doc_view/index.shtml">doc/view</a><br>
        <a href="/splitter/index.shtml">splitter</a><br>
      </small>
      <hr>
    </td></tr>

    </table>

<!-- JOB BUTTON --> 
    <table border=0 cellpadding=5 cellspacing=0 width=150>
    <tr><td align="center">
       <a href="http://jobs.internet.com" target="new">
         <IMG SRC="http://www.codeguru.com/jobs.gif" alt="[Internet Jobs]">
       </a>
    </td></tr>
    </table>

  </td>
</tr>
</table>

<!--/navbar>


<!-- blank column for spacing -->

<td valign="top" width="20">&nbsp;&nbsp;&nbsp;</td>

<!-- end blank column for spacing -->

<!-- begin content column -->

<TD VALIGN="TOP" >

<!--
<table cellpadding="0" cellspacing="0">
<tr>
-->

<!-- begin main content column -->


<!-- closign of column, row, and table are in subfoot file -->





<script type="text/javascript" language="javascript"> 
if (screen.width==640 || screen.width==800)
{
   document.write("<link rel=stylesheet href='/global/global800.css'>"); 
} 
else 
{ 
   document.write("<link rel=stylesheet href='/global/global.css'>"); 
} 
</script>


<CENTER><H3><FONT COLOR="#AOAO99">
Common File Tasks -- Search and Replace, and Append</FONT></H3></CENTER><HR>

<!-- Author and contact details -->

<p>This article was contributed by <A HREF="mailto:james_moody@yahoo.com">James Moody</A>.</p>

<p>A class to do search and replace functions within a file and add a line to a file.</p>

<!-- Sample image - gif or jpg -->
<P><IMG SRC="SnR.jpg">

<!-- For which environment is this code specific??? -->
<p><u>Environment:</u> MFC Visual C++ (6.0)

<p>After re-implementing certain file functions a few times, I thought it would be worthwhile to make a class that would do some common tasks. This class basically does two things:</p>

<ol>
<li>Replace: Searches the specified file, replacing all occurences of the specified search string with the specified replacement string. An optional parameter is case-sensitivity. The return value is the number of replacements made.</li>
<li>InsertLineIntoFile: Adds the specified entry to the specified file. Optional paramters are case-sensitivity and if the string should be added only if the entry does not already exist or not. The return value is non-zero if the line was added.</li>
</ol>

<p>The class is really pretty simple. The code should be relatively easy to understand. I do not combine five statements into one and I try to use descriptive variable names.</p>

<p>An emphasis was placed on readability and functionality versus efficiency.</p>

<p>Extensive use was made of the CString functions.</p>

<p>To implement the SnR (Search and Replace) class, you just add SnR.cpp and SnR.h to your project and add #include "SnR.h" to your source code file.</p>

<p>A sample program/project is provided to demonstrate the use of the class.</p>

<p>I have put lots of comments in the code, so this is the end of the commentary. The .h and .cpp file are shown here and are available for download at the bottom, either by themselves or in the sample project.</p>

<p>Here is SnR.h:</p>

<!-- start a block of source code -->
<PRE>
// SnR (Search and Replace Class) written by James Moody
// Functions:
// Replace:  Replacing all occurences of a string in a file
//    case sensitive or not
//    returns the number of changes made
// DoLineReplacement:  Replacing all occurences of a sub-string 
//    in a string
//    case sensitive or not
//    returns the number of changes made
//    Was created to support the Replace Function but could be
//      used on its own
//    Takes a pointer to the string to be modified
//    InsertLineIntoFile
//      Targeted toward updating configuration 
//      files where line entries
//      should be added if they do not already exist
//      case sensitive or not.

class SnR
{
public:
  int Replace( CString TheFile,
               CString SearchString, 
               CString ReplaceString,
               int iCheckCase = 0);
  int DoLineReplacement(CString *LineString, 
                        CString SearchString,
                        CString ReplaceString,
                        int iCheckCase = 0 );
  int InsertLineIntoFile(CString TheFile,
                         CString InsertLine, 
    int iOnlyIfNotThere = 1, int iCheckCase=0);
private:

  char c;
  CString SearchTemp;
  CString ReplaceTemp;
  CString LineStringTemp;
  int iSearchToCompare;
  int iReturn;
  int iStringStart;
  int iRightCharacters;;
  int iLengthSearch;
  CString TempFile;
  FILE* pSearchFile;
  FILE* pTempFile;
  CString LineFromFile;
  CString LineToFile;
  CString RightPortion;

};
</PRE>

<HR>

<p>Here is SnR.cpp:</p>

<PRE>
#include "stdafx.h"
#include "SnR.h"

// Class Name......: SandR
// Desription......: Search and Replace in a file, and add to a file
// Author, email, date....: James Moody james_moody@yahoo.com
//                          28 May 2002
// Public Member Functions (Methods):
// Replace	Does a search and replace on the contents 
//    of a file.
// Has a parameter to specify case-sensitive or not.
// InsertLineIntoFile	Adds the string to the file
//    Has a parameter to specify case-sensitive or not.
//    Has a parameter to specify if the line will be added 
//    if it already exists.
// DoLineReplacement	Is called by Replace, so it could be a 
//    private function, but 
//    could be useful by itself.  Within a string, 
//    replaces every occurence of the search string
//    with the replace string.


int SnR::DoLineReplacement(CString* LineString, 
                           CString SearchString, 
                           CString ReplaceString,
                           int iCheckCase)
{
iLengthSearch = SearchString.GetLength();
int iReturn2=0;  // the return value
SearchTemp = SearchString;  
ReplaceTemp =  ReplaceString;
LineStringTemp = *LineString;
//  If case insensitive, make all upper case before comparing
//  Use a temp string for comparing and make changes 
//    to the original string
if( ! iCheckCase)
{
SearchTemp.MakeUpper();
// ReplaceTemp.MakeUpper();
LineStringTemp.MakeUpper();

}

// will do the while loop until no more matches with the
// search string are found
// iStringStart (if not -1) will hold the location where 
// the matching string starts

while( (iStringStart= LineStringTemp.Find(SearchTemp)) != -1)
    {
    LineToFile = LineString->Left(iStringStart);
    // now LineToFile has everything up to where 
    //the search string starts
    LineToFile += ReplaceString;
    // now LineToFile has the replace string inserted
    iRightCharacters = LineString->GetLength() - 
      iStringStart - iLengthSearch;
    RightPortion = LineString->Right(iRightCharacters);
    LineToFile += RightPortion; 
  // now LineToFile has the string with the first 
    // occurence replaced
    *LineString = LineToFile;
  // now LineString has the string with the first occurence replaced
    LineStringTemp = *LineString;
    iReturn2++;
//  If case insensitive, make all upper case before comparing
//  Use a temp string for comparing and make changes 
//    to the original string
      if(! iCheckCase)
      {

      LineStringTemp.MakeUpper();
      } // if(iCheckCase)

    } // while (iStringStart= LineFromFile....
return iReturn2;
}


// Replace
// Replaces in 'TheFile' each occurrence of 'ReplaceString' 
//      with 'SearchString'
// iCheckCase, if Non-Zero makes the determination case sensitive 
//      and defaults to 0
int SnR::Replace( CString TheFile,
                  CString SearchString, 
                  CString ReplaceString,
                  int iCheckCase)
{
  iReturn=0;
  iStringStart = 0;
  iRightCharacters = 0;;
  iLengthSearch = SearchString.GetLength();
  TempFile = "tempSnr.txt";
  pSearchFile = 0;
  pTempFile = 0;
  LineFromFile = "";
  LineToFile = "";
  RightPortion = "";

  if(iLengthSearch &lt; 1 )
      return 0;


  // going to open the search file
  if (pSearchFile =fopen(TheFile,"r"))
  {
  // going to open the temp file
  if(pTempFile = fopen(TempFile,"w"))
    {
  while ( (c=getc(pSearchFile) )!= EOF)  // filling the 
    //string with a line from the file.
    {
    LineFromFile += (CString) c;
    if((c != 10) &amp;&amp; (c !=13) )
    {

    }
    else
  {  // found a newline or carriage return character
     // so now analyze the line
     // call DoLineReplacement on the newly aquired line
  iReturn += DoLineReplacement(&amp;LineFromFile,
                               SearchString,
                               ReplaceString,
                               iCheckCase);

  LineToFile = LineFromFile;
  // print the possibly modified line to the temporary file
  fprintf(pTempFile,LineToFile);
  LineFromFile = "";
    }// if((c != 10) &amp;&amp; (c !=13) )

  } //while (c=getc(TheFile) != EOF)

  // in case the last line did not have a cr or ln will 
  //analyze the line
  iReturn += DoLineReplacement(&amp;LineFromFile, 
                               SearchString, 
                               ReplaceString,
                               iCheckCase);

    LineToFile = LineFromFile;
    fprintf(pTempFile,LineToFile);
    LineFromFile = "";
    // done dealing with the last line



  fclose(pTempFile);
  } //if(pTempFile = fopen(TempFile,"w"))
  else
  {

  } // else of if(pTempFile = fopen(TempFile,"w"))
  fclose(pSearchFile);
  }  //if (pSearchFile =fopen(TheFile,"r"))
  else
  {
  AfxMessageBox("Unable to open the file.");
  } //  else of if (pSearchFile =fopen(TheFile,"r"))


  if (iReturn)
    {  //  If any modifications were made
  // Now we will copy the newly created tempfile that 
  // has the modifications back to 
  // the original file, manually
  // It's true there is a CFile class member function 
  // called rename. We could have used that, but used this 
  // general method when creating the file anyway
  // so there should be no problem using this method 
  // to rename the file back
  if(pTempFile = fopen(TempFile,"r"))
  {
  if (pSearchFile =fopen(TheFile,"w"))
  {
  while ( (c=getc(pTempFile) )!= EOF)
    {
    putc(c,pSearchFile);
    }// while ( (c=getc(pSearchFile) )!= EOF)
  fclose(pSearchFile);
  } // if (pSearchFile =fopen(TheFile,"w"))
  fclose(pTempFile);	
  } // if(pTempFile = fopen(TempFile,"r"))
} // if (iReturn)
// deleting the temporary file that had the changes
DeleteFile(TempFile);	
return iReturn;

}  // BOOL SnR::Replace(CString TheFile, CString SearchString, 
    //CString ReplaceString)


//  InsertLineIntoFile
//  This Function works on a 'line' basis.
//  It inserts the line in the end of the file
//  The Parameter iOnlyIfNotThere, if Non-Zero will only add 
//    the line if it was not found in the file
//  The Parameter iCheckCase, if Non-Zero will make the 
//     determination
//  case sensitive
int SnR::InsertLineIntoFile(CString TheFile, CString InsertLine, 
  int iOnlyIfNotThere, int iCheckCase)
{
  iReturn=0;
  CString InsertLineTemp = InsertLine;

  int iFoundLine=0;
  //  If case insensitive, make all upper case before comparing
  //  Use a temp string for comparing and make changes to
  //  the original string
  if( ! iCheckCase) 
  {
    InsertLineTemp.MakeUpper();
  }

  LineFromFile = "";
  if(iOnlyIfNotThere) // need to find out if the string exists 
    //in the file if the parameter is 'on'
    if (pSearchFile =fopen(TheFile,"r"))
    {

    while ( (c=getc(pSearchFile) )!= EOF)
    {
    LineFromFile += (CString) c;
    if((c != 10) &amp;&amp; (c !=13) )
    {
    }
    else
    {
    if( ! iCheckCase)
    {
      LineFromFile.MakeUpper();

    }

  if(InsertLineTemp == LineFromFile)
    {
    iFoundLine=1;
    } // if(InsertLine == LineFromFile)
  // Maybe a newline or whitespace prevented a 
  // match so trim those and check again
  LineFromFile.TrimRight("\n");
  LineFromFile.TrimRight();
  if(InsertLineTemp == LineFromFile)
    {
    iFoundLine=1;
    } // if(InsertLine == LineFromFile)


    LineFromFile = "";
    }// if((c != 10) &amp;&amp; (c !=13) )

  } //while (c=getc(TheFile) != EOF)

// in case the last line did not have a cr or 
// ln will analyze the line
  if( ! iCheckCase)
  {
  LineFromFile.MakeUpper();
  }


  if(InsertLineTemp == LineFromFile)
    {
    iFoundLine=1;
    } // if(InsertLine == LineFromFile)
  // Maybe a newline or whitespace prevented a match 
  // so trim those and check again
  LineFromFile.TrimRight("\n");
  LineFromFile.TrimRight();
  if(InsertLineTemp == LineFromFile)
    {
    iFoundLine=1;
    } // if(InsertLine == LineFromFile)

  LineFromFile = "";
// done dealing with the last line

fclose(pSearchFile);

}  //if (pSearchFile =fopen(TheFile,"r"))
else
{
AfxMessageBox("Unable to open the file.");
} //  else of if (pSearchFile =fopen(TheFile,"r"))


// now we will add the line if it was not found or if we are 
// supposed to add it either way
if( (! iFoundLine ) || ( ! iOnlyIfNotThere) )
  {
  if (pSearchFile =fopen(TheFile,"a"))
  {
  fprintf(pSearchFile,"\n");
  fprintf(pSearchFile,InsertLine);
  fprintf(pSearchFile,"\n");
  fclose(pSearchFile);
  iReturn=1;
  } // if (pSearchFile =fopen(TheFile,"r"))

} // if( (! iFoundLine ) || ( ! iOnlyIfNotThere) )


return iReturn;
}
</PRE>

<h3>Downloads</h3>
<!-- demo and source files -->
<A HREF="SnR_demo.zip">Download demo project - SnR_demo.zip - 16 Kb</A><BR>
<A HREF="SnR_src.zip">Download source -SnR_src.zip - 3 Kb</A><BR>

<h3>History</h3>
Date Posted:  June 7, 2002<BR>

<!-- Only use the following if the article is updated --> 
<!-- Date Last Updated:  [today's date in the format month day, year] -->

<!--comments-->
<h3>Comments:</h3><ul>
<!--startlist-->
<li><a href="/mfc/comments/38880.shtml">Any thoughts.......???</a> - Daniel (2002/06/19)

</ul>
<P>
<strong><a href="/cgi-bin/addpage/addpage.cgi?cfg=addcomment&action=Comment">
Add Comment</a></strong>
<P>

</td>

      <!--BLJAds - Added right side tower ad -->
<TD VALIGN="TOP">
<A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/14090/125x800/Oracle_RUP_ORA09M_1a/InternetcomRONSky120x600.html/38366531313035623364326631643630?2002.07.12.18.18.23"> <IMG SRC="http://ad.doubleclick.net/ad/N339.Internet.com/B974922.2;sz=120x600;ord=2002.07.12.18.18.23?" BORDER=0 WIDTH=120 HEIGHT=600 ALT=""></A>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/14090/125x800/Oracle_RUP_ORA09M_1a/InternetcomRONSky120x600.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>

<p>

<!-- Commerce bar -->
<table border="0" cellpadding="3" width="140">

<tr bgcolor="black"><td>
<font face="Arial" color="white" size="1" >
<b><center>internet.commerce</center></b></font>
</td></tr>
<tr bgcolor="lightgrey"><td>
<font face="Arial" size="1" >
<a href="http://www.internet.com/partners/">Be a Commerce Partner</A><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4856/cp1/Top_Hosts_13c/tophosts.html/38366531313035623364326631643630">Find a Web Host</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4856/cp1/Top_Hosts_13c/tophosts.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<A href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26704/cp2/Domain_Bank_14d/RegisterDomains.html/38366531313035623364326631643630">Register Domains</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26704/cp2/Domain_Bank_14d/RegisterDomains.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/15783/cp3/Perlcoders_4d/ForCGIScripts.html/38366531313035623364326631643630">For CGI Scripts</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/15783/cp3/Perlcoders_4d/ForCGIScripts.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4863/cp4/Business_com_2c/BusinessSearch.html/38366531313035623364326631643630">Business Search</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4863/cp4/Business_com_2c/BusinessSearch.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26710/cp5/ImpactBuilderPro_com_5d/buildflashonline.html/38366531313035623364326631643630">Build Flash Online</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26710/cp5/ImpactBuilderPro_com_5d/buildflashonline.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/15790/cp6/Tradepub.com_12d/tech.html/38366531313035623364326631643630">Tech Magazines-Free</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/15790/cp6/Tradepub.com_12d/tech.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4869/cp7/EMedia_2d/EMediaMagFreeSub.html/38366531313035623364326631643630">EMedia Mag Free Sub</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4869/cp7/EMedia_2d/EMediaMagFreeSub.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26717/cp8/PriceGrabber.com_2d/ComparisonShopping.html/38366531313035623364326631643630">Comparison Shopping</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26717/cp8/PriceGrabber.com_2d/ComparisonShopping.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/15796/cp9/Computer_Training_Schools_7d/ComputerTraining.html/38366531313035623364326631643630">Computer Training</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/15796/cp9/Computer_Training_Schools_7d/ComputerTraining.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4876/cp10/Imsisoft_2a/ForWebGraphics.html/38366531313035623364326631643630">For Web Graphics</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/4876/cp10/Imsisoft_2a/ForWebGraphics.html/38366531313035623364326631643630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>

</font>
</td></tr>
</table>
<br>


</TD>

</tr>
</table>
<!-- begin footer information -->
<br>
<CENTER>
<A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26724/468x60-2/House_VoiceXML_For_BusMgrs_1c/voicexmlbus_750.gif/38366531313035623364326631643630" target="_top"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_VoiceXML_For_BusMgrs_1c/voicexmlbus_750.gif"  ALT=""  BORDER="0"></A><img src="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/SnR.html/26724/468x60-2/House_VoiceXML_For_BusMgrs_1c/voicexmlbus_750.gif/38366531313035623364326631643630?_RM_EMPTY_" Width="1" Height="1" Border="0">
<br>
<FONT SIZE="-1">EarthWeb is a service of INT Media Group, Incorporated.<br>
Copyright 2002 INT Media Group, Incorporated. All Rights Reserved.<BR>
<A HREF="http://www.internet.com/help/feedback.html">Feedback</A>, &nbsp;
<A HREF="http://www.itmarketer.com">Advertising Info</A>, &nbsp;
<A HREF="http://www.internet.com/corporate/legal.html">Legal Notices</A>,&nbsp;
<A HREF="http://www.internet.com/corporate/reprints.html#Licensing">Licensing</A>, 
<A HREF="http://www.internet.com/corporate/reprints.html#Reprints">Reprints</A>, &amp; 
<A HREF="http://www.internet.com/corporate/reprints.html#Permissions">Permissions</A>, &nbsp;
<A HREF="http://www.internet.com/corporate/privacy/privacypolicy.html">Privacy Policy</A>.
<BR>
<A HREF="http://www.internet.com"><IMG SRC="/images/internetcom.gif"
ALT="http://www.internet.com/" WIDTH="161" HEIGHT="18"
BORDER="0"></A></FONT>
</CENTER>

</BODY>
</HTML>





