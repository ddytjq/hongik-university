ID=E0066
URL=http://www.codeguru.com/cpp_mfc/dill1.html
SIZE=42068
DATE=12/07/02
TIME=19:17:02
DATASET=C
HTML=<HTML>
<HEAD>   
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">   
    <META NAME="Author" CONTENT="Tom Archer">
    <TITLE>C++ & MFC - Table of Contents</TITLE>   
    <META Name="description" Content="Source codes with MFC">
    <META Name="keywords" Content="SOURCE CODE MFC">

    <SCRIPT LANGUAGE="JavaScript">
<!--
var axel = Math.random() + "";
var ord = axel * 1000000000000000000 + "?";

//This part of script alleviates a Netscape document.write bug
<!-- 
NS4 = document.layers;
if (NS4) {
origWidth = innerWidth;
origHeight = innerHeight;
}
function reDo() {
if (innerWidth != origWidth || innerHeight != origHeight) 
location.reload();
}
if (NS4) onresize = reDo;
//-->
</SCRIPT>

</HEAD>



<body>

<!-- begin logo and top banner ad table -->

<TABLE width=100% cellpadding="0" cellspacing="0">

  <TR align="left">
    <TD COLSPAN="3" VALIGN="TOP" align="left">
      <A HREF="http://www.earthweb.com" TARGET="_top">
        <IMG SRC="/images/eweb_banner.gif" BORDER="0" ALT="EarthWeb">
      </a>
    </TD>
  </TR>

  <TR>
<!--BljAds
    <TD VALIGN="TOP" align=left>
      <A HREF="/">
        <IMG SRC="/images/logo_cobrand.gif" BORDER="0" ALT="Developer.com">
      </a>
    </TD>

    <TD>
      <img src="/images/dotclear.gif" WIDTH="40" HEIGHT="1">
    </TD>
-->
    <TD align="TOP">
    <center>
      <IFRAME SRC="http://ad.doubleclick.net/adi/N339.Internet.com/B974922;sz=468x60;ord=2002.07.12.18.16.31?" WIDTH=470 HEIGHT=62 MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no BORDERCOLOR='#000000'>
<SCRIPT language='JavaScript1.1' SRC="http://ad.doubleclick.net/adj/N339.Internet.com/B974922;abr=!ie;sz=468x60;ord=2002.07.12.18.16.31?">
</SCRIPT>
<NOSCRIPT>
<A HREF="http://ad.doubleclick.net/jump/N339.Internet.com/B974922;abr=!ie4;abr=!ie5;sz=468x60;ord=2002.07.12.18.16.31?">
<IMG SRC="http://ad.doubleclick.net/ad/N339.Internet.com/B974922;abr=!ie4;abr=!ie5;sz=468x60;ord=2002.07.12.18.16.31?" BORDER=0 WIDTH=468 HEIGHT=60 ALT="Alt Text">Alt Text</A>
</NOSCRIPT>
</IFRAME><IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8779/468x60-1/Oracle_RUP_ORA09M_1a/InternetRONBanner468x60.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>

<!-- Counter Position Eliminated -->

    </center>
    </TD>
  </TR>

</TABLE>
<hr>
<!-- end logo and top banner ad table -->

<!-- begin lower outer table -->

<TABLE cellpadding="0" cellspacing="0" border="0">
<TR>
<TD bgcolor=#efefef VALIGN="TOP" WIDTH="90">




<table border=1 cellspacing=0 cellpadding=0>
<tr><td>

<table border=0 cellpadding=5 cellspacing=0 width=150>
   <tr>
     <td align="center">
      <A HREF="/">
        <IMG SRC="/images/logo_cobrand.gif" BORDER="0" ALT="Developer.com">
      </a>
      </td>
   </tr>
   <tr>
     <td align="center">
     <A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/22138/125x125-1/House_Career_Channel_11g/webopediajobs-125.gif/38366531313035623364326631636630" target="_top"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_Career_Channel_11g/webopediajobs-125.gif"  WIDTH=125 HEIGHT=125 ALT=""  BORDER="0"></A><img src="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/22138/125x125-1/House_Career_Channel_11g/webopediajobs-125.gif/38366531313035623364326631636630?_RM_EMPTY_" Width="1" Height="1" Border="0">
     </td>
   </tr>
</table>

</td></tr>
<tr><td align="center">
  <table width="100%" border=0 cellpadding=5 cellspacing=0><tr><td align="center"><font size=-1>
  <a href="http://www.bizrate.com/mkt.xpml?mkt_id=503249" target="new">Shop for Software</a></font>
  </td></tr></table>
</td></tr>
<tr><td>
  <table width=130 border=0 cellpadding=5 cellspacing=0>
    <tr>
      <td>
        <!-- SEARCH FORM-->
        <form method="post" action="http://search.internet.com/codeguru.earthweb.com">
          <input type="hidden" name="IC_StartNumber" value="0">
          <input type="hidden" name="IC_BatchSize" value="10">
          <input type="hidden" name="IC_RelevanceThreshold" value="30">
          <input type="hidden" name="IC_QueryDatabase"  value="codeguru.earthweb.com">
          <input type="text"   name="IC_QueryText" value="" size="10">
          <input type="submit" value="Search">
        </form>
        <!-- END OF SEARCH FORM -->
      </td>
    </tr>
  </table>

  <table border=0 cellpadding=5 cellspacing=0 width=150>
    <tr><td><span class="navBarH1">CodeGuru Sites</span></td></tr>
    <tr><td nowrap>
        <small>
          <a href="/index.shtml">Visual C++ / MFC / C++</a><br>
          <a HREF="/csharp/index.shtml">.NET (C# and more)</a><br>
          <a href="/vb/index.shtml">Visual Basic</a><br>
          <a href="http://www.gamelan.com">Gamelan (Java)</a><br>
          <a href="http://www.jars.com">JARs (Java Applets)</a><br>
          <hr>
        </small>
        
        
    <a href="/SubmissionsGuidelines.html">
    <font face="verdana, helvetica" color="#000000" size=1>
       submission guidelines
    </font></a>
<br>

<hr>

    </td></tr>


    <tr><td><span class="navBarH1">Interact</span></td></tr>
    <tr><td nowrap>
        <small>
          <a href="/cgi-bin/bbs/wt/wwwthreads.pl">Discussion Boards</a><br>
          <a href="http://e-newsletters.internet.com">Newsletters (subscribe)</a><br>
          <a href="/Guestbook/guestbook.shtml">Guestbook</a><br>
          <a href="/cgi-bin/recommend.cgi">Recommend Us!</a><br>
          <hr>
        </small>
    </td></tr>


    <tr><td><span class="navBarH1">Of Interest</span></td></tr>
    <tr><td nowrap>
        <small>
       <a href="/announcements/dotnetbooks.html">Books on .NET</a><!--<img src="/images/new.gif">--><br>
       <a HREF="/bookReviews/index.shtml">Book Reviews</a><br>
       <a href="/newsletters/index.shtml">Newsletters (archived)</a><br> 
          <a href="/about.shtml">About Us</a><br>
          <hr>
        </small>
    </td></tr>

    <tr><td><span class="navBarH1">Article Sections</span></td></tr>

    <tr><td>
      <span class="navBarH2">C++</span>
      <br>
      <small>
        <a href="/algorithms/index.shtml">algorithms & formulas</a></br>
        <a href="/cpp_mfc/index.shtml">c++ & mfc</a><br>
        <a href="/date_time/index.shtml">date & time</a><br>
        <a href="/string/index.shtml">string</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">COM-based Technologies</span>
      <br>
      <small>
        <a href="/atl/index.shtml">atl & wtl</a><br>
        <a href="/activex/index.shtml">com & activex</a><br>
        <a href="/complus/index.shtml">com+</a><br>
        <a href="/shell/index.shtml">shell programming</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Controls</span>
      <br>
      <small>
        <a href="/buttonctrl/index.shtml">button control  </a><br>
        <a href="/combobox//index.shtml">combobox  </a><br>
        <a href="/editctrl/index.shtml">edit control  </a><br>
        <a href="/imagelist/index.shtml">imagelist control </a><br>
        <a href="/listbox/index.shtml">listbox control  </a><br>
        <a href="/listview/index.shtml">listview control  </a><br>
        <a href="/menu/index.shtml">menu  </a><br>
        <a href="/controls/index.shtml">other controls </a><br>
        <a href="/propertysheet/index.shtml">property sheet  </a><br>
        <a href="/richedit/index.shtml">rich edit control  </a><br>
        <a href="/staticctrl/index.shtml">static control  </a><br>
        <a href="/statusbar/index.shtml">status bar </a><br>
        <a href="/toolbar/index.shtml">toolbar  </a><br>
        <a href="/treeview/index.shtml">treeview control </a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Data</span>
      <br>
      <small>
    <!--
        <a href="/ado/index.shtml">ado & oledb</a><br>
        <a href="/odbc/index.shtml">odbc</a><br>
        <a href="/mfc_database/index.shtml">mfc database classes</a><br>
        <a href="/office_db/index.shtml">office products</a><br>
        <a href="/oracle/index.shtml">oracle</a><br>
        <a href="/serialization/index.shtml">serialization</a><br>
        <a href="/sqlserver/index.shtml">sql server</a><br>
    -->
        <a href="/mfc_database/index.shtml">database</a><br>
        <a href="/data-misc/index.shtml">miscellaneous</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Frameworks</span>
      <br>
      <small>
    <!--
        <a href="/component_frameworks/index.shtml">component frameworks</a><br>
        <a href="/printing_frameworks/index.shtml">printing frameworks</a><br>
        <a href="/ui_frameworks/index.shtml">ui frameworks</a><br>
    -->
        <a href="/advancedui/index.shtml">ui & printing frameworks</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Graphics & Multimedia</span>
      <br>
      <small>
        <a href="/bitmap/index.shtml">bitmaps & palettes</a><br>
        <a href="/directx/index.shtml">directx</a><br>
        <a href="/gdi/index.shtml">gdi</a><br>
        <a href="/multimedia/index.shtml">multimedia</a><br>
        <a href="/opengl/index.shtml">opengl</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Internet & Networking</span>
      <br>
      <small>
        <a href="/ieprogram/index.shtml">ie programming</a><br>
        <a href="/internet/index.shtml">internet protocols</a><br>
        <a href="/isapi/index.shtml">isapi</a><br>
        <a href="/network/index.shtml">network protocols</a><br>
      </small>
    </td></tr>
	
    <tr><td>
      <span class="navBarH2">Miscellaneous</span>
      <br>
      <small>
        <a href="/misc/index.shtml">miscellaneous</a><br>
        <a href="/samples/index.shtml">samples</a><br>
      </small>
    </td></tr>

    <!--
    <tr><td><span class="navBarH2">Security</span></td></tr>
    <tr><td><small>
      <a href="/cryptoapi/index.shtml">crypto api</a><br>
      <a href="/encryption/index.shtml">encryption/decryption</a><br>
      <br>
    </small></td></tr>
    -->

    <tr><td>
      <span class="navBarH2">Visual Studio</span>
      <br>
      <small>
    <!--
        <a href="/addins/index.shtml">add-ins</a><br>

        <a href="/tips/index.shtml">editor tips</a><br>
        <a href="/macros/index.shtml">macros</a><br>
    -->
        <a href="/debug/index.shtml">debugging</a><br>
        <a href="/devstudio_macros/index.shtml">add-ins & macros</a><br>
        <a href="/tips/index.shtml">editor tips</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Windows Programming</span>
      <br>
      <small>
        <a href="/ce/index.shtml">ce</a><br>
        <a href="/clipboard/index.shtml">clipboard</a><br>
        <a href="/dll/index.shtml">dll</a><br>
        <a href="/files/index.shtml">file & folder</a><br>
        <a href="/help/index.shtml">help systems</a><br>
        <a href="/printing/index.shtml">printing</a><br>
        <a href="/win32/index.shtml">win32</a><br>
        <a href="/system/index.shtml">system</a><br>
      </small>
    </td></tr>

    <tr><td>
      <span class="navBarH2">Windows &amp; Dialogs</span>
      <br>
      <small>
        <a href="/console/index.shtml">console</a></br>
        <a href="/dialog/index.shtml">dialog</a><br>
        <a href="/docking/index.shtml">docking window</a><br>
        <a href="/doc_view/index.shtml">doc/view</a><br>
        <a href="/splitter/index.shtml">splitter</a><br>
      </small>
      <hr>
    </td></tr>

    </table>

<!-- JOB BUTTON --> 
    <table border=0 cellpadding=5 cellspacing=0 width=150>
    <tr><td align="center">
       <a href="http://jobs.internet.com" target="new">
         <IMG SRC="http://www.codeguru.com/jobs.gif" alt="[Internet Jobs]">
       </a>
    </td></tr>
    </table>

  </td>
</tr>
</table>

<!--/navbar>


<!-- blank column for spacing -->

<td valign="top" width="20">&nbsp;&nbsp;&nbsp;</td>

<!-- end blank column for spacing -->

<!-- begin content column -->

<TD VALIGN="TOP" >

<!--
<table cellpadding="0" cellspacing="0">
<tr>
-->

<!-- begin main content column -->


<!-- closign of column, row, and table are in subfoot file -->





<script type="text/javascript" language="javascript"> 
if (screen.width==640 || screen.width==800)
{
   document.write("<link rel=stylesheet href='/global/global800.css'>"); 
} 
else 
{ 
   document.write("<link rel=stylesheet href='/global/global.css'>"); 
} 
</script>


<CENTER><H3><FONT COLOR = "#a0a099">MFC .DLL TUTORIAL, PART 1</FONT></H3></CENTER><HR>
<!-- Author and contact details -->

This article was contributed by 
<A href="mailto:afenster@core.com">Andrew Fenster</A>. <!-- For which environment is this code specific? -->
<p><u>Environment:</u>  Visual C++

<P>

At one point in time, before COM, before ATL, programmers 
used ordinary .DLLs instead.  You could do a lot with a .DLL.  
If you had several programs that used the same functions or 
other resources, you could save space by putting those resources 
in a .DLL.  Putting code used by multiple programs in a single 
.DLL often saved maintenance time because the code was all in 
one place.  Fixes and other modifications would only have to be 
done one time.   If you had a program which needed to run 
different routines at different times, you could put those 
routines into .DLLs and have the application load the appropriate 
.DLL when it was needed.  There were lots of good reasons to use .DLLs.  

<P>

There are still a lot of good reasons to use .DLLs.  They 
haven't gone away.  Sure, whatever you can do with a .DLL, 
you can probably do with a COM  object.  Granted, there are 
a number of shortcomings to .DLLs, some of them serious, which 
is why we ended up with COM in the first place.  Still, .DLLs 
remain a very useful tool.  Compared to COM and ATL, they are 
much easier to make.  Learning COM or ATL requires a serious 
investment of time and effort.  Making a .DLL is relatively easy.  
Modifying one is easy too.  If you know some C++ and MFC, you 
could be making .DLLs today.

<P>

This article will review the types of .DLLs you can make with 
MFC, including when to use each type and how to make them.  In 
the next article there will be a discussion of the limitations 
of .DLLs (which led to the rise of COM and ATL), and how these 
can be partially avoided.  In the third article, there will be 
more coding details and examples.

<P>

<CENTER><H3><FONT COLOR = "#a0a099">Different types of .DLLs</FONT></H3></CENTER>

There are two kinds of .DLLs you can make using MFC:  an MFC 
extension .DLL or a regular .DLL.  Regular .DLLs in turn come 
in two varieties:  dynamically linked or statically linked.  
Visual C++ also allows you to make a generic Win32 .DLL, but 
in this article I'm only going to discuss the MFC-based .DLL types.

<P>

<B><U>MFC extension .DLLs</B></U><P>

Every .DLL has some kind of interface.  The interface is the set 
of the variables, pointers, functions or classes provided by the 
.DLL which you can access from the client program.  They are the 
things that allow the client program to use the .DLL.  An MFC 
extension .DLL can have a C++ style interface.  That is, it can 
provide ("export") C++ functions and entire C++ classes to be 
used by the client application.  The functions it exports can 
use C++ or MFC data types as parameters or as return values.  
When it exports a class, the client will be able to create objects 
of that class or derive new classes from it.  Inside the .DLL, you 
can also use MFC and C++.

<P>

The MFC code library used by Visual C++ is stored in a .DLL.  An 
MFC extension .DLL dynamically links to the MFC code library .DLL.  
The client application must also dynamically link to the MFC code 
library .DLL.  As the years have gone by the MFC library has grown.  
As a result, there are a few different versions of the MFC code 
library .DLL out there.  Both the client program and the extension 
.DLL must be built using the same version of MFC.  Therefore, for 
an MFC extension .DLL to work, both the extension .DLL and the client 
program must dynamically link to the same MFC code library .DLL, and 
this .DLL must be available on the computer where the application is 
running.

<P>

Note:  If you have an application which is statically linked to MFC, 
and you wish to modify it so that it can access functions from an 
extension .DLL, you can change the application to dynamically link 
to MFC.  In Visual C++, select "Project | Settings" from the menu.  
On the "General" settings tab you can change your application to 
dynamically link to MFC.

<P>

MFC extension .DLLs are very small.  You can build an extension .DLL 
which exports a few functions or small classes and has a size of 10-15 
KB.  Obviously, the size of your .DLL depends on how much code you 
store in it, but in general MFC extension .DLLs are relatively small 
and quick to load.

<P>

<B><U>Regular .DLLs</B></U><P>

The MFC extension .DLL only works with MFC client applications.  If 
you need a .DLL that can be loaded and run by a wider range of Win32 
programs, you should use a regular .DLL.  The downside is that your
.DLL and your client application cannot send each other pointers or 
references to MFC-derived classes and objects.  If you export a 
function, it cannot use MFC data types in its parameters or return 
values.  If you export a C++ class, it cannot be derived from MFC. You 
can still use MFC <B>inside</B> your .DLL, but not in your interface. 

<P>

Your regular .DLL still needs to have access to the code in the MFC 
code library .DLL.  You can dynamically link to this code or statically 
link.  If you dynamically link, that means the MFC code your .DLL needs 
in order to function is not built into your .DLL.  Your .DLL will get 
the code it needs from the MFC code library .DLL found on the client 
application's computer.  If the right version of the MFC code library 
.DLL is not there, your .DLL won't run.  Like the MFC extension .DLL, 
you get a small .DLL (because the .DLL doesn't include the MFC code), 
but you can only run if the client computer has the MFC code library 
.DLL.

<P>

If you statically link to the MFC code library, your .DLL will 
incorporate within itself all the MFC code it needs.  Thus, it will 
be a larger .DLL, but it won't be dependent on the client computer 
having the proper MFC code library .DLL.  If you can't rely on the 
host computer having the right version of MFC available, this is the 
way to go.  If your application users are all within your own company, 
and you have control over what versions of the MFC .DLLs are lurking 
on their computers, or if your installation program also loads the 
right MFC .DLL, this might not be an issue.

<P>

<CENTER><H3><FONT COLOR = "#a0a099">Building a .DLL</FONT></H3></CENTER>

You can make an MFC-based .DLL with the App Wizard.  Select "File | New" 
from the menu.  On the "Projects" tab, select "MFC AppWizard (.DLL)."  
Pick a name for your new project and click "OK."  On the next screen, 
you will have the choice to create an MFC extension .DLL, a regular .DLL 
"using shared MFC .DLL" (i.e., a regular .DLL dynamically linked to MFC), 
or a regular .DLL statically linked to MFC.  Pick the one you want and 
click "Finish."  

<P>

App Wizard builds a .DLL which doesn't do anything.  The new .DLL will 
compile, but since it doesn't export any classes or functions yet, it 
is still essentially useless.  You now have two jobs:  (1) add 
functionality to make your .DLL useful; and (2)  modify your client 
application to use your .DLL. 

<P>

<B><U>Export a class</B></U>

<P>

Once you're done with the App Wizard, you can add classes to your .DLL
by adding the .cpp and .h files from another project, or you can create 
them from scratch within your current project.  To export a class, you 
add "__declspec(dllexport)" to the class declaration so it looks 
like this:

<P>
<PRE>
  class __declspec(dllexport) CMyClass
  {
     <span class="codeComment">//class declaration goes here</span>
  };</PRE>

<P>

If you are making an MFC extension .DLL, you can instead use the 
AFX_EXT_CLASS macro:

<P>
<PRE>
  class AFX_EXT_CLASS CMyClass
  {
     <span class="codeComment">//class declaration goes here</span>
  };</PRE>

<P>

There are other ways to export a class, but this is the easiest.  If 
your exported class requires a resource which is located in the .DLL,
for example a class derived from CDialog, the process is more
involved.  I'll cover this subject in tutorial #3.

Below I'll discuss what to do to the client application so that 
it can use your exported class.

<P>

<B><U>Export variables, constants and objects</B></U>

<P>

Instead of exporting a whole class, you can have your .DLL export a 
variable, constant or object. To export a variable or constant, you 
simply declare it like this:

<P>
<PRE>
__declspec(dllexport) int   MyInt;
__declspec(dllexport) extern const COLORREF MyColor = 
                                      RGB(50,50,50);</PRE>
<P>

When you want to export a constant, you must use the "extern" specifier.
Otherwise you will get a link error.  

<P>

You can declare and export a class object in the exact same manner:

<P>
<PRE>
__declspec(dllexport) CRect MyRect(30, 30, 300, 300);</PRE>
<P>

Note that you can only export a class object if the client 
application recognizes the class and has its header file.  
If you make a new class inside your .DLL, the client application 
won't recognize it without the header file. 

<P>

When you export a variable or object, each client application 
which loads the .DLL will get its own copy.  Thus, if two different 
applications are using the same .DLL, changes made by one application 
will not affect the other application.

<P>

It's important to remember that you can only export objects and variables 
which are of <B>global</B> scope within your .DLL.  Local objects and 
variables cease to exist when they go out of scope.  Thus, if your .DLL 
included the following, it wouldn't work.

<P>
<PRE>
MyFunction( )
{
     __declspec(dllexport) CSomeClass SomeObject;
     __declspec(dllexport) int SomeInt;
}</PRE>

<P>

As soon as the object and variable go out of scope, they will cease to 
exist.

<P>

<B><U>Export a function</B></U>

<P>

Exporting functions is similar to exporting objects or variables.  
You simply tack "_declspec(dllexport)" onto the beginning of your 
function prototype:

<P>
<PRE>
__declspec(dllexport) int SomeFunction(int);</PRE>
<P>

If you are making an MFC regular .DLL which will be used by a client
application written in C, your function declaration should look like this:

<P>
<PRE>
extern "C" __declspec(dllexport) int SomeFunction(int);</PRE>

<P>

and your function definition should look like this:

<P>
<PRE>
extern "C" __declspec(dllexport) int SomeFunction(int x)
{
     <span class="codeComment">//do something </span>
}</PRE>

<P>

If you are building a regular .DLL which is <B>dynamically linked</B> to the
MFC code library .DLL, you must insert the AFX_MANAGE_STATE macro as 
the first line of any exported function.  Thus, your function definition 
would look like this:

<P>
<PRE>
extern "C" __declspec(dllexport) int AddFive(int x)
{
     AFX_MANAGE_STATE(AfxGetStaticModuleState( ));
     return x + 5;
}</PRE>

<P>

It doesn't hurt to do this in every regular .DLL.  If you you switch your
.DLL to static linking, the macro will simply have no effect.

<P>

That's all there is to exporting functions.  Remember, only an MFC 
extension .DLL can export functions with MFC data types in the 
parameters or return value.   

<P>

<B><U>Export a pointer</B></U>

<P>

Exporting an uninitialized pointer is simple.  You do it the same way
you export a variable or object:

<P>
<PRE>
__declspec(dllexport) int* SomeInt;</PRE>

<P>

You can also export an initialized object this way:

<P>
<PRE>
__declspec(dllexport) CSomeClass* SomePointer = 
                                     new CSomeClass;</PRE>

<P>

Of course, if you declare and initialize your pointer you need to find 
a place to delete it.

<P>

In an extension .DLL, you will find a function called DllMain( ).  
This function gets called when the client program attaches your .DLL 
and again when it detaches.  So here's one possible way to handle 
your pointers in an extension .DLL:

<P>
<PRE>
#include "SomeClass.h"

_declspec(dllexport) CSomeClass* SomePointer = new CSomeClass;

DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved)
{
     if (dwReason == DLL_PROCESS_ATTACH)
     { 

     }
     else if (dwReason == DLL_PROCESS_DETACH)
     {
        delete SomePointer;
     }
}</PRE>
<P>

A regular .DLL looks more like an ordinary MFC executable.  It has an object
derived from CWinApp to handle opening and closing your .DLL.  You can use the
class wizard to add an InitInstance( ) function and an ExitInstance( ) function.

<P>
<PRE>
int CMyDllApp::ExitInstance() 
{
     delete SomePointer;
     return CWinApp::ExitInstance();
}</PRE>

<P>

<CENTER><H3><FONT COLOR = "#a0a099">Using the .DLL in a client application</FONT></H3></CENTER>

A .DLL can't run on its own.  It requires a client application to load it 
and use its interface.  Making a client application that can do so is not 
difficult.

<P>

When you compile your .DLL, the compiler creates two important files:  
the .DLL file and the .lib file.  Your client application needs both of 
these.  You must copy them into the project folder of your client 
application.  Note that the .DLL and .lib files that are created when 
you build in Debug are different that those built when you build in Release.  
When you are building your client application in Debug, you need the 
Debug versions of the .DLL and .lib files, and when you are building 
in Release you need the Release .DLL and .lib.  The easiest way to 
handle this is to put the Debug .DLL and .lib files in your client 
application's Debug folder and the Release .DLL and .lib in the Release 
folder.

<P>

The next step is to go into your client project settings and tell the
linker to look for your .lib file.  You must tell the linker the 
name of your .lib file and where it can be found.  To do this, open 
the project settings, go to the "Link" tab and enter your file name 
and path in the "Object/library modules" box.  It should look something 
like this:

<P>
<IMG align=absMiddle alt="" 
src="dill1.jpg" 
style="LEFT: 334px; TOP: 2618px">
<P> 

In addition to the .DLL and .lib files, your client application needs 
a header file for the imported classes, functions, objects and variables.  
When we were exporting, we added "__declspec(dllexport)" to our declarations.  
Now when we are importing, we will add "__declspec(dllimport)."  So if we 
wanted to import the variable, object and function used in our previous 
examples, our header file would contain the following:

<P>
<PRE>
__declspec(dllimport) int SomeFunction(int);
__declspec(dllexport) CSomeClass SomeObject;
__declspec(dllexport) int SomeInt;</PRE>
<P>

Remember, if you used the <B>extern "C"</B> specifier in the .DLL, you must
also use it in the client application:

<P>
<PRE>
extern "C" __declspec(dllimport) int SomeFunction(int);</PRE>

<P>

To make things more readable, we might write it like this instead:

<P>
<PRE>
#define DLLIMPORT __declspec(dllimport)

DLLIMPORT int SomeFunction(int);
DLLIMPORT CSomeClass SomeObject;
DLLIMPORT int SomeInt;</PRE>

<P>

Now that you have declared your object, variable and function in a 
header file inside your client application, they are available for use.

<P>

To import an entire class, you must copy the entire .h header file into
the client application.  The .DLL and the client application will thus have 
identical header files for the exported class, except one will say 
"class __declspec(dllexport) CMyClass" and one will say 
"class __declspec(dllimport) CMyClass".  If you are making
an MFC extension .DLL, you could instead say "class AFX_EXT_CLASS CMyClass"
in both places.  

<P>

Once you are done building your client application and you're ready to 
turn it over to the actual users, you should give them your Release 
executable and the Release .DLL.  You do not need to give the users the 
.lib file.  The .DLL can go in the same directory as the executable, or 
it can go in the Windows System directory.  As discussed above, you may 
also have to provide your users with the correct MFC code library .DLL.  
This .DLL was loaded onto your computer when you installed Visual C++.  
Your users, however, may not have it.  It does not come standard with 
Windows.  

<P>

<CENTER><H3><FONT COLOR = "#a0a099">A Word of Caution</FONT></H3></CENTER>

This article should provide you with enough information to start building 
your own .DLLs.  A word of caution is needed, however.  As mentioned at 
the beginning of this article, there are several serious shortcomings to 
.DLLs.  These shortcomings are the reason that we now have COM and ATL.  
There are two main problems.  First, a .DLL built with one brand of 
compiler may not be compatible with a client application built with a 
different compiler.   Second, when you modify the .DLL, you may have to 
recompile the client application, even though you aren't changing any 
code in the client application.  You may still have to copy in a new .DLL 
and .lib file and recompile.

<P>

There are ways to avoid this problem under some circumstances.  I'll 
discuss the problem in more detail in the next article.


<h3>History</h3>
Date Posted:  July 9, 2001<br>
Updated:  March 6, 2002

<!--comments-->
<h3>Comments:</h3><ul>
<!--startlist-->
<li><a href="/mfc/comments/39846.shtml">Great tutorial!</a> - Bebe Stanie (2002/07/12)

<li><a href="/mfc/comments/39298.shtml">Good Resource</a> - Abir Basak (2002/06/28)

<li><a href="/mfc/comments/36292.shtml">Good Resource</a> - nikhil alulkar (2002/04/21)

<li><a href="/mfc/comments/34356.shtml">At least this is very helpful for me</a> - Waqar Amin (2002/03/08)


<li><b>Article Updated</b> - Brad Jones (Webmaster) (2002/03/06)

<li><a href="/mfc/comments/34199.shtml">How can I use this dll in VB</a> - Rajiv (2002/03/06)

<li><a href="/mfc/comments/33946.shtml">thanks</a> - Kevin Smith (2002/02/28)

<li><a href="/mfc/comments/31437.shtml">Very helpful!!!</a> - Vishal (2002/01/07)

<li><a href="/mfc/comments/30350.shtml">shared objects/variables among clients</a> - bugsweeper (2001/12/11)

<li><a href="/mfc/comments/24923.shtml">DLL or COM/ATL?</a> - John Simmons (2001/07/30)

<li><a href="/mfc/comments/24314.shtml">Difference between __declspec(dllexport) and using .DEF file</a> - Erling Eybye (2001/07/10)

<li><a href="/mfc/comments/24293.shtml">There is an error here....</a> - James Schumacher (2001/07/10)

<li><a href="/mfc/comments/24267.shtml">MFC .DLL TUTORIAL, PART 1</a> - miomeme (2001/07/09)

</ul>
<P>
<strong><a href="/cgi-bin/addpage/addpage.cgi?cfg=addcomment&action=Comment">
Add Comment</a></strong>
<P>

</td>

      <!--BLJAds - Added right side tower ad -->
<TD VALIGN="TOP">
<A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/2730/125x800/Oracle_RUP_ORA09M_1a/InternetcomRONSky120x600.html/38366531313035623364326631636630?2002.07.12.18.16.31"> <IMG SRC="http://ad.doubleclick.net/ad/N339.Internet.com/B974922.2;sz=120x600;ord=2002.07.12.18.16.31?" BORDER=0 WIDTH=120 HEIGHT=600 ALT=""></A>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/2730/125x800/Oracle_RUP_ORA09M_1a/InternetcomRONSky120x600.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>

<p>

<!-- Commerce bar -->
<table border="0" cellpadding="3" width="140">

<tr bgcolor="black"><td>
<font face="Arial" color="white" size="1" >
<b><center>internet.commerce</center></b></font>
</td></tr>
<tr bgcolor="lightgrey"><td>
<font face="Arial" size="1" >
<a href="http://www.internet.com/partners/">Be a Commerce Partner</A><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29841/cp1/ImpactBuilderPro_com_5d/buildflashonline.html/38366531313035623364326631636630">Build Flash Online</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29841/cp1/ImpactBuilderPro_com_5d/buildflashonline.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18921/cp2/Trellian_8d/PromoteYourWebsite.html/38366531313035623364326631636630">Promote Your Website</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18921/cp2/Trellian_8d/PromoteYourWebsite.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8000/cp3/Erain_1e/flash.html/38366531313035623364326631636630">FlashMX Tools/Bundles</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8000/cp3/Erain_1e/flash.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29848/cp4/PriceGrabber.com_2d/ComparisonShopping.html/38366531313035623364326631636630">Comparison Shopping</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29848/cp4/PriceGrabber.com_2d/ComparisonShopping.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18927/cp5/DealTime_3b/dealtime.html/38366531313035623364326631636630">Compare Prices</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18927/cp5/DealTime_3b/dealtime.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8007/cp6/Imsisoft_2a/ForWebGraphics.html/38366531313035623364326631636630">For Web Graphics</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8007/cp6/Imsisoft_2a/ForWebGraphics.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29854/cp7/UltraDNS_9e/FreeDNSOffer.html/38366531313035623364326631636630">Free DNS Offer</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29854/cp7/UltraDNS_9e/FreeDNSOffer.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18934/cp8/Global_Reports_2a/FindAnnualReports.html/38366531313035623364326631636630">Find Annual Reports</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18934/cp8/Global_Reports_2a/FindAnnualReports.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8014/cp9/Rawhide_3b/Rawhide_text.html/38366531313035623364326631636630">Search Marketplace</a>
<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/8014/cp9/Rawhide_3b/Rawhide_text.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1><BR>
<a href="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29861/cp10/Dice_16b/dice_careerbuilder_text.html/38366531313035623364326631636630">Internet Jobs</a>


<IMG SRC="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/29861/cp10/Dice_16b/dice_careerbuilder_text.html/38366531313035623364326631636630?_RM_EMPTY_" WIDTH=1 HEIGHT=1>
<BR>

</font>
</td></tr>
</table>
<br>


</TD>

</tr>
</table>
<!-- begin footer information -->
<br>
<CENTER>
<A HREF="http://www.codeguru.com/RealMedia/ads/click_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18941/468x60-2/House_Instant_Messaging_2a/imp2002fall-leo.gif/38366531313035623364326631636630" target="_top"><IMG SRC="http://www.codeguru.com/RealMedia/ads/Creatives/House_Instant_Messaging_2a/imp2002fall-leo.gif"  ALT="Instant Messaging Planet Fall"  BORDER="0"></A><img src="http://www.codeguru.com/RealMedia/ads/adstream_lx.cgi/ew/ewsoftware/www.codeguru.com/cpp_mfc/dill1.html/18941/468x60-2/House_Instant_Messaging_2a/imp2002fall-leo.gif/38366531313035623364326631636630?_RM_EMPTY_" Width="1" Height="1" Border="0">
<br>
<FONT SIZE="-1">EarthWeb is a service of INT Media Group, Incorporated.<br>
Copyright 2002 INT Media Group, Incorporated. All Rights Reserved.<BR>
<A HREF="http://www.internet.com/help/feedback.html">Feedback</A>, &nbsp;
<A HREF="http://www.itmarketer.com">Advertising Info</A>, &nbsp;
<A HREF="http://www.internet.com/corporate/legal.html">Legal Notices</A>,&nbsp;
<A HREF="http://www.internet.com/corporate/reprints.html#Licensing">Licensing</A>, 
<A HREF="http://www.internet.com/corporate/reprints.html#Reprints">Reprints</A>, &amp; 
<A HREF="http://www.internet.com/corporate/reprints.html#Permissions">Permissions</A>, &nbsp;
<A HREF="http://www.internet.com/corporate/privacy/privacypolicy.html">Privacy Policy</A>.
<BR>
<A HREF="http://www.internet.com"><IMG SRC="/images/internetcom.gif"
ALT="http://www.internet.com/" WIDTH="161" HEIGHT="18"
BORDER="0"></A></FONT>
</CENTER>

</BODY>
</HTML>





