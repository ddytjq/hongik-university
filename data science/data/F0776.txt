ID=F0776
URL=http://www.vbsquare.com/mouse/context/
SIZE=20686
DATE=09/07/2002
TIME=13:25:39
DATASET=Visual Basic
HTML=<html>
<head>
<title>VB Square - Mouse and Keyboard - Articles - Detect the keyboard's right click button - </title>
<meta name="keywords" content="Right click, context,,visual basic,vb,visual,basic,win32,vb4,vb5,vb6,visual basic,vb,visual,basic,win32,vb4,vb5,vb6">
<meta name="description" content="Many keyboards now support a small key in-between the Atl Gr key and the Windows Key that, when pressed, shows the default context menu for the control that is currently selected. This article shows you how to emulate this.">
<STYLE type=text/css>
.blfont {
  COLOR: #007F00;
}
.redfont {
  COLOR: #cc0033;
}
.yllwfont {
  font-family: Verdana, Arial; 
  font-size: 11px;
  font-weight: bold;
  COLOR: #FFFF33;
}
.bluefont {
  COLOR: #007F00;
  font-family: Verdana, Arial; 
  font-size: 11px;
}
.navbit {
  font-family: Verdana, Geneva, Lucida, Arial; 
  font-size: 11px;
}
.whitefont {
  COLOR: #000000;
}
A:hover {
  COLOR: #ff0000;
}
A:link {
  COLOR: #0000FF;
}
</STYLE>
</head>
<body background="/images/bground.gif" bgcolor="#ffffff" text="#000000">
<!-- VBS -->
<!-- Start Header -->
<a name="top"></a>

<!-- Start Branding Table -->
<table border="0" cellPadding="0" cellSpacing="0" width="100%"><TBODY>
<tr><td width="110" valign="top">
<a href="/"><img src="/images/vbsquare.gif" width="90" height="64" border="0"></a>
<img src="/images/clear.gif" height="1" width="110"></td>
<td width="4"><img src="/images/clear.gif" height="1" width="4"></td>
<td width="100%" valign="top">

<!-- Begin Adslot1 -->
<!-- $ adslot1 -->
<!-- End Adslot1 -->

</td></tr>
</tbody></table>
<!-- End Branding Table -->

<!-- Start Content Table -->

<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY>
<tr><td width="110" valign="top">

<!-- Start left nav bar -->
<FONT SIZE="-1" FACE="verdana, arial, helvetica">

<p align="left"><font color="#FFFF33" class=yllwfont><b>Topic Areas</b></font><br>
<a href="/activex/"><font color="#99CCFF" class=bluefont>ActiveX</font></a><br>
<a href="/api/"><font color="#99CCFF" class=bluefont>API</font></a><br>
<a href="/beginning/"><font color="#99CCFF" class=bluefont>Beginning</font></a><br>
<a href="/controls/"><font color="#99CCFF" class=bluefont>Controls/Forms</font></a><br>
<a href="/databases/"><font color="#99CCFF" class=bluefont>Databases</font></a><br>
<a href="/files/"><font color="#99CCFF" class=bluefont>File/Directory</font></a><br>
<a href="/graphics/"><font color="#99CCFF" class=bluefont>Graphics</font></a><br>
<a href="/internet/"><font color="#99CCFF" class=bluefont>Internet</font></a><br>
<a href="/misc/"><font color="#99CCFF" class=bluefont>Miscellaneous</font></a><br>
<a href="/mouse/"><font color="#99CCFF" class=bluefont>Mouse/Keyboard</font></a><br>
<a href="/registry/"><font color="#99CCFF" class=bluefont>Registry</font></a></p>

<p align="left"><font color="#FFFF33" class=yllwfont><b>Contents</b></font><br>
<a href="/articles/"><font color="#99CCFF" class=bluefont>Articles</font></a><br>
<a href="/tips/"><font color="#99CCFF" class=bluefont>Tips</font></a><br>
<a href="/demos/"><font color="#99CCFF" class=bluefont>Demo Projects</font></a><br>
<a href="/books/"><font color="#99CCFF" class=bluefont>Books</font></a><br>

<p><font color="#FFFF33" class=yllwfont><b>Resources</b></font><br>
<a href="http://www.vbforums.com/?styleid=3"><font color="#99CCFF" class=bluefont>Q and A</font></a><br>
<a href="http://www.vbworld.com/news/"><font color="#99CCFF" class=bluefont>Tech News</font></a><br>
<a href="/newsletters/"><font color="#99CCFF" class=bluefont>Newsletters</font></a><br>
<a href="/php-bin/contactus.php"><font color="#99CCFF" class=bluefont>Contact Us</font></a><br>

</font>
<!-- end left nav bar -->

    <img src="/images/clear.gif" height="1" width="110">
    </td></td>
    <td width="4"><img src="/images/clear.gif" height="1" width="4"></td>
    <td width="100%" valign="top">
    <!-- Start Main page content -->

<!-- End Header -->
<!-- Breadcrumb -->
<table border="0" cellPadding="3" cellSpacing="0" width="100%">
<TBODY><tr>
<td align="left" bgColor="#FFCC00" vAlign="top" width="100%">
<font FACE="Verdana, Arial, Helvetica" SIZE="2">
<b>&nbsp;&nbsp;
<a href="/"><FONT color=#ffffff class=whitefont>Home</font></a> 

<FONT color=#000000>&nbsp;&gt;</font> 
<a href="/mouse/"><FONT color=#000000 class=whitefont>Mouse and Keyboard</font></a><FONT color=#000000>&nbsp;&gt;</font> 
<a href="/mouse/articles.html"><FONT color=#000000 class=whitefont>Articles</font></a>

</b></font></td></tr>
</TBODY></table>

<table width="100%" border=0 cellspacing=0 cellpadding=0 bgcolor="#eeeeee"><tr align=center valign=middle>
<td width="25%" align="center" nowrap>
<FONT face="MS Sans Serif, Geneva" size=-2><a href="/tips/">Visual Basic Code</a></font>
</td><td width="50%" height=40 align=center nowrap>
<!-- Start Search box table -->
<table border=0 cellspacing=0 cellpadding=0 height=40 bgcolor="#EEEEEE">
<form method="GET" action="/php-bin/search.php">
<input type="hidden" name="searchview" value="priority">
<tr align=center valign=middle>
<td height=40 align=right nowrap>&nbsp;</td>
<td align=left nowrap><FONT face="MS Sans Serif, Geneva" size=-2><b>Search VB Square:</b></font></td>
<td height=40 align=right nowrap>&nbsp;</td>
<td align=left><input type="Text" name="query" size="18" maxlength="255"></td>
<td>&nbsp;<input type="submit" value="Go">&nbsp;</td>
</tr></form></table>
<!-- End search box table -->
</td><td width="25%">
<FONT face="MS Sans Serif, Geneva" size=-2><a href="/articles/">Detailed VB Articles</a></font>
</td></tr></table>

<!-- End Breadcrumb -->

<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY>

<tr><td vAlign="top" width="100%">

<FONT SIZE="-1" FACE="verdana, arial, helvetica">
<br>
<p><font face="Arial, Helvetica" size="+1"><b>Detect the keyboard's right click button</b></font></p>
<p><i>By <a href="/php-bin/authorbio.php?authorid=31&associd=75&assoctype=2">Sam Huggill</a></i></p>
<p><font face="Arial, Helvetica" size="+1"><b></b></font></p>

<p>Many keyboards now support a small key in-between the Atl Gr key and the Windows Key that, when pressed, shows the default context menu for the control that is currently selected.</p>

<p>For example, set the focus on a text box and press the context menu key. See the context menu popup?</p>

<p>While developing my Developers Code Book application, I have context menus on both the treeview and the edit window. I use the context menu key a lot when programming, because I hate having to reach over for the mouse. So naturally, when I wanted to show a context menu on my treeview and edit window by pressing the context key, I had to stop and use the mouse; how irritating! So, I looked around for some way of getting around this problem.</p>

<p>After spending sometime searching the MSDN and other useful sources, I came to the conclusion that I would have to use subclassing. And the message I was looking for? WM_CONTEXTMENU.</p>

<p>I came across this message when doing a previous article, &quot;Replacing the system menu on a form&quot;. All you have to do is set up a simple subclassing window procedure, and react to the WM_CONTEXTMENU message.</p>

<p>Once you have received this message, you can call your own procedure that then can call the controls MouseUp event or whatever you want to do to show your context menu. You can apply this code to many controls that don't have a built in context menu, but in this example I have simply used it on a treeview control.</p>

<p>NOTE: If you are planning on subclassing more than one control in the same project, then use a third party control to subclass the control (such as <a href="http://vbaccelerator.com/">Steve McMahon's Subclassing Control</a>)</p>

<p>OK. Lets get some code down. Start a new Standard EXE Project and add a module. To the form add a treeview control. Rename the module modSubclass and copy the following code into it:</p>

</font><pre><font color="#00007F">Option</font> <font color="#00007F">Explicit</font>

<font color="#007F00">' Holds a reference to the previous window procedure </font>
<font color="#007F00">' before we started subclassing </font>

<font color="#00007F">Public</font> OldProc <font color="#00007F">As</font> <font color="#00007F">Long</font>

<font color="#00007F">Declare</font> <font color="#00007F">Function</font> SetWindowLong <font color="#00007F">Lib</font> "user32" <font color="#00007F">Alias</font> "SetWindowLongA" _ 
(<font color="#00007F">ByVal</font> hWnd <font color="#00007F">As</font> <font color="#00007F">Long</font>, <font color="#00007F">ByVal</font> nIndex <font color="#00007F">As</font> <font color="#00007F">Long</font>, _ <font color="#00007F">ByVal</font>  dwNewLong <font color="#00007F">As</font> <font color="#00007F">Long</font>) <font color="#00007F">As</font> <font color="#00007F">Long</font>

<font color="#00007F">Declare</font> <font color="#00007F">Function</font> GetWindowLong <font color="#00007F">Lib</font> "user32" <font color="#00007F">Alias</font> "GetWindowLongA" _ 
(<font color="#00007F">ByVal</font> hWnd <font color="#00007F">As</font> <font color="#00007F">Long</font>, <font color="#00007F">ByVal</font> nIndex <font color="#00007F">As</font> <font color="#00007F">Long</font>) <font color="#00007F">As</font> <font color="#00007F">Long</font>

<font color="#00007F">Const</font> GWL_WNDPROC = (-4)

<font color="#00007F">Declare</font> <font color="#00007F">Function</font> CallWindowProc <font color="#00007F">Lib</font> "user32" <font color="#00007F">Alias</font> "CallWindowProcA" _ 
(<font color="#00007F">ByVal</font> lpPrevWndFunc <font color="#00007F">As</font> <font color="#00007F">Long</font>, <font color="#00007F">ByVal</font> hWnd <font color="#00007F">As</font> <font color="#00007F">Long</font>, _
<font color="#00007F">ByVal</font> Msg <font color="#00007F">As</font> <font color="#00007F">Long</font>, _
<font color="#00007F">ByVal</font> wParam <font color="#00007F">As</font> <font color="#00007F">Long</font>, <font color="#00007F">ByVal</font> lParam <font color="#00007F">As</font> <font color="#00007F">Long</font>) <font color="#00007F">As</font> <font color="#00007F">Long</font>

<font color="#007F00">' The message that we are going to monitor</font>

<font color="#00007F">Public</font> <font color="#00007F">Const</font> WM_CONTEXTMENU = &H7B&

<font color="#00007F">Public</font> <font color="#00007F">Function</font> WndProc(<font color="#00007F">ByVal</font> hWnd <font color="#00007F">As</font> <font color="#00007F">Long</font>, <font color="#00007F">ByVal</font> wMsg <font color="#00007F">As</font> <font color="#00007F">Long</font>, _
<font color="#00007F">ByVal</font> wParam <font color="#00007F">As</font> <font color="#00007F">Long</font>, <font color="#00007F">ByVal</font> lParam <font color="#00007F">As</font> <font color="#00007F">Long</font>) <font color="#00007F">As</font> <font color="#00007F">Long</font>

<font color="#00007F">If</font> wMsg = WM_CONTEXTMENU <font color="#00007F">Then</font>
  <font color="#007F00">' Handle this message and call our popup routine</font>
  WndProc = 0
  frmTest.ShowPopup 
  <font color="#00007F">Exit</font> <font color="#00007F">Function</font> 
<font color="#00007F">End</font> <font color="#00007F">If</font>

<font color="#007F00">' Pass on all the other unhandled messages</font>

WndProc = CallWindowProc(OldProc, hWnd, wMsg,wParam, lParam) 

<font color="#00007F">End</font> Function</pre><FONT SIZE="-1" FACE="verdana, arial, helvetica">

<p>Now add this code to the form:</p>

</font><pre><font color="#00007F">Option</font> <font color="#00007F">Explicit</font>

<font color="#00007F">Private</font> <font color="#00007F">Sub</font> Form_Load() 

<font color="#007F00">'Store a reference to the old window procedure </font>

OldProc = GetWindowLong(TreeView1.hWnd,GWL_WNDPROC) 

<font color="#007F00">'Set our custom window procedure for the treeview </font>

SetWindowLong TreeView1.hWnd, GWL_WNDPROC, AddressOf WndProc 

<font color="#00007F">End</font> <font color="#00007F">Sub</font> 

<font color="#00007F">Public</font> <font color="#00007F">Sub</font> ShowPopup()
<font color="#007F00">'Carry out your popup menu code here</font>
<font color="#00007F">End</font> <font color="#00007F">Sub</font>

<font color="#00007F">Private</font> <font color="#00007F">Sub</font> Form_Unload(Cancel <font color="#00007F">As</font> <font color="#00007F">Integer</font>)

<font color="#007F00">' Restore the original window procedure</font>

SetWindowLong TreeView1.hWnd, GWL_WNDPROC, OldProc 

<font color="#00007F">End</font> Sub</pre><FONT SIZE="-1" FACE="verdana, arial, helvetica">

<p>Easy!</p>

<p>If you get stuck with this demo then download the <a href="/demos/context-demo/index.html">source code</a>, otherwise, contact me at <a href="mailto:sam@vbsquare.com">sam@vbsquare.com</a> and tell me what you thought of this article. Thanks!</p>

</font>

<table width="100%" border="0">
<tr><td width="50%"></td>
<td width="50%"></td>
</td></tr></table>

<br>
<center><table border=0><tr>
<td><a href="/php-bin/feedback.php?action=viewtopics&associd=75&assoctype=2">
<img src="/images/fbicon1.gif" width="27" height="31" border="0"></a></td>
<td><a href="/php-bin/feedback.php?action=viewtopics&associd=75&assoctype=2"><FONT SIZE="-1" FACE="verdana, arial, helvetica"><a href="/php-bin/feedback.php?action=viewtopics&associd=75&assoctype=2"><b>Question, Query, Criticism?<br>Post your feedback now!</a></b> 0 comments.</font></td>
</tr></table></center>

</td>
<td width="8"><img src="/images/clear.gif" width="8"></td>
<td vAlign="top" width="125">
<br>


<!-- Start Options -->
<TABLE border=0 cellPadding=2 cellSpacing=0 width=125 bgcolor="#FFCC00"><TBODY>
<TR>
<TD vAlign=middle width=16><img src="/images/email_button.gif" width="16" height="16" border="0"></TD>
<TD vAlign=middle><font size="-1" class=navbit><A href="/php-bin/sendtofriend.php?subject=Detect+the+keyboard%27s+right+click+button">Email this page</A></font></TD>
</TR><TR>
<TD vAlign=middle width=16><img src="/images/print_button.gif" width="16" height="16" border="0"></TD>
<TD vAlign=middle><font size="-1" class=navbit><A href="/php-bin/printfriendly.php?articlepageid=307">Printer Friendly</A></font></TD>
</TR>
<TR>
<TD vAlign=middle width=16><img src="/images/more_button.gif" width="16" height="16" border="0"></TD>
<TD vAlign=middle><font size="-1" class=navbit><A href="/php-bin/authorbio.php?authorid=31&associd=75&assoctype=2">More From Sam</A></font></TD>
</TR>
<TR>
<TD vAlign=middle width=16><img src="/images/feedback_button.gif" width="16" height="16" border="0"></TD>
<TD vAlign=middle><font size="-1" class=navbit><A href="/php-bin/feedback.php?action=viewtopics&associd=75&assoctype=2">Post Feedback</A></font></TD>
</TR>
</TBODY></TABLE>

<br>
<!-- End Options -->

<!-- Start Related -->
<TABLE border=0 cellPadding=0 cellSpacing=0 width=125>
<TBODY><TR><TD bgColor=#FFCC00 vAlign=top width=125>
<CENTER><FONT face=arial,helvetica size=2>
<B>Related</B>
</FONT></CENTER>
</TD></TR></tbody></table>
<TABLE border=0 cellPadding=2 cellSpacing=0 width=125><TBODY>
<TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/mouse/context/">Detect the keyboard's right click button</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/mouse/tip284.html">Ascii Keycodes</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/mouse/tip429.html">Detect mousepointer changes</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/mouse/tip342.html">Determine if a control has the focus by tab key or mouse click</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/mouse/tip401.html">Find the cursor position</A></font></TD>
</TR>
</TBODY></TABLE>
<br>
<!-- End Related -->
<!-- Start Newsletter -->
<TABLE bgColor=#FFCC00 border=0 cellPadding=2 cellSpacing=0 width=125>
<TBODY><tr><td vAlign=center width=100%>
<CENTER><FONT face=arial,helvetica size=2><B>Free Newsletter</b></font></center>
</td></tr><tr><td valign=center width=100%>
<table cellspacing="0" cellpadding="0" border=0>
<tr><td bgcolor="#FFCC00"><FORM action="http://inbound.postmastergeneral.com/cgi-bin/pmg_subscribe.pl" method=post><input type="TEXT" name="email_address" size="10" value="enter email">&nbsp;
</td><td valign="top" bgcolor="#FFCC00">
<input type="hidden" name="list" value="vbsquare">
<input type="SUBMIT" name="server_action:Subscribe" value="GO"></td>
</tr></form></table>
</td></TR></TBODY></TABLE><BR>
<!-- End Newsletter -->

<!-- Start Hot Picks -->
<TABLE border=0 cellPadding=0 cellSpacing=0 width=125>
<TBODY><TR><TD bgColor=#FFCC00 vAlign=top width=125>
<CENTER><FONT face=arial,helvetica size=2>
<B>Hot Picks</B>
</FONT></CENTER>
</TD></TR></tbody></table>
<TABLE border=0 cellPadding=2 cellSpacing=0 width=125><TBODY>
<TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/internet/inet1/">Using the inet control</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/articles/graph/">Make a  Chart control!</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/articles/diary/">Life of a VB programmer</A></font></TD>
</TR><TR>
<TD vAlign=top width=5><FONT size=-2><b>-</b><FONT SIZE="-1" FACE="verdana, arial, helvetica"></TD>
<TD vAlign=center><font size="-1" class=navbit><A href="/articles/wordobj1/">MS Object Models</A></font></TD>
</TR>
</TBODY></TABLE>
<br>
<!-- End Hot Picks -->

<img src="/images/clear.gif" width="125" height="1">
<!-- End Main Page Content -->
</td></tr></tbody></table>
</td></tr></tbody></table>

<!-- Start End Branding Table -->

<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY><tr>
<td width="110"><img src="/images/clear.gif" width="110" height="1" border="0"></td>
<td width="4"><img src="/images/clear.gif" width="4" height="1" border="0"></td>
<td width="100%">
<TABLE bgColor=#ffffff border=0 cellPadding=0 cellSpacing=0 width="100%">
<TBODY><TR><TD bgColor="#FFCC00" width="100%">
<b><font FACE="Verdana, Arial, Helvetica" SIZE="-1">&nbsp;VB Square Today</font></b>
</td></tr><tr><td width=100%>
<font FACE="Verdana, Arial, Helvetica" SIZE="-1">
<a href="/activex/begobjects/">Beginning Objects in VB</a> - Learn all you ever wanted to know about objects in our weekly series.<br>
<a href="/internet/xml/index.html">Learn XML</a> - Catch up on this new technology as Sam Huggill reveals all.<br>
<a href="/internet/aspvb/">Using ASP with VB components</a> - Leverage your VB skills and use ASP to provide your data to a wider audience<br>
<a href="/articles/mcsd/">Is MCSD Worth It?</a> - Mack Male finds out just how much MCSD does for you as a programmer.<br>

</font>
</td></tr></tbody></table>
</td></tr></tbody></table>

<!-- End End Branding Table -->

<table border="0" cellPadding="0" cellSpacing="0" width="100%">
<TBODY><tr>
<td width="110" align="center"><img src="/images/clear.gif" width="110" height="1" border="0"><br><a href="#top"><img src="/images/gototop.gif" alt="Top" WIDTH="23" HEIGHT="21" BORDER="0"></a></td>
<td width="4"><img src="/images/clear.gif" width="4" height="1" border="0"></td>
<td width="100%">
<hr>
<p align="center"><font face="Verdana, Arial, Helvetica" size="-2">
Copyright &copy;1997-2001 Lighthouse Internet Solutions. All rights reserved. <a href="/privacy.html">Privacy Policy</a>.
</font></p>
</td></tr>
</tbody></table>
</body></html>
