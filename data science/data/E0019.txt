ID=E0019
URL=http://home.att.net/~robertdunn/FAQs/Faqs.html
SIZE=104301
DATE=12/07/02
TIME=19:16:28
DATASET=C
HTML=<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
 
<HTML>
 
<HEAD>
<META HTTP-EQUIV="CONTENT-TYPE"
 CONTENT="text/html; charset=iso-8859-1"> 
<TITLE>Yet Another Code Site - FAQs </TITLE>
<META NAME="CHANGEDBY" CONTENT="Robert Dunn"> 
</HEAD>

<BODY STYLE="vertical-align: top">
<TABLE WIDTH="100%" BORDER="0" CELLPADDING="0"
 CELLSPACING="0"> 
<TR>
  <TD WIDTH="100%" VALIGN="TOP" BGCOLOR="#000080">
	 <H1 ALIGN="CENTER"><A NAME="TopOfPage"></A><FONT
	 COLOR="#ffffff"> Yet Another Code Site</FONT> </H1>
  </TD>
</TR>
</TABLE> 
<H2 ALIGN="CENTER">Frequently Asked Questions </H2>
<BR>
<TABLE WIDTH="100%" BORDER="1" CELLPADDING="4"
 CELLSPACING="0"> 
<TR>
  <TD WIDTH="100%" VALIGN="TOP" BGCOLOR="#e6e6ff">
	 <P ALIGN="LEFT">This page answers questions frequently
		asked about Rich Edit controls, the Borland TRichEdit VCL
		component, and the VCL in general.&nbsp; I humbly suggest
		that you spend some time here before posting queries to
		newsgroups or sending me questions.&nbsp; Of course, if you
		have questions not answered here or elsewhere on this site,
		please feel free to send the questions to me.&nbsp; And if
		you find a solution for a problem that might be of interest
		to others, please share this information with me so that I
		may add it to this site. 
	 </P> 
  </TD>
</TR>
</TABLE> <BR>
<TABLE WIDTH="100%" BORDER="1"> 
<TR>
  <TD>
	 <FONT SIZE="+1"><B>&nbsp;The Questions:</B></FONT> 
  </TD>
</TR>
</TABLE> <BR>
<TABLE WIDTH="100%" BORDER="0" CELLPADDING="4"
 CELLSPACING="0"> 
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic73"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I downloaded a code sample from this site but it
		does not compile.</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk001" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic74"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>When I use TRichEditOle(RichEdit1) in my form's
		constructor, it does not work properly.</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk002" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic75"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>TRichEditOle works until I for a while and then
		the OLE features stop working.&nbsp; What gives?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk003" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic76"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I created a Rich Text Format (RTF) document in
		WordPad and inserted a bitmap in the document.&nbsp; When I
		load the document into a TRichEdit control, the bitmap is
		not displayed. &nbsp;When I print the document, the bitmap
		is not printed.&nbsp; How do I display and print bitmaps
		with a TRichEdit control?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk004" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic77"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do I determine the current position (line and
		character offset or column) of the cursor in a TRichEdit
		control?&nbsp; How do I move the cursor to a specific line
		or column?</B>&nbsp; (11-01-1998) &nbsp;<A HREF="#Bmk005"
		TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic78"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do I control the margins when printing the
		contents of a TRichEdit control?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk006" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic79"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I want to print the contents of two TRichEdit
		controls on the same page.&nbsp; However, when the first
		page finishes, the page is ejected and the second one
		begins on the second page.&nbsp; How do I print them on the
		same page?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk007" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic80"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I want to create a print preview window for my
		TRichEdit control.&nbsp; Where do I start?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk008" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic81"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I want my Print Dialog to display &quot;Print
		Range, From Page 1 To [last page].&quot;&nbsp; How do I
		determine how many pages a TRichEdit will print so that I
		can display the page range in the Print Dialog?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk009" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic82"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I want to display a bitmap behind my TRichEdit
		control.&nbsp; Is this possible?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk010" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic83"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I created a TRichEdit control, set the PlainText
		property to true, and set the font to a fixed-pitch font
		(e.g., Courier New).&nbsp; How do I set the tab stops so
		that the columns line up properly?</B>&nbsp;
		(07-24-1999)&nbsp; <A HREF="#Bmk011" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic84"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>Many Windows programs let you undo/redo many
		changes.&nbsp; Can I add multi-level undo/redo to
		TRichEdit?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk012" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic85"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I know that I can turn on word wrap by setting
		the TRichEdit WordWrap property.&nbsp; This causes lines to
		wrap at the window boundaries.&nbsp; However, I would like
		to have lines wrap exactly as they would print while I edit
		text in the control.</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk013" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic86"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do determine the current insert/overwrite
		mode for a TRichEdit?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk014" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic87"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>When I load a large document (greater than 64k),
		the document loads fine and I can scroll to the
		bottom.&nbsp; Oddly, I cannot add text to the
		control.&nbsp; If I delete some text, I can add that number
		of characters back, but I cannot add more text than I
		delete.&nbsp; How do I load and edit large files with
		TRichEdit?</B>&nbsp; (11-01-1998, updated 12-21-2000)&nbsp;
		<A HREF="#Bmk015" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic88"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>The TRichEdit vertical scrollbar disappears
		sometimes.&nbsp; Is there a fix or work-around?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk016" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic89"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do I determine if a document file is plain
		text, Rich Text Format (RTF), or something else before I
		load the document?</B>&nbsp; (11/01/98)&nbsp;
		<A HREF="#Bmk017" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic90"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>You mention that the Rich Edit 2.0 control
		supports multi-level undo/redo.&nbsp; What else does it
		do?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk018" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic91"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I am interested in the Rich Edit 2.0
		control.&nbsp; Where do I get it?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk019" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic92"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I wrote a custom component that needs to trap the
		parent form's messages.&nbsp; How do I subclass the form's
		WinProc to call my class's member function?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk020" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic93"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I wrote a component that saves the
		Printer()-&gt;Handle when it is created.&nbsp; At some
		point in the program, the saved value seems to no longer be
		valid.&nbsp; What causes this?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk021" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic94"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I am using TRichEdit::Print(AnsiString Caption)
		to print the contents of a Rich Edit control.&nbsp; Why
		does the caption not print at the top of any of the
		pages?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk022" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic95"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I downloaded the TRichEdit20 sample code.&nbsp;
		Why does it raise an &quot;out of resources&quot; exception
		when I add or insert a line of text
		programmatically?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk023" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic96"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>The Lines property of TRichEdit returns only the
		plain ASCII text from the control.&nbsp; I want to get the
		raw RTF-encoded text from a Rich Edit control.&nbsp; How do
		I do that?&nbsp; Can I insert RTF coded text into a Rich
		Edit control?&nbsp; Can I copy text from one Rich Edit
		control into another without using the Clipboard?</B>&nbsp;
		(11-01-1998)&nbsp; <A HREF="#Bmk024" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic97"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I combined the printing code from the </B><A HREF="../Yacs.html#Papers"
		TARGET="_top">Printing and Previewing Rich Edit
		Controls</A><B> paper with the TRichEdit20 class.&nbsp;
		When I try to print, the program hangs in the rendering
		loop.&nbsp; Any ideas?</B>&nbsp; (11-01-1998)&nbsp;
		<A HREF="#Bmk025" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic98"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I downloaded the TRichEditRawRtf class code from
		the site and it sounds like what I need.&nbsp;
		Unfortunately, whenever I attempt to insert RTF-encoded
		text, I get an exception with a &quot;code 16.&quot;&nbsp;
		Why?</B>&nbsp; (02-18-1998, updated 12-23-2000)&nbsp;
		<A HREF="#Bmk026" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic99"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>The TRichEdit20 class looks like it should be
		simple to convert to a component.&nbsp; Why do you
		distribute it as a class instead of a component?</B>&nbsp;
		(04-03-1999)&nbsp; <A HREF="#Bmk027" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic100"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>When I distribute my program, I have to
		distribute other Borland runtime library DLLs with my
		program.&nbsp; How do I include everything in my program so
		that I do not have to distribute any other files?</B>&nbsp;
		(07-24-1999)&nbsp; <A HREF="#Bmk028" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic101"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>Many programs have buttons on the Help About
		dialog that will let the user send the developer e-mail or
		link directly to the developer's site.&nbsp; How do I do
		that?</B>&nbsp; (07-24-1999)&nbsp;
		<A HREF="#Bmk029" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic102"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>When I disable a Rich Edit 2.0 control, the
		background is redrawn in gray.&nbsp; TRichEdit leaves the
		background white when disabled, which is what I want.&nbsp;
		Why is this?&nbsp; Can I change this to get the white
		background instead?</B>&nbsp; (07-30-1999)&nbsp;
		<A HREF="#Bmk030" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic103"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I wrote a TConversion class for my application's
		documents and used TRichEdit::RegisterConversionFormat to
		associate the file extension with the converter.&nbsp; If I
		open one of my application's documents, the data is
		converted as expected.&nbsp; If I then open a *.txt file
		without restarting the program, TRichEdit tries to convert
		the plain text as if it were one of my application's
		documents.&nbsp; Similarly, if I first open a *.txt file
		and then open one of my application's documents, the data
		is not converted.&nbsp; What is going on?</B>&nbsp;
		(07-31-1999)&nbsp; <A HREF="#Bmk031" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic104"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I need details on the Rich Text Format (RTF)
		encoding format.&nbsp; Where can I get more information on
		the RTF specification?</B>&nbsp; (10-19-1999)&nbsp;
		<A HREF="#Bmk032" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic105"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I am taking a C/C++ class and my homework
		assignment requires that I print the result of several
		computations.&nbsp; The instructor has given me code to
		print the results but it does not work.</B>&nbsp;
		(11-01-1999)&nbsp; <A HREF="#Bmk033" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic106"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I want to print an RTF document file, but I do
		not need to display it in a Rich Edit control.&nbsp; Can I
		simply print the document without using all of the Rich
		Edit printing code on your site?</B>&nbsp;
		(01-13-2000)&nbsp; <A HREF="#Bmk034" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic107"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>You used the phrase &quot;RTF
		round-tripping.&quot; What the &amp;*$% is that?</B>&nbsp;
		(01-25-2000)&nbsp; <A HREF="#Bmk035" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic108"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>When a user pastes text from the Clipboard into
		my TRichEdit control, I want the text to be
		unformatted.&nbsp; I set the PlainText property to true
		but, when the user pastes text, formatted text is
		inserted.&nbsp; How do I ensure that pasted text is
		unformatted?</B>&nbsp; (07-14-2000)&nbsp;
		<A HREF="#Bmk036" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic1"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>Is there a simple way to use regular expressions
		with TRichEdit controls?&nbsp; Most regular expression
		libraries use a unique syntax &#150; what is the particular
		syntax used by the VCL library?</B>&nbsp;
		(08-27-2000)&nbsp; <A HREF="#Bmk037" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic3"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>My program works flawlessly on my development
		machine.&nbsp; However, some users have problems printing
		with certain printers which I do not have available for
		testing.&nbsp; Is there a way to recreate the problems on
		my development machine?</B>&nbsp; (09-09-2000)&nbsp;
		<A HREF="#Bmk038" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic5"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>The TRichEdit component takes much longer than
		WordPad to open large files.&nbsp; Can I improve the load
		times?</B>&nbsp; (09-22-2000)&nbsp;
		<A HREF="#Bmk039" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic7"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do I save and restore the current scroll
		position in a TRichEdit component?</B>&nbsp; (10-19-2000,
		updated 01-14-2001)&nbsp; <A HREF="#Bmk040"
		TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic9"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>Where can I find a code sample to do
		&lt;<I>something</I>&gt;?</B>&nbsp; (12-22-2000)&nbsp;
		<A HREF="#Bmk041" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic11"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do I trap double-clicks on a
		TRichEdit?</B>&nbsp; (12-23-2000)&nbsp;
		<A HREF="#Bmk042" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic13"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>How do I get the TRichEdit to scroll to the
		bottom of the text when new lines are added?</B>&nbsp;
		(12-25-2000)&nbsp; <A HREF="#Bmk043" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic15"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>I am using Rich Edit 2.0/3.0 and set the
		paragraph line spacing to single, 1.5, or double using
		PARAFORMAT2.bLineSpacingRule.&nbsp; After setting the
		spacing to 1.5 or double, I cannot set the paragraph line
		spacing back to single-spacing.&nbsp; What gives?</B>&nbsp;
		(01-27-2001)&nbsp; <A HREF="#Bmk044" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic17"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>In my program, the TRichEdit flashes excessively
		when I do certain things.&nbsp; That is, it appears to be
		redrawn frequently.&nbsp; How do I eliminate flicker in
		TRichEdit components?</B>&nbsp; (02-20-2001)&nbsp;
		<A HREF="#Bmk045" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic19"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>The TRichEdit component works properly on Windows
		95/98/NT but behaves oddly on Windows 2000.&nbsp; What is
		causing this?</B>&nbsp; (02-24-2001)&nbsp;
		<A HREF="#Bmk046" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic21"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>My program loads riched20.dll (i.e., it uses
		RichEdit 2.0/3.0).&nbsp; Is it possible to determine at
		runtime which version (2.0 or 3.0) is actually
		loaded?</B>&nbsp; (03-03-2001)&nbsp;
		<A HREF="#Bmk047" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic23"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>In addition to left, center, and right paragraph
		justification, the RichEdit 2.0 PARAFORMAT2 structure
		includes a &quot;full justification&quot; value
		(PFA_JUSTIFY).&nbsp; It does not seem to work.&nbsp; Any
		ideas?</B>&nbsp; (03-04-2001)&nbsp;
		<A HREF="#Bmk048" TARGET="_top">Read the FAQ</A>. 
	 </P> 
  </TD>
</TR>
<TR VALIGN="TOP">
  <TD WIDTH="3%">
	 <P><IMG SRC="../Images/bludiamd.gif" NAME="Graphic24"
		ALIGN="TOP" WIDTH="14" HEIGHT="14" BORDER="0"> 
	 </P> 
  </TD>
  <TD WIDTH="97%">
	 <P><B>Microsoft Word's spell-checker underlines
		misspelled words with a red wavy underline.&nbsp; Can
		RichEdit controls do this? </B>&nbsp; (09-07-2001, updated
		09-10-2001)&nbsp; <A HREF="#Bmk049" TARGET="_top">Read the
		FAQ</A>. 
	 </P> 
  </TD>
</TR>
</TABLE> <BR>
<TABLE WIDTH="100%" BORDER="1"> 
<TR>
  <TD>
	 <FONT SIZE="+1"><B>&nbsp;The Answers:</B></FONT> 
  </TD>
</TR>
</TABLE> 
<P><A NAME="Bmk001"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic26" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0"> I downloaded a code
  sample from this site but it does not compile.</B> 
</P> 
<P>There are a couple of possibilities:&nbsp; (1) You are
  using BCB 1.0 or (2) the code has bugs. 
</P> 
<P>(1) If you are using BCB 1.0. 
</P> 
<P>Most of the code on this site should work with BCB 1.0
  with minor changes.&nbsp; There are two primary categories
  of changes that you should expect to make. 
</P> 
<P>First, BCB 3.0 introduced a new macro (or maybe it is a
  keyword) &#150; &quot;PACKAGE.&quot;&nbsp; The code may
  work if you simply remove &quot;PACKAGE&quot; wherever you
  find it. 
</P> 
<P>[ By the way, if you have BCB 1.0 and find yourself
  searching the include files and source directories
  regularly, consider using the DOSKEY utility that comes
  with Windows 95.&nbsp; DOSKEY lets you scroll back and
  forth through the most recent commands, edit them, and
  re-execute them.&nbsp; It is very handy if you spend much
  time with the DOS command line. 
</P> 
<P>Second, BCB 3.0 added new headers and may have
  reorganized the contents of some of the old headers.&nbsp;
  If you get an error message that says that a header could
  not be found, try commenting the #include statement
  out.&nbsp; It may not even be needed.&nbsp; If this
  generates errors elsewhere in the code, try searching all
  of the include files in the &#133;\include and
  &#133;\include\vcl directories for the function being
  called.&nbsp; The GREP utility included with BCB can be
  used to do this and has a switch for searching
  subdirectories. 
</P> 
<P>One more tip:&nbsp; Both BCB 1.0 &amp; 3.0 come with a
  VCL class browser.&nbsp; It is included in the examples
  and, once compiled, can be added to the IDE Tools
  menu.&nbsp; This tool makes studying the VCL and navigating
  through the class hierarchy code much easier. ] 
</P> 
<P>(2) You believe that the code has bugs. 
</P> 
<P>Most of the code samples and FAQ examples are taken from
  a large working project.&nbsp; I may have inadvertently
  left calls to functions in my project that are not included
  in the code on this site.&nbsp; There are also a few
  examples that I cobbled up from bits and pieces of
  otherwise unrelated code.&nbsp; I may simply have screwed
  them up.&nbsp; If you believe that the code is incomplete
  or simply wrong, please send me
  <A HREF="mailto:robertdunn@worldnet.att.net">e-mail</A> so
  that I can fix it. 
</P> <HR>
<P><A NAME="Bmk002"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic27" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;When I use
  TRichEditOle(RichEdit1) in my form's constructor, it does
  not work properly.</B> 
</P> 
<P>This is probably because the Windows handle for
  RichEdit1 was not valid.&nbsp; See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Window handles
  vs. TRichEdit (and other VCL) controls</A> available on
  this site. 
</P> <HR>
<P><A NAME="Bmk003"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic28" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0"> TRichEditOle works until
  I for a while and then the OLE features stop working.&nbsp;
  What gives?</B> 
</P> 
<P>The VCL is free to destroy and create controls whenever
  it needs to.&nbsp; Certain events, like changing the
  Scrollbars property for a TRichEdit control, cause this to
  happen.&nbsp; When this does happen, the connection between
  the TRichEdit control and TRichEditOleCallback class is
  lost &#150; the &quot;new&quot; Rich Edit no longer calls
  the TRichEditOleCallback functions that provide the OLE
  support.&nbsp; See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Window handles
  vs. TRichEdit (and other VCL) controls</A> available on
  this site for more information. 
</P> <HR>
<P><A NAME="Bmk004"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic29" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I created a Rich
  Text Format (RTF) document in WordPad and inserted a bitmap
  in the document.&nbsp; When I load the document into a
  TRichEdit control, the bitmap is not displayed.&nbsp; When
  I print the document, the bitmap is not printed.&nbsp; How
  do I display and print bitmaps with a TRichEdit
  control?</B> 
</P> 
<P>The Windows Rich Edit control relies on OLE to provide
  support for displaying and printing bitmaps.&nbsp; Adding
  OLE support solves this.&nbsp; See the code sample titled
  <A HREF="../Yacs.html#CodeSamples" TARGET="_top">Adding OLE
  functionality to TRichEdit</A> for one solution to this
  problem. 
</P> <HR>
<P><A NAME="Bmk005"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic30" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;How do I determine
  the current position (line and character offset or column)
  of the cursor in a TRichEdit control?&nbsp; How do I move
  the cursor to a specific line or column?</B> 
</P> 
<P><A HREF="../CodeSamples/CodeSnips.html#Bmk009"
  TARGET="_top">See the Code Snippet</A>. 
</P> <HR>
<P><A NAME="Bmk006"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic31" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;How do I control
  the margins when printing the contents of a TRichEdit
  control?</B> 
</P> 
<P>See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Printing and
  Previewing Rich Edit Controls</A> available on this site. 
</P> <HR>
<P><A NAME="Bmk007"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic32" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I want to print the
  contents of two TRichEdit controls on the same page.&nbsp;
  However, when the first page finishes, the page is ejected
  and the second one begins on the second page.&nbsp; How do
  I print them on the same page?</B> 
</P> 
<P>See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Printing and
  Previewing Rich Edit Controls</A> available on this site. 
</P> <HR>
<P><A NAME="Bmk008"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic33" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I want to create a
  print preview window for my TRichEdit control.&nbsp; Where
  do I start?</B> 
</P> 
<P>See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Printing and
  Previewing Rich Edit Controls</A> available on this site. 
</P> <HR>
<P><A NAME="Bmk009"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic34" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I want my Print
  Dialog to display &quot;Print Range, From Page 1 To [last
  page].&quot;&nbsp; How do I determine how many pages a
  TRichEdit will print so that I can display the page range
  in the Print Dialog?</B> 
</P> 
<P>See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Printing and
  Previewing Rich Edit Controls</A> available on this site. 
</P> <HR>
<P><A NAME="Bmk010"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic36" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I want to display a
  bitmap behind my TRichEdit control.&nbsp; Is this
  possible?</B> 
</P> 
<P>Thanks to Kimberly Paternoster for sending the solution
  for this one. 
</P> 
<P>I do not know of a way to do this with Rich Edit 1.0
  controls.&nbsp; Kimberly says that it cannot be done:&nbsp;
  &quot;As it ends up, RE 1.0 doesn't support transparent
  background.&nbsp; It paints the background in the WM_PAINT
  message instead of the WM_ERASEBKGND.&quot; 
</P> 
<P>Kimberly went on to point out that Rich Edit 2.0
  controls can be created with the WS_EX_TRANSPARENT style to
  allow a background bitmap to show through.&nbsp; The
  WS_EX_TRANSPARENT flag tells Windows to paint all sibling
  controls obscured by the Rich Edit 2.0 before painting the
  Rich Edit control. 
</P> 
<P>This turns out to be remarkably easy to add to the
  TRichEdit20 class available on this site.&nbsp; Simply add 
</P> <PRE STYLE="margin-left: 0.5in">Params.ExStyle |= WS_EX_TRANSPARENT;</PRE>

<P> to the TRichEdit20::CreateParams() method.&nbsp; Then
  drop a TImage on the form where the TRichEdit20 object will
  be displayed.&nbsp; Load a bitmap into the TImage and set
  the Alignment and AutoSize properties as desired. That is
  all that there is to it....&nbsp; Well, under certain
  conditions, I found that I also had to set the
  TRichEdit-&gt;Brush-&gt;Style to bsClear. 
</P> 
<P>I was also successful changing the WS_EX_TRANSPARENT
  flag after the Rich Edit 2.0 control was visible using: 
</P> <PRE STYLE="margin-left: 0.5in">LONG exStyle = ::GetWindowLong(RE-&gt;Handle, GWL_EXSTYLE);
exStyle |= WS_EX_TRANSPARENT;
::SetWindowLong(RE-&gt;Handle, GWL_EXSTYLE, exStyle);
RE-&gt;Brush-&gt;Style = bsClear; // just to make sure</PRE>

<P> Finally, I can confirm Kimberly's observation.&nbsp;
  This does not seem to work for Rich Edit 1.0 (TRichEdit)
  controls. 
</P> <HR>
<P><A NAME="Bmk011"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic35" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I created a
  TRichEdit control, set the PlainText property to true, and
  set the font to a fixed-pitch font (e.g., Courier
  New).&nbsp; How do I set the tab stops so that the columns
  line up properly?</B> 
</P> 
<P>This one took a remarkable length of time to
  solve.&nbsp; There are a few prefacing comments. 
</P> 
<P>First, this is only an issue if you are trying to
  display a formatted output with a fixed pitch font.&nbsp;
  This is common for source code editors and hexadecimal
  dumps where each character of output must line up with the
  character above it.&nbsp; If you are using a proportional
  font, then absolute offsets from the left margin are fine
  and you do not need this FAQ. 
</P> 
<P>Second, the native Rich Edit control allows you to set
  up to 32 tabstops (MAX_TAB_STOPS as defined in richedit.h)
  &#150; beyond that, you're screwed. 
</P> 
<P>Third, tabstops are set in TWIPs relative to the left
  margin in the native Rich Edit control.&nbsp; The problem
  is converting character positions (as offsets) into
  absolute offsets in TWIPs.&nbsp; The offsets are, of
  course, dependent upon the font being used. 
</P> 
<P>All that said, the following code works for me. 
</P> <PRE STYLE="margin-left: 0.5in">//---------------------------------------------------------------------------
typedef int TTabStops[MAX_TAB_STOPS];

class TMyRichEdit : public TRichEdit
{
protected:
        TTabStops FTabStops;
        int FTabStopsCount;

public:
        __fastcall TMyRichEdit(TComponent* Owner) :
                TRichEdit(Owner), FtabStopsCount(0) {};
        void TMyRichEdit::SetTabStops(int tabCount, TTabStops&amp; tabStops);
        void TMyRichEdit::SetTabStops(int tabSize);
        void TMyRichEdit::SetTabStops(int tabChars, TFont&amp; font, bool entireDocument);
};
//---------------------------------------------------------------------------
void TMyRichEdit::SetTabStops(int tabCount, TTabStops&amp; tabStops)
{
        PARAFORMAT pfmt;
        ::memset(&amp;pfmt, 0, sizeof(pfmt));
        pfmt.cbSize = sizeof(pfmt);
        pfmt.dwMask = PFM_TABSTOPS;
        for (int i = 0; i &lt; MAX_TAB_STOPS; i++) {
                pfmt.rgxTabs[i] = tabStops[i];
                FTabStops[i] = tabStops[i];
                }
        pfmt.cTabCount = (SHORT) tabCount;
        FTabStopsCount = tabCount;
        if (::IsWindow(WindowHandle))
                ::SendMessage(Handle, EM_SETPARAFORMAT, 0, (LPARAM) &amp;pfmt);
}
//---------------------------------------------------------------------------
void TMyRichEdit::SetTabStops(int tabSize)
{
        TTabStops tabs;
        for (int i = 0; i &lt; MAX_TAB_STOPS; i++) tabs[i] = (i + 1) * tabSize;
        SetTabStops(MAX_TAB_STOPS, tabs);
}
//---------------------------------------------------------------------------
void TMyRichEdit::SetTabStops(int tabChars, TFont&amp; font, bool entireDocument)
{
        HDC hdc = ::GetDC(Handle);
        ::SaveDC(hdc);
        ::SetMapMode(hdc, MM_TEXT);
        TFont* afont = new TFont();
        afont-&gt;Assign(&amp;font);
        ::SelectObject(hdc, afont-&gt;Handle);
        AnsiString s = AnsiString::StringOfChar('X', tabChars);
        SIZE sz;
        int cx = ::GetDeviceCaps(hdc, LOGPIXELSX);
        int success = ::GetTextExtentPoint32(hdc, s.c_str(), tabChars, &amp;sz);
        int tabSizeTwips = sz.cx;
        ::RestoreDC(hdc, -1);
        ::ReleaseDC(Handle, hdc);
        delete afont;
        tabSizeTwips = ::MulDiv(tabSizeTwips, 1440, cx);
        // hide and save selection
        CHARRANGE chrg, chrgAll;
        ::SendMessage(Handle, EM_EXGETSEL, 0, (LPARAM) &amp;chrg);
        // if entireDocument, set selection to all
        if (entireDocument) {
                chrgAll.cpMin = 0;
                chrgAll.cpMax = -1;
                ::SendMessage(Handle, EM_EXSETSEL, 0, (LPARAM) &amp;chrgAll);
                }
        // set tab size
        if (success) SetTabStops(abs(tabSizeTwips));    // no error on failure...
        // restore selection
        ::SendMessage(Handle, EM_EXSETSEL, 0, (LPARAM) &amp;chrg);
}
//---------------------------------------------------------------------------</PRE>

<P> Thanks to Jonathan Grenier and others for pointing out
  that I left out some important code.&nbsp; Hopefully, the
  code is now less mysterious. 
</P> <HR>
<P><A NAME="Bmk012"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic37" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;Many Windows
  programs let you undo/redo many changes.&nbsp; Can I add
  multi-level undo/redo to TRichEdit?</B> 
</P> 
<P>There are two solutions:&nbsp; (1) Write the code to
  track changes and implement the undo/redo actions yourself
  and (2) use Rich Edit 2.0 which does the work for
  you.&nbsp; See the code sample titled
  <A HREF="../Yacs.html#CodeSamples" TARGET="_top">Adding
  Rich Edit 2.0 functionality to TRichEdit</A> available on
  this site for solution #2. 
</P> <HR>
<P><A NAME="Bmk013"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic38" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I know that I can
  turn on word wrap by setting the TRichEdit WordWrap
  property.&nbsp; This causes lines to wrap at the window
  boundaries.&nbsp; However, I would like to have lines wrap
  exactly as they would print while I edit text in the
  control.</B> 
</P> 
<P>Try this: 
</P> <PRE STYLE="margin-left: 0.5in">::SendMessage(Handle, EM_SETTARGETDEVICE, (WPARAM) Printer()-&gt;Handle,(LPARAM) width);</PRE>

<P> The width parameter above is the rendering rectangle
  width in twips. 
</P> <HR>
<P><A NAME="Bmk014"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic39" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;How do determine
  the current insert/overwrite mode for a TRichEdit?</B> 
</P> 
<P>The native Rich Edit control will not tell you whether
  the next character keyed will be inserted or
  overwritten.&nbsp; You will have to trap keystrokes and
  track the insert/overwrite mode yourself.&nbsp; One way to
  do this is to write your own class, presumably derived from
  TRichEdit, to track the control's current insert/overwrite
  state.&nbsp; Note that Rich Edit controls are in insert
  mode when created. 
</P> 
<P>Here is what I use: 
</P> <PRE STYLE="margin-left: 0.5in">class TMyRichEdit : public TRichEdit
{
protected:
        bool FInsertMode;
        TNotifyEvent FOnInsertChange;
        void __fastcall SetInsertMode(bool insertMode);
        void ToggleInsertMode(void);
public:
        TMyRichEdit(&#133;)&#133; set state variable
        DYNAMIC void __fastcall KeyDown(Word &amp;Key, Classes::TShiftState Shift);
        __property bool InsertMode = { read = FInsertMode, write = SetInsertMode, nodefault };
__published:
        __property TNotifyEvent OnInsertChange = { read = FOnInsertChange, write = FOnInsertChange, default = 0 };
};
//---------------------------------------------------------------------------
void __fastcall TMyRichEdit::KeyDown(Word &amp;Key, Classes::TShiftState Shift)
{
        TRichEdit::KeyDown(Key, Shift);

        TShiftState noShiftKeys;
        if (Key == VK_INSERT &amp;&amp; Shift == noShiftKeys) {
                FInsertMode = !FInsertMode;
                if (FOnInsertChange) FOnInsertChange(this);
                }
}
//---------------------------------------------------------------------------
// note: SetInsertMode() does not trigger an OnInsertChange event
//
void __fastcall TMyRichEdit::SetInsertMode(bool insertMode)
{
        if (insertMode == FInsertMode) return;
        ToggleInsertMode();
}
//---------------------------------------------------------------------------
// note: ToggleInsertMode() does not trigger an OnInsertChange event --
// the FInsertMode member shadow variable gets flipped in the KeyDown()
// handler
//
void TMyRichEdit::ToggleInsertMode(void)
{
        // synthesize an insert keystroke (cannot use keybd_event() because
        // there is no window associated with the API function)
        if (!Handle) return;
        // save and clear the event handler
        TNotifyEvent event = FOnInsertChange;
        FOnInsertChange = 0;
        // the following scarfed from a Micro$oft VB(?) example
        ::SendMessage(Handle, WM_KEYDOWN, VK_INSERT, 0x00510001);
        ::SendMessage(Handle, WM_KEYUP, VK_INSERT, 0xC0510001);
        // restore the event handler
        FOnInsertChange = event;
}
//---------------------------------------------------------------------------</PRE>

<HR>
<P><A NAME="Bmk015"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic40" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;When I load a large
  document (greater than 64k), the document loads fine and I
  can scroll to the bottom.&nbsp; Oddly, I cannot add text to
  the control.&nbsp; If I delete some text, I can add that
  number of characters back, but I cannot add more text than
  I delete.&nbsp; How do I load and edit large files with
  TRichEdit?</B> 
</P> 
<P>This is a rather gray area.&nbsp; I have been able to
  duplicate some reported problems.&nbsp; However, my
  solutions do not seem to universally resolve the problem. 
</P> 
<P>First, if you are using BCB 1.0, there is a known
  problem with the MaxLength property.&nbsp; Check out the
  paper titled <A HREF="../Yacs.html#Papers"
  TARGET="_top">BCB 1.0 &amp; 3.0 TRichEdit bugs</A>
  available from this site. 
</P> 
<P>Next, try 
</P> <PRE STYLE="margin-left: 0.5in">::SendMessage(RichEdit1-&gt;Handle, EM_EXLIMITTEXT, 0, 0x7fffffff);</PRE>

<P> after RichEdit1-&gt;Handle is valid.&nbsp; (See the
  paper titled <A HREF="../Yacs.html#Papers"
  TARGET="_top">Window handles vs. TRichEdit (and other VCL)
  controls</A> available on this site for an explanation of
  when RichEdit1-&gt;Handle is valid.)&nbsp; Do this before
  adding or loading any text into the control. 
</P> 
<P>Note #1:&nbsp; I have determined empirically that
  setting the EM_EXLIMITTEXT to a value with the high bit set
  can cause problems in some cases.&nbsp; Hence, the
  0x7fffffff value above rather than 0xfffffff. 
</P> 
<P>Note #2:&nbsp; Adrian Carter reports that 0x7ffffffd was
  the largest value that worked correctly on his version of
  RichEdit 1.0 (riched32.dll, 173,536 bytes, 1996/08/24,
  version 4.00.834.839). 
</P> <HR>
<P><A NAME="Bmk016"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic41" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;The TRichEdit
  vertical scrollbar disappears sometimes.&nbsp; Is there a
  fix or work-around?</B> 
</P> 
<P>This appears to be a bug in the Rich Edit control or in
  the TRichEdit class.&nbsp; I have found some magical code
  in TRichEdit (meaning that I have not bothered to
  completely debug it) that may be responsible.&nbsp; Anyway,
  here is a workaround (along with my comments to myself): 
</P> <PRE STYLE="margin-left: 0.5in">// apparently there is a bug which we must work around...  if you drop a large
// file (&gt; 32k?) on a TRichEdit, the vertical scroll bar is not enabled until the 
// control is manually scrolled down a page.  this would not be such a big 
// deal if we trapped the LoadFromFile() used, typically, to load the TRichEdit 
// control.  unfortunately, that would require deriving from TRichEditStrings 
// and working a lot harder than I'm willing to work at the moment, so we'll try
// to fix it here.  the sad result is that the programmer must call this function 
// after loads to make sure the vertical scroll bar is visible.  man! working 
// around Microsoft bugs is a lot easier in OWL, but it (OWL) looks like a 
// dead horse.  anyway, it is an ugly work-around -- it has an ugly name...
//
void TMyRichEdit::WorkAroundVerticalScrollBarBug(void)
{
        // scroll down a page, then back
        ::SendMessage(Handle, EM_SCROLL, (WPARAM) (INT) SB_PAGEDOWN, 0);
        ::SendMessage(Handle, EM_SCROLL, (WPARAM) (INT) SB_PAGEUP, 0);
}</PRE>

<HR>
<P><A NAME="Bmk017"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic42" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;How do I determine
  if a document file is plain text, Rich Text Format (RTF),
  or something else before I load the document?</B> 
</P> 
<P>There are no guarantees, but here is what I use:&nbsp;
  <A HREF="../CodeSamples/CodeSnips.html#Bmk010"
	TARGET="_top">See the Code Snippet</A>. 
</P> <HR>
<P><A NAME="Bmk018"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic43" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;You mention that
  the Rich Edit 2.0 control supports multi-level
  undo/redo.&nbsp; What else does it do?</B> 
</P> 
<P>Well, I am assuming that it fixes at least some of the
  bugs in Rich Edit 1.0.&nbsp; Additional
  functionality:&nbsp; Automatic recognition of URLs and the
  ability to send a message to your program when a URL is
  invoked (clicked); and support for new Rich Text Format
  (RTF) codes (RTF 1.5?).&nbsp; Check out the
  <A HREF="http://msdn.microsoft.com/developer/"
	TARGET="_top">Microsoft Developer Network</A> for more
  information.&nbsp; For a demonstration of how to use some
  of these features, see the TRichEdit20 class in the
  <A HREF="../Yacs.html#CodeSamples" TARGET="_top">Code
  Samples section</A> of this site. 
</P> <HR>
<P><A NAME="Bmk019"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic44" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I am interested in
  the Rich Edit 2.0 control.&nbsp; Where do I get it?</B> 
</P> 
<P>See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Using Rich Edit
  2.0 With BCB</A> available on this site. 
</P> <HR>
<P><A NAME="Bmk020"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic45" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I wrote a custom
  component that needs to trap the parent form's
  messages.&nbsp; How do I subclass the form's WinProc to
  call my class's member function?</B> 
</P> 
<P>See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Creating a
  Windows Callback to a Member Function</A> available on this
  site. 
</P> <HR>
<P><A NAME="Bmk021"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic46" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I wrote a component
  that saves the Printer()-&gt;Handle when it is
  created.&nbsp; At some point in the program, the saved
  value seems to no longer be valid.&nbsp; What causes
  this?</B> 
</P> 
<P>Printer()-&gt;Handle returns the handle to the global
  TPrinter object that is automatically created by the
  VCL.&nbsp; This object is used by some VCL objects, like
  TRichEdit, for basic printing. 
</P> 
<P>Printer()-&gt;Handle actually returns a handle to a
  device context (HDC) or a handle to an information context
  (HIC) at different points in time.&nbsp; If I recall
  correctly, it actually returns a HDC only between
  BeginDoc() and EndDoc(), in other words, only when it is
  printing.&nbsp; Outside of a BeginDoc()/EndDoc() pair, it
  returns a HIC.&nbsp; The HIC returned before BeginDoc() may
  be different from the HIC returned afterwards.&nbsp; To be
  safe, do not store the value returned by
  Printer()-&gt;Handle unless you invest the time to study
  the VCL code thoroughly. 
</P> <HR>
<P><A NAME="Bmk022"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic47" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I am using
  TRichEdit::Print(AnsiString Caption) to print the contents
  of a Rich Edit control.&nbsp; Why does the caption not
  print at the top of any of the pages?</B> 
</P> 
<P>According to the help files, &quot;The Caption parameter
  specifies the title that appears on the printed
  output.&quot;&nbsp; This is incredibly misleading. The only
  printed output on which this string would appear is a
  network print job banner page. 
</P> 
<P>There is no code in TRichEdit::Print() to print headers
  or footers of any kind.&nbsp; The Caption string is
  actually assigned to the Title property of Printer (the
  global TPrinter object).&nbsp; This, in turn, is displayed
  in the Print Manager (or print spooler) and, as I
  mentioned, on network print job banner pages. 
</P> 
<P>You can, of course, print your own headers and
  footers.&nbsp; See the paper titled
  <A HREF="../Yacs.html#Papers" TARGET="_top">Printing and
  Previewing Rich Edit Controls</A> available on this site. 
</P> <HR>
<P><A NAME="Bmk023"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic48" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I downloaded the
  TRichEdit20 sample code.&nbsp; Why does it raise an
  &quot;out of resources&quot; exception when I add or insert
  a line of text programmatically?</B> 
</P> 
<P>The &quot;out of resources&quot; exception occurs when
  adding or inserting a line of text with code similar to the
  following: 
</P> <PRE STYLE="margin-left: 0.5in">RichEdit1-&gt;Lines-&gt;Add(&quot;Some text.&quot;);    // to add text at the end
/* or */
RichEdit1-&gt;Lines-&gt;Insert(0, &quot;Some text.&quot;);      // to add text at the beginning</PRE>

<P> I was a bit lazy when building the TRichEdit20
  class.&nbsp; If you look at all of the code involved to
  date, you will find a number of supporting classes, some of
  which are extensions to existing classes.&nbsp; For
  example, TFontStyle2, TConsistentAttributes2,
  TTextAttributes2, and TParaAttributes2 are extensions to
  existing VCL classes. I was trying to keep the number of
  extended classes to a minimum&#133;. 
</P> 
<P>The problem is buried in the VCL TRichEditStrings
  class.&nbsp; When a line of text is inserted, the
  TRichEditStrings class adds a carriage return/linefeed pair
  (CRLF)&nbsp;. It then saves the current start of text
  position, adds the text, and, if the resulting text
  position is not equal to the original + the length of the
  inserted text + 2 (for the CRLF), then the VCL raises an
  exception.&nbsp; Rich Edit 2.0 controls convert CRLF pairs
  into CR and, thus, the number of characters inserted is one
  less than with Rich Edit 1.0 controls.&nbsp; The VCL
  assumes that this means that there was insufficient memory
  to insert the text. 
</P> 
<P>The ultimate solution is to create a new class derived
  from TRichEditStrings and wedge it into the TRichEdit20
  class. &nbsp;Until I get around to that, the workaround is
  to trap the error.&nbsp; If you are uncomfortable assuming
  that the text was inserted without any errors, you can try
  the following untested code (let me know if you have
  corrections): 
</P> <PRE STYLE="margin-left: 0.5in">RichEdit1-&gt;SelLength = 0;
int i = RichEdit1-&gt;SelStart;
AnsiString text = &quot;Some text.&quot;;
try {
        RichEdit1-&gt;Lines-&gt;Add(text);
        }
catch (EOutOfResources&amp; e) {
        if (RichEdit1-&gt;SelStart != i + text.Length() + 1) throw e;
        }
// no error</PRE>

<P> I hope to add an update to cure this problem fairly
  soon, so keep an eye on the site. 
</P> <HR>
<P><A NAME="Bmk024"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic49" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;The Lines property
  of TRichEdit returns only the plain ASCII text from the
  control.&nbsp; I want to get the raw RTF-encoded text from
  a Rich Edit control.&nbsp; How do I do that?&nbsp; Can I
  insert RTF coded text into a Rich Edit control?&nbsp; Can I
  copy text from one Rich Edit control into another without
  using the Clipboard?</B> 
</P> 
<P>RTF-encoded text can be retrieved from a Rich Edit
  control using WinAPI calls.&nbsp; RTF-encoded text can
  similarly be inserted into a Rich Edit control.&nbsp;
  Putting the two together allows you to copy RTF-encoded
  text from one Rich Edit control into another without using
  the Clipboard. 
</P> 
<P>Code to demonstrate this technique is available on this
  site.&nbsp; See the
  <A HREF="../Yacs.html#CodeSamples"
	TARGET="_top">TRichEditRawRtf class code sample</A>. 
</P> <HR>
<P><A NAME="Bmk025"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic50" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I combined the
  printing code from the </B><A HREF="../Yacs.html#Papers"
  TARGET="_top">Printing and Previewing Rich Edit
  Controls</A><B> paper with the TRichEdit20 class.&nbsp;
  When I try to print, the program hangs in the rendering
  loop.&nbsp; Any ideas?</B> 
</P> 
<P>A new message was added for Rich Edit 2.0 controls,
  EM_GETTEXTLENGTHEX, which must be used instead of
  WM_GETTEXTLENGTH.&nbsp; Replace the following line (in both
  the printing and previewing rendering loops): 
</P> <PRE STYLE="margin-left: 0.5in">int lastOffset = ::SendMessage(RichEdit1-&gt;Handle, WM_GETTEXTLENGTH, 0, 0);</PRE>

<P> with this: 
</P> <PRE STYLE="margin-left: 0.5in">GETTEXTLENGTHEX gtlx = { GTL_PRECISE, CP_ACP };
int lastOffset = ::SendMessage(Handle, EM_GETTEXTLENGTHEX, (WPARAM) &amp;gtlx, 0);</PRE>

<P> I have not found a good explanation of the
  GETTEXTLENGTHEX structure values, so these were selected by
  trial and error.&nbsp; If you find a good explanation of
  the structure, please let me know. 
</P> <HR>
<P><A NAME="Bmk026"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic52" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I downloaded the
  TRichEditRawRtf class code from the site and it sounds like
  what I need.&nbsp; Unfortunately, whenever I attempt to
  insert RTF-encoded text, I get an exception with a
  &quot;code 16.&quot;&nbsp; Why?</B> 
</P> 
<P>This particular code is returned by the underlying
  Windows Rich Edit control, not by the sample code.&nbsp;
  From my experience, it is caused by trying to insert text
  that is not properly RTF-encoded text. 
</P> 
<P>The TRichEditRawRtf class uses standard Rich Edit
  functions to move code into and out of the control, and
  both assume that you are inserting or extracting a complete
  and valid RTF-encoded file.&nbsp; That is, when you
  &quot;GetRtf(), you receive an AnsiString that, by itself,
  would comprise a valid RTF file.&nbsp; Similarly, when you
  &quot;PutRtf(),&quot; the rtfText parameter must contain
  text that would be a complete RTF-encoded file. 
</P> 
<P>All of that may be incomprehensible, so let me put it
  another way.&nbsp; Most problems using the code from the
  site seem to result from not creating a <U>full</U>RTF
  stream to insert into an existing Rich Edit control.&nbsp;
  A minimally complete RTF-encoded file would be something
  like: 
</P> <PRE STYLE="margin-left: 0.5in">{\rtf1 Some text}</PRE>

<P> A more complete RTF stream might look like this: 
</P> <PRE STYLE="margin-left: 0.5in">{\rtf1\ansi\ansicpg1252\deff0\deftab720{\fonttbl{\f0\fswiss MS Sans Serif;}
{\f1\froman\fcharset2 Symbol;}{\f2\fswiss\fcharset1 MS Sans Serif;}}
{\colortbl\red0\green0\blue0;}\deflang1033\pard\plain\f2\fs16 Some Text}</PRE>

<P> The most common mistake seems to be trying to insert
  only a portion of the above.&nbsp; For example, you
  <B>cannot</B>use the following to change the color of the
  text (by itself): 
</P> <PRE STYLE="margin-left: 0.5in">MyRichEditRawRtf-&gt;PutRtf(&quot;\colortbl\red1\greeen1\blue1 Some text&quot;);</PRE>

<P> Instead, you must insert something like: 
</P> <PRE STYLE="margin-left: 0.5in">MyRichEditRawRtf-&gt;PutRtf(&quot;{\rtf1\colortbl\red1\greeen1\blue1 Some text }&quot;);</PRE>

<P> To make a long story short, please spend some time with
  the sample application &#150; it displays exactly what
  should be passed to PutRtf(). 
</P> 
<P>Note:&nbsp; Menno van der Leden reports that using
  &quot;{\rtf1 Some text}&quot; continued to give the code 16
  error.&nbsp; He found that &quot;{\rtf Some text}&quot;
  (omitting the &quot;1&quot;) solved it. 
</P> <HR>
<P><A NAME="Bmk027"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic54" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;The TRichEdit20
  class looks like it should be simple to convert to a
  component.&nbsp; Why do you distribute it as a class
  instead of a component?</B> 
</P> 
<P>Good question.&nbsp; There are several reasons. 
</P> 
<P>First, I did not develop the code as a full-featured,
  drop-in replacement for TRichEdit.&nbsp; My intent is to
  give you a good starting point for learning about Rich Edit
  controls in general, and the Rich Edit 2.0 control in
  particular.&nbsp; Frankly, components add additional
  complexity not related to the issues that I am trying to
  address. 
</P> 
<P>Second, I am too lazy to answer all of the questions
  about component installation problems that would
  undoubtedly arise.&nbsp; I have had plenty of problems
  installing third party components, converting my own
  components from BCB3 to BCB4, and the like.&nbsp; Classes
  are much simpler and engender fewer questions. 
</P> 
<P>Lastly, if you try to convert the class into a
  component, you will discover that an exception is raised
  when the component is instantiated by the IDE.&nbsp; This
  happens when the IDE attempts to set the control's text to
  match the control's name.&nbsp; As I described in another
  FAQ (see the link below), I did not rewrite the
  TRichEditStrings class used by the Lines property of
  TRichEdit and inherited by the TRichEdit20 class.&nbsp; The
  TRichEditStrings class assumes that adding a line of text
  will extend the length of the text in the control by two
  bytes (carriage control + linefeed, aka CR/LF).&nbsp; Since
  Rich Edit 2.0 uses only one byte (CR) to delimit a line,
  TRichEditStrings assumes that the line was not inserted
  successfully and throws an &quot;insufficient memory&quot;
  exception.&nbsp; You can trap this in your own code;
  however, the IDE executes code not present in the
  TRichEdit20 class.&nbsp; Perhaps there is an easy way
  around this &#150; I will post a fix as soon as I bother to
  solve it or someone is kind enough to solve it for all of
  us. 
</P> 
<P><A HREF="#Bmk023" TARGET="_top">Go to the related
  FAQ</A>. 
</P> 
<P>Note:&nbsp; The
  <A HREF="../Yacs.html#TaeRichEditComponent"
	TARGET="_top">TaeRichEdit Component</A> available on this
  site is a full-featured Rich Edit 2.0/3.0 IDE component
  that solves the last problem.&nbsp; Although largely
  compatible with the Borland TRichEdit component, there are
  differences. 
</P> <HR>
<P><A NAME="Bmk028"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic57" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;When I distribute
  my program, I have to distribute other Borland runtime
  library DLLs with my program.&nbsp; How do I include
  everything in my program such that I do not have to
  distribute any other files?</B> 
</P> 
<P>To include all of the needed code in the executable
  program and eliminate the runtime DLLs in BCB4 and BCB5,
  change the following options: 
</P> 
<P STYLE="margin-left: 0.5in">Project | Options, Linker
  tab, uncheck &quot;Use Dynamic RTL.&quot; 
</P> 
<P STYLE="margin-left: 0.5in">Project | Options, Packages
  tab, uncheck &quot;Build with runtime packages.&quot; 
</P> 
<P>BCB3 has the same options, but one of them located
  elsewhere (I think the second one was in the Options menu).
  
</P> 
<P>Be aware that this will include the runtime code in your
  *.exe making it significantly larger.&nbsp; Other options
  on the Compiler and Linker tabs will also affect the size
  and speed of your program. 
</P> <HR>
<P><A NAME="Bmk029"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic58" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;Many programs have
  buttons on the Help About dialog that will let the user
  send the developer e-mail or link directly to the
  developer's site.&nbsp; How do I do that?</B> 
</P> 
<P>Thanks to Michael Cutler for this one.&nbsp; Here is
  what he worked out (edited to be addresses at
  &quot;somesite.com&quot;): 
</P> 
<P STYLE="margin-left: 0.5in">&quot;The ShellExecute()
  Method works for both HTTP and MAILTO.&nbsp; You need to
  include '#include &lt;shellapi.h&gt;' for it to work.&nbsp;
  Below is the code I used (2 buttons, one for HTTP and one
  for MAILTO).&quot; 
</P> <PRE STYLE="margin-left: 0.5in">//----------------------------------------------------------------------
void __fastcall TForm1::HTTPButtonClick(TObject *Sender)
{
        ::ShellExecute(NULL, &quot;open&quot;, &quot;http://somesite.com&quot;, NULL, NULL, SW_SHOWNORMAL);
}
//----------------------------------------------------------------------
void __fastcall TForm1::MAILTOButtonClick(TObject *Sender)
{
        ::ShellExecute(NULL, &quot;open&quot;, &quot;mailto:someone@somesite.com&quot;, NULL, NULL, SW_SHOWNORMAL);
}
//----------------------------------------------------------------------</PRE>

<P> Keep in mind that these functions assume that the user
  has installed a default browser and e-mail program,
  respectively.&nbsp; For truly bullet-proof code, you would
  need to determine if these default programs were installed.
  
</P> <HR>
<P><A NAME="Bmk030"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic60" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;When I disable a
  Rich Edit 2.0 control, the background is redrawn in
  gray.&nbsp; TRichEdit leaves the background white when
  disabled, which is what I want.&nbsp; Why is this?&nbsp;
  Can I change this to get the white background instead?</B> 
</P> 
<P>Well, this was a surprise -- I had not noticed
  this.&nbsp; My tests confirmed that TRichEdit (Rich Edit
  1.0) does indeed leave the background color unchanged when
  disabled while Rich Edit 2.0/3.0 controls gray the
  background when disabled.&nbsp; Oddly, I have been unable
  to find any documented reference to this change. 
</P> 
<P>The easiest way to work around this problem is to use
  the TRichEdit::ReadOnly property instead of the
  TRichEdit::Enabled property.&nbsp; Setting ReadOnly to
  false leaves the background color intact and does not allow
  the text to be changed, which is probably what you are
  trying to do. 
</P> 
<P>This is not, however, a perfect solution.&nbsp; A
  disabled control does not normally receive focus (for
  example, the user cannot &lt;Tab&gt; or &lt;Shift-Tab&gt;
  into the control), whereas a read-only edit control can
  receive focus but the text cannot be changed.&nbsp; This is
  a rather subtle difference for most purposes, but if it
  matters to your application, I will suggest a couple of
  possible solutions: 
</P> <UL>
<LI> 
<P>Use the ReadOnly property, trap the TWinControl::OnEnter
  event, and throw the focus to the next control (forwards or
  backwards, depending upon how the user got there).&nbsp;
  This seems a bit tricky to me, but it may very well be easy
  with the VCL. 
</P> </LI>
<LI> 
<P>Use the Enabled property and intercept the WM_PAINT
  and/or WM_ERASEBKGND messages and change the background
  brush to the appropriate color.&nbsp; I have a gut feeling
  that messing with Rich Edit paint messages is not a Good
  Thing, but I have not ruled it out....&nbsp; Yet. 
</P> </LI>
</UL>
<P>I have tried neither of these solutions and would be
  interested in hearing from you if you try them, either
  successfully or unsuccessfully. 
</P> 
<P>Thanks to David Davies for mentioning the problem. 
</P> <HR>
<P><A NAME="Bmk031"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic62" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I wrote a
  TConversion class for my application's documents and used
  TRichEdit::RegisterConversionFormat to associate the file
  extension with the converter.&nbsp; If I open one of my
  application's documents, the data is converted as
  expected.&nbsp; If I then open a *.txt file without
  restarting the program, TRichEdit tries to convert the
  plain text as if it were one of my application's
  documents.&nbsp; Similarly, if I first open a *.txt file
  and then open one of my application's documents, the data
  is not converted.&nbsp; What is going on?</B> 
</P> 
<P>The interactions between TConversion class and
  TRichEdit::Lines-&gt;LoadFromFile(), SaveToFile(),
  LoadFromStream(), and SaveToStream() are, at best,
  unintuitive.&nbsp; To me they are simply buggy. 
</P> 
<P>The problem is buried in the TRichEditStrings class
  (TRichEdit::Lines property) and is implemented in
  comctrls.pas.&nbsp; The first time a file is loaded using
  LoadFromFile(), TRichEditStrings looks up the file
  extension in the list of registered converters and, if it
  is found, assigns the converter to a variable called
  FConverter.&nbsp; If no converter is found, a default text
  converter (which does nothing) -- not the
  TRichEdit::DefaultConverter -- is created and assigned to
  FConverter.&nbsp; However, if FConverter is not null, the
  assignment is not made and the previously assigned
  converter is used. 
</P> 
<P>This has implications for SaveToFile() as well.&nbsp;
  When you load a file, FConverter is initialized.&nbsp; If
  you then save the file with a different file extension,
  SaveToFile() will use the old converter.&nbsp; For example,
  say you wrote a converter and associated it with
  *.xyz.&nbsp; You then open a *.txt file and save it as a
  *.xyz file. The data will be saved as a plain text file
  (with, of course, the xyz extension). 
</P> 
<P>Note that TRichEdit::DefaultConverter may not work quite
  as you would expect either.&nbsp; It will only be used for
  LoadFromStream() and SaveToStream() operations.&nbsp; And,
  if you LoadFromFile() and then SaveToStream(), the
  converter used for LoadFromFile() will still be used for
  streaming the data out. 
</P> 
<P>Sadly, I have no solutions short of rewriting
  significant portions of the TRichEdit and TRichEditStrings
  classes or doing your own streaming directly from the
  underlying Rich Edit control.&nbsp; See the EM_STREAMIN and
  EM_STREAMOUT messages in the WinAPI and the
  <A HREF="../Yacs.html#CodeSamples"
	TARGET="_top">TRichEditRawRtf class code</A> on this site
  if you are interested in the latter approach. 
</P> <HR>
<P><A NAME="Bmk032"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic64" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I need details on
  the Rich Text Format (RTF) encoding format.&nbsp; Where can
  I get more information on the RTF specification?</B> 
</P> 
<P>You probably already know this, but Rich Text Format is
  a specification unique to and fully controlled by
  Microsoft.&nbsp; There is no standard outside of what
  Microsoft shares with us.&nbsp; Given that, the
  specification can be found on Microsoft's site.&nbsp; I
  suggest that you search the Microsoft KnowledgeBase for the
  most current information, but here is what I found when I
  posted this FAQ: 
</P> 
<P>Microsoft KnowledgeBase article titled:&nbsp; <U>WD:
  Rich Text Format (RTF) Specification 1.5 Appnote
  (GC0165)</U>: 
</P> 
<P STYLE="margin-left: 0.5in"><A
  HREF="http://support.microsoft.com/support/kb/articles/Q86/9/99.ASP"
  TARGET="_top">http://support.microsoft.com/support/kb/articles/Q86/9/99.ASP</A>
  
</P> 
<P>Microsoft has an Application Note available:&nbsp;
  <U>Rich Text Format (RTF) Specification and Sample RTF
  Reader (GC0165)</U> that contains: 
</P><UL>
<LI>Version 1.5 of the Microsoft Rich Text Format
Specification </LI>
<LI>Addendum for the Japanese version of Word 6.0</LI>
<LI>Addendum describing how to create an RTF reader
application</LI>
<LI>Source code for a sample RTF reader</LI>
</UL>
<P>You can get this Application Note at: 
</P> 
<P STYLE="margin-left: 0.5in"><A
  HREF="http://support.microsoft.com/download/support/mslfiles/GC0165.exe"
  TARGET="_top">http://support.microsoft.com/download/support/mslfiles/GC0165.exe</A>.
  
</P> <HR>
<P><A NAME="Bmk033"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic66" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I am taking a C/C++
  class and my homework assignment requires that I print the
  result of several computations.&nbsp; The instructor has
  given me code to print the results but it does not
  work.</B> 
</P> 
<P>Apparently, many C/C++ course instructors are unfamiliar
  with the Windows operating system.&nbsp; This is, by
  itself, not necessarily a Bad Thing.&nbsp; For their
  students that use Windows development tools, however, it
  creates much confusion and frustration.&nbsp; Typically,
  the sample code provided by the instructor looks something
  like this: 
</P> 
<P>C programs: 
</P> <PRE STYLE="margin-left: 0.5in">printf(&quot;The answer is: %i&quot;, theAnswerVariable);
/* or */
fprintf(stdout, &quot;The answer is: %i&quot;, theAnswerVariable);</PRE>

<P> C++ programs: 
</P> <PRE STYLE="margin-left: 0.5in">cout &lt;&lt; &quot;The answer is: &quot; &lt;&lt; theAnswerVariable;</PRE>

<P> The instructor will generally tell you to run your
  program (named &quot;myprog.exe&quot; below) from the
  MS-DOS command line like this: 
</P> <PRE STYLE="margin-left: 0.5in">C:&gt;myprog &gt;&gt; prn:</PRE>

<P> or 
</P> <PRE STYLE="margin-left: 0.5in">C:&gt;myprog &gt;&gt; lpt1:</PRE>

<P> If this looks similar to your homework assignment
  instructions, then this FAQ may help. 
</P> 
<P>The standard C/C++ input/output (I/O) techniques do not
  work with Windows programs.&nbsp; Neither do the MS-DOS
  techniques for redirecting output to the printer.&nbsp;
  Despite the strong temptation, I will not go into a
  long-winded explanation of early teletype devices, MS-DOS
  command line redirection, the ANSI character code set, the
  development of the C and C++ languages, the evolution of
  the associated I/O libraries, and the history of the
  world.&nbsp; No, I will not even mention these
  pre-requisites.&nbsp; Just take my word for it -- these
  routines and techniques do not work in the Windows
  environment. 
</P> 
<P>So, how do you get your homework assignment answers
  printed?&nbsp; A simple solution is to send the output to a
  disk file and then open and print the file using the
  Microsoft Windows NotePad program.&nbsp; If you have not
  changed the default Windows *.txt file association, then
  the following should work. 
</P> 
<P>C programs: 
</P> <PRE STYLE="margin-left: 0.5in">/* you may need to #include &lt;stdio.h&gt; */
/* open the disk file. */
FILE* outfile;
/* open to write, replace if already exists */
outfile = fopen(&quot;c:\temp.txt&quot;, &quot;w+&quot;);  
/* &quot;print&quot; to the file.  substitute all of the printf() parameters for &quot;...&quot; below.
fprintf(outfile, ...);
/* close the disk file. */
fclose(outfile);</PRE>

<P> C++ programs: 
</P> <PRE STYLE="margin-left: 0.5in">// you may need to #include &lt;fstream.h&gt;
// open the disk file.
ofstream outStr(&quot;c:\temp.txt&quot;);
// &quot;print&quot; to the file (stream).
outStr &lt;&lt; /* same things that you would have sent to cout */;
// the stream is automatically closed when outStr goes out of scope.
// you can use outStr.close() to explicitly close the file.</PRE>

<P> Of course, the above instructions are for simple text
  files -- the same stuff that you would have sent to the
  standard output device (stdout for C or cout for
  C++).&nbsp; Binary files are a different matter
  entirely.... 
</P> 
<P>Now that you have created the text file, simply open the
  file using Microsoft's NotePad program and print it. 
</P> 
<P>Big Note:&nbsp; I have not tested the above code (it is
  pretty basic).&nbsp; If you use it, please let me know that
  it works (so that I can remove this warning) or that it
  does not (so that I can fix it).&nbsp; Thanks. 
</P> <HR>
<P><A NAME="Bmk034"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic67" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;I want to print an
  RTF document file, but I do not need to display it in a
  Rich Edit control.&nbsp; Can I simply print the document
  without using all of the Rich Edit printing code on your
  site?</B> 
</P> 
<P>Yes, you can print an RTF document using WordPad without
  all of the great code on my site.&nbsp; The trick is to
  execute WordPad with &quot;filename.rtf -p&quot; as command
  line parameters.&nbsp; You should be able to do this with a
  short-cut, with the C execl() or spawnl() function or the
  variants, or with the WinAPI ShellExecute() or
  ShellExecuteEx() functions.&nbsp; (Note:&nbsp; Since
  WordPad is uses Rich Edit 1.0, you are limited to Rich Edit
  1.0 functionality.) 
</P> 
<P>Thanks to Hal Davitt for working out the details. 
</P> <HR>
<P><A NAME="Bmk035"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic70" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp;You used the phrase
  &quot;RTF round-tripping.&quot; What the &amp;*$% is
  that?.</B> 
</P> 
<P>This is a really great example of what top-notch
  marketing departments do -- they transform an unimplemented
  function into a feature.&nbsp; And Microsoft clearly has an
  above-average marketing department.&nbsp; If you ever have
  a chance to hire an ex-Microsoft Marketing person for a
  marketing position, do it -- these guys are good! 
</P> 
<P>To answer your question, you must first understand that
  there is an official Microsoft specification for RTF.&nbsp;
  In fact, there are several versions of the specification
  (RTF 1.0, 1.5, and 2.0).&nbsp; None of the Rich Edit
  controls fully implemented the latest version of the RTF
  specification when the specifications were released.&nbsp;
  On the other hand, some other products did implement the
  (then current) RTF specification.&nbsp; For example,
  Microsoft Word can save files in RTF format and generally
  uses a more current version of the RTF specification than
  the current Rich Edit control implements. 
</P> 
<P>Rich Edit 1.0 had a really nasty habit of removing RTF
  codes that it did not understand.&nbsp; This meant that, if
  you created an RTF document in Word (say, RTF 1.5), loaded
  it into WordPad (say, RTF 1.0), and then saved it from
  WordPad, then any RTF codes that WordPad did not understand
  would be tossed out and not saved in the resulting RTF
  file. 
</P> 
<P>Microsoft attempted to resolve this problem in Rich Edit
  2.0+.&nbsp; It tries to be more intelligent when dealing
  with unknown RTF codes.&nbsp; There are now a number of RTF
  codes that it recognizes and does not throw away.&nbsp;
  That is, if you load the file into a Rich Edit 2.0+ control
  and then save it, some of the &quot;unknown&quot; codes
  will not be lost.&nbsp; However, these RTF codes are not
  implemented when displaying or printing the Rich Edit's
  contents. 
</P> 
<P>So, to tell you what the Microsoft marketing department
  is not telling you:&nbsp; &quot;RTF round-tripping&quot; is
  a code-word meaning that the control does not remove the
  RTF codes, but the Rich Edit control does not use them to
  display or print the text contained in the control. 
</P> <HR>
<P><A NAME="Bmk036"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic72" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; When a user pastes
  text from the Clipboard into my TRichEdit control, I want
  the text to be unformatted.&nbsp; I set the PlainText
  property to true but, when the user pastes text, formatted
  text is inserted.&nbsp; How do I ensure that pasted text is
  unformatted?</B> 
</P> 
<P>The TRichEdit::PlainText property affects only streaming
  actions (TRichEdit::Lines-&gt;LoadFromStream() and
  TRichEdit::Lines-&gt;LoadFromFile()).&nbsp; Clipboard
  operations do not use streams. 
</P> 
<P>By default, the TRichEdit control passes keystrokes to
  the underlying Windows Rich Edit control.&nbsp; The native
  Rich Edit control interprets &lt;Shift-Insert&gt; and
  &lt;Ctrl-V&gt; keystrokes as instructions to insert text
  from the Clipboard.&nbsp; The Rich Edit control will
  attempt to insert the Clipboard contents in the &quot;most
  suitable format&quot; (my words, not Microsoft's).&nbsp;
  This means that, if possible, the control will insert the
  text with the original formatting. 
</P> 
<P>To force the TRichEdit component to insert text without
  formatting, you must trap any actions that insert text from
  the Clipboard.&nbsp; Below is an example that traps the
  &lt;Shift-Insert&gt; keystroke using the TRichEdit
  OnKeyDown event and forces the text to be inserted without
  formatting.&nbsp; Trapping other keystrokes, mouse
  operations, etc., is left as &quot;an exercise for the
  student.&quot; 
</P> <PRE STYLE="margin-left: 0.5in">//---------------------------------------------------------------------------
void __fastcall TForm1::RichEdit1KeyDown(TObject *Sender, WORD &amp;Key, TShiftState Shift)
{
// create a TshiftState set that corresponds to only the shift key
TShiftState ss;
ss = ss &lt;&lt; ssShift;

// does the message correspond to &lt;Shift-Insert&gt;?
if (Key == VK_INSERT &amp;&amp; Shift == ss) {
        // null out the key code to prevent further processing
        Key = 0;

        // create a REPASTESPECIAL structure to use in the 
        // EM_PASTESPECIAL message
        REPASTESPECIAL reps = { 0, 0 };

        // tell the Rich Edit control to insert unformatted text (CF_TEXT)
        ::SendMessage(RichEdit1-&gt;Handle, EM_PASTESPECIAL, CF_TEXT, (LPARAM) &amp;reps);
        }
}
//---------------------------------------------------------------------------</PRE>

<HR>
<P><A NAME="Bmk037"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic2" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; Is there a simple
  way to use regular expressions with TRichEdit
  controls?&nbsp; Most regular expression libraries use a
  unique syntax &#150; what is the particular syntax used by
  the VCL library?</B> 
</P> 
<P>The VCL regular expression library included in BCB4 and
  BCB5 is fairly simple to use.&nbsp; You may want to use the
  TTaeRegExp class available on this site.&nbsp; See the
  TaeRegExp.zip download available in the
  <A HREF="../yacs.html#CodeSamples" TARGET="_top">Code
  Samples</A> section of this site. 
</P> 
<P>If you want to develop your own code from scratch,
  search for &quot;Perl-compatible regular expressions&quot;
  topic in the BCB help. 
</P> <HR>
<P><A NAME="Bmk038"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic4" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; My program works
  flawlessly on my development machine.&nbsp; However, some
  users have problems printing with certain printers which I
  do not have available for testing.&nbsp; Is there a way to
  recreate the problems on my development machine?</B> 
</P> 
<P>If the problem is that the print does not look as
  expected, you will probably need to get the specific
  hardware configuration set up in your test lab to see the
  actual printed output.&nbsp; On the other hand, if the
  problem is that the program generates a GPF, you may be
  able to reproduce the problem by simply installing the
  printer driver that the user has installed. 
</P> 
<P>I assume that you would already have asked the user to
  install the most current drivers available from the printer
  manufacturer and the problem persisted.&nbsp; So, go grab
  the same driver from the manufacturer's site and install it
  as a local (non-networked) printer.&nbsp; If the install
  program complains that you do not have the printer
  attached, you may (should!) be able to continue the
  installation (lie to the install program if necessary). 
</P> 
<P>If you can get the driver installed, go into Start Menu
  | Settings | Printers and right-click the newly installed
  printer.&nbsp; From the context menu, select
  Properties.&nbsp; This will bring up the printer's
  Properties dialog.&nbsp; Select the Details tab and change
  the &quot;print to&quot; destination from &quot;LPT1:&quot;
  (or whatever hardware port you selected during the
  installation) to &quot;File:&quot;&nbsp; Change any other
  printer settings to match your user's printer settings. 
</P> 
<P>Barring any user network issues, the new printer should
  operate identically to the user's configuration except that
  whenever your program sends print to this printer, it will
  send the output to a file.&nbsp; (You will be prompted for
  a destination filename each time that you print.)&nbsp; If
  your program is, indeed, causing the problem that the user
  reported, you should now be able to reproduce it. 
</P> <HR>
<P><A NAME="Bmk039"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic6" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; The TRichEdit
  component takes much longer than WordPad to open large
  files.&nbsp; Can I improve the load times?</B> 
</P> 
<P>You can try disabling the ENM_REQUESTRESIZE
  notification., which corresponds to the TRichEdit
  OnResizeRequest event, while loading the file with the
  following code: 
</P> <PRE STYLE="margin-left: 0.5in">int mask = ::SendMessage(RichEdit1-&gt;Handle, EM_GETEVENTMASK, 0, 0);
::SendMessage(RichEdit1-&gt;Handle, mask &amp; ~ENM_REQUESTRESIZE, 0, 0);
[ load the file ]
::SendMessage(RichEdit1-&gt;Handle, EM_SETEVENTMASK, 0, mask);</PRE>

<P> Thanks to Petr Vones for this suggestion. 
</P> <HR>
<P><A NAME="Bmk040"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic8" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; How do I save and
  restore the current scroll position in a TRichEdit
  component?</B> 
</P> 
<P>First, a brief description of the problem:&nbsp; Assume
  that you are writing a chat room program.&nbsp; As new
  messages are a posted in the chat room, you want to append
  them to the text in the control.&nbsp; However, to do this,
  you must position the caret at the bottom of the text and
  then insert the text.&nbsp; Finally, you need to restore
  the original caret position (easy) and scroll back such
  that the top line displayed is the same one as before
  inserting the text (not so easy). 
</P> 
<P>Here is a trick posted by Peter Below (TeamB) in a
  Delphi forum.&nbsp; I have translated, modified, and
  expanded the original post somewhat for presentation
  here.&nbsp; Hopefully, I have not munged it too badly. 
</P> <PRE STYLE="margin-left: 0.5in">// first save the current caret location
int selStart = RichEdit1-&gt;SelStart;
int selLength = RichEdit1-&gt;SelLength;

// get the line number of the first visible line
int firstLine = ::SendMessage(RichEdit1-&gt;Handle, EM_GETFIRSTVISIBLELINE, 0 , 0);

// disable screen redraws
RichEdit1-&gt;Lines-&gt;BeginUpdate();

[ move the caret, insert the text, etc. ]

// restore the caret location
RichEdit1-&gt;SelStart = selStart;
RichEdit1-&gt;SelLength = selLength;

// here is the trick &#150;- get the current first visible line, 
// compute the number of lines to scroll, and scroll...
int currLine = ::SendMessage(RichEdit1-&gt;Handle, EM_GETFIRSTVISIBLELINE, 0, 0);
::SendMessage(RichEdit1-&gt;Handle, EM_LINESCROLL, 0, firstLine &#150; currLine);

// enable screen redraws
RichEdit1-&gt;Lines-&gt;EndUpdate();</PRE>

<P> In truth, this solves only half of the problem.&nbsp;
  The vertical position has been restored, but the horizontal
  position may not be correct. 
</P> 
<P>Michael Buschbeck offers the following solution for
  restoring the horizontal position: 
</P> <PRE STYLE="margin-left: 0.5in">// get horizontal scroll bar position
int nHorzScrollPos = ::GetScrollPos(RichEdit1-&gt;Handle, SB_HORZ);

[ do whatever you want ]

// restore horizontal scroll bar position
::SendMessage(RichEdit1-&gt;Handle, WM_HSCROLL, SB_THUMBPOSITION | (nHorzScrollPos &lt;&lt; 16), 0);</PRE>

<P> By the way, if you are using a component based on Rich
  Edit 3.0, there is a much easier way &#150; see the
  EM_GETSCROLLPOS and EM_SETSCROLLPOS messages. 
</P> <HR>
<P><A NAME="Bmk041"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic10" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; Where can I find a
  code sample to do &lt;<I>something</I>&gt;?</B> 
</P> 
<P>There are
  <A HREF="../Links.html#TopOfPage" TARGET="_top">many
  sites</A> with sample code and
  <A HREF="../Links.html#WebRings" TARGET="_top">web
  rings</A> and
  <A HREF="../Links.html#BestStarts" TARGET="_top">search
  sites</A> to help locate these sites.&nbsp; Of course, the
  <A HREF="../Links.html#BorlandNewsgroups"
	TARGET="_top">Borland newsgroups</A> are also a great
  source of information.... 
</P> 
<P>However, BCB comes with lots of useful sample code that
  is easy to overlook.&nbsp; Before wasting a lot of time
  searching the Internet for answers, you might want to spend
  a few minutes searching the Examples folder in the BCB
  installation directory (for BCB5, the default is
  C:\Program&nbsp;Files\Borland\CBuilder5\Examples &#150;
  other versions are similar).&nbsp; Some of the neat things
  that are included with BCB5 Professional (other versions
  may not include all of these &#150; or may include even
  more): 
</P> <UL>
<LI> A &quot;single instance&quot; component.&nbsp; If the
user attempts to run a second copy of the program, this
component signals the first instance and passes information
from the second to the first instance before terminating
the second instance.&nbsp; Look in the
Examples\Controls\SingleInst folder. </LI>
<LI> An example of using the undocumented TrayIcon class to
put an icon in the system taskbar's tray (next to the
clock). (Note:&nbsp; I have been unable to find the source
code for this component nor any other documentation beyond
the sample code.)&nbsp; Look in the
Examples\Controls\TrayDemo folder. </LI>
<LI> A component that allows your program to get program
version information.&nbsp; Look for the
Examples\Controls\VersionInfo folder. </LI>
</UL>
<P>If you do not find the examples, then you may not have
  installed them &#150; check the BCB installation
  disk.&nbsp; Assuming that your CD drive is D: and that you
  have BCB5, look in D:\RunImage\CBuilder5\Examples.&nbsp;
  Adjust as necessary for a different CD drive assignment or
  version of BCB. 
</P> 
<P>The BCB5 Professional installation disk also includes: 
</P> <UL>
<LI> The C++ Builder 5 <U>Developer's Guide</U>
(D:\Documentation\Dg.pdf) </LI>
<LI> The C++ Builder 5 <U>Quick Start</U> manual
(D:\Documentation\Qs.pdf). </LI>
<LI> A JPEG image component (D:\Info\Extras\Jpeg) </LI>
</UL>
<P>So, check out the samples &#150; hopefully, this will
  save you a bit of time.... 
</P> <HR>
<P><A NAME="Bmk042"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic12" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; How do I trap
  double-clicks on a TRichEdit?</B> 
</P> 
<P>Remy Lebeau (Gambit) offered the following solution in a
  C++ Builder forum.&nbsp; Simply publish the unpublished
  OnDblClick event like so: 
</P> <PRE STYLE="margin-left: 0.5in">class PACKAGE TMyRichEdit : public TRichEdit
{
public:
        __fastcall TMyRichEdit(TComponent* Owner);

__published:
        __property OnDblClick;
};

__fastcall TMyRichEdit::TMyRichEdit(TComponent* Owner) : TRichEdit(Owner)
{
}

void __fastcall TForm1::MyRichEditDblClick(TObject* Sender)
{
        ShowMessage(&quot;double-clicked&quot;);
}</PRE>

<P> Thanks for sharing, Remy. 
</P> <HR>
<P><A NAME="Bmk043"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic14" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; How do I get the
  TRichEdit to scroll to the bottom of the text when new
  lines are added?</B> 
</P> 
<P>To scroll to the bottom of the text in the component,
  move the selection to the bottom and then tell the
  TRichEdit to scroll to the caret like so: 
</P> <PRE STYLE="margin-left: 0.5in">RichEdit1-&gt;SelLength = 0;
RichEdit1-&gt;SelStart = RichEdit1-&gt;GetTextLen();
::SendMessage(RichEdit1-&gt;Handle, EM_SCROLLCARET, 0, 0);</PRE>

<P> If that does not work, you may need to add code to
  ensure that the Rich Edit control has focus.&nbsp; For
  example: 
</P> <PRE STYLE="margin-left: 0.5in">TWinControl* activeControl = Form1-&gt;ActiveControl;
Form1-&gt;ActiveControl = RichEdit1;
[ do the above here ]
Form1-&gt;ActiveControl = activeControl;</PRE>

<P> Finally, the TRichEdit::HideSelection property may play
  a role; try setting the property to false. 
</P> <HR>
<P><A NAME="Bmk044"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic16" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; I am using Rich
  Edit 2.0/3.0 and set the paragraph line spacing to single,
  1.5, or double using PARAFORMAT2.bLineSpacingRule.&nbsp;
  After setting the spacing to 1.5 or double, I cannot set
  the paragraph line spacing back to single-spacing.&nbsp;
  What gives?</B> 
</P> 
<P>The EM_SETPARAFORMAT message appears to work properly
  with PARAFORMAT2.bLineSpacingRule set to 1 (1.5 spacing) or
  2 (double-spacing).&nbsp; However, as you have found,
  setting the paragraph line spacing back to single-spacing
  (bLineSpacingRule = 0) has no effect.&nbsp; This appears to
  be a bug in both RE 2.0 and 3.0. 
</P> 
<P>To clarify/simplify the question and solution, assume
  the following function: 
</P> <PRE STYLE="margin-left: 0.5in">//---------------------------------------------------------------------------
void SetLineSpacing(int lineSpacing) 
{
        PARAFORMAT2 pf2;
        ::memset(&amp;pf2, 0, sizeof(PARAFORMAT2));
        pf2.cbSize = sizeof(PARAFORMAT2);
        pf2.dwMask = PFM_LINESPACING;
        pf2.bLineSpacingRule = lineSpacing;
        ::SendMessage(RichEdit1-&gt;Handle, EM_SETPARAFORMAT,0, (LPARAM) &amp;pf2);
}
//---------------------------------------------------------------------------</PRE>

<P> If you call the above with SetLineSpacing(1), the
  selected paragraph(s) will be spaced at 1.5 times the line
  height as expected.&nbsp; If you then call
  SetLineSpacing(2), the paragraph(s) will be properly
  double-spaced.&nbsp; However, subsequent calls of
  SetLineSpacing(0) will not result in the expected and
  documented paragraph single-spacing. 
</P> 
<P>The work-around is easy once you know how &#150; the
  PARAFORMAT2.bLineSpacingRule = 5 sets the line height in
  twentieths of a single line's height; this works correctly
  for 20 twentieths (single-spacing).&nbsp; The following
  revision to the above code ensures that EM_GETPARAFORMAT
  returns the proper value (0) in
  PARAFORMAT2.bLineSpacingRule. 
</P> <PRE STYLE="margin-left: 0.5in">//---------------------------------------------------------------------------
void SetLineSpacing(int lineSpacing)
{
        PARAFORMAT2 pf2;
        ::memset(&amp;pf2, 0, sizeof(PARAFORMAT2));
        pf2.cbSize = sizeof(PARAFORMAT2);
        pf2.dwMask = PFM_LINESPACING;
        // if single-spacing, set to 20 twentieths
        if (!lineSpacing) {
                pf2.bLineSpacingRule = 5; // space in 20ths of a line height
                pf2.dyLineSpacing = 20;
                ::SendMessage(RichEdit1-&gt;Handle, EM_SETPARAFORMAT, 0, (LPARAM) &amp;pf2);
                }
        // drop through even if lineSpacing == 0 to ensure 
        // correct value from bLineSpacingRule with EM_GETPARAFORMAT
        pf2.bLineSpacingRule = lineSpacing;
        ::SendMessage(RichEdit1-&gt;Handle, EM_SETPARAFORMAT, 0, (LPARAM) &amp;pf2);
}
//---------------------------------------------------------------------------</PRE>

<P> Thanks to Lincoln Silk and Paivi Majaranta bringing
  this bug to my attention and for helping me work through
  it. 
</P> <HR>
<P><A NAME="Bmk045"></A><B><IMG
  SRC="../Images/bludiamd.gif" NAME="Graphic18" ALIGN="TOP"
  WIDTH="14" HEIGHT="14" BORDER="0">&nbsp; In my program, the
  TRichEdit flashes excessively when I do certain
  things.&nbsp; That is, it appears to be redrawn
  frequently.&nbsp; How do I eliminate flicker in TRichEdit
  components?</B> 
</P> 
<P>While you may not be able to completely eliminate
  redrawing, you can definitely minimize it.&nbsp; The
  typical answer &#150; and one that I have given for years
  &#150; is to use code like this: 
</P> <PRE STYLE="margin-left: 0.5in">RichEdit1-&gt;Lines-&gt;BeginUpdate();
[do the stuff that causes flicker]
RichEdit1-&gt;Lines-&gt;EndUpdate();</PRE>

<P> I suggest that you try this first.&nbsp; However, you
  may still get a lot of flicker because the VCL forces the
  TRichEdit window to be redrawn after many of the
  component's operations. 
</P> 
<P>You can take total control using the WinAPI, but you
  will need to be careful.&nbsp; Here are the pieces of code:
  
</P> <PRE STYLE="margin-left: 0.5in">// disable redrawing
::SendMessage(RichEdit1-&gt;Handle, WM_SETREDRAW, 0, 0);
[do the stuff that causes flicker]
// tell Windows to ignore anything previously done that might have changed
// the contents of the window
::ValidateRect(RichEdit1-&gt;Handle, 0);
// re-enable drawing
::SendMessage(RichEdit1-&gt;Handle, WM_SETREDRAW, 1, 0);</PRE>

<P> As I mentioned, you must be careful with this code to
  be sure that the screen is properly updated when
  necessary.&nbsp; At this point, the TRichEdit window has
  not been redrawn to reflect any changes.&nbsp; If you moved
  the caret, modified text, or did anything else that changed
  what should be displayed, the control will not properly
  reflect this.&nbsp; To force the control to redraw itself,
  use one of the following: 
</P> <PRE STYLE="margin-left: 0.5in">::InvalidateRect(RichEdit1-&gt;Handle, 0, 1);  // erase background and redraw
::InvalidateRect(RichEdit1-&gt;Handle, 0, 0);  // redraw without erasing background</PRE>

<P> The above tells Windows that the RichEdit contents
  should be updated &quot;when convenient.&quot;&nbsp; To
  force an immediate repainting of the window (rather than
  waiting for Windows &quot;to get around to it&quot;), add
  the following: 
</P> <PRE STYLE="margin-left: 0.5in">::UpdateWindow(RichEdit1-&gt;Handle);</PRE>

<P> Finally, a warning:&nbsp; Do not use the above inside
  of a WM_PAINT message handler or the VCL Paint() method. 
</P> <HR>
<P><A NAME="Bmk046"></A><IMG SRC="../Images/bludiamd.gif"
  NAME="Graphic20" ALIGN="TOP" WIDTH="14" HEIGHT="14"
  BORDER="0">&nbsp; <B>The VCL TRichEdit component works
  properly on Windows 95/98/NT but behaves oddly on Windows
  2000.&nbsp; What is causing this?</B> 
</P> 
<P>Assuming that your code is not at fault, the problem may
  have something to do with the way that Microsoft has
  implemented RichEdit 1.0 (TRichEdit uses RE 1.0) support
  for Windows 2000.&nbsp; If you check the size of
  riched32.dll, I think that you will find that the file is
  somewhere around 4KB, nowhere near the normal 160+KB for
  the full RE 1.0 DLL.&nbsp; This leads me to believe that
  W2K riched32.dll is a &quot;wrapper&quot; that simply
  forwards calls to riched20.dll (RE 2.0/3.0).&nbsp; And,
  based on the reports that I have received, it appears to be
  a rather buggy wrapper. 
</P> 
<P>If you are confident that your code is correct, my best
  advice is to try to convert your code to use RE 2.0/3.0
  directly.&nbsp; You can find links to a couple of the
  better-known free Delphi-based components on my Links page
  or you can try the
  <A HREF="../Yacs.html#CodeSamples"
	TARGET="_top">TRichEdit20 class</A> (free) or
  <A HREF="../Yacs.html#TaeRichEditComponent"
	TARGET="_top">TaeRichEdit Component</A> (free only for
  non-commercial use), both available on this site. 
</P> <HR>
<P><A NAME="Bmk047"></A><IMG SRC="../Images/bludiamd.gif"
  NAME="Graphic24" ALIGN="TOP" WIDTH="14" HEIGHT="14"
  BORDER="0">&nbsp; <B>My program loads riched20.dll (i.e.,
  it uses RichEdit 2.0/3.0).&nbsp; Is it possible to
  determine at runtime which version (2.0 or 3.0) is actually
  loaded?</B> 
</P> 
<P>Here is one way:&nbsp;
  <A HREF="../CodeSamples/CodeSnips.html#Bmk012"
	TARGET="_top">See the Code Snippet</A>.&nbsp; Note that, if
  you have the source for the component, you might want to
  modify the sample code to use the module handle returned
  from ::LoadLibrary() instead of obtaining the handle using
  ::GetModuleHandle(). 
</P> <HR>
<P><A NAME="Bmk048"></A><IMG SRC="../Images/bludiamd.gif"
  NAME="Graphic22" ALIGN="TOP" WIDTH="14" HEIGHT="14"
  BORDER="0">&nbsp; <B>In addition to left, center, and right
  paragraph justification, the RichEdit 2.0 PARAFORMAT2
  structure includes a &quot;full justification&quot; value
  (PFA_JUSTIFY).&nbsp; It does not seem to work.&nbsp; Any
  ideas?</B> 
</P> 
<P>Try adding the following to enable some of the more
  advanced line-breaking features: 
</P> <PRE STYLE="margin-left: 0.5in">::SendMessage(RichEdit1-&gt;Handle, EM_SETTYPOGRAPHYOPTIONS, TO_ADVANCEDTYPOGRAPHY, TO_ADVANCEDTYPOGRAPHY);</PRE>

<P> Note:&nbsp; The WinAPI help states that this is a
  RichEdit 3.0-only message.&nbsp; However, I would try it
  with RE 2.0 since the documentation is so frequently
  incorrect. 
</P> <HR>
<P><A NAME="Bmk049"></A><IMG SRC="../Images/bludiamd.gif"
  NAME="Graphic22" ALIGN="TOP" WIDTH="14" HEIGHT="14"
  BORDER="0">&nbsp;<B>Microsoft Word's spell-checker
  underlines misspelled words with a red wavy
  underline.&nbsp; Can RichEdit controls do this? </B> 
</P> 
<P> There are two parts to this question:&nbsp;(1) Can you
  create a wavy underline and (2) can you color the underline
  red while leaving the text color unchanged.&nbsp; RichEdit
  1.0 supports only a plain underline and the color cannot be
  separately specified.&nbsp; RichEdit 2.0 supports at least
  a couple of underline types (single, double, and word)
  according to the documentation.&nbsp; RichEdit 3.0 supports
  even more underline styles including thick, wave, dash,
  dash-dot, dash-dot-dot, and dotted (I have not verified
  that they all work; the wavy style *does* work).&nbsp;
  Since setting the underline color to a different color than
  the text is listed as a RichEdit 3.0 enhancement, I assume
  that it does not work with prior versions.&nbsp; However,
  many RE 2.0 features are undocumented, so it may be worth
  trying if you are using RE 2.0. 
</P> 
<P>All of that said, here is how it works:&nbsp; Set the
  lower nibble of the CHARFORMAT2 bUnderlineType to the
  desired underline style and set the upper nibble of
  bUnderlineType to values of 1 to 15 (0x1? to 0xf?) to set
  the color.&nbsp; (Be sure to read &quot;the catch&quot; at
  the bottom of this entry.) 
</P> 
<P>For example, the following code will add a wavy red
  underline to the selected text in a RE 3.0: 
</P> <PRE STYLE="margin-left: 0.5in">// create a CHARFORMAT2 structure
::CHARFORMAT2 cf2;
  
// initialize the CHARFORMAT2 structure to modify the underline type
::memset(&amp;cf2, 0, sizeof(cf2));
cf2.cbSize = sizeof(cf2);
cf2.dwMask = CFM_UNDERLINETYPE;

// set the underline type to the wavy style and the color to red
cf2.bUnderlineType = CFU_UNDERLINEWAVE | 0x50 /* 5 = red */

// apply the change to the selected text
::SendMessage(RichEdit1-&gt;Handle, EM_SETCHARFORMAT, true, (LPARAM) &amp;cf2);
</PRE>

<P>Many thanks to Patrick Blackman for sharing this
  information. 
</P> 
<P> Unfortunately, there is a catch.&nbsp; Although the
  above displays correctly, the RE 3.0 control does not
  appear to save the color value correctly in an RTF
  document.&nbsp; In fact, if you use any color value other
  than zero (auto-color), the RE control not only does not
  save the underscore color, it strips the underscore from
  the document entirely.&nbsp; Underscore colors may simply
  be unsupported in RTF; I did not find it in the RTF 1.5
  specification.&nbsp; OTOH, this may be yet another RE
  bug.... 
</P><HR>
<TABLE WIDTH="100%" BORDER="0" CELLPADDING="2"
 CELLSPACING="0"> 
<TR VALIGN="TOP">
  <TD WIDTH="*" BGCOLOR="#e6e6e6">
	 <P><FONT SIZE="-1"><B>
		<A HREF="../Yacs.html" TARGET="_top">Home</A> |
		<A HREF="#TopOfPage" TARGET="_top">Top Of Page</A> |
		<A HREF="../Yacs.html#CodeSection" TARGET="_top">Code</A> |
		<A HREF="../Yacs.html#Papers" TARGET="_top">Papers</A> |
		FAQs | <A HREF="../Links.html" TARGET="_top">Links</A> |
		<A HREF="../Yacs.html#SiteSearch" TARGET="_top">Search</A>
		| <A HREF="../Yacs.html#ContactMe"
		TARGET="_top">Feedback</A> </B></FONT> 
	 </P> 
  </TD>
  <TD WIDTH="*" BGCOLOR="#e6e6e6">
	 <P ALIGN="RIGHT"><FONT SIZE="-1"> Page updated 
		<SCRIPT LANGUAGE="javascript" TYPE="text/javascript" SRC="../lstmoddt.js">
			</SCRIPT> </FONT> 
	 </P> 
  </TD>
</TR>
</TABLE> 
<P ALIGN="CENTER"><B><FONT SIZE="-1"> Copyright &copy;
  1998-2001 Thin Air Enterprises and Robert Dunn.&nbsp; All
  rights reserved.</FONT></B> 
</P> 
</BODY>
</HTML>


