ID=F0370
URL=http://www.vbip.com/itc/itc-http-component-01.asp
SIZE=40397
DATE=09/07/2002
TIME=13:19:43
DATASET=Visual Basic
HTML=
<html>

<head>
<title>HTTP Transfer Component - Create a Server Component using Internet Transfer Control</title>
<meta name="keywords" content="Visual Basic, HTTP, ITC, Internet Transfer Control, download, ActiveX DLL">
<meta name="description" content="This article will show you how to create a server component using Internet Transfer Control. I shall talk about the ITC (Internet Transfer Control) in more detail shortly but first of all let’s see why do we need this component.">
<meta name="ROBOTS" content="INDEX,FOLLOW">

	<link rel="stylesheet" type="text/css" href="../../vbip_nn.css">

</head>

<body bgcolor="#FFFFFF">
<form name="GlobalForm" ID="GlobalForm">
<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%">
      <table border="0" width="100%" cellspacing="0" cellpadding="0">
        <tr>
          <td width="120"><img border="0" src="../_borders/vbip_logo3.gif" width="132" height="50"></td>
          <td valign="middle">
				<p align="center">
              <!-- start BITS ad HTML -- top of page -- 468x60 banner www.bitsonthewire.com         --> 
               <iframe src="http://ads.bitsonthewire.com/admgriframe.asp?siteid=1126&ad_type=0" width=468 height=60 marginwidth=0 marginheight=0 hspace=0 vspace=0 frameborder=0 scrolling=no> 
                 <a href="http://ads.bitsonthewire.com/adrdrmanager.asp?loc=1">
                   <img border="0" src="http://ads.bitsonthewire.com/admanager.asp?loc=1&siteid=1126&ad_type=0">
                 </a></iframe> 
              <!-- stop BITS ad HTML -- top of page -- 468x60 banner                                --> 
				&nbsp;
              <a href="http://www.amazon.com/exec/obidos/redirect-home/vbipvisualbasici">
              <img border="0" src="../images/gnused120x60.gif" width="120" height="60"></a></p>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td width="100%" height="1" valign="top">
      <hr noshade color="#FF9933">
    </td>
  </tr>
  <tr>
    <td width="100%" height="1" valign="top">
    <p class="barsidecaption">
    	<a href="../default.asp">Home</a> -
      	<a href="../whatsnew.asp"> What's New</a> - <a href="../tools.asp"> Tools&amp;Technologies</a> -
      	<a href="../resources.asp"> Resources</a> - <a href="../resources/books/default.asp">Books</a>
        - <a href="../forum/">Forum</a>
    </p>
    </td>
  </tr>
  <tr>
    <td width="100%" height="1" valign="top">
      <hr noshade color="#FF9933">
    </td>
  </tr>
</table>

<table width="100%" cellspacing="1" cellpadding="2" bordercolor="#800000" border="1">
  <tr>
    <td width="100%" bgcolor="#FF9933">
      <font color="#FFFFCC">
      <table border="0" width="100%" cellspacing="0" cellpadding="0">
        <tr>
          <td width="37%">
          <SCRIPT LANGUAGE=javascript>
          <!--
          if(navigator.appName.indexOf('Microsoft')>=0)
          {
          document.write('<a HREF="javascript:void(0);" class="tbcaption" onClick="window.external.AddFavorite(location.href, document.title);">Add to Favorites</a>');
          }
          // -->
          </SCRIPT>
          </td>
          <td width="63%">
            <p align="right" class="tbcaption">
            <a href="../default.asp" class="tbcaption">Home</a> -
            <a href="../tools.asp" class="tbcaption">Tools&amp;Technologies</a> -
            <a class="tbcaption" href="../itc">ITC</a> - 
            HTTP Transfer Component
          </td>
        </tr>
      </table>
      </font>
    </td>
  </tr>
</table>
<table border="0" width="100%" cellspacing="0" cellpadding="0">

<!--table-->
    <td width="125" valign="top"  style="border-left: 1px solid #800000; border-right: 1px solid #800000; " bgcolor="#FF9933">

    <table border="0" width="100%">
     <tr>
        <td width="100%" bgcolor="#FFCC00" style="border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " height="20">
          <p align="center" class="barsidecaption">[Advertisement]</td>
      </tr>
      <tr>
        <td width="100%" style="border: 1px solid #800000; " height="120">
<!-- start BITS ad HTML -- first 125x125 banner www.bitsonthewire.com                 --> 
<iframe src="http://ads.bitsonthewire.com/admgriframe.asp?siteid=1126&ad_type=-6" width=125 height=125 marginwidth=0 marginheight=0 hspace=0 vspace=0 frameborder=0 scrolling=no>
<a href="http://ads.bitsonthewire.com/adrdrmanager.asp?loc=3"><img border="0" src="http://ads.bitsonthewire.com/admanager.asp?loc=3&siteid=1126&ad_type=-6"></a></iframe> 
<!-- stop BITS ad HTML -- 125x125 banner                                             --> 	
        </td>
      </tr>
         
      <tr>
        <td width="100%" style="border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " bgcolor="#FFCC00" height="21">
          <p align="center" class="barsidecaption">[Search vbip.com]</td>
      </tr>
      <tr>
      
        <td valign="top" width="100%" height="21">
        
			<input type="text" size="7" name="search_site">&nbsp;
			<input type="button"  value="Go" onclick='location.href="http://www.vbip.com/search2/search.asp?Realm=vbip.com&Match=1&Terms="+document.GlobalForm.search_site.value;'>	
		
        </td>
      </tr>
         
      <tr>
        <td width="100%" style="border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " bgcolor="#FFCC00" height="21">
          <p align="center" class="barsidecaption">[Search other VB sites]</td>
      </tr>
      <tr>
        <td valign="top" width="100%" height="21">
        
			<input type="text" size="7" name="search_web">&nbsp;
			<input type="button"  value="Go" onclick='location.href="http://www.vbip.com/search2/search.asp?Realm=Other+VB+Websites&Match=1&Terms="+document.GlobalForm.search_web.value;'>	
		      
      </tr>
     
      <tr>
        <td width="100%" style="border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " bgcolor="#FFCC00" height="21">
          <p align="center" class="barsidecaption">[Featured Book]</td>
      </tr>
      <tr>
        <td valign="top" width="100%" height="21">
<center><center>
<a href="http://www.vbip.com/appdev.asp">
<img src="http://www.vbip.com/images/appdev120x240.jpg">
</a>
</center></center>
        </td>
      </tr>
     
      <tr>
        <td width="100%" style="border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " bgcolor="#FFCC00" height="21">
          <p align="center" class="barsidecaption">[Newsletter]</td>
      </tr>
      <tr>
        <td width="100%" height="56">
          <form method="POST" action="../sub.asp" onSubmit="">
            <table border="0" width="100%" cellspacing="0">
              <tr>
                <td width="84%">
                <input type="text" name="T1" size="8" style="font-family: Tahoma; color: #800000; font-size: 8pt; background-color: #FFCC99; border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " value="your e-mail"></td>
                <td width="16%"><input type="submit" value="Sub" name="B1" style="font-family: Tahoma; font-size: 8pt; color: #800000"></td>
              </tr>
              <tr>
                <td width="100%" colspan="2"><input type="radio" value="V1" checked name="R1"><span class="barsidecaption">HTML</span>
                  <input type="radio" name="R1" value="V2"><span class="barsidecaption">Text</span></td>
              </tr>
            </table>
          </form>
        </td>
      </tr>

      <tr>
        <td width="100%" style="border-left: 1px solid #800000; border-right: 1px solid #FFFFCC; border-top: 1px solid #800000; border-bottom: 1px solid #FFFFCC; " bgcolor="#FFCC00" height="21">
      <p align="center" class="barsidecaption">
      [Partners]
      </tr>
	
  <tr>
        <td width="100%" height="22">
      <p align="center"><a href="http://www.vbcity.com" target="_blank"><img border="0" src="..//images/vbcity2_100x30.gif" width="100" height="30"></a>
  </tr>
  <tr>
        <td width="100%" height="22">
      <p align="center"><a href="http://www.vbweb.co.uk/" target="_blank"><img border="0" src="..//images/vbweb_button.gif" width="100" height="30"></a>
  </tr>  
      <tr>
        <td width="100%" height="12" align="center">
      <a href="http://www.vbwire.com" target="_blank"><img border="0" src="..//images/VBWire-btn.gif" width="100" height="30"></a>
      </tr>

  <tr>
        <td width="100%" height="22">
      <p align="center"><a href="http://www.developersdex.com/vb" target="_blank"><img border="0" src="..//images/vbdex.gif" width="100" height="30"></a>
  </tr>  
  <tr>
        <td width="100%" height="3">
        <center>
        <!-- BEGIN ACKY CODE -->
		<a href="http://www.acky.net" target="_blank"><img
		src="http://www.acky.net/banners/ackbut3.gif" width="88" height="31"
		border="0" alt="Acky.net is your one stop shop for all of your web
		developing needs"></a>
		<!-- END ACKY CODE -->
		</center>
  </tr>
    </table>

    </td>
    <td valign="top" bgcolor="#FFFFFF">
      <blockquote>
        <p><b><font face="Arial"><a href="../winsock_control.asp"><br>
        </a><img border="0" src="itc-banner.gif">
        </font></b></p>
        <p class="ChapterTitle"><span lang="en-us">HTTP Transfer Component</span></p>
          <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="90%" id="AutoNumber1">
            <tr>
              <td width="62%"><b><font face="Arial" size="2" color="#800000">
              Create a Server Component using Internet Transfer Control</font></b></td>
              <td width="38%">
              <p align="right"><b><font face="Arial" size="2" color="#800000">
              Written By S.S. Ahmed</font></b></td>
            </tr>
        </table>
          <table border="0" width="90%" cellspacing="0" cellpadding="0" height="44">
            <tr>
              <td width="100%" height="15" colspan="3">
        <hr noshade size="1" color="#FF9933">
              </td>
            </tr>
            <tr>
              <td width="16" bgcolor="#FFFFCC" height="21" valign="top" style="border: 1px solid #FF9933" class="tbcaption">
                <p align="center">
                <a href="HttpComponent.zip">
                <img border="0" src="../images/download-icon4.gif" align="right"></a></td>
              <td width="40%" bgcolor="#FF9933" height="21" class="tbcaption">
                <p>&nbsp;<a class="tbcaption" href="HttpComponent.zip">Download
                <span lang="en-us">HTTPComponent</span> sample project</a></td>
              <td width="57%" bgcolor="#FF9933" height="21" class="tbcaption">
              <p align="right" class="tbcaption">
              &nbsp;</td>
            </tr>
            <tr>
              <td width="100%" height="15" colspan="3">
        <hr noshade size="1" color="#FF9933">
              </td>
            </tr>
          </table>
        <p class="ArticleH2">Introduction</p>
        <p>This article will show you how to create a server component using 
        Internet Transfer Control. I shall talk about the ITC (Internet Transfer 
        Control) in more detail shortly but first of all let’s see why do we 
        need this component. This component can be used to download files from 
        the Internet especially the image files. You might find some download 
        components on the Internet which will allow you to download text or html 
        files but have you ever tried to download a binary file with such 
        components? This component will show you how to download binary files 
        from the Internet. The component was created in VB and has been tested 
        in both VB and ASP. You can download images from your local intranet as 
        well as from the remote sites. Today’s applications are expected to 
        extend their reach globally. An application should be able to download 
        files from any computer connected to the Internet. Luckily, Microsoft 
        has created an ActiveX control that makes accessing files on the 
        Internet much easier.</p>
        <p class="ArticleH2">Internet Transfer Control</p>
        <p>Internet Transfer Control can be used to send and retrieve documents 
        across the net. This control uses File Transfer Protocol (FTP) and 
        Hypertext Transfer Protocol (HTTP). Using FTP, the user can send and 
        retrieve files from any system connected to the Internet. Users can 
        perform actions such as rename and delete files, create and remove 
        directories, etc. ITC is a very handy control for the VB programmers. 
        Basically, Internet is used for transferring data and ITC helps 
        programmers to utilize Internet in a better way. All of the 
        functionality of ITC is implemented through it’s methods, and it 
        requires no interface.</p>
        <p>ITC supports both synchronous and asynchronous transfers. In 
        synchronous transfer, you can make the system wait until the transfer is 
        complete and in asynchronous transfer, the system can work as usual 
        while at the back end the file is transferred. ITC has many methods and 
        properties which we can not discuss here in detail; you can refer to 
        MSDN for complete documentation.</p>
        <p>I will show you how to create and test this component in steps which 
        will make it easier for you to understand the functionality. Through out 
        the article, I will discuss methods and properties used in the 
        component.</p>
        <p class="ArticleH2"><i>Step 1: Creating the project</i></p>
        <p>Start a new “ActiveX DLL” project. Assign a valid name to the 
        project; I have named it “HTTP”. Assign a name to the class module. I 
        have named the class “DLoad”.</p>
        <p class="ArticleH2"><i>Step 2: Adding a form</i></p>
        <p>Add a form to the current ActiveX project. This step was necessary so 
        that we could place the Internet Transfer Control on a form. Through 
        this form, we will access the control’s methods and properties. I have 
        done this to make programming simpler and it would be much easier for 
        the beginners to understand and use the control. Remember, we could have 
        accessed the control directly in the DLL project and accessed its 
        methods but to keep the task simpler, I have included a form to place 
        the ITC on.</p>
        <p class="ArticleH2"><i>Step 3: Adding functionality</i></p>
        <p>First of all, we are going to add some properties to the class 
        module. You can use class builder utility for this purpose. Add the 
        following properties to the class:</p>
        <ul type="square">
          <li>Status</li>
          <li>ProxyAddress</li>
          <li>RemotePort1</li>
          <li>RemoteHost1</li>
          <li>Protocol1</li>
        </ul>
        <p>Let’s discuss these properties one by one. The first property will be 
        used to display the status of the file transfer. The following messages 
        are displayed:</p>
        <ul type="square">
          <li><i>URL not provided </i><br>
          This message is displayed if the correct URL is not provided or is not 
          provided at all. <br>
&nbsp;</li>
          <li><i>Timed Out </i><br>
          This message is displayed when the time out occurs. <br>
&nbsp;</li>
          <li><i>Server not found </i><br>
          If the computer from where the file is to be downloaded is not found 
          then this error message is displayed. <br>
&nbsp;</li>
          <li><i>File not found </i><br>
          If the file is not found on the remote computer, then this message 
          will tell the user that the file could not be found. <br>
&nbsp;</li>
          <li><i>File was downloaded successfully </i><br>
          This message is displayed if the file is successfully retrieved and 
          downloaded to the system.</li>
        </ul>
        <p>The second property is used to get proxy address from the user. ITC’s 
        this property is used to set or get the name of the proxy server used to 
        access the Internet.</p>
        <p>The third property will be used to connect to the remote port of the 
        server. ITC’s this property is used to set or get the port number of the 
        remote system to which the control connects.</p>
        <p>The fourth property is used to access the remote host. ITC’s this 
        property is used to set or get the address of the remote system to which 
        the control sends and/or receives data.</p>
        <p>The fifth property is used to set the protocol that we are going to 
        use in this component. As already discussed, there are two protocols 
        used in the ITC. We shall use the HTTP protocol in our component.</p>
        <p>Now let’s move on to the main function. Declare the function as 
        below:</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
        <p class="code"><font color="#000080">Public Function</font> DLoad(<font color="#000080">ByVal</font> strURL
        <font color="#000080">As String</font>, <font color="#000080">Optional ByVal</font> sOutPutFile
        <font color="#000080">As String</font>)</p>
    </td>
  </tr>
</table>
        <p>Two parameters are passed to the function, the first one is the 
        string containing the address of the file to be downloaded and the 
        second parameter is the string containing the name and path of the 
        output file to be generated. File handling routine is not included in 
        this component; this will have to be incorporated in the ASP script or 
        the VB application, which ever is used as a test driver.</p>
        <p>Next, declare variables that will be used through out the class 
        module, these are following:</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <p class='code'><font color="#000080">Dim</font> bytes() 
      <font color="#000080">As Byte </font> <br>
      <font color="#000080">Dim</font> fn <font color="#000080">As Integer
      </font> <br>
      <font color="#000080">Dim</font> msg <font color="#000080">As String</font> <br>
      <font color="#000080">Dim</font> buf <font color="#000080">As String
      </font> <br>
      <font color="#000080">Dim</font> fnf <font color="#000080">As Integer
      </font> <br>
      <font color="#000080">Dim</font> snf <font color="#000080">As Integer
      </font> <br>
      <font color="#000080">Dim</font> tout <font color="#000080">As Integer
      </font> <br>
      <font color="#000080">Dim</font> OK <font color="#000080">As Integer
      </font> <br>
      <font color="#000080">Dim</font> tempbuf <font color="#000080">As String
      </font> <br>
      <font color="#000080">Dim</font> strResult <font color="#000080">As String</font></p>
    </td>
  </tr>
</table>
        <p>Bytes() is the array of bytes which will contain the downloaded 
        material. “fn” will contain the number of the file which will be opened 
        to be written to. Other important variables include “buf”, “fnf”, “snf” 
        and “tout”. “buf” is a buffer which will contain the data. “fnf” stands 
        for “file not found” and will contain the number of files not found. 
        “snf” stands for “server not found” and will contain the number of 
        remote addresses not found. “tout” stands for “timed out” and will 
        contain the number of timed out messages. “strResult” will contain the 
        downloaded string.</p>
        <p>Next, set the properties to default values if no values are provided 
        by the user.</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre class="code"><font color="#008000">'Set the transfer protocol</font>
<font color="#000080">If Not</font> Protocol1 = &quot;&quot; <font color="#000080">Then</font>
    Form1.Inet1.Protocol = icHTTP
    <font color="#000080">ElseIf</font> Protocol1 = &quot;http&quot; <font color="#000080">Or</font> Protocol1 = &quot;HTTP&quot; <font color="#000080">Then</font>
        Form1.Inet1.Protocol = icHTTP
<font color="#000080">Else</font>
       Form1.Inet1.Protocol = icHTTP
<font color="#000080">End If</font>

<font color="#008000">'Set the Access Type to Default</font>
Form1.Inet1.AccessType = icUseDefault

<font color="#008000">'Set the proxy address</font>
<font color="#000080">If Not</font> ProxyAddress = &quot;&quot; <font color="#000080">Then</font>
    Form1.Inet1.Proxy = ProxyAddress
<font color="#000080">End If</font>
    
<font color="#000080">If Not</font> RemotePort1 = &quot;&quot; <font color="#000080">Then</font>
    Form1.Inet1.RemotePort = RemotePort1
<font color="#000080">End If</font></pre>
    </td>
  </tr>
</table>
        <p>Notice the way we are accessing the control’s properties. Set the 
        protocol to HTTP. HTTP protocol is a stateless protocol. Originally, 
        HTTP was designed for the transmission of text but it can be used to 
        transfer binary files as well. Set the AccessType property to default. 
        AccessType specifies how the control will access the Internet. There are 
        three possible settings for this property:</p>
        <ul type="square">
          <li><i>icUseDefault</i> The control uses the access settings that are 
          specified in the Windows registry to access the Internet. <br>
&nbsp;</li>
          <li><i>icDirect</i> The control has a direct connection to the 
          Internet. <br>
&nbsp;</li>
          <li><i>icNamedProxy</i> The control uses a proxy server. The proxy 
          server must be specified in the control’s Proxy property.<br>
&nbsp;</li>
        </ul>
        <p>Similarly, set the remotehost and remoteport property which are 
        supplied by the user.</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre class="code"><font color="#000080">On Error Resume Next</font>

<font color="#000080">If</font> strURL = &quot;&quot; <font color="#000080">Then</font>
    Status = &quot;URL not provided&quot;
<font color="#000080">    Exit Function
End If</font>

Form1.Inet1.URL = strURL
bytes() = Form1.Inet1.OpenURL(, icByteArray)

strResult = Form1.Inet1.OpenURL(strURL, icString)

<font color="#008000">'Essential to avoid tying up the system</font>
<font color="#000080">Do Until</font> Form1.Inet1.StillExecuting = <font color="#000080">False</font> <font color="#008000">' WAIT Downloading..</font>
 DoEvents
<font color="#000080">Loop</font>
</pre>
    </td>
  </tr>
</table>
        <p>We have used the OpenURL method of the control to retrieve the 
        content from the remote file. The easiest way to use the Internet 
        Tranfer Control is with the OpenURL method. Two parameters are passed to 
        this method. The first parameter is the URL of the file to be downloaded 
        and the second parameter is the datatype which will tell the control 
        about the datatype of the content to be downloaded from the remote 
        server. This can be text or binary. If you want to download file from a 
        FTP server then the URL parameter should contain something like this:</p>
        <blockquote>
        <p><i>ftp://ftp.server.com/test.htm</i></p>
        </blockquote>
        <p>In case of HTTP, provide the URL in the format shown below:</p>
        <blockquote>
        <p><i>http://www.server.com/image1.gif</i></p>
        </blockquote>
        <p>Data type is the type of data being retrieved; this can be text or 
        binary. The values that can be provided to this parameter are as 
        following:</p>
        <ul type="square">
          <li><i>icString</i> Use this type if you want to download the data as 
          a string. <br>
&nbsp;</li>
          <li><i>icByteArray</i> Use this datatype if you want to download the 
          data as a binary.</li>
        </ul>
        <p>We have used the URL property of the control to assign the URL of the 
        file to be downloaded to the control. We have used the OpenURL method 
        twice, first time, to retrieve the actual data and second time to 
        retrieve the data as a text. I know this is an inefficient way but I did 
        this just for demonstration purposes. The data is retrieved as a text 
        because the first 50 chars of the downloaded string contain the error 
        messages, if any.</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre class="code"><font color="#000080">Do Until</font> Form1.Inet1.StillExecuting = <font color="#000080">False</font> <font color="#008000">' WAIT Downloading..</font>
 DoEvents
<font color="#000080">Loop</font>
</pre>
    </td>
  </tr>
</table>
        <p>Lets bring our focus to the statement above, what we are doing is 
        checking the status of the control, this is important as we want the 
        system to wait for the control to complete the transfer. If 
        “StillExecuting” is true then it means that the control is still busy 
        downloading the file.</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre class="code">tempbuf = bytes()

<font color="#008000">'If the URL returned any thing, put the first
'50 characters in a buffer, Error messages
'will be found here.</font>
<font color="#000080">If</font> Len(strResult) &gt; 50 <font color="#000080">Then</font>
    buf = Left(strResult, 100)
<font color="#000080">Else</font>
    buf = bytes()
<font color="#000080">End If</font>

<font color="#008000">'Catch a time out error</font>
<font color="#000080">If</font> Err = 35761 <font color="#000080">Then</font>
    tout = tout + 1
    Status = &quot;Timed out: &quot; &amp; tout
    Err.Clear
    <font color="#000080">Exit Function</font>

<font color="#008000">'If nothing is returned, it usually means
'that the server was not found.</font>
<font color="#000080">ElseIf</font> tempbuf = &quot;&quot; <font color="#000080">Then</font>
    snf = snf + 1
    Status = &quot;Server not found: &quot; &amp; snf
    <font color="#000080">Exit Function</font>

<font color="#008000">'if nothing is returned, it usually means that
'the server was found, but the requested file was
'not present.</font>

<font color="#000080">ElseIf</font> InStr(1, buf, &quot;404&quot;) <font color="#000080">Then</font>
    fnf = fnf + 1
    Status = &quot;File not found: &quot; &amp; fnf
<font color="#000080">    Exit Function
Else</font>
<font color="#008000">'Otherwise, everything is OK</font>
    OK = OK + 1
    Status = &quot;File was downloaded successfully: &quot; &amp; OK
   
<font color="#000080">End If</font></pre>
    </td>
  </tr>
</table>
        <p>If the downloaded string is larger than 50 chars then transfer the 
        first 100 characters to the buffer so that the error messages can be 
        searched for. 35761 is the time out error.</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre><font color="#008000">'Get a file number</font>
fn = FreeFile
    
<font color="#008000">'Open a binary file and load data into it!</font>
<font color="#000080">Open</font> sOutPutFile <font color="#000080">For Binary Access Write As</font> #fn
<font color="#000080">Put</font> #fn, , bytes()
DoEvents
<font color="#008000">'Close the open file</font>
<font color="#000080">Close</font> #fn
</pre>
    </td>
  </tr>
</table>
        <p>Now its time to write the information retrieved from the remote 
        server to the local file. We have used FreeFile function here, FreeFile 
        function returns an integer representing the next file number available 
        for use by the open statement.1 – 255 file numbers can be used to open 
        files not accessible to other applications. Use file numbers in the 
        range 256 – 511 for files accessible from other applications. 
        SOutPutFile is the name of the output file provided by the user. We have 
        opened the file for binary access. Put the downloaded bytes into the 
        newly opened file. After writing the content to the file, close the 
        file. That’s it. I used this component to download image files from 
        remote computers and it always worked fine.</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre><font color="#000080">Private Sub</font> Class_Terminate()
<font color="#000080">Set</font> Form1 = <font color="#000080">Nothing</font>
<font color="#000080">End Sub</font>
</pre>
    </td>
  </tr>
</table>
        <p>In the class_terminate() event of the class, destroy the form on 
        which we placed the control.</p>
        <p class="ArticleH2"><i>Step 4: Compile the project</i></p>
        <p>It’s time to compile the project. From the file menu, select the 
        “Make HTTP.dll”. The component is automatically registered on the 
        computer where it is compiled but to register it on other computers, you 
        will have to register it manually. Use regsvr32.exe to register the 
        component manually.</p>
        <p class="ArticleH2"><i>Step 5: Testing the component</i></p>
        <p>Lets test the component in VB first. It is always good practice to 
        test the component in VB before taking it to the ASP. If you find an 
        error while using the component in ASP then it will be quite laborious 
        to recompile the component with new changes added to it. If such a 
        situation occurs, then stop the IIS services and always unregister the 
        component before deleting it, if you decide to do so. To unregister the 
        component, use the following command:</p>
        <p class="code">Regsvr32.exe /u component.dll</p>
        <p>Recompile the component and start the IIS services. To test the 
        component in VB, add a standard EXE project to the current project. Add 
        two command buttons on the form, change the caption of one button to 
        “Test Dload Component” and change the caption of the other button to 
        “Exit”</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre class="code"><font color="#000080">Private Sub</font> Test_Click()

<font color="#000080">    Dim</font> objHTTP <font color="#000080">As New</font> HTTP.DLoad
<font color="#000080">    Dim</font> strURL <font color="#000080">As String</font>
    objHTTP.Protocol1 = icHTTP
    objHTTP.ProxyAddress = &quot;&quot;
    objHTTP.RemotePort1 = 80
    strURL = &quot;http://server/application/images/image1.gif&quot;
    objHTTP.DLoad strURL, &quot;c:\test.gif&quot;
    MsgBox objHTTP.Status

<font color="#000080">    Set</font> objHTTP = <font color="#000080">Nothing</font>

<font color="#000080">End Sub</font>
</pre>
    </td>
  </tr>
</table>
        <p>The test code is pretty simple. Set the property values and provide 
        the name of the file to be download. Use the code below to test the 
        component in ASP:</p>
        <table border='0' width='90%' bgcolor='#F8F8F8' cellspacing='0' cellpadding='2'>
  <tr>
    <td width='100%'>
      <pre class="code"><font color="#000080">Dim</font> objHTTP 
<font color="#000080">Set</font> objHTTP = server.createobject(“HTTP.Dload”)
<font color="#000080">Dim</font> strURL
objHTTP.Protocol1 = icHTTP
objHTTP.ProxyAddress = &quot;&quot;
objHTTP.RemotePort1 = 80
strURL = &quot;http://server/application/images/image1.gif&quot;
objHTTP.DLoad (strURL, &quot;c:\test.gif&quot;)
response.write objHTTP.Status

<font color="#000080">Set</font> objHTTP = <font color="#000080">Nothing</font>
</pre>
    </td>
  </tr>
</table>
        <p>You will find the string (string containing the name of the file to 
        be downloaded) parsing code in the ASP file provided with this article.</p>
        <p>ASP and VB code is provided with this article. ASP code contains two 
        asp pages, form1.asp is the initial form and the results from form1.asp 
        are passed to the form2.asp. In form2.asp, object is created and the 
        values from form1.asp are passed to the object.</p>
        <p>VB code contains a form and values that are to be passed to the 
        object are hard coded in the form, you can change the values to test the 
        functionality.</p>
        <p class="ArticleH2">Summary</p>
        <p>This article shows you how to create a server component that can be 
        used to download files from web sites. This component is especially 
        designed to download binary files including image files. You can 
        download images from any computer connected to the Internet.</p>
        <p class="ArticleH2">About the Author</p>
        <p>S.S. Ahmed is a senior software engineer in a software development 
        company that specializes in web application development. To contact 
        Ahmed with questions or comments, please email him at
        <a href="mailto:ss_ahmed1@hotmail.com">ss_ahmed1@hotmail.com</a>.</p>
        <p>&nbsp;</p>
<p>        
    <hr noshade color="#FF9933">
    <table width="90%" align="center" border="0">
      <tr>
        <td width="25%">
          <img border="0" src="../../images/comments.gif">
        </td>
        <td width="75%">
          Please, post here only feedback for the article/tutorial/sample you
          have read above.<br>
          If you have any question and like to get an answer, post your messages in the <a href="http://www.vbip.com/forum/">Forum</a>.
        <td>
      </tr>
    </table>
    
    
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?392">Synchronous vs Asynchronous </a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">Brady Kelly Monday, June 25, 2001</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?415">inet control in dll</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">pete Thursday, July 12, 2001</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?438">Won't download ASP generated files</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">Jerry Thompson Monday, July 30, 2001</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?453">What about https?</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">Cristian Grigoriu Saturday, August 04, 2001</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?566">This is not a server.</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">Mark Wednesday, October 17, 2001</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?643">ULOAD Method</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">SGR Friday, December 14, 2001</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?707">This code is full of errors !!</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">Jo Tuesday, January 22, 2002</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?795">http</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">harikrishna Saturday, March 30, 2002</font></i>	
			</p>
			
			<p><b><font face="Arial" size="2" color="#800000"><a href="../../comment.asp?825">Want to Keep track of Download File</a></font></b><br>
			<i><font color="#808080" face="Times New Roman" size="2">Chaitanya S Tembe Thursday, April 18, 2002</font></i>	
			</p>
			
        <p>
        <form name="newcomm" method="POST" action="../../add_comments.asp">
          <p><input align="right" border="0" src="../../images/addyours2.gif" name="I1" type="image"></p>
          <input type="hidden" name="page" value="/itc/itc-http-component-01.asp">
          <input type="hidden" name="title">
	  <input type="hidden" name="actionID" value="add">
        </form>
        <SCRIPT LANGUAGE="JavaScript">
        	{document.newcomm.title.value = document.title}
        </SCRIPT>
	<br>
        <p>
        <hr noshade color="#FF9933">
</p>   
      </blockquote>
<p><center>
<!-- start BITS ad HTML -- bottom of page 468x60 banner www.bitsonthewire.com         --> 
  <iframe src="http://ads.bitsonthewire.com/admgriframe.asp?siteid=1126&ad_type=2" width=468 height=60 marginwidth=0 marginheight=0 hspace=0 vspace=0 frameborder=0 scrolling=no> 
    <a href="http://ads.bitsonthewire.com/adrdrmanager.asp?loc=2">
      <p>
      <img border="0" src="http://ads.bitsonthewire.com/admanager.asp?loc=2&siteid=1126&ad_type=2">
    </a>
  </iframe> 
<!-- stop BITS ad HTML -- bottom of page 468x60 banner                                --> 
</center></p>
    </td>
</table>
<table border="1" width="100%" cellspacing="1" cellpadding="2" bordercolor="#800000">
  <tr>
    <td width="100%" bgcolor="#FF9933">
      <font color="#FFFFCC">
      <table border="0" width="100%" cellspacing="0" cellpadding="0">
        <tr>
          <td width="37%"></td>
          <td width="63%">
      <font color="#FFFFCC">
            <p align="right" class="tbcaption">
            <a href="../default.asp" class="tbcaption">Home</a> -
            <a href="../tools.asp" class="tbcaption">Tools&amp;Technologies</a> -
            <a class="tbcaption" href="../itc">ITC</a> - 
            HTTP Transfer Component
          </font>
          </td>
        </tr>
      </table>
      </font>
    </td>
  </tr>
</table>
&nbsp;<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="121" valign="top">
<!-- START OF WEBTRENDS LIVE TAG -->
<!-- Copyright 2001 NetIQ Corporation -->
<!--  For privacy concerns, check our Privacy Policy at http://www.webtrendslive.com/privacy_policy.htm -->
<SCRIPT LANGUAGE="JavaScript">
<!--
// Modification of this code is not allowed and will permanently disable your account!
// SiteName:  Visual Basic Internet Programming
function wtl_Tag4_27048()
{
	function D8( d)
	{
		var fwd=1, seed= new Date('01/01/2000'), key= "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
		var s= key.charAt( d.getFullYear()-2000)+key.charAt( d.getMonth()+1)+key.charAt( d.getDate());
		s+= key.charAt( d.getHours())+key.charAt( d.getMinutes())+key.charAt( d.getSeconds());
		while( seed.getDay()!=fwd) seed= new Date(seed.getTime() + 86400000);
		var w= Math.floor( (d.getTime()-(seed.getTime()+86400000)) / 604800000 );
		s+= key.charAt( (w-(w%16))/16 );
		s+= key.charAt( w%16);
		return s;
	}

	var t = new Date();
	var W="tagver=4&si=27048&fw=1&bn=13";
	W+="&tz="+escape(t.getTimezoneOffset());
	W+="&ch="+escape(t.getHours());
	W+="&cl="+escape(D8(t));
	W+="&ti="+escape(document.title);
	W+="&url="+escape(window.document.URL);
	W+="&rf="+escape(window.document.referrer);
	W+="&js=Yes";
	W+="&ul="+(navigator.appName=="Netscape"?navigator.language:navigator.userLanguage);
	if(typeof(screen)=="object")
	{
	W+="&sr="+screen.width+"x"+screen.height;
	W+="&cd="+screen.colorDepth;
	W+="&jo="+(navigator.javaEnabled()?"Yes":"No");
	}
	
	
	document.write('<A TARGET="_blank" HREF="http://www.webtrendslive.com/redirect.asp?siteID=27048">');
	document.write('<IMG ID="WTL_TAG" BORDER="0" WIDTH="100" HEIGHT="30" ALT="This Site Tracked by WebTrendsLive." SRC="http://p.wtlive.com/S003-00-9-14-186109-27048/button4.asp?'+W+'">');
	document.write('</A>');
	
}	

wtl_Tag4_27048();
//-->
</SCRIPT>


<NOSCRIPT>
<A TARGET="_blank" HREF="http://www.webtrendslive.com/redirect.asp?siteID=27048">
<IMG BORDER="0" WIDTH="100" HEIGHT="30" ALT="This Site Tracked by WebTrendsLive." SRC="http://p.wtlive.com/S003-00-9-14-186109-27048/button4.asp?tagver=4&si=27048&fw=1&bn=13&js=No&"></A></NOSCRIPT>


<!-- END OF WEBTRENDS LIVE TAG -->

     
      </td>
    <td>
<p align="center" class="barsidecaption"><a href="../default.asp">Home</a> | <a href="../whatsnew.asp">What's
New</a> | <a href="../tools.asp"> Tools
&amp; Technologies</a> | <a href="../resources.asp">Resources</a> | <a href="../resources/books/default.asp">Books</a>
 | <a href="../forum/">Forum</a></p>
<p align="center" class="barsidecaption">Report about any problems and errors to <a href="mailto:webmaster@vbip.com">webmaster@vbip.com</a><br>
Copyright © 1998 - 2002 by <a href="mailto:oleg@vbip.com"> Oleg Gdalevich</a></p>
    </td>
    <td valign="top" width="140">
<p align="center">
<a target="_blank" href="http://www.amazon.com/exec/obidos/ASIN/B00005AFI2/vbipvisualbasici">
<img border="0" src="../images/frontpage_button.gif" align="right" width="100" height="38"></a>
    </td>
  </tr>
</table>
</body>

</html>
